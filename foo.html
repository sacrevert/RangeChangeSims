<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<script type="text/javascript"><!--
function showVariable(name, symIds)
{

  var ids = symIds[name];
//  alert("showing symbols " + name + " " + ids.length);
  for(var i =0; i < ids.length; i++) {
     var el = document.getElementById(ids[i]);
     el.className = "showSymbol";
  }

}

function hideVariable(name, symIds)
{

  var ids = symIds[name];
  for(var i =0; i < ids.length; i++) {
     var el = document.getElementById(ids[i]);
     el.className = "symbol";
  }

}
--></script><script type="text/javascript">var symIdentifiers = {
 ".": [ "sym10", "sym21", "sym31", "sym182", "sym191", "sym1392", "sym2031", "sym2125" ],
"...": "sym1427",
"a": [ "sym629", "sym669", "sym898", "sym1315" ],
"alpha": [ "sym368", "sym369", "sym920", "sym929", "sym934", "sym1172" ],
"Alpha": "sym1954",
"ann_persit_rate": [ "sym826", "sym841" ],
"as.R.obj": "sym2007",
"b": [ "sym630", "sym670", "sym1316" ],
"B2_IncrnVisit": [ "sym720", "sym757", "sym762" ],
"B2C1_IncVsShtEv": "sym755",
"B2C2_IncVsShtIn": "sym760",
"B3f_IncrnVBiasFc": "sym725",
"balance": [ "sym2254", "sym2258" ],
"Ball_model": [ "sym1618", "sym1631", "sym1632", "sym1656", "sym1669", "sym1670" ],
"bench_thresh": [ "sym1958", "sym1963" ],
"bias": "sym2143",
"bias_focal": "sym543",
"binomial": [ "sym147", "sym216", "sym224", "sym404", "sym417", "sym1498", "sym1516", "sym1543", "sym1564", "sym1585", "sym1622", "sym1660", "sym1695" ],
"bsh1": [ "sym598", "sym636", "sym679" ],
"bsh2": [ "sym599", "sym637", "sym680" ],
"bugs_data": [ "sym1822", "sym1836", "sym1841", "sym1843", "sym1852", "sym1856", "sym1860", "sym1862", "sym1864", "sym1866", "sym1879" ],
"BUGSoutput": "sym1888",
"C1_pShortLEven": "sym730",
"C2_pShortLIncr": "sym734",
"cast_recs": "sym3",
"castrecs": [ "sym5", "sym17", "sym33", "sym34", "sym35", "sym36", "sym39", "sym40", "sym42", "sym43", "sym44", "sym45", "sym46" ],
"CellID": [ "sym523", "sym524" ],
"CI": "sym464",
"coef": [ "sym406", "sym419", "sym1501", "sym1521", "sym1550", "sym1553", "sym1557", "sym1558", "sym1571", "sym1574", "sym1578", "sym1579", "sym1592", "sym1595", "sym1599", "sym1600", "sym1623", "sym1661", "sym1696", "sym1921", "sym1935" ],
"coefficients": [ "sym58", "sym60", "sym78", "sym81" ],
"coefs": [ "sym148", "sym154", "sym157", "sym158", "sym226", "sym232", "sym238" ],
"col": [ "sym1017", "sym1021" ],
"cols": [ "sym1973", "sym1976" ],
"combos": [ "sym753", "sym869", "sym880", "sym1089", "sym1117" ],
"confintRd": "sym353",
"Convert_records_to_2tp": "sym84",
"create_data": "sym656",
"create_data_1": "sym569",
"create_data_2": "sym592",
"create_data_3": "sym620",
"cYr": [ "sym199", "sym212", "sym221", "sym1532", "sym1540", "sym1562", "sym1583" ],
"d1": [ "sym99", "sym115" ],
"d2": [ "sym104", "sym116" ],
"D2_SelectvIncr": "sym739",
"data": [ "sym164", "sym170", "sym171", "sym172", "sym174", "sym176", "sym179", "sym188", "sym530", "sym539" ],
"DATATYPE2": "sym1853",
"DATATYPE3": "sym1857",
"datecode": [ "sym983", "sym1012", "sym1153", "sym1216", "sym1261" ],
"decline": [ "sym712", "sym749", "sym774", "sym801", "sym814", "sym815", "sym816", "sym818", "sym819", "sym820", "sym825", "sym827", "sym942", "sym1087", "sym1110", "sym1191" ],
"detected": [ "sym1414", "sym1417", "sym1421" ],
"DetP": "sym696",
"disadvantage": [ "sym545", "sym546", "sym556" ],
"distribution": [ "sym322", "sym324", "sym341", "sym346", "sym357", "sym359", "sym365" ],
"dtype2.p": "sym1789",
"dtype2p_max": [ "sym1844", "sym1863" ],
"dtype2p_min": [ "sym1842", "sym1861" ],
"dtype3.p": "sym1791",
"dtype3p_max": "sym1867",
"dtype3p_min": "sym1865",
"er": [ "sym1185", "sym1193", "sym1194", "sym1195", "sym1198", "sym1200", "sym1202" ],
"error_rate": [ "sym914", "sym950" ],
"error_rates": [ "sym886", "sym902", "sym946", "sym963", "sym975", "sym978", "sym979", "sym982", "sym985", "sym1173" ],
"error_report": [ "sym2167", "sym2172" ],
"extinctions": [ "sym838", "sym844" ],
"F": [ "sym162", "sym163", "sym657", "sym700", "sym702", "sym703", "sym783", "sym813", "sym888", "sym891", "sym1016", "sym1067", "sym1068", "sym1070", "sym1071", "sym1072", "sym1189", "sym1192", "sym1310", "sym1361", "sym1875", "sym1891", "sym2061", "sym2162" ],
"F_NfDecline": "sym745",
"failures": [ "sym194", "sym211", "sym220", "sym1611", "sym1620", "sym1647", "sym1658", "sym1683", "sym1693" ],
"fit_LadybirdMM": "sym118",
"fit_ladybirdMM_bin": "sym161",
"fit_Maes": "sym242",
"fit_Maes_old": "sym431",
"fit_Telfer": "sym502",
"focal": [ "sym137", "sym141", "sym177", "sym552", "sym558", "sym561", "sym564", "sym570", "sym590", "sym593", "sym612", "sym621", "sym648", "sym658", "sym690", "sym1018", "sym1064", "sym1495", "sym1513", "sym1539", "sym1561", "sym1582", "sym1603", "sym1637", "sym1674", "sym1826", "sym2185", "sym2205", "sym2213", "sym2217" ],
"focalsites": [ "sym1489", "sym1520", "sym1636", "sym1643", "sym1653" ],
"focalspname": [ "sym15", "sym26", "sym41" ],
"fr": [ "sym49", "sym62", "sym64", "sym68", "sym75" ],
"fres_in": [ "sym1974", "sym1979", "sym1982", "sym1986", "sym1989", "sym1992", "sym1995", "sym1996", "sym1997", "sym1999" ],
"Frescalo": [ "sym1097", "sym1119", "sym1741", "sym1751", "sym1945" ],
"frescalo_bootstrap": "sym47",
"frescalo_path": [ "sym1098", "sym1742", "sym1743", "sym1755", "sym2001" ],
"frescalo_summ": [ "sym1757", "sym1759", "sym1760", "sym1762", "sym1765" ],
"frescalo_trend": "sym61",
"frst": [ "sym1948", "sym1949", "sym1953" ],
"fx": "sym1312",
"fxp": "sym1335",
"generate_all_scenarios": "sym699",
"generate_records": "sym782",
"get_all_stats": "sym864",
"get_error_rates": "sym937",
"get_summary_stats": "sym986",
"grep": "sym960",
"gridcell_counts": [ "sym109", "sym112", "sym113", "sym114", "sym117", "sym504", "sym506", "sym508", "sym510", "sym516", "sym1433", "sym1437", "sym1447", "sym1452", "sym1483" ],
"H0": [ "sym342", "sym347" ],
"Ha": "sym366",
"Hill_detectability": "sym624",
"Hill_search": "sym1410",
"HillP": "sym662",
"i": [ "sym119", "sym123", "sym124", "sym128", "sym135", "sym138", "sym146", "sym159", "sym160", "sym336", "sym338", "sym340", "sym343", "sym345", "sym348", "sym350", "sym399", "sym412", "sym791", "sym799", "sym830", "sym848", "sym850", "sym857", "sym859", "sym949", "sym967", "sym969", "sym988", "sym990", "sym992", "sym993", "sym995", "sym996", "sym998", "sym999", "sym1001", "sym1006", "sym1047", "sym1160", "sym1164", "sym1168", "sym1169", "sym1175", "sym1223", "sym1227", "sym1230", "sym1231", "sym1236", "sym1240", "sym1244", "sym1247", "sym1248", "sym1253", "sym1265", "sym1272", "sym1274", "sym1279", "sym1280", "sym1372", "sym1374", "sym1486", "sym1545", "sym1566", "sym1587", "sym1673", "sym1679", "sym1688", "sym1717", "sym1721", "sym1725", "sym1732", "sym1736", "sym1750", "sym1756", "sym1761", "sym1784", "sym1787", "sym1814", "sym1818", "sym1824", "sym1832", "sym1839", "sym2012", "sym2015", "sym2019", "sym2067", "sym2071", "sym2095", "sym2101", "sym2150", "sym2153", "sym2161", "sym2171", "sym2264", "sym2269" ],
"id": [ "sym780", "sym871", "sym882", "sym906", "sym910", "sym1088", "sym1121", "sym1127", "sym1395", "sym1403", "sym2010" ],
"ignore.first": "sym1180",
"incidental_records": "sym1015",
"inclMM": [ "sym1096", "sym1118", "sym1714", "sym1718" ],
"increment": [ "sym544", "sym557", "sym1034", "sym1040", "sym2021", "sym2040", "sym2083", "sym2091", "sym2108", "sym2116" ],
"indata": [ "sym165", "sym236" ],
"init": [ "sym1039", "sym1781", "sym1785", "sym1788", "sym1790", "sym1792", "sym1795", "sym1847", "sym1870", "sym1874", "sym2084", "sym2088", "sym2109", "sym2113" ],
"init.vals": [ "sym1871", "sym1880" ],
"initiate": "sym1780",
"is.gridcell.wellsampled": "sym521",
"is.gridcell.wellsampled2": "sym528",
"iterate_all_scenarios": "sym1066",
"j": [ "sym832", "sym837", "sym842", "sym846", "sym1158", "sym1165", "sym1171", "sym1174", "sym1221", "sym1228", "sym1234", "sym1237", "sym1238", "sym1245", "sym1251", "sym1254", "sym1267", "sym1275", "sym1282" ],
"k": [ "sym602", "sym638" ],
"L": [ "sym121", "sym166", "sym1497", "sym1500", "sym1515", "sym1518", "sym1541", "sym1546", "sym1563", "sym1567", "sym1588", "sym1840", "sym1855", "sym1859", "sym2183", "sym2198", "sym2203", "sym2229", "sym2233", "sym2237", "sym2241" ],
"L1": [ "sym1199", "sym1387" ],
"length": [ "sym183", "sym533", "sym1393", "sym1610", "sym1646", "sym1682", "sym1805", "sym2032", "sym2126" ],
"LenUniq": [ "sym11", "sym22", "sym91", "sym98", "sym1130", "sym1931", "sym2082", "sym2107", "sym2194" ],
"LL": "sym2049",
"LL.p": "sym1786",
"LL_mm_SS": [ "sym1538", "sym1554" ],
"LL_model": [ "sym1494", "sym1509", "sym1510" ],
"LL_model2": [ "sym1512", "sym1529", "sym1530" ],
"LL_SS": [ "sym1560", "sym1575" ],
"logL": "sym1837",
"lost": [ "sym560", "sym566" ],
"lower": [ "sym1981", "sym1990" ],
"Maes": [ "sym421", "sym426", "sym428", "sym430", "sym492", "sym497", "sym499", "sym501", "sym1462", "sym1468", "sym1470", "sym1472", "sym1478", "sym1480" ],
"Maes_fit": [ "sym384", "sym388", "sym390", "sym395", "sym408", "sym420", "sym424", "sym425" ],
"max": "sym1775",
"max_vis": "sym1352",
"maxN": "sym1268",
"maxV": [ "sym1317", "sym1340" ],
"median": "sym1004",
"median_occ": "sym1132",
"Method": [ "sym1205", "sym1206" ],
"method_cols": [ "sym1149", "sym1157", "sym1161", "sym1163", "sym1167" ],
"min": "sym1423",
"min_sp": [ "sym266", "sym450" ],
"min_sq": [ "sym518", "sym1439", "sym1449", "sym1453", "sym1465", "sym1475" ],
"MM": [ "sym140", "sym149", "sym209", "sym218", "sym227", "sym1706", "sym1708", "sym1709", "sym1710", "sym1713", "sym1719", "sym1723", "sym1724", "sym1726", "sym1729", "sym1730", "sym1734", "sym1735", "sym1737", "sym1740" ],
"mm_SS": [ "sym1581", "sym1596" ],
"MMdata": [ "sym120", "sym126", "sym131", "sym133", "sym136", "sym145", "sym155", "sym178", "sym184", "sym185", "sym186", "sym193", "sym195", "sym198", "sym200", "sym202", "sym206", "sym208", "sym215", "sym223", "sym233", "sym235", "sym1715", "sym1720" ],
"mod": [ "sym53", "sym57", "sym59", "sym72", "sym77", "sym80", "sym400", "sym405", "sym413", "sym418" ],
"model_file": [ "sym1876", "sym1882" ],
"model1": [ "sym511", "sym520" ],
"mv": [ "sym713", "sym750", "sym777", "sym794", "sym853", "sym1091", "sym1113" ],
"my": [ "sym130", "sym143" ],
"n": [ "sym50", "sym278", "sym284", "sym288", "sym292", "sym296", "sym299", "sym302", "sym323", "sym327", "sym358", "sym362", "sym392", "sym402", "sym427", "sym462", "sym466", "sym468", "sym479", "sym481", "sym527", "sym538", "sym1322", "sym1325", "sym1329", "sym1331", "sym1332", "sym1334" ],
"n_valid_reps": [ "sym895", "sym899", "sym900", "sym904" ],
"n1": [ "sym85", "sym110", "sym505", "sym517", "sym1438", "sym1442", "sym1443", "sym1446", "sym1448" ],
"n2": [ "sym92", "sym111", "sym509", "sym1440", "sym1441", "sym1445", "sym1450" ],
"name": [ "sym1135", "sym1139", "sym1904", "sym1913" ],
"nb": [ "sym1768", "sym1886" ],
"nc": [ "sym1770", "sym1872", "sym1883" ],
"ni": [ "sym1767", "sym1884" ],
"nInc": [ "sym1023", "sym1029", "sym1037", "sym1046", "sym1054" ],
"nonfocal": [ "sym2181", "sym2221", "sym2225" ],
"NRecMod": [ "sym1918", "sym1924", "sym1925" ],
"nreps": [ "sym1077", "sym1102", "sym1177", "sym1179", "sym1182", "sym1184" ],
"nS": [ "sym1285", "sym1288", "sym1342", "sym1351", "sym1359" ],
"nSite": [ "sym1323", "sym1327", "sym1339" ],
"nSites": [ "sym571", "sym580", "sym584", "sym594", "sym604", "sym608", "sym622", "sym640", "sym644", "sym659", "sym682", "sym686", "sym705", "sym768", "sym1079", "sym1104" ],
"NSmod": [ "sym1932", "sym1938", "sym1939" ],
"nsp": [ "sym122", "sym156", "sym167", "sym168", "sym1364", "sym1369", "sym2186", "sym2199" ],
"nSp": [ "sym626", "sym627", "sym664", "sym666" ],
"nsp_declining": [ "sym807", "sym812", "sym817", "sym821" ],
"nSpecies": [ "sym574", "sym581", "sym586", "sym597", "sym605", "sym610", "sym633", "sym635", "sym641", "sym646", "sym673", "sym678", "sym683", "sym688", "sym706", "sym767", "sym1080", "sym1103" ],
"nt": [ "sym1769", "sym1885" ],
"num_sites_recorded": [ "sym1926", "sym1933", "sym1934" ],
"num_visits_recorded": [ "sym1601", "sym1613", "sym1619", "sym1633", "sym1649", "sym1657", "sym1671", "sym1685", "sym1692", "sym1919", "sym1920" ],
"num_visits_that_year": [ "sym1606", "sym1612", "sym1640", "sym1648", "sym1677", "sym1684" ],
"num_yrs_visits": [ "sym534", "sym537" ],
"nV": [ "sym2078", "sym2093", "sym2103", "sym2118" ],
"nV_include": [ "sym2092", "sym2097", "sym2117", "sym2152", "sym2160", "sym2170" ],
"nVis": [ "sym196", "sym1370", "sym1378" ],
"nVisits": [ "sym1025", "sym1042", "sym1061", "sym1289" ],
"nVR": [ "sym187", "sym197", "sym210", "sym219" ],
"nyear": [ "sym1776", "sym1783", "sym1829" ],
"nyr": [ "sym129", "sym169", "sym173", "sym1074", "sym1100", "sym1114", "sym1488", "sym1722", "sym1733", "sym1809" ],
"nyrs": [ "sym522", "sym525", "sym526" ],
"nYrs": [ "sym709", "sym746", "sym769", "sym803", "sym828", "sym831", "sym1027", "sym1036", "sym1041", "sym1044", "sym1081", "sym1105" ],
"obs": [ "sym207", "sym214", "sym397", "sym401", "sym403", "sym410", "sym414", "sym416" ],
"occ": [ "sym834", "sym839", "sym840" ],
"Occ": [ "sym661", "sym1073", "sym1099" ],
"Occ_out": [ "sym1908", "sym1911", "sym1917" ],
"Occ_trends": [ "sym1894", "sym1897", "sym1898", "sym1900", "sym1903", "sym1905", "sym1906", "sym1907", "sym1909", "sym1912" ],
"OccMod": [ "sym1797", "sym1798", "sym1799", "sym1800", "sym1835", "sym1848", "sym1851" ],
"OccModFile": [ "sym1796", "sym1877" ],
"OccMods": [ "sym1766", "sym1794", "sym1893" ],
"OccResults": [ "sym1793", "sym1892", "sym1895" ],
"occurrence": [ "sym1", "sym32", "sym258", "sym442" ],
"od": "sym205",
"one_to_two_tail": "sym1140",
"ONR": "sym674",
"out": [ "sym1878", "sym1887" ],
"output": [ "sym866", "sym868", "sym870", "sym872", "sym874", "sym875", "sym876", "sym877", "sym879", "sym881", "sym883", "sym885", "sym887", "sym890", "sym894", "sym896", "sym907", "sym911", "sym941", "sym944", "sym948", "sym951", "sym952", "sym953", "sym954", "sym956", "sym961", "sym965", "sym973", "sym984", "sym989", "sym991", "sym994", "sym997", "sym1000", "sym1003", "sym1013", "sym1076", "sym1101", "sym1115", "sym1120", "sym1122", "sym1125", "sym1128", "sym1129", "sym1146", "sym1148", "sym1150", "sym1154", "sym1156", "sym1159", "sym1162", "sym1166", "sym1170", "sym1178", "sym1187", "sym1190", "sym1211", "sym1213", "sym1215", "sym1217", "sym1219", "sym1222", "sym1226", "sym1229", "sym1233", "sym1235", "sym1239", "sym1243", "sym1246", "sym1250", "sym1252", "sym1257", "sym1259", "sym1262", "sym1270", "sym1281", "sym1454", "sym1458", "sym1459", "sym1466", "sym1467", "sym1476", "sym1477", "sym1482", "sym1505", "sym1506", "sym1507", "sym1508", "sym1525", "sym1526", "sym1527", "sym1528", "sym1551", "sym1552", "sym1555", "sym1556", "sym1572", "sym1573", "sym1576", "sym1577", "sym1593", "sym1594", "sym1597", "sym1598", "sym1627", "sym1628", "sym1629", "sym1630", "sym1665", "sym1666", "sym1667", "sym1668", "sym1700", "sym1701", "sym1702", "sym1703", "sym1711", "sym1712", "sym1727", "sym1728", "sym1738", "sym1739", "sym1763", "sym1764", "sym1915", "sym1916", "sym1922", "sym1923", "sym1936", "sym1937", "sym1950", "sym1951", "sym1965", "sym1966", "sym1971" ],
"output_dir": [ "sym1749", "sym1754", "sym2000" ],
"p": [ "sym70", "sym79", "sym83", "sym333", "sym352", "sym915", "sym916", "sym917", "sym918", "sym919", "sym921", "sym926", "sym928", "sym932", "sym933", "sym936", "sym1141", "sym1142", "sym1143", "sym1899" ],
"p.values": [ "sym472", "sym495", "sym496" ],
"p_detect": [ "sym596", "sym601", "sym618", "sym632", "sym654", "sym672", "sym676", "sym697" ],
"p_lost": [ "sym555", "sym562" ],
"p_obs": [ "sym1416", "sym1419" ],
"p_occ": [ "sym600", "sym606", "sym634", "sym642", "sym675", "sym677", "sym684" ],
"p_sel": [ "sym2140", "sym2164" ],
"p_short": [ "sym732", "sym736", "sym758", "sym763", "sym772", "sym1022", "sym1024", "sym1035", "sym1038", "sym1085", "sym1108", "sym2022", "sym2023", "sym2039", "sym2257" ],
"p_used": [ "sym234", "sym239" ],
"p_val_cols": [ "sym893", "sym897", "sym943", "sym947", "sym957", "sym964", "sym968", "sym974", "sym1145", "sym1151" ],
"p1": [ "sym503", "sym514", "sym515" ],
"p2": [ "sym507", "sym512", "sym513", "sym519" ],
"parameters": [ "sym1779", "sym1845", "sym1846", "sym1849", "sym1850", "sym1868", "sym1869", "sym1881" ],
"path": [ "sym2005", "sym2009", "sym2016" ],
"pbinom": "sym378",
"pd": [ "sym628", "sym667" ],
"pDetMod": [ "sym741", "sym773", "sym1086", "sym1109" ],
"pFocal": [ "sym572", "sym595", "sym617", "sym623", "sym653", "sym660", "sym695", "sym707", "sym771", "sym1084", "sym1107" ],
"platform": "sym1947",
"plot_error_rates": "sym1144",
"plot_error_rates_trace": "sym1176",
"plot_summary_stats": "sym1209",
"plot_summary_stats3": "sym1255",
"plr": [ "sym1444", "sym1456", "sym1460" ],
"positive": "sym925",
"pr": [ "sym1314", "sym1318", "sym1319", "sym1320", "sym1324", "sym1326", "sym1412" ],
"prch": "sym1338",
"pRecsBench": [ "sym1960", "sym1967" ],
"prob": [ "sym573", "sym575", "sym576", "sym577", "sym578", "sym582" ],
"prop.diff": [ "sym1436", "sym1455" ],
"prop_short": [ "sym2038", "sym2045" ],
"prVis": [ "sym1355", "sym1357", "sym1362" ],
"pse": "sym665",
"pSVS": [ "sym710", "sym747", "sym770", "sym785", "sym786", "sym787", "sym790", "sym792", "sym849", "sym851", "sym1082", "sym1106", "sym1337", "sym1350" ],
"pV_include": [ "sym2087", "sym2094", "sym2112", "sym2119" ],
"pval": [ "sym377", "sym382", "sym383", "sym386", "sym1471", "sym1481" ],
"qp": [ "sym1201", "sym1207" ],
"quantile": "sym367",
"R": [ "sym625", "sym631", "sym663", "sym671" ],
"R.version": "sym1946",
"ratio": [ "sym2255", "sym2256" ],
"rbind": "sym861",
"rc": [ "sym253", "sym260", "sym268", "sym269", "sym437", "sym444", "sym452", "sym453" ],
"rc1": [ "sym259", "sym263", "sym264", "sym443", "sym447", "sym448" ],
"rc2": [ "sym267", "sym272", "sym451", "sym456" ],
"rc3": [ "sym271", "sym275", "sym279", "sym379", "sym381", "sym396", "sym398", "sym409", "sym411", "sym422", "sym423", "sym455", "sym459", "sym463", "sym493", "sym494", "sym498" ],
"rd": [ "sym274", "sym281", "sym285", "sym289", "sym293", "sym314", "sym317", "sym326", "sym330", "sym331", "sym332", "sym334", "sym361", "sym374", "sym375", "sym376", "sym380", "sym391", "sym458", "sym465", "sym473" ],
"rd.names": [ "sym283", "sym287", "sym291" ],
"record_id": [ "sym550", "sym565", "sym2056", "sym2068", "sym2074" ],
"record_id_to_lose": [ "sym563", "sym568" ],
"recording_cycle": "sym1309",
"recording_cycle_old": "sym1283",
"recording_rate_cols": [ "sym1147", "sym1152" ],
"recording_summary": [ "sym1941", "sym1970" ],
"recording_visit": "sym1409",
"records": [ "sym6", "sym13", "sym18", "sym24", "sym86", "sym93", "sym100", "sym105", "sym246", "sym248", "sym250", "sym254", "sym432", "sym434", "sym438", "sym547", "sym549", "sym551", "sym553", "sym567", "sym716", "sym719", "sym724", "sym729", "sym733", "sym738", "sym744", "sym754", "sym756", "sym759", "sym761", "sym764", "sym766", "sym779", "sym781", "sym789", "sym797", "sym800", "sym802", "sym829", "sym847", "sym856", "sym860", "sym862", "sym863", "sym1078", "sym1094", "sym1294", "sym1296", "sym1297", "sym1298", "sym1300", "sym1303", "sym1305", "sym1380", "sym1382", "sym1383", "sym1386", "sym1389", "sym1397", "sym1398", "sym1400", "sym1402", "sym1404", "sym1431", "sym1434", "sym1463", "sym1473", "sym1485", "sym1490", "sym1504", "sym1524", "sym1549", "sym1570", "sym1591", "sym1626", "sym1664", "sym1699", "sym1716", "sym1753", "sym1927", "sym1943", "sym1956", "sym1975", "sym2008", "sym2024", "sym2027", "sym2055", "sym2057", "sym2059", "sym2072", "sym2073", "sym2076", "sym2079", "sym2085", "sym2089", "sym2098", "sym2100", "sym2104", "sym2110", "sym2114", "sym2121", "sym2130", "sym2131", "sym2145", "sym2168", "sym2175" ],
"records_A": [ "sym708", "sym717", "sym721", "sym722", "sym726", "sym731", "sym735", "sym740" ],
"records_tmp": [ "sym2058", "sym2065" ],
"recs": [ "sym1026", "sym1031", "sym1032", "sym1033", "sym1043", "sym1049", "sym1050", "sym1051", "sym1052", "sym1057", "sym1059", "sym1062", "sym1065" ],
"recs_to_omit": [ "sym2062", "sym2075" ],
"recs_to_remove": [ "sym2047", "sym2054", "sym2064", "sym2066" ],
"recs_to_return": [ "sym2174", "sym2178" ],
"rem": [ "sym1328", "sym1330", "sym1333" ],
"repnum": [ "sym1196", "sym1203" ],
"RepVisit": "sym1391",
"resample": [ "sym1424", "sym2070" ],
"resolution": [ "sym4", "sym16" ],
"result": [ "sym237", "sym240", "sym241" ],
"right_direction": [ "sym923", "sym930", "sym935" ],
"rownum": "sym1828",
"rps": [ "sym1955", "sym1959", "sym1961", "sym1962", "sym1964", "sym1968", "sym1969" ],
"RRSS": [ "sym1691", "sym1704", "sym1705" ],
"run_all_methods": [ "sym1095", "sym1428" ],
"S": [ "sym668", "sym1411", "sym1413", "sym1420" ],
"sample_reps": [ "sym1181", "sym1183", "sym1186", "sym1197" ],
"sampleRd": "sym280",
"save_data": [ "sym778", "sym1083" ],
"save_records": "sym2003",
"save_to_txt": [ "sym905", "sym981", "sym1010" ],
"sc": [ "sym1214", "sym1224", "sym1232", "sym1241", "sym1249" ],
"Scenarios": [ "sym718", "sym728", "sym737", "sym742", "sym743", "sym1090", "sym1116" ],
"sf": [ "sym892", "sym980", "sym1009" ],
"shorten_lists": "sym2020",
"simdata": [ "sym1484", "sym1487", "sym1499", "sym1517", "sym1531", "sym1533", "sym1535", "sym1544", "sym1565", "sym1586", "sym1602", "sym1607", "sym1615", "sym1634", "sym1641", "sym1651", "sym1672", "sym1678", "sym1687", "sym1707", "sym1731", "sym1772", "sym1777", "sym1802", "sym1815", "sym1823", "sym1831", "sym1838", "sym1854", "sym1858", "sym1942", "sym2180", "sym2182", "sym2184", "sym2188", "sym2191", "sym2196", "sym2197", "sym2200", "sym2202", "sym2204", "sym2210", "sym2214", "sym2218", "sym2222", "sym2226", "sym2230", "sym2234", "sym2238" ],
"simpars": [ "sym867", "sym878" ],
"sims_to_frescalo": "sym1972",
"Site": [ "sym8", "sym20", "sym30", "sym89", "sym96", "sym103", "sym108", "sym127", "sym134", "sym144", "sym175", "sym181", "sym190", "sym213", "sym222", "sym256", "sym440", "sym531", "sym540", "sym1301", "sym1308", "sym1384", "sym1390", "sym1408", "sym1492", "sym1519", "sym1542", "sym1584", "sym1608", "sym1635", "sym1642", "sym1644", "sym1652", "sym1680", "sym1773", "sym1803", "sym1816", "sym1929", "sym2029", "sym2123", "sym2137", "sym2192" ],
"site_to_row_lookup": [ "sym1819", "sym1825" ],
"Site_visit_stats": [ "sym2190", "sym2206", "sym2208", "sym2242", "sym2244", "sym2246", "sym2247", "sym2249", "sym2250" ],
"sites": [ "sym1019", "sym1028", "sym1045" ],
"sites_to_include": [ "sym536", "sym542", "sym1806", "sym1813", "sym1817" ],
"sites_to_visit": [ "sym1358", "sym1366", "sym1367", "sym1368", "sym1377", "sym1385" ],
"sites_visited": [ "sym1287", "sym1292", "sym1302", "sym2267" ],
"sparta_dir": [ "sym1744", "sym1745", "sym1747" ],
"spdata": [ "sym12", "sym23", "sym27", "sym28", "sym37" ],
"Species": [ "sym14", "sym25", "sym90", "sym97", "sym255", "sym439", "sym554", "sym1063", "sym1306", "sym1406", "sym1491", "sym1928", "sym1944", "sym1957" ],
"split": [ "sym1978", "sym1984", "sym1988" ],
"splityr": [ "sym88", "sym95", "sym102", "sym107", "sym244", "sym245", "sym252", "sym436", "sym1430", "sym1435", "sym1464", "sym1474", "sym2187", "sym2207", "sym2209", "sym2212", "sym2216", "sym2220", "sym2224", "sym2228", "sym2232", "sym2236", "sym2240", "sym2243", "sym2245", "sym2248", "sym2251" ],
"spp_vector": [ "sym1415", "sym1418", "sym1422" ],
"stat_names": [ "sym1258", "sym1278" ],
"StDev": "sym69",
"stoch": [ "sym715", "sym752", "sym776", "sym796", "sym855", "sym1093", "sym1112" ],
"stochastic": [ "sym1321", "sym1341", "sym1353" ],
"subset_recs_Biased": "sym2102",
"subset_recs_by_X": "sym2077",
"sum": [ "sym192", "sym261", "sym273", "sym445", "sym457", "sym1605", "sym1639", "sym1676" ],
"summ_stats": [ "sym889", "sym903" ],
"summarize": "sym1940",
"summarize_recording": "sym2179",
"summary": "sym1889",
"summary_stats": [ "sym2195", "sym2252" ],
"sv": [ "sym1349", "sym1360", "sym1371", "sym1373" ],
"T": [ "sym38", "sym125", "sym150", "sym228", "sym243", "sym319", "sym354", "sym701", "sym784", "sym865", "sym931", "sym938", "sym962", "sym987", "sym1005", "sym1030", "sym1048", "sym1069", "sym1155", "sym1218", "sym1263", "sym1284", "sym1311", "sym1313", "sym1336", "sym1429", "sym1502", "sym1522", "sym1547", "sym1568", "sym1589", "sym1624", "sym1662", "sym1697", "sym1890", "sym2004", "sym2165" ],
"t1": [ "sym282", "sym294", "sym295", "sym303", "sym307", "sym308", "sym310", "sym311", "sym313", "sym316" ],
"t1_cols": [ "sym1210", "sym1220", "sym1225", "sym1256", "sym1260", "sym1264", "sym1266", "sym1271", "sym1273" ],
"t2.0": [ "sym286", "sym297", "sym298", "sym304", "sym306", "sym312" ],
"t2.a": [ "sym290", "sym300", "sym301", "sym305", "sym309", "sym315" ],
"t2_cols": [ "sym1212", "sym1242" ],
"target": [ "sym2134", "sym2135", "sym2138", "sym2142" ],
"target_LL": [ "sym2044", "sym2051" ],
"targetLL": "sym2253",
"Telfer": [ "sym1451", "sym1457", "sym1461" ],
"temp": [ "sym1269", "sym1276", "sym1277" ],
"test": [ "sym372", "sym387", "sym389", "sym394", "sym407" ],
"test_power": [ "sym922", "sym970" ],
"Tfac_Stdev": [ "sym1752", "sym1758", "sym1952" ],
"Tfac_StDev": [ "sym1998", "sym2002" ],
"Tfactor": [ "sym65", "sym73" ],
"time": [ "sym873", "sym884" ],
"TimePeriod": "sym74",
"times": "sym2262",
"timestamp": [ "sym2006", "sym2011", "sym2017" ],
"tp": [ "sym249", "sym257", "sym433", "sym441" ],
"tp2": "sym1977",
"trend": [ "sym63", "sym67", "sym76", "sym82", "sym329", "sym335", "sym337", "sym339", "sym344", "sym349", "sym351", "sym373", "sym385", "sym474", "sym485", "sym487", "sym489", "sym491", "sym1469", "sym1479" ],
"trend.null": [ "sym478", "sym486", "sym488", "sym490" ],
"trend_cols": [ "sym958", "sym966" ],
"trend_names": [ "sym955", "sym959" ],
"true_change": [ "sym939", "sym940", "sym945", "sym971" ],
"true_data": [ "sym704", "sym711", "sym727", "sym748", "sym765", "sym793", "sym809", "sym811", "sym835", "sym843", "sym852", "sym1020", "sym1134", "sym1286", "sym1293", "sym1343", "sym1356", "sym1365", "sym1379", "sym2263", "sym2265", "sym2268", "sym2270" ],
"twoSidedPValue": "sym318",
"uniq_vis": [ "sym1388", "sym1394", "sym1396", "sym1399", "sym2026", "sym2033", "sym2034", "sym2035", "sym2037", "sym2041", "sym2043", "sym2046", "sym2048", "sym2050", "sym2052", "sym2053", "sym2060", "sym2063", "sym2120", "sym2127", "sym2129", "sym2132", "sym2133", "sym2136", "sym2139", "sym2141", "sym2148", "sym2169" ],
"upper": [ "sym1985", "sym1993" ],
"V": [ "sym217", "sym225" ],
"value": [ "sym54", "sym1056", "sym1204", "sym1299", "sym1405", "sym1910" ],
"var": [ "sym320", "sym321", "sym328", "sym355", "sym356", "sym363", "sym393" ],
"Var1": "sym1208",
"Var2": "sym55",
"variable": "sym1914",
"varnames": [ "sym972", "sym976", "sym977" ],
"vis_tmp": [ "sym2147", "sym2151", "sym2155", "sym2158", "sym2163" ],
"vis_to_include": [ "sym2144", "sym2177" ],
"Visit": [ "sym9", "sym723", "sym1053", "sym1058", "sym1060", "sym1304", "sym1307", "sym1401", "sym1407", "sym2030", "sym2080", "sym2105", "sym2124" ],
"visit_id": [ "sym2036", "sym2069", "sym2128", "sym2156", "sym2159", "sym2176" ],
"visit_site_Ntimes": [ "sym1376", "sym2261" ],
"visit_these_sites": "sym2266",
"VisRichSites": [ "sym1344", "sym1345", "sym1346", "sym1347", "sym1348", "sym1354", "sym1363" ],
"vrs": [ "sym714", "sym751", "sym775", "sym795", "sym854", "sym1092", "sym1111" ],
"well_sampled": [ "sym262", "sym270", "sym415", "sym429", "sym446", "sym454", "sym500" ],
"which.decline": [ "sym805", "sym806", "sym808", "sym810", "sym822", "sym823", "sym824", "sym833", "sym836", "sym845" ],
"with_repl": "sym1290",
"writePath": [ "sym909", "sym1124", "sym1126" ],
"wts_copy": [ "sym1746", "sym1748" ],
"x": [ "sym2", "sym48", "sym51", "sym52", "sym56", "sym139", "sym151", "sym152", "sym153", "sym204", "sym229", "sym230", "sym231", "sym265", "sym276", "sym277", "sym325", "sym360", "sym364", "sym370", "sym371", "sym449", "sym460", "sym461", "sym467", "sym475", "sym476", "sym477", "sym480", "sym529", "sym535", "sym541", "sym579", "sym583", "sym585", "sym587", "sym588", "sym589", "sym591", "sym603", "sym607", "sym609", "sym611", "sym613", "sym614", "sym615", "sym616", "sym619", "sym639", "sym643", "sym645", "sym647", "sym649", "sym650", "sym651", "sym652", "sym655", "sym681", "sym685", "sym687", "sym689", "sym691", "sym692", "sym693", "sym694", "sym698", "sym901", "sym908", "sym912", "sym913", "sym924", "sym927", "sym1002", "sym1007", "sym1008", "sym1011", "sym1014", "sym1055", "sym1075", "sym1123", "sym1131", "sym1133", "sym1136", "sym1137", "sym1138", "sym1188", "sym1291", "sym1295", "sym1375", "sym1381", "sym1425", "sym1426", "sym1493", "sym1503", "sym1511", "sym1523", "sym1537", "sym1548", "sym1559", "sym1569", "sym1580", "sym1590", "sym1617", "sym1625", "sym1655", "sym1663", "sym1690", "sym1698", "sym1896", "sym1901", "sym1902", "sym2013", "sym2014", "sym2018", "sym2154", "sym2157", "sym2166", "sym2173", "sym2259", "sym2260" ],
"X": "sym2096",
"y": [ "sym469", "sym470", "sym471", "sym482", "sym483", "sym484" ],
"Year": [ "sym7", "sym19", "sym29", "sym87", "sym94", "sym101", "sym106", "sym132", "sym142", "sym180", "sym189", "sym201", "sym203", "sym247", "sym251", "sym435", "sym532", "sym548", "sym559", "sym798", "sym858", "sym1432", "sym1496", "sym1514", "sym1534", "sym1536", "sym1604", "sym1609", "sym1614", "sym1616", "sym1621", "sym1638", "sym1645", "sym1654", "sym1675", "sym1681", "sym1686", "sym1689", "sym1694", "sym1774", "sym1778", "sym1804", "sym1827", "sym1833", "sym1834", "sym1930", "sym1980", "sym1983", "sym1987", "sym1991", "sym1994", "sym2025", "sym2028", "sym2042", "sym2081", "sym2086", "sym2090", "sym2099", "sym2106", "sym2111", "sym2115", "sym2122", "sym2146", "sym2149", "sym2189", "sym2193", "sym2201", "sym2211", "sym2215", "sym2219", "sym2223", "sym2227", "sym2231", "sym2235", "sym2239" ],
"YearFS": [ "sym1650", "sym1659" ],
"yps": [ "sym1801", "sym1807", "sym1808" ],
"z": [ "sym66", "sym71", "sym1782" ],
"zeroDecline": [ "sym788", "sym804" ],
"zst": [ "sym1771", "sym1810", "sym1811", "sym1812", "sym1820", "sym1821", "sym1830", "sym1873" ] 
};</script><style rel="stylesheet" type="text/css">
 pre.Rcode {
   background: lightgrey;
 }

 .number{
 	color: rgb(21,20,181) ;
 }
 
 .functioncall{
 	color: black ;
 }
 
 .string{
 	color: rgb(153,153,255) ;
 }
 
 .keyword{
 	font-weight: bolder ;
 	color: black;
 }
 
 .argument{
 	color: rgb( 177,63,5) ;
 }
 
 .comment{
 	color: rgb( 255, 0, 0) ;
 }
 
 .roxygencomment{
 	color: rgb(0,151,255);
 }
 
 .formalargs{
 	color: rgb(18,182,18);
 }
 
 .eqformalargs{
 	color: rgb(18,182,18);
 }
 
 .assignement{
 	font-weight: bolder;
 	color: rgb(55,55,98);
 }
 
 .package{
 	color: rgb(150,182,37);
 }
 
 .slot{
 	font-style:italic;
 }
 
 .symbol{
 	color: black ;
 }
 
 .prompt{
 	color: black ;
 }
 
 .line{
     color: gray ;   
 }

 .showSymbol {
  background: grey;
  color: red;
 }

</style>
</head>
<body>
<pre class="Rcode">
<span class="comment"># Nick Isaac</span>
<span class="comment"># 22 Ocobter 2012</span>
<span class="comment"># </span>
<span class="comment"># Complete rewrite of most simulation functionality</span>
<span class="comment"># </span>
<span class="comment">#################################################</span>
<span class="comment">#</span>
<span class="comment"># TO DO</span>
<span class="comment"># Check plot functions with multiple MM thresholds</span>
<span class="comment">#</span>
<span class="comment">#################################################</span>
<a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/reshape2"><span class="symbol">reshape2</span></a><span class="keyword">)</span>
<a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/lme4"><span class="symbol">lme4</span></a><span class="keyword">)</span>
<a href="base/source.html">source</a><span class="keyword">(</span><span class="string">'sims_to_frescalo.r'</span><span class="keyword">)</span>
<a href="base/source.html">source</a><span class="keyword">(</span><span class="string">'run_fresc_param_sims.r'</span><span class="keyword">)</span>
<a href="base/source.html">source</a><span class="keyword">(</span><span class="string">'Explore_results.r'</span><span class="keyword">)</span>
<span class="comment">################################################# GENERIC FUNCTIONS - TO BE ADDED TO TO 'RANGE CHANGE FUNCS'</span>
<span id="sym1" class="symbol" onmouseover='showVariable("occurrence", symIdentifiers);' onmouseout='hideVariable("occurrence", symIdentifiers);'>occurrence</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <a href="base/length.html">length</a><span class="keyword">(</span><span id="sym2" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span> <span class="comment"># takes a vector and returns whether the length is greater than 0</span>


<span id="sym3" class="symbol" onmouseover='showVariable("cast_recs", symIdentifiers);' onmouseout='hideVariable("cast_recs", symIdentifiers);'>cast_recs</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">resolution</span><span class="eqformalargs">=</span><span class="string">'visit'</span><span class="keyword">,</span> <span class="formalargs">focalspname</span><span class="eqformalargs">=</span><span class="string">'focal'</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment">#takes a set of records and returns a dataframe suitable for analysis</span>
        <span class="comment">#columns include the list length and presence/absence of the focal species</span>
    <span class="comment">#6 December: minor alterations to make it work with nonfocal species</span>

        <span class="keyword">if</span><span class="keyword">(</span><span id="sym4" class="symbol" onmouseover='showVariable("resolution", symIdentifiers);' onmouseout='hideVariable("resolution", symIdentifiers);'>resolution</span>==<span class="string">'visit'</span><span class="keyword">)</span><span class="keyword">{</span>
                <span id="sym5" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span> <span class="assignement">&lt;-</span> <a href="NA/dcast.html">dcast</a><span class="keyword">(</span><span id="sym6" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym7" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <span id="sym8" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">+</span> <span id="sym9" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span> <span class="keyword">~</span> <span id="sym10" class="symbol" onmouseover='showVariable(".", symIdentifiers);' onmouseout='hideVariable(".", symIdentifiers);'>.</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'Species'</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym11" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span><span class="keyword">)</span>
                <span id="sym12" class="symbol" onmouseover='showVariable("spdata", symIdentifiers);' onmouseout='hideVariable("spdata", symIdentifiers);'>spdata</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym13" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym14" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span>==<span id="sym15" class="symbol" onmouseover='showVariable("focalspname", symIdentifiers);' onmouseout='hideVariable("focalspname", symIdentifiers);'>focalspname</span><span class="keyword">)</span> <span class="comment">#simply the subset of data for the focal species</span>

    <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">if</span><span class="keyword">(</span><span id="sym16" class="symbol" onmouseover='showVariable("resolution", symIdentifiers);' onmouseout='hideVariable("resolution", symIdentifiers);'>resolution</span>==<span class="string">'kmyr'</span><span class="keyword">)</span><span class="keyword">{</span>
                <span id="sym17" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span> <span class="assignement">&lt;-</span> <a href="NA/dcast.html">dcast</a><span class="keyword">(</span><span id="sym18" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym19" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <span id="sym20" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">~</span> <span id="sym21" class="symbol" onmouseover='showVariable(".", symIdentifiers);' onmouseout='hideVariable(".", symIdentifiers);'>.</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'Species'</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym22" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span><span class="keyword">)</span>
                <span id="sym23" class="symbol" onmouseover='showVariable("spdata", symIdentifiers);' onmouseout='hideVariable("spdata", symIdentifiers);'>spdata</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym24" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym25" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span>==<span id="sym26" class="symbol" onmouseover='showVariable("focalspname", symIdentifiers);' onmouseout='hideVariable("focalspname", symIdentifiers);'>focalspname</span><span class="keyword">)</span> <span class="comment">#simply the subset of data for the focal species</span>
                <span id="sym27" class="symbol" onmouseover='showVariable("spdata", symIdentifiers);' onmouseout='hideVariable("spdata", symIdentifiers);'>spdata</span> <span class="assignement">&lt;-</span> <a href="NA/dcast.html">dcast</a><span class="keyword">(</span><span id="sym28" class="symbol" onmouseover='showVariable("spdata", symIdentifiers);' onmouseout='hideVariable("spdata", symIdentifiers);'>spdata</span><span class="keyword">,</span> <span id="sym29" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <span id="sym30" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">~</span> <span id="sym31" class="symbol" onmouseover='showVariable(".", symIdentifiers);' onmouseout='hideVariable(".", symIdentifiers);'>.</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'Species'</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym32" class="symbol" onmouseover='showVariable("occurrence", symIdentifiers);' onmouseout='hideVariable("occurrence", symIdentifiers);'>occurrence</span><span class="keyword">)</span>
        <span class="keyword">}</span>
        <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym33" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">)</span><span class="keyword">[</span><a href="base/ncol.html">ncol</a><span class="keyword">(</span><span id="sym34" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">)</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="string">'L'</span>
        <span class="comment"># merge the two</span>
        <span id="sym35" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span> <span class="assignement">&lt;-</span> <a href="base/merge.html">merge</a><span class="keyword">(</span><span id="sym36" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">,</span> <span id="sym37" class="symbol" onmouseover='showVariable("spdata", symIdentifiers);' onmouseout='hideVariable("spdata", symIdentifiers);'>spdata</span><span class="keyword">,</span> <span class="argument">all</span><span class="argument">=</span><span id="sym38" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="argument">nomatch</span><span class="argument">=</span><span class="number">FALSE</span><span class="keyword">)</span>

    <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym39" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">)</span><span class="keyword">[</span><a href="base/ncol.html">ncol</a><span class="keyword">(</span><span id="sym40" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">)</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span id="sym41" class="symbol" onmouseover='showVariable("focalspname", symIdentifiers);' onmouseout='hideVariable("focalspname", symIdentifiers);'>focalspname</span> <span class="comment">#changed from 'focal'</span>
        <span id="sym42" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">[</span><a href="base/ncol.html">ncol</a><span class="keyword">(</span><span id="sym43" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">)</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/as.logical.html">as.logical</a><span class="keyword">(</span><span class="keyword">!</span><a href="base/is.na.html">is.na</a><span class="keyword">(</span><span id="sym44" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">[</span><a href="base/ncol.html">ncol</a><span class="keyword">(</span><span id="sym45" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym46" class="symbol" onmouseover='showVariable("castrecs", symIdentifiers);' onmouseout='hideVariable("castrecs", symIdentifiers);'>castrecs</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym47" class="symbol" onmouseover='showVariable("frescalo_bootstrap", symIdentifiers);' onmouseout='hideVariable("frescalo_bootstrap", symIdentifiers);'>frescalo_bootstrap</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">fr</span><span class="keyword">,</span> <span class="formalargs">n</span><span class="eqformalargs">=</span><span class="number">1000</span><span class="keyword">)</span><span class="keyword">{</span>
  <span class="comment">#takes the output from sims_to_frescalo()</span>
  <span class="comment">#it returns a trend and p-value, estimated from bootstrapping</span>
  <span class="comment">#NB 'trend' estimates are measured in units of 'time periods', not the underlying years (ok if nTp=nYr)</span>
  <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/reshape2"><span class="symbol">reshape2</span></a><span class="keyword">)</span>
  <span id="sym48" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym49" class="symbol" onmouseover='showVariable("fr", symIdentifiers);' onmouseout='hideVariable("fr", symIdentifiers);'>fr</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <a href="stats/rnorm.html">rnorm</a><span class="keyword">(</span><span id="sym50" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">,</span> <span class="argument">mean</span><span class="argument">=</span><span id="sym51" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">sd</span><span class="argument">=</span><span id="sym52" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span>
  <span id="sym53" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/lm.html">lm</a><span class="keyword">(</span><span id="sym54" class="symbol" onmouseover='showVariable("value", symIdentifiers);' onmouseout='hideVariable("value", symIdentifiers);'>value</span> <span class="keyword">~</span> <span id="sym55" class="symbol" onmouseover='showVariable("Var2", symIdentifiers);' onmouseout='hideVariable("Var2", symIdentifiers);'>Var2</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><a href="NA/melt.html">melt</a><span class="keyword">(</span><span id="sym56" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
  <a href="base/return.html">return</a><span class="keyword">(</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym57" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span><span class="keyword">$</span><span id="sym58" class="symbol" onmouseover='showVariable("coefficients", symIdentifiers);' onmouseout='hideVariable("coefficients", symIdentifiers);'>coefficients</span><span class="keyword">[</span><span class="string">'Var2'</span><span class="keyword">,</span><span class="string">'Estimate'</span><span class="keyword">]</span><span class="keyword">,</span> <span id="sym59" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span><span class="keyword">$</span><span id="sym60" class="symbol" onmouseover='showVariable("coefficients", symIdentifiers);' onmouseout='hideVariable("coefficients", symIdentifiers);'>coefficients</span><span class="keyword">[</span><span class="string">'Var2'</span><span class="keyword">,</span><span class="string">'Pr(&gt;|t|)'</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym61" class="symbol" onmouseover='showVariable("frescalo_trend", symIdentifiers);' onmouseout='hideVariable("frescalo_trend", symIdentifiers);'>frescalo_trend</span><span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">fr</span><span class="keyword">)</span><span class="keyword">{</span>
  <span class="comment">#takes the output from sims_to_frescalo()</span>
  <span class="comment">#it returns a trend and p-value</span>
  <span class="comment">#if nTP=2 then it uses a z-test</span>
  <span class="comment">#if nTP&gt;2 is calculates a linear trend, ignoring stdev</span>
  <span class="comment">#NB 'trend' estimates are measured in units of 'time periods', not the underlying years (ok if nTp=nYr)</span>
  <span class="keyword">if</span><span class="keyword">(</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym62" class="symbol" onmouseover='showVariable("fr", symIdentifiers);' onmouseout='hideVariable("fr", symIdentifiers);'>fr</span><span class="keyword">)</span>==<span class="number">2</span><span class="keyword">)</span><span class="keyword">{</span>
    <span id="sym63" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span> <span class="assignement">&lt;-</span> <a href="base/diff.html">diff</a><span class="keyword">(</span><span id="sym64" class="symbol" onmouseover='showVariable("fr", symIdentifiers);' onmouseout='hideVariable("fr", symIdentifiers);'>fr</span><span class="keyword">$</span><span id="sym65" class="symbol" onmouseover='showVariable("Tfactor", symIdentifiers);' onmouseout='hideVariable("Tfactor", symIdentifiers);'>Tfactor</span><span class="keyword">)</span>
    <span id="sym66" class="symbol" onmouseover='showVariable("z", symIdentifiers);' onmouseout='hideVariable("z", symIdentifiers);'>z</span> <span class="assignement">&lt;-</span> <span id="sym67" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">/</span><a href="base/sqrt.html">sqrt</a><span class="keyword">(</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym68" class="symbol" onmouseover='showVariable("fr", symIdentifiers);' onmouseout='hideVariable("fr", symIdentifiers);'>fr</span><span class="keyword">$</span><span id="sym69" class="symbol" onmouseover='showVariable("StDev", symIdentifiers);' onmouseout='hideVariable("StDev", symIdentifiers);'>StDev</span><span class="keyword">^</span><span class="number">2</span><span class="keyword">)</span><span class="keyword">)</span>
    <span id="sym70" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span> <span class="assignement">&lt;-</span> <a href="NA/one_to_two_tail.html">one_to_two_tail</a><span class="keyword">(</span><a href="stats/pnorm.html">pnorm</a><span class="keyword">(</span><span id="sym71" class="symbol" onmouseover='showVariable("z", symIdentifiers);' onmouseout='hideVariable("z", symIdentifiers);'>z</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
    <span id="sym72" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/lm.html">lm</a><span class="keyword">(</span><span id="sym73" class="symbol" onmouseover='showVariable("Tfactor", symIdentifiers);' onmouseout='hideVariable("Tfactor", symIdentifiers);'>Tfactor</span> <span class="keyword">~</span> <span id="sym74" class="symbol" onmouseover='showVariable("TimePeriod", symIdentifiers);' onmouseout='hideVariable("TimePeriod", symIdentifiers);'>TimePeriod</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><span id="sym75" class="symbol" onmouseover='showVariable("fr", symIdentifiers);' onmouseout='hideVariable("fr", symIdentifiers);'>fr</span><span class="keyword">)</span><span class="keyword">)</span>
    <span id="sym76" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span> <span class="assignement">&lt;-</span> <span id="sym77" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span><span class="keyword">$</span><span id="sym78" class="symbol" onmouseover='showVariable("coefficients", symIdentifiers);' onmouseout='hideVariable("coefficients", symIdentifiers);'>coefficients</span><span class="keyword">[</span><span class="string">'TimePeriod'</span><span class="keyword">,</span><span class="string">'Estimate'</span><span class="keyword">]</span>
    <span id="sym79" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span> <span class="assignement">&lt;-</span> <span id="sym80" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span><span class="keyword">$</span><span id="sym81" class="symbol" onmouseover='showVariable("coefficients", symIdentifiers);' onmouseout='hideVariable("coefficients", symIdentifiers);'>coefficients</span><span class="keyword">[</span><span class="string">'TimePeriod'</span><span class="keyword">,</span><span class="string">'Pr(&gt;|t|)'</span><span class="keyword">]</span>
  <span class="keyword">}</span>
  <a href="base/return.html">return</a><span class="keyword">(</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym82" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">,</span> <span id="sym83" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym84" class="symbol" onmouseover='showVariable("Convert_records_to_2tp", symIdentifiers);' onmouseout='hideVariable("Convert_records_to_2tp", symIdentifiers);'>Convert_records_to_2tp</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">splityr</span><span class="keyword">)</span> <span class="keyword">{</span>
        <span class="comment"># takes raw biological records and generates a dataframe suitable for Telfer etc</span>
        <span id="sym85" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym86" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym87" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> &lt;= <span id="sym88" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym89" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">,</span> <span id="sym90" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span><span class="keyword">,</span> <span id="sym91" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># number of sites for each species in t1</span>
        <span id="sym92" class="symbol" onmouseover='showVariable("n2", symIdentifiers);' onmouseout='hideVariable("n2", symIdentifiers);'>n2</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym93" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym94" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">&gt;</span> <span id="sym95" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym96" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">,</span> <span id="sym97" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span><span class="keyword">,</span> <span id="sym98" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym99" class="symbol" onmouseover='showVariable("d1", symIdentifiers);' onmouseout='hideVariable("d1", symIdentifiers);'>d1</span> <span class="assignement">&lt;-</span> <a href="NA/LenUniq.html">LenUniq</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym100" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym101" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> &lt;= <span id="sym102" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym103" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span> <span class="comment"># total number of sites in t1</span>
        <span id="sym104" class="symbol" onmouseover='showVariable("d2", symIdentifiers);' onmouseout='hideVariable("d2", symIdentifiers);'>d2</span> <span class="assignement">&lt;-</span> <a href="NA/LenUniq.html">LenUniq</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym105" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym106" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">&gt;</span> <span id="sym107" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym108" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span> <span class="comment"># total number of sites in t2</span>
        <span id="sym109" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span> <span class="assignement">&lt;-</span> <a href="base/data.frame.html">data.frame</a><span class="keyword">(</span><span id="sym110" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span><span class="keyword">,</span><span id="sym111" class="symbol" onmouseover='showVariable("n2", symIdentifiers);' onmouseout='hideVariable("n2", symIdentifiers);'>n2</span><span class="keyword">)</span>
        <span id="sym112" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">[</span><a href="base/is.na.html">is.na</a><span class="keyword">(</span><span id="sym113" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">)</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="number">0</span> <span class="comment"># fix the bug of unrecorded species (added 10/1/13)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym114" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">,</span> <span class="string">'denom'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym115" class="symbol" onmouseover='showVariable("d1", symIdentifiers);' onmouseout='hideVariable("d1", symIdentifiers);'>d1</span><span class="keyword">,</span><span id="sym116" class="symbol" onmouseover='showVariable("d2", symIdentifiers);' onmouseout='hideVariable("d2", symIdentifiers);'>d2</span><span class="keyword">)</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym117" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym118" class="symbol" onmouseover='showVariable("fit_LadybirdMM", symIdentifiers);' onmouseout='hideVariable("fit_LadybirdMM", symIdentifiers);'>fit_LadybirdMM</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">MMdata</span><span class="keyword">,</span> <span class="formalargs">nsp</span><span class="eqformalargs">=</span><span class="number">2</span><span class="keyword">,</span> <span class="formalargs">nyr</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment">#0.44 seconds</span>
        <span class="comment"># this version returns only the coefficients and the proportion of observations that were 'well-sampled'</span>
        <span class="comment"># 14 December: minor change: I removed the call to MMdata to outside the function.</span>
    <span class="comment">#   this Gives extra flexibility to analyse disaggregated data.</span>
    <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/lme4"><span class="symbol">lme4</span></a><span class="keyword">)</span>

    <span class="comment">#subset the data</span>
    <span id="sym119" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <span id="sym120" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym121" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span> <span class="keyword">&gt;=</span> <span id="sym122" class="symbol" onmouseover='showVariable("nsp", symIdentifiers);' onmouseout='hideVariable("nsp", symIdentifiers);'>nsp</span>
          <span id="sym123" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">[</span><span id="sym124" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span>==<span id="sym125" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="NA/is.gridcell.wellsampled.html">is.gridcell.wellsampled</a><span class="keyword">(</span><span id="sym126" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym127" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">[</span><span id="sym128" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">n</span><span class="argument">=</span><span id="sym129" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">)</span>

    <span class="comment"># 4/2/13: with small numbers of visits, it's possible that no gridcells meet the criterion</span>
        <span class="comment"># I also centred the data on the mid year in order to improve numerical convergence </span>
    <span id="sym130" class="symbol" onmouseover='showVariable("my", symIdentifiers);' onmouseout='hideVariable("my", symIdentifiers);'>my</span> <span class="assignement">&lt;-</span><a href="stats/median.html">median</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym131" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym132" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">if</span><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym133" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym134" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">[</span><span id="sym135" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">1</span> <span class="keyword">&amp;</span> <a href="stats/var.html">var</a><span class="keyword">(</span><span id="sym136" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym137" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">[</span><span id="sym138" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span><span class="keyword">{</span>
        <span id="sym139" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span><span class="keyword">{</span><span class="comment"># another source of the bug error is if there's not enough to fit the model</span>
            <span id="sym140" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span> <span class="assignement">&lt;-</span> <a href="NA/glmer.html">glmer</a><span class="keyword">(</span><span id="sym141" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="keyword">~</span> <a href="base/I.html">I</a><span class="keyword">(</span><span id="sym142" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">-</span><span id="sym143" class="symbol" onmouseover='showVariable("my", symIdentifiers);' onmouseout='hideVariable("my", symIdentifiers);'>my</span><span class="keyword">)</span> <span class="keyword">+</span> <span class="keyword">(</span><span class="number">1</span><span class="keyword">|</span><span id="sym144" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym145" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">,</span> <span class="argument">subset</span><span class="argument">=</span><span id="sym146" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span> <span class="argument">family</span><span class="argument">=</span><span id="sym147" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">)</span>
            <span id="sym148" class="symbol" onmouseover='showVariable("coefs", symIdentifiers);' onmouseout='hideVariable("coefs", symIdentifiers);'>coefs</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="stats/coef.html">coef</a><span class="keyword">(</span><a href="base/summary.html">summary</a><span class="keyword">(</span><span id="sym149" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># should be compatible across versions</span>
            <span class="keyword">}</span><span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym150" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym151" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'step-halvings failed'</span><span class="keyword">,</span> <span id="sym152" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span> <span class="keyword">|</span> <a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'did not converge'</span><span class="keyword">,</span> <span id="sym153" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span> <span id="sym154" class="symbol" onmouseover='showVariable("coefs", symIdentifiers);' onmouseout='hideVariable("coefs", symIdentifiers);'>coefs</span> <span class="assignement">&lt;-</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span class="number">NA</span><span class="keyword">,</span> <span class="number">4</span><span class="keyword">)</span> <span class="comment">#the model fails if the data are too sparse</span>
          <span class="keyword">else</span> <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym155" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'MM_ber_tryerror_'</span><span class="keyword">,</span><span id="sym156" class="symbol" onmouseover='showVariable("nsp", symIdentifiers);' onmouseout='hideVariable("nsp", symIdentifiers);'>nsp</span><span class="keyword">,</span><span class="string">'.rData'</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">}</span>
        <span class="comment"># end bug check</span>
    <span class="keyword">}</span> <span class="keyword">else</span> <span id="sym157" class="symbol" onmouseover='showVariable("coefs", symIdentifiers);' onmouseout='hideVariable("coefs", symIdentifiers);'>coefs</span> <span class="assignement">&lt;-</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span class="number">NA</span><span class="keyword">,</span> <span class="number">4</span><span class="keyword">)</span>

        <a href="base/return.html">return</a><span class="keyword">(</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym158" class="symbol" onmouseover='showVariable("coefs", symIdentifiers);' onmouseout='hideVariable("coefs", symIdentifiers);'>coefs</span><span class="keyword">,</span> <a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym159" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span><span class="keyword">/</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym160" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># keep this a two step process in case we later decide to extract other info</span>
<span class="keyword">}</span>


<span id="sym161" class="symbol" onmouseover='showVariable("fit_ladybirdMM_bin", symIdentifiers);' onmouseout='hideVariable("fit_ladybirdMM_bin", symIdentifiers);'>fit_ladybirdMM_bin</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">indata</span><span class="keyword">,</span> <span class="formalargs">nsp</span><span class="eqformalargs">=</span><span class="number">2</span><span class="keyword">,</span> <span class="formalargs">nyr</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">,</span> <span class="formalargs">od</span><span class="eqformalargs">=</span><span id="sym162" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">V</span><span class="eqformalargs">=</span><span id="sym163" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># indata (simdata) contains 1 row per valid visit, with a true or false for whether it was recorded</span>
    <span class="comment"># now we aggregate this to the year:monad level, with a binomial response (not bernoulli) &lt;- thanks to Ben Bolker</span>
    <span class="comment"># initially I calculated nVR directly from records, but this includes all the lists of length 1 and the poorly-sampled grid cells</span>
    <span class="comment"># optional arguments for modelling Overdispersion (very slow) and verbose output</span>

    <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/lme4"><span class="symbol">lme4</span></a><span class="keyword">)</span>

    <span class="comment">#subset the data: remove the short lists (defined by nsp)</span>
    <span id="sym164" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym165" class="symbol" onmouseover='showVariable("indata", symIdentifiers);' onmouseout='hideVariable("indata", symIdentifiers);'>indata</span><span class="keyword">,</span> <span id="sym166" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">&gt;=</span><span id="sym167" class="symbol" onmouseover='showVariable("nsp", symIdentifiers);' onmouseout='hideVariable("nsp", symIdentifiers);'>nsp</span><span class="keyword">)</span>

    <span class="comment"># of these visits, which are on well-sampled sites?</span>
    <span class="comment"># 21 June: if no thresholds are applied then no need to look for well-sampled set</span>
    <span class="keyword">if</span><span class="keyword">(</span><span id="sym168" class="symbol" onmouseover='showVariable("nsp", symIdentifiers);' onmouseout='hideVariable("nsp", symIdentifiers);'>nsp</span><span class="keyword">&gt;</span><span class="number">1</span> <span class="keyword">&amp;</span> <span id="sym169" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">&gt;</span><span class="number">1</span><span class="keyword">)</span> <span id="sym170" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym171" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span><span class="keyword">,</span> <a href="NA/is.gridcell.wellsampled2.html">is.gridcell.wellsampled2</a><span class="keyword">(</span><span id="sym172" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span><span class="keyword">,</span> <span class="argument">n</span><span class="argument">=</span><span id="sym173" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">)</span><span class="keyword">)</span>

    <span class="keyword">if</span><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym174" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span><span class="keyword">$</span><span id="sym175" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">1</span> <span class="keyword">&amp;</span> <a href="stats/var.html">var</a><span class="keyword">(</span><span id="sym176" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span><span class="keyword">$</span><span id="sym177" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># we have enough data in the well-sampled set to try running a model</span>
        <span id="sym178" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span> <span class="assignement">&lt;-</span> <a href="NA/dcast.html">dcast</a><span class="keyword">(</span><span id="sym179" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span><span class="keyword">,</span> <span id="sym180" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <span id="sym181" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">~</span> <span id="sym182" class="symbol" onmouseover='showVariable(".", symIdentifiers);' onmouseout='hideVariable(".", symIdentifiers);'>.</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym183" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'L'</span><span class="keyword">)</span> <span class="comment">#how many lists?</span>
        <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym184" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">)</span><span class="keyword">[</span><a href="base/ncol.html">ncol</a><span class="keyword">(</span><span id="sym185" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">)</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="string">'nVis'</span>

        <span id="sym186" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym187" class="symbol" onmouseover='showVariable("nVR", symIdentifiers);' onmouseout='hideVariable("nVR", symIdentifiers);'>nVR</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="NA/acast.html">acast</a><span class="keyword">(</span><span id="sym188" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span><span class="keyword">,</span> <span id="sym189" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <span id="sym190" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">~</span> <span id="sym191" class="symbol" onmouseover='showVariable(".", symIdentifiers);' onmouseout='hideVariable(".", symIdentifiers);'>.</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym192" class="symbol" onmouseover='showVariable("sum", symIdentifiers);' onmouseout='hideVariable("sum", symIdentifiers);'>sum</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'focal'</span><span class="keyword">)</span><span class="keyword">)</span>

        <span class="comment"># to fit a binomial model, we define a new column containing the number of visits without an observaiton of the focal</span>
        <span id="sym193" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym194" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym195" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">,</span> <span id="sym196" class="symbol" onmouseover='showVariable("nVis", symIdentifiers);' onmouseout='hideVariable("nVis", symIdentifiers);'>nVis</span> <span class="keyword">-</span> <span id="sym197" class="symbol" onmouseover='showVariable("nVR", symIdentifiers);' onmouseout='hideVariable("nVR", symIdentifiers);'>nVR</span><span class="keyword">)</span>

        <span class="comment"># centre the Year on the median value (for numerical stability)</span>
        <span id="sym198" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym199" class="symbol" onmouseover='showVariable("cYr", symIdentifiers);' onmouseout='hideVariable("cYr", symIdentifiers);'>cYr</span> <span class="assignement">&lt;-</span> <span id="sym200" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym201" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">-</span> <a href="stats/median.html">median</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym202" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym203" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span>

        <span id="sym204" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span><span class="keyword">{</span><span class="comment"># another source of the bug error is if there's not enough to fit the model</span>
            <span class="keyword">if</span><span class="keyword">(</span><span id="sym205" class="symbol" onmouseover='showVariable("od", symIdentifiers);' onmouseout='hideVariable("od", symIdentifiers);'>od</span><span class="keyword">)</span> <span class="keyword">{</span>
                <span id="sym206" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">$</span><span id="sym207" class="symbol" onmouseover='showVariable("obs", symIdentifiers);' onmouseout='hideVariable("obs", symIdentifiers);'>obs</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym208" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">)</span>
                <span id="sym209" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span> <span class="assignement">&lt;-</span> <a href="NA/glmer.html">glmer</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym210" class="symbol" onmouseover='showVariable("nVR", symIdentifiers);' onmouseout='hideVariable("nVR", symIdentifiers);'>nVR</span><span class="keyword">,</span> <span id="sym211" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span><span class="keyword">)</span> <span class="keyword">~</span> <span id="sym212" class="symbol" onmouseover='showVariable("cYr", symIdentifiers);' onmouseout='hideVariable("cYr", symIdentifiers);'>cYr</span> <span class="keyword">+</span> <span class="keyword">(</span><span class="number">1</span><span class="keyword">|</span><span id="sym213" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span> <span class="keyword">+</span> <span class="keyword">(</span><span class="number">1</span><span class="keyword">|</span><span id="sym214" class="symbol" onmouseover='showVariable("obs", symIdentifiers);' onmouseout='hideVariable("obs", symIdentifiers);'>obs</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><span id="sym215" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">,</span> <span class="argument">family</span><span class="argument">=</span><span id="sym216" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">,</span> <span class="argument">verbose</span><span class="argument">=</span><span id="sym217" class="symbol" onmouseover='showVariable("V", symIdentifiers);' onmouseout='hideVariable("V", symIdentifiers);'>V</span><span class="keyword">)</span>
            <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
                <span id="sym218" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span> <span class="assignement">&lt;-</span> <a href="NA/glmer.html">glmer</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym219" class="symbol" onmouseover='showVariable("nVR", symIdentifiers);' onmouseout='hideVariable("nVR", symIdentifiers);'>nVR</span><span class="keyword">,</span> <span id="sym220" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span><span class="keyword">)</span> <span class="keyword">~</span> <span id="sym221" class="symbol" onmouseover='showVariable("cYr", symIdentifiers);' onmouseout='hideVariable("cYr", symIdentifiers);'>cYr</span> <span class="keyword">+</span> <span class="keyword">(</span><span class="number">1</span><span class="keyword">|</span><span id="sym222" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><span id="sym223" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">,</span> <span class="argument">family</span><span class="argument">=</span><span id="sym224" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">,</span> <span class="argument">verbose</span><span class="argument">=</span><span id="sym225" class="symbol" onmouseover='showVariable("V", symIdentifiers);' onmouseout='hideVariable("V", symIdentifiers);'>V</span><span class="keyword">)</span>
            <span class="keyword">}</span>

            <span id="sym226" class="symbol" onmouseover='showVariable("coefs", symIdentifiers);' onmouseout='hideVariable("coefs", symIdentifiers);'>coefs</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="stats/coef.html">coef</a><span class="keyword">(</span><a href="base/summary.html">summary</a><span class="keyword">(</span><span id="sym227" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># should be compatible with old and new versions of lme4</span>
            <span class="keyword">}</span><span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym228" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym229" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span> <span class="keyword">{</span><span class="comment"># bug check</span>
          <span class="comment"># several sources of error in these models exists.</span>
          <span class="comment"># the try statement was originally written to capture datasets that were too small, but these are handled above</span>
          <span class="comment"># Jan 2014:  new code to catch errors under lme4 v1</span>
          <span class="comment"># some errors we understand</span>
          <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'step-halvings failed'</span><span class="keyword">,</span> <span id="sym230" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span> <span class="keyword">|</span> <a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'did not converge'</span><span class="keyword">,</span> <span id="sym231" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span> <span id="sym232" class="symbol" onmouseover='showVariable("coefs", symIdentifiers);' onmouseout='hideVariable("coefs", symIdentifiers);'>coefs</span> <span class="assignement">&lt;-</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span class="number">NA</span><span class="keyword">,</span> <span class="number">4</span><span class="keyword">)</span> <span class="comment">#the model fails if the data are too sparse              </span>
          <span class="keyword">else</span> <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym233" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'MM_bin_tryerror.rData'</span><span class="keyword">)</span>
        <span class="keyword">}</span>

        <span class="comment"># calculate the number of rows in the model as a proportion of the total site-year combos</span>
        <span id="sym234" class="symbol" onmouseover='showVariable("p_used", symIdentifiers);' onmouseout='hideVariable("p_used", symIdentifiers);'>p_used</span> <span class="assignement">&lt;-</span> <a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym235" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">)</span><span class="keyword">/</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym236" class="symbol" onmouseover='showVariable("indata", symIdentifiers);' onmouseout='hideVariable("indata", symIdentifiers);'>indata</span><span class="keyword">[</span><span class="keyword">,</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'Year'</span><span class="keyword">,</span><span class="string">'Site'</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym237" class="symbol" onmouseover='showVariable("result", symIdentifiers);' onmouseout='hideVariable("result", symIdentifiers);'>result</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym238" class="symbol" onmouseover='showVariable("coefs", symIdentifiers);' onmouseout='hideVariable("coefs", symIdentifiers);'>coefs</span><span class="keyword">,</span> <span id="sym239" class="symbol" onmouseover='showVariable("p_used", symIdentifiers);' onmouseout='hideVariable("p_used", symIdentifiers);'>p_used</span><span class="keyword">)</span>
    <span class="keyword">}</span> <span class="keyword">else</span> <span id="sym240" class="symbol" onmouseover='showVariable("result", symIdentifiers);' onmouseout='hideVariable("result", symIdentifiers);'>result</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><a href="base/rep.html">rep</a><span class="keyword">(</span><span class="number">NA</span><span class="keyword">,</span> <span class="number">4</span><span class="keyword">)</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">)</span> <span class="comment"># there's no 'well-sampled' cells</span>

    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym241" class="symbol" onmouseover='showVariable("result", symIdentifiers);' onmouseout='hideVariable("result", symIdentifiers);'>result</span><span class="keyword">)</span> <span class="comment"># keep this a two step process in case we later decide to extract other info</span>
<span class="keyword">}</span>



<span id="sym242" class="symbol" onmouseover='showVariable("fit_Maes", symIdentifiers);' onmouseout='hideVariable("fit_Maes", symIdentifiers);'>fit_Maes</span> <span class="assignement">&lt;-</span><span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">splityr</span><span class="eqformalargs">=</span>NULL<span class="keyword">,</span> <span class="formalargs">min_sp</span><span class="eqformalargs">=</span><span class="number">5</span><span class="keyword">,</span> <span class="formalargs">var</span><span class="eqformalargs">=</span><span id="sym243" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="formalargs">test</span><span class="eqformalargs">=</span><span class="number">4</span><span class="keyword">)</span><span class="keyword">{</span>
  <span class="comment"># fits the method described in Maes et al 2012 (Biol Cons 145: 258-266)</span>
  <span class="comment"># I checked this by comparing the results against those in Maes et al SI</span>
  <span class="comment"># the function returns numbers of sites in 2 time periods (out of the well-sampled ones), the %trend and p-value</span>
  <span class="comment"># 29/11/13: updated p-value as per Thierry Onkelinx's helper functions </span>
  <span class="comment">#           (I tried adding the var=T option but it doesn't really help deliver 'sensible' T1 errors)</span>
  <span class="comment"># 2/12/13: there have been several attempts to figure out the test statistic here</span>
  <span class="comment">#         I've modified the code to allow a choice.</span>
  <span class="comment"># 6/12/13: I've realised that low power is due to few sites passing the threshold.</span>
  <span class="comment">#         For pSVS=0.05 under Control, only 9% of sites have &gt;=5 species in both tp (12% have &gt;=3 species)</span>
  <span class="comment">#         For pSVS=0.1 under Control, 27% of sites have &gt;=5 species in both tp (30% have &gt;=3 species)</span>


  <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/reshape2"><span class="symbol">reshape2</span></a><span class="keyword">)</span>

  <span class="keyword">if</span><span class="keyword">(</span><a href="base/is.null.html">is.null</a><span class="keyword">(</span><span id="sym244" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">)</span> <span id="sym245" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span> <span class="assignement">&lt;-</span> <a href="stats/median.html">median</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym246" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym247" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span>

  <span class="comment"># which time period is each record in?</span>
  <span id="sym248" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym249" class="symbol" onmouseover='showVariable("tp", symIdentifiers);' onmouseout='hideVariable("tp", symIdentifiers);'>tp</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">+</span> <span class="keyword">(</span><span id="sym250" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym251" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">&gt;</span> <span id="sym252" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span>

  <span class="comment"># convert the records into a 3D array</span>
  <span id="sym253" class="symbol" onmouseover='showVariable("rc", symIdentifiers);' onmouseout='hideVariable("rc", symIdentifiers);'>rc</span> <span class="assignement">&lt;-</span> <a href="NA/acast.html">acast</a><span class="keyword">(</span><span id="sym254" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym255" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span> <span class="keyword">~</span> <span id="sym256" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">~</span> <span id="sym257" class="symbol" onmouseover='showVariable("tp", symIdentifiers);' onmouseout='hideVariable("tp", symIdentifiers);'>tp</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym258" class="symbol" onmouseover='showVariable("occurrence", symIdentifiers);' onmouseout='hideVariable("occurrence", symIdentifiers);'>occurrence</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="number">2</span><span class="keyword">)</span>

  <span class="comment"># what is the observed species richness in each cell in each year</span>
  <span id="sym259" class="symbol" onmouseover='showVariable("rc1", symIdentifiers);' onmouseout='hideVariable("rc1", symIdentifiers);'>rc1</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym260" class="symbol" onmouseover='showVariable("rc", symIdentifiers);' onmouseout='hideVariable("rc", symIdentifiers);'>rc</span><span class="keyword">,</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">2</span><span class="keyword">,</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym261" class="symbol" onmouseover='showVariable("sum", symIdentifiers);' onmouseout='hideVariable("sum", symIdentifiers);'>sum</span><span class="keyword">)</span>

  <span class="comment"># which sites have are well-sampled? (defined as having at least min_sp species in BOTH time periods)</span>
  <span id="sym262" class="symbol" onmouseover='showVariable("well_sampled", symIdentifiers);' onmouseout='hideVariable("well_sampled", symIdentifiers);'>well_sampled</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym263" class="symbol" onmouseover='showVariable("rc1", symIdentifiers);' onmouseout='hideVariable("rc1", symIdentifiers);'>rc1</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym264" class="symbol" onmouseover='showVariable("rc1", symIdentifiers);' onmouseout='hideVariable("rc1", symIdentifiers);'>rc1</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <a href="base/all.html">all</a><span class="keyword">(</span><span id="sym265" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">&gt;=</span><span id="sym266" class="symbol" onmouseover='showVariable("min_sp", symIdentifiers);' onmouseout='hideVariable("min_sp", symIdentifiers);'>min_sp</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span>
  <span class="comment">#well_sampled &lt;- as.numeric(names(which(apply(rc1 &gt;= min_sp, 1, all)))) # alternate formulation</span>

  <span class="comment"># look at just the data for these well-sampled cells</span>
  <span id="sym267" class="symbol" onmouseover='showVariable("rc2", symIdentifiers);' onmouseout='hideVariable("rc2", symIdentifiers);'>rc2</span> <span class="assignement">&lt;-</span> <span id="sym268" class="symbol" onmouseover='showVariable("rc", symIdentifiers);' onmouseout='hideVariable("rc", symIdentifiers);'>rc</span><span class="keyword">[</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym269" class="symbol" onmouseover='showVariable("rc", symIdentifiers);' onmouseout='hideVariable("rc", symIdentifiers);'>rc</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span> <span class="keyword">%in%</span> <span id="sym270" class="symbol" onmouseover='showVariable("well_sampled", symIdentifiers);' onmouseout='hideVariable("well_sampled", symIdentifiers);'>well_sampled</span><span class="keyword">,</span><span class="keyword">]</span>

  <span class="comment"># how many sites for each species in each time period?</span>
  <span id="sym271" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym272" class="symbol" onmouseover='showVariable("rc2", symIdentifiers);' onmouseout='hideVariable("rc2", symIdentifiers);'>rc2</span><span class="keyword">,</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym273" class="symbol" onmouseover='showVariable("sum", symIdentifiers);' onmouseout='hideVariable("sum", symIdentifiers);'>sum</span><span class="keyword">)</span>

  <span class="comment"># calculate the relative distribution in each time period</span>
  <span id="sym274" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym275" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <span id="sym276" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">/</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym277" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span>

  <span id="sym278" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span> <span class="assignement">&lt;-</span> <a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym279" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">)</span>

  <span class="comment">##########################################################</span>
  <span class="comment"># 3 helper functions by Thierry Onkelinx</span>
  <span id="sym280" class="symbol" onmouseover='showVariable("sampleRd", symIdentifiers);' onmouseout='hideVariable("sampleRd", symIdentifiers);'>sampleRd</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">rd</span><span class="keyword">,</span> <span class="formalargs">n</span><span class="keyword">,</span> <span class="formalargs">rd.names</span> <span class="eqformalargs">=</span> <a href="base/factor.html">factor</a><span class="keyword">(</span><a href="base/seq_len.html">seq_len</a><span class="keyword">(</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym281" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment">#Generate a new set of relative distributions based on a given set of relative distributions</span>
    <span class="comment">#@author Thierry Onkelinx</span>
    <span class="comment">#@export</span>
    <span class="comment">#@param rd a matrix with relative distributions. The first column contains the relative distribution at the first timepoint. The column column those of the second timepoint. Other columns are ignored.</span>
    <span class="comment">#@param n a vector with the number of sampled gridcells in each period. Only the first two are used.</span>
    <span class="comment">#@param rd.names an optinal vector with the species names</span>
    <span class="comment">#@return a matrix with five columns and as much rows as in rd. </span>
    <span class="comment"># The columns contain: </span>
    <span class="comment"># 1) the resampled relative distribution at timepoint 1</span>
    <span class="comment"># 2) the resampled relative distribution at timepoint 2 under the null hypothesis (rd1 == rd2)</span>
    <span class="comment"># 3) the resampled relative distribution at timepoint 2 under the alternate hypothesis (rd1 != rd2)</span>
    <span class="comment"># 4) the index from Maes et al assuming the null hypothesis and the </span>
    <span class="comment"># 5) observed index from Maes et al based on the new sample.</span>
    <span id="sym282" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span> <span class="assignement">&lt;-</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><span id="sym283" class="symbol" onmouseover='showVariable("rd.names", symIdentifiers);' onmouseout='hideVariable("rd.names", symIdentifiers);'>rd.names</span><span class="keyword">,</span> <span class="argument">size</span> <span class="argument">=</span> <span id="sym284" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">prob</span> <span class="argument">=</span> <span id="sym285" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">replace</span> <span class="argument">=</span> <span class="number">TRUE</span><span class="keyword">)</span>
    <span id="sym286" class="symbol" onmouseover='showVariable("t2.0", symIdentifiers);' onmouseout='hideVariable("t2.0", symIdentifiers);'>t2.0</span> <span class="assignement">&lt;-</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><span id="sym287" class="symbol" onmouseover='showVariable("rd.names", symIdentifiers);' onmouseout='hideVariable("rd.names", symIdentifiers);'>rd.names</span><span class="keyword">,</span> <span class="argument">size</span> <span class="argument">=</span> <span id="sym288" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">prob</span> <span class="argument">=</span> <span id="sym289" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">replace</span> <span class="argument">=</span> <span class="number">TRUE</span><span class="keyword">)</span>
    <span id="sym290" class="symbol" onmouseover='showVariable("t2.a", symIdentifiers);' onmouseout='hideVariable("t2.a", symIdentifiers);'>t2.a</span> <span class="assignement">&lt;-</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><span id="sym291" class="symbol" onmouseover='showVariable("rd.names", symIdentifiers);' onmouseout='hideVariable("rd.names", symIdentifiers);'>rd.names</span><span class="keyword">,</span> <span class="argument">size</span> <span class="argument">=</span> <span id="sym292" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">prob</span> <span class="argument">=</span> <span id="sym293" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">replace</span> <span class="argument">=</span> <span class="number">TRUE</span><span class="keyword">)</span>
    <span id="sym294" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span> <span class="assignement">&lt;-</span> <a href="base/table.html">table</a><span class="keyword">(</span><span id="sym295" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym296" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span>
    <span id="sym297" class="symbol" onmouseover='showVariable("t2.0", symIdentifiers);' onmouseout='hideVariable("t2.0", symIdentifiers);'>t2.0</span> <span class="assignement">&lt;-</span> <a href="base/table.html">table</a><span class="keyword">(</span><span id="sym298" class="symbol" onmouseover='showVariable("t2.0", symIdentifiers);' onmouseout='hideVariable("t2.0", symIdentifiers);'>t2.0</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym299" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span>
    <span id="sym300" class="symbol" onmouseover='showVariable("t2.a", symIdentifiers);' onmouseout='hideVariable("t2.a", symIdentifiers);'>t2.a</span> <span class="assignement">&lt;-</span> <a href="base/table.html">table</a><span class="keyword">(</span><span id="sym301" class="symbol" onmouseover='showVariable("t2.a", symIdentifiers);' onmouseout='hideVariable("t2.a", symIdentifiers);'>t2.a</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym302" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span>
    <a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym303" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span><span class="keyword">,</span> <span id="sym304" class="symbol" onmouseover='showVariable("t2.0", symIdentifiers);' onmouseout='hideVariable("t2.0", symIdentifiers);'>t2.0</span><span class="keyword">,</span> <span id="sym305" class="symbol" onmouseover='showVariable("t2.a", symIdentifiers);' onmouseout='hideVariable("t2.a", symIdentifiers);'>t2.a</span><span class="keyword">,</span>
          <span class="argument">d0</span><span class="argument">=</span><span class="keyword">(</span><span id="sym306" class="symbol" onmouseover='showVariable("t2.0", symIdentifiers);' onmouseout='hideVariable("t2.0", symIdentifiers);'>t2.0</span> <span class="keyword">-</span> <span id="sym307" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym308" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span><span class="keyword">,</span> <span class="argument">da</span><span class="argument">=</span><span class="keyword">(</span><span id="sym309" class="symbol" onmouseover='showVariable("t2.a", symIdentifiers);' onmouseout='hideVariable("t2.a", symIdentifiers);'>t2.a</span> <span class="keyword">-</span> <span id="sym310" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym311" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span><span class="keyword">,</span>
          <span class="argument">dx0</span><span class="argument">=</span><span class="keyword">(</span><span id="sym312" class="symbol" onmouseover='showVariable("t2.0", symIdentifiers);' onmouseout='hideVariable("t2.0", symIdentifiers);'>t2.0</span> <span class="keyword">-</span> <span id="sym313" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span><span class="keyword">)</span><span class="keyword">/</span><span id="sym314" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">dxa</span><span class="argument">=</span><span class="keyword">(</span><span id="sym315" class="symbol" onmouseover='showVariable("t2.a", symIdentifiers);' onmouseout='hideVariable("t2.a", symIdentifiers);'>t2.a</span> <span class="keyword">-</span> <span id="sym316" class="symbol" onmouseover='showVariable("t1", symIdentifiers);' onmouseout='hideVariable("t1", symIdentifiers);'>t1</span><span class="keyword">)</span><span class="keyword">/</span><span id="sym317" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># Added by NI to reduce the variance</span>
  <span class="keyword">}</span>

  <span id="sym318" class="symbol" onmouseover='showVariable("twoSidedPValue", symIdentifiers);' onmouseout='hideVariable("twoSidedPValue", symIdentifiers);'>twoSidedPValue</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">rd</span><span class="keyword">,</span> <span class="formalargs">n</span><span class="keyword">,</span> <span class="formalargs">distribution</span><span class="keyword">,</span> <span class="formalargs">var</span><span class="eqformalargs">=</span><span id="sym319" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment">#Calculate two sided p-values for the index from Maes et al based on their bootstrapped distribution under the null hypothesis</span>
    <span class="comment"># @author Thierry Onkelinx</span>
    <span class="comment"># @export</span>
    <span class="comment"># @param rd a matrix with relative distributions. The first column contains the relative distribution at the first timepoint. The column column those of the second timepoint. Other columns are ignored.</span>
    <span class="comment"># @param n a vector with the number of sampled gridcells in each period. Only the first two are used. Ignored when distribution is given.</span>
    <span class="comment"># @param distribution a list with at least one item H0 contains a matrix with as many rows as rd containing resampled values of the index under the null hypothesis. Will be calculated if missing.</span>
    <span class="comment"># @return a vector with two sided p-values for each row of rd</span>

    <span id="sym320" class="symbol" onmouseover='showVariable("var", symIdentifiers);' onmouseout='hideVariable("var", symIdentifiers);'>var</span> <span class="assignement">&lt;-</span> <a href="base/ifelse.html">ifelse</a><span class="keyword">(</span><span id="sym321" class="symbol" onmouseover='showVariable("var", symIdentifiers);' onmouseout='hideVariable("var", symIdentifiers);'>var</span><span class="keyword">,</span> <span class="number">4</span><span class="keyword">,</span><span class="number">6</span><span class="keyword">)</span> <span class="comment"># should we use the randomised value in the denominator or the observed?</span>

    <span class="keyword">if</span><span class="keyword">(</span><a href="base/missing.html">missing</a><span class="keyword">(</span><span id="sym322" class="symbol" onmouseover='showVariable("distribution", symIdentifiers);' onmouseout='hideVariable("distribution", symIdentifiers);'>distribution</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
      <span class="keyword">if</span><span class="keyword">(</span><a href="base/missing.html">missing</a><span class="keyword">(</span><span id="sym323" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
        <a href="base/stop.html">stop</a><span class="keyword">(</span><span class="string">"either n or distribution must be defined"</span><span class="keyword">)</span>
      <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
        <span id="sym324" class="symbol" onmouseover='showVariable("distribution", symIdentifiers);' onmouseout='hideVariable("distribution", symIdentifiers);'>distribution</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a><span class="keyword">(</span>
          <span class="argument">H0</span> <span class="argument">=</span> <a href="base/replicate.html">replicate</a><span class="keyword">(</span><span class="number">1e3</span><span class="keyword">,</span> <span class="keyword">{</span>
            <span id="sym325" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="NA/sampleRd.html">sampleRd</a><span class="keyword">(</span><span class="argument">rd</span> <span class="argument">=</span> <span id="sym326" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">,</span> <span class="argument">n</span> <span class="argument">=</span> <span id="sym327" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">)</span><span class="keyword">[</span><span class="keyword">,</span> <span id="sym328" class="symbol" onmouseover='showVariable("var", symIdentifiers);' onmouseout='hideVariable("var", symIdentifiers);'>var</span><span class="keyword">]</span>
          <span class="keyword">}</span><span class="keyword">)</span>
        <span class="keyword">)</span>
      <span class="keyword">}</span>
    <span class="keyword">}</span>
    <span id="sym329" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span> <span class="assignement">&lt;-</span> <span class="keyword">(</span><span id="sym330" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">-</span><span id="sym331" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">/</span><span id="sym332" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span>
    <span id="sym333" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span> <span class="assignement">&lt;-</span> <a href="base/sapply.html">sapply</a><span class="keyword">(</span><a href="base/seq_len.html">seq_len</a><span class="keyword">(</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym334" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span><span class="keyword">{</span>
      <span class="keyword">if</span><span class="keyword">(</span><a href="base/is.infinite.html">is.infinite</a><span class="keyword">(</span><span id="sym335" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">[</span><span id="sym336" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">|</span> <a href="base/is.na.html">is.na</a><span class="keyword">(</span><span id="sym337" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">[</span><span id="sym338" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="number">NA</span>
      <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">if</span><span class="keyword">(</span><span id="sym339" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">[</span><span id="sym340" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span><span class="keyword">{</span>
        <a href="base/mean.html">mean</a><span class="keyword">(</span><span id="sym341" class="symbol" onmouseover='showVariable("distribution", symIdentifiers);' onmouseout='hideVariable("distribution", symIdentifiers);'>distribution</span><span class="keyword">$</span><span id="sym342" class="symbol" onmouseover='showVariable("H0", symIdentifiers);' onmouseout='hideVariable("H0", symIdentifiers);'>H0</span><span class="keyword">[</span><span id="sym343" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span> <span class="keyword">]</span> <span class="keyword">&gt;=</span> <span id="sym344" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">[</span><span id="sym345" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">*</span> <span class="number">2</span>
      <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
        <a href="base/mean.html">mean</a><span class="keyword">(</span><span id="sym346" class="symbol" onmouseover='showVariable("distribution", symIdentifiers);' onmouseout='hideVariable("distribution", symIdentifiers);'>distribution</span><span class="keyword">$</span><span id="sym347" class="symbol" onmouseover='showVariable("H0", symIdentifiers);' onmouseout='hideVariable("H0", symIdentifiers);'>H0</span><span class="keyword">[</span><span id="sym348" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span> <span class="keyword">]</span> &lt;= <span id="sym349" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">[</span><span id="sym350" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">*</span> <span class="number">2</span>
      <span class="keyword">}</span>
    <span class="keyword">}</span><span class="keyword">)</span>
  <a href="base/return.html">return</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym351" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">,</span> <span id="sym352" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">}</span>

  <span id="sym353" class="symbol" onmouseover='showVariable("confintRd", symIdentifiers);' onmouseout='hideVariable("confintRd", symIdentifiers);'>confintRd</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">rd</span><span class="keyword">,</span> <span class="formalargs">n</span><span class="keyword">,</span> <span class="formalargs">distribution</span><span class="keyword">,</span> <span class="formalargs">alpha</span> <span class="eqformalargs">=</span> <span class="number">0.05</span><span class="keyword">,</span> <span class="formalargs">var</span><span class="eqformalargs">=</span><span id="sym354" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment">#'Calculate confidence intervals for the index from Maes et al based on their bootstrapped distribution under the alternative hypothesis</span>
    <span class="comment"># @author Thierry Onkelinx</span>
    <span class="comment"># @export</span>
    <span class="comment">#@param rd a matrix with relative distributions. The first column contains the relative distribution at the first timepoint. The column column those of the second timepoint. Other columns are ignored.</span>
    <span class="comment">#@param n a vector with the number of sampled gridcells in each period. Only the first two are used. Ignored when distribution is given.</span>
    <span class="comment">#@param distribution a list with at least one item Ha contains a matrix with as many rows as rd containing resampled values of the index under the alternative hypothesis. Will be calculated if missing.</span>
    <span class="comment">#@param alpha the errorlevel</span>
    <span class="comment">#@return a matrix with observed index, lower confidence limits, upper confidence limit and median.</span>

    <span id="sym355" class="symbol" onmouseover='showVariable("var", symIdentifiers);' onmouseout='hideVariable("var", symIdentifiers);'>var</span> <span class="assignement">&lt;-</span> <a href="base/ifelse.html">ifelse</a><span class="keyword">(</span><span id="sym356" class="symbol" onmouseover='showVariable("var", symIdentifiers);' onmouseout='hideVariable("var", symIdentifiers);'>var</span><span class="keyword">,</span> <span class="number">5</span><span class="keyword">,</span><span class="number">7</span><span class="keyword">)</span> <span class="comment"># should we use the randomised t1 in the denominator or the observed?</span>

    <span class="keyword">if</span><span class="keyword">(</span><a href="base/missing.html">missing</a><span class="keyword">(</span><span id="sym357" class="symbol" onmouseover='showVariable("distribution", symIdentifiers);' onmouseout='hideVariable("distribution", symIdentifiers);'>distribution</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
      <span class="keyword">if</span><span class="keyword">(</span><a href="base/missing.html">missing</a><span class="keyword">(</span><span id="sym358" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
        <a href="base/stop.html">stop</a><span class="keyword">(</span><span class="string">"either n or distribution must be given."</span><span class="keyword">)</span>
      <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
        <span id="sym359" class="symbol" onmouseover='showVariable("distribution", symIdentifiers);' onmouseout='hideVariable("distribution", symIdentifiers);'>distribution</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a><span class="keyword">(</span>
          <span class="argument">Ha</span> <span class="argument">=</span> <a href="base/replicate.html">replicate</a><span class="keyword">(</span><span class="number">1e3</span><span class="keyword">,</span> <span class="keyword">{</span>
            <span id="sym360" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="NA/sampleRd.html">sampleRd</a><span class="keyword">(</span><span class="argument">rd</span> <span class="argument">=</span> <span id="sym361" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">,</span> <span class="argument">n</span> <span class="argument">=</span> <span id="sym362" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">)</span><span class="keyword">[</span><span class="keyword">,</span> <span id="sym363" class="symbol" onmouseover='showVariable("var", symIdentifiers);' onmouseout='hideVariable("var", symIdentifiers);'>var</span><span class="keyword">]</span>
          <span class="keyword">}</span><span class="keyword">)</span>
        <span class="keyword">)</span>
      <span class="keyword">}</span>
    <span class="keyword">}</span>
    <span id="sym364" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/apply.html">apply</a><span class="keyword">(</span>
      <span id="sym365" class="symbol" onmouseover='showVariable("distribution", symIdentifiers);' onmouseout='hideVariable("distribution", symIdentifiers);'>distribution</span><span class="keyword">$</span><span id="sym366" class="symbol" onmouseover='showVariable("Ha", symIdentifiers);' onmouseout='hideVariable("Ha", symIdentifiers);'>Ha</span><span class="keyword">,</span>
      <span class="number">1</span><span class="keyword">,</span>
      <span id="sym367" class="symbol" onmouseover='showVariable("quantile", symIdentifiers);' onmouseout='hideVariable("quantile", symIdentifiers);'>quantile</span><span class="keyword">,</span>
      <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym368" class="symbol" onmouseover='showVariable("alpha", symIdentifiers);' onmouseout='hideVariable("alpha", symIdentifiers);'>alpha</span> <span class="keyword">/</span> <span class="number">2</span><span class="keyword">,</span> <span class="number">1</span> <span class="keyword">-</span> <span id="sym369" class="symbol" onmouseover='showVariable("alpha", symIdentifiers);' onmouseout='hideVariable("alpha", symIdentifiers);'>alpha</span> <span class="keyword">/</span> <span class="number">2</span><span class="keyword">,</span> <span class="number">0.5</span><span class="keyword">)</span>
    <span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">#x &lt;- cbind(rd[, 3], x)</span>
    <span class="comment">#colnames(x) &lt;- c("observed", "lcl", "ucl", "median")</span>
    <a href="base/colnames.html">colnames</a><span class="keyword">(</span><span id="sym370" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">"lcl"</span><span class="keyword">,</span> <span class="string">"ucl"</span><span class="keyword">,</span> <span class="string">"median"</span><span class="keyword">)</span>
    <span id="sym371" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span>
  <span class="keyword">}</span>

  <span class="comment">########################################################## end functions by thierry Onkelinx</span>

  <span class="keyword">if</span><span class="keyword">(</span><span id="sym372" class="symbol" onmouseover='showVariable("test", symIdentifiers);' onmouseout='hideVariable("test", symIdentifiers);'>test</span>==<span class="number">1</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment"># my simple version: binomial probability of t2 observations given prob in T1</span>
    <span id="sym373" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span> <span class="assignement">&lt;-</span> <span class="keyword">(</span><span id="sym374" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">-</span><span id="sym375" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">/</span><span id="sym376" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span>
    <span id="sym377" class="symbol" onmouseover='showVariable("pval", symIdentifiers);' onmouseout='hideVariable("pval", symIdentifiers);'>pval</span> <span class="assignement">&lt;-</span> <a href="base/mapply.html">mapply</a><span class="keyword">(</span><span class="argument">FUN</span><span class="argument">=</span><span id="sym378" class="symbol" onmouseover='showVariable("pbinom", symIdentifiers);' onmouseout='hideVariable("pbinom", symIdentifiers);'>pbinom</span><span class="keyword">,</span> <span class="argument">q</span><span class="argument">=</span><span id="sym379" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym380" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">MoreArgs</span><span class="argument">=</span><a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">size</span><span class="argument">=</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym381" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">#these are one-tailed: convert them to one-tailed</span>
    <span id="sym382" class="symbol" onmouseover='showVariable("pval", symIdentifiers);' onmouseout='hideVariable("pval", symIdentifiers);'>pval</span> <span class="assignement">&lt;-</span> <a href="NA/one_to_two_tail.html">one_to_two_tail</a><span class="keyword">(</span><span id="sym383" class="symbol" onmouseover='showVariable("pval", symIdentifiers);' onmouseout='hideVariable("pval", symIdentifiers);'>pval</span><span class="keyword">)</span>
    <span id="sym384" class="symbol" onmouseover='showVariable("Maes_fit", symIdentifiers);' onmouseout='hideVariable("Maes_fit", symIdentifiers);'>Maes_fit</span> <span class="assignement">&lt;-</span> <a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym385" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">,</span> <span id="sym386" class="symbol" onmouseover='showVariable("pval", symIdentifiers);' onmouseout='hideVariable("pval", symIdentifiers);'>pval</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">if</span><span class="keyword">(</span><span id="sym387" class="symbol" onmouseover='showVariable("test", symIdentifiers);' onmouseout='hideVariable("test", symIdentifiers);'>test</span>==<span class="number">2</span><span class="keyword">)</span> <span class="keyword">{</span>
    <span id="sym388" class="symbol" onmouseover='showVariable("Maes_fit", symIdentifiers);' onmouseout='hideVariable("Maes_fit", symIdentifiers);'>Maes_fit</span> <span class="assignement">=</span> NULL <span class="comment"># to implement</span>
  <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">if</span><span class="keyword">(</span><span id="sym389" class="symbol" onmouseover='showVariable("test", symIdentifiers);' onmouseout='hideVariable("test", symIdentifiers);'>test</span>==<span class="number">3</span><span class="keyword">)</span> <span class="keyword">{</span> <span class="comment"># thierry#s modification of my bootstrapping suggestion</span>
    <span id="sym390" class="symbol" onmouseover='showVariable("Maes_fit", symIdentifiers);' onmouseout='hideVariable("Maes_fit", symIdentifiers);'>Maes_fit</span> <span class="assignement">&lt;-</span> <a href="NA/twoSidedPValue.html">twoSidedPValue</a><span class="keyword">(</span><span id="sym391" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">,</span> <span class="argument">n</span><span class="argument">=</span><span id="sym392" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">,</span> <span class="argument">var</span><span class="argument">=</span><span id="sym393" class="symbol" onmouseover='showVariable("var", symIdentifiers);' onmouseout='hideVariable("var", symIdentifiers);'>var</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">if</span><span class="keyword">(</span><span id="sym394" class="symbol" onmouseover='showVariable("test", symIdentifiers);' onmouseout='hideVariable("test", symIdentifiers);'>test</span>==<span class="number">4</span><span class="keyword">)</span> <span class="keyword">{</span> <span class="comment"># a binomial glm with gridcell sum as denominator</span>
    <span id="sym395" class="symbol" onmouseover='showVariable("Maes_fit", symIdentifiers);' onmouseout='hideVariable("Maes_fit", symIdentifiers);'>Maes_fit</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/sapply.html">sapply</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym396" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span> <span class="keyword">{</span>
      <span id="sym397" class="symbol" onmouseover='showVariable("obs", symIdentifiers);' onmouseout='hideVariable("obs", symIdentifiers);'>obs</span> <span class="assignement">&lt;-</span> <span id="sym398" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">[</span><span id="sym399" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span>
      <span id="sym400" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span> <span class="assignement">&lt;-</span> <a href="stats/glm.html">glm</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym401" class="symbol" onmouseover='showVariable("obs", symIdentifiers);' onmouseout='hideVariable("obs", symIdentifiers);'>obs</span><span class="keyword">,</span><span id="sym402" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">-</span><span id="sym403" class="symbol" onmouseover='showVariable("obs", symIdentifiers);' onmouseout='hideVariable("obs", symIdentifiers);'>obs</span><span class="keyword">)</span> <span class="keyword">~</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span class="number">2</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym404" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">)</span>
      <a href="base/summary.html">summary</a><span class="keyword">(</span><span id="sym405" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym406" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">)</span><span class="keyword">]</span>
      <span class="keyword">}</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">if</span><span class="keyword">(</span><span id="sym407" class="symbol" onmouseover='showVariable("test", symIdentifiers);' onmouseout='hideVariable("test", symIdentifiers);'>test</span>==<span class="number">5</span><span class="keyword">)</span> <span class="keyword">{</span> <span class="comment"># a binomial glm with number of sites as denominator</span>
    <span id="sym408" class="symbol" onmouseover='showVariable("Maes_fit", symIdentifiers);' onmouseout='hideVariable("Maes_fit", symIdentifiers);'>Maes_fit</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/sapply.html">sapply</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym409" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span> <span class="keyword">{</span>
      <span id="sym410" class="symbol" onmouseover='showVariable("obs", symIdentifiers);' onmouseout='hideVariable("obs", symIdentifiers);'>obs</span> <span class="assignement">&lt;-</span> <span id="sym411" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">[</span><span id="sym412" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span>
      <span id="sym413" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span> <span class="assignement">&lt;-</span> <a href="stats/glm.html">glm</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym414" class="symbol" onmouseover='showVariable("obs", symIdentifiers);' onmouseout='hideVariable("obs", symIdentifiers);'>obs</span><span class="keyword">,</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym415" class="symbol" onmouseover='showVariable("well_sampled", symIdentifiers);' onmouseout='hideVariable("well_sampled", symIdentifiers);'>well_sampled</span><span class="keyword">)</span><span class="keyword">-</span><span id="sym416" class="symbol" onmouseover='showVariable("obs", symIdentifiers);' onmouseout='hideVariable("obs", symIdentifiers);'>obs</span><span class="keyword">)</span> <span class="keyword">~</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span class="number">2</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym417" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">)</span>
      <a href="base/summary.html">summary</a><span class="keyword">(</span><span id="sym418" class="symbol" onmouseover='showVariable("mod", symIdentifiers);' onmouseout='hideVariable("mod", symIdentifiers);'>mod</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym419" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">)</span><span class="keyword">]</span>
    <span class="keyword">}</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="keyword">else</span> <span id="sym420" class="symbol" onmouseover='showVariable("Maes_fit", symIdentifiers);' onmouseout='hideVariable("Maes_fit", symIdentifiers);'>Maes_fit</span> <span class="assignement">=</span> NULL

  <span id="sym421" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span> <span class="assignement">&lt;-</span> <a href="base/data.frame.html">data.frame</a><span class="keyword">(</span><span class="argument">N1</span><span class="argument">=</span><span id="sym422" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">N2</span><span class="argument">=</span><span id="sym423" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">trend</span><span class="argument">=</span><span id="sym424" class="symbol" onmouseover='showVariable("Maes_fit", symIdentifiers);' onmouseout='hideVariable("Maes_fit", symIdentifiers);'>Maes_fit</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">pval</span><span class="argument">=</span><span id="sym425" class="symbol" onmouseover='showVariable("Maes_fit", symIdentifiers);' onmouseout='hideVariable("Maes_fit", symIdentifiers);'>Maes_fit</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">)</span>
  <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym426" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">,</span> <span class="string">'GridCellSums'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <span id="sym427" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span>
  <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym428" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">,</span> <span class="string">'wellsampled'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/length.html">length</a><span class="keyword">(</span><span id="sym429" class="symbol" onmouseover='showVariable("well_sampled", symIdentifiers);' onmouseout='hideVariable("well_sampled", symIdentifiers);'>well_sampled</span><span class="keyword">)</span>
  <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym430" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym431" class="symbol" onmouseover='showVariable("fit_Maes_old", symIdentifiers);' onmouseout='hideVariable("fit_Maes_old", symIdentifiers);'>fit_Maes_old</span> <span class="assignement">&lt;-</span><span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">splityr</span><span class="keyword">,</span> <span class="formalargs">min_sp</span><span class="eqformalargs">=</span><span class="number">5</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># fits the method described in Maes et al 2012 (Biol Cons 145: 258-266)</span>
    <span class="comment"># I checked this by comparing the results against those in Maes et al SI</span>
    <span class="comment"># I've added a sampling theory to estimate p-values. We'll see whether it's robust!</span>
    <span class="comment"># the function returns numbers of sites in 2 time periods (out of the well-sampled ones), the %trend and p-value</span>
    <span class="comment"># 31/9/13: updated p-value as per Thierry Onkelinx's code</span>

    <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/reshape2"><span class="symbol">reshape2</span></a><span class="keyword">)</span>

    <span class="comment"># which time period is each record in?</span>
    <span id="sym432" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym433" class="symbol" onmouseover='showVariable("tp", symIdentifiers);' onmouseout='hideVariable("tp", symIdentifiers);'>tp</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">+</span> <span class="keyword">(</span><span id="sym434" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym435" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">&gt;</span> <span id="sym436" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span>

    <span class="comment"># convert the records into a 3D array</span>
    <span id="sym437" class="symbol" onmouseover='showVariable("rc", symIdentifiers);' onmouseout='hideVariable("rc", symIdentifiers);'>rc</span> <span class="assignement">&lt;-</span> <a href="NA/acast.html">acast</a><span class="keyword">(</span><span id="sym438" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym439" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span> <span class="keyword">~</span> <span id="sym440" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">~</span> <span id="sym441" class="symbol" onmouseover='showVariable("tp", symIdentifiers);' onmouseout='hideVariable("tp", symIdentifiers);'>tp</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym442" class="symbol" onmouseover='showVariable("occurrence", symIdentifiers);' onmouseout='hideVariable("occurrence", symIdentifiers);'>occurrence</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="number">2</span><span class="keyword">)</span>

    <span class="comment"># what is the observed species richness in each cell in each year</span>
    <span id="sym443" class="symbol" onmouseover='showVariable("rc1", symIdentifiers);' onmouseout='hideVariable("rc1", symIdentifiers);'>rc1</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym444" class="symbol" onmouseover='showVariable("rc", symIdentifiers);' onmouseout='hideVariable("rc", symIdentifiers);'>rc</span><span class="keyword">,</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">2</span><span class="keyword">,</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym445" class="symbol" onmouseover='showVariable("sum", symIdentifiers);' onmouseout='hideVariable("sum", symIdentifiers);'>sum</span><span class="keyword">)</span>

    <span class="comment"># which sites have are well-sampled? (defined as having at least min_sp species in BOTH time periods)</span>
    <span id="sym446" class="symbol" onmouseover='showVariable("well_sampled", symIdentifiers);' onmouseout='hideVariable("well_sampled", symIdentifiers);'>well_sampled</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym447" class="symbol" onmouseover='showVariable("rc1", symIdentifiers);' onmouseout='hideVariable("rc1", symIdentifiers);'>rc1</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym448" class="symbol" onmouseover='showVariable("rc1", symIdentifiers);' onmouseout='hideVariable("rc1", symIdentifiers);'>rc1</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <a href="base/all.html">all</a><span class="keyword">(</span><span id="sym449" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">&gt;=</span><span id="sym450" class="symbol" onmouseover='showVariable("min_sp", symIdentifiers);' onmouseout='hideVariable("min_sp", symIdentifiers);'>min_sp</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span>
    <span class="comment">#well_sampled &lt;- as.numeric(names(which(apply(rc1 &gt;= min_sp, 1, all)))) # alternate formulation</span>

    <span class="comment"># look at just the data for these well-sampled cells</span>
    <span id="sym451" class="symbol" onmouseover='showVariable("rc2", symIdentifiers);' onmouseout='hideVariable("rc2", symIdentifiers);'>rc2</span> <span class="assignement">&lt;-</span> <span id="sym452" class="symbol" onmouseover='showVariable("rc", symIdentifiers);' onmouseout='hideVariable("rc", symIdentifiers);'>rc</span><span class="keyword">[</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym453" class="symbol" onmouseover='showVariable("rc", symIdentifiers);' onmouseout='hideVariable("rc", symIdentifiers);'>rc</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span> <span class="keyword">%in%</span> <span id="sym454" class="symbol" onmouseover='showVariable("well_sampled", symIdentifiers);' onmouseout='hideVariable("well_sampled", symIdentifiers);'>well_sampled</span><span class="keyword">,</span><span class="keyword">]</span>

    <span class="comment"># how many sites for each species in each time period?</span>
    <span id="sym455" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym456" class="symbol" onmouseover='showVariable("rc2", symIdentifiers);' onmouseout='hideVariable("rc2", symIdentifiers);'>rc2</span><span class="keyword">,</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym457" class="symbol" onmouseover='showVariable("sum", symIdentifiers);' onmouseout='hideVariable("sum", symIdentifiers);'>sum</span><span class="keyword">)</span>

    <span class="comment"># calculate the relative distribution in each time period</span>
    <span class="comment">#nS &lt;- colSums(rc1&gt;0)# the number of sites in each time period</span>
    <span class="comment">#rd1 &lt;- rc3[,1]/nS[1]</span>
    <span class="comment">#rd2 &lt;- rc3[,2]/nS[2]</span>
    <span class="comment"># trend &lt;- 100 * (rd2-rd1)/rd1</span>

    <span class="comment"># 12.9.13: THIS CODE ABOVE IS WRONG! </span>
    <span class="comment"># RE-reading Maes, I see that the denominator is *not* the total number of cells in each period</span>
    <span class="comment"># rather, it's the total number of unqiue site-species combos within the well-sampled set (for each period)</span>
    <span class="comment"># this is what Maes calles the 'grid cell sum'</span>
    <span class="comment"># CORRECTED VERSION HERE:</span>
    <span id="sym458" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym459" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <span id="sym460" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">/</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym461" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">#trend &lt;- 100 * (rd[,2]-rd[,1])/rd[,1]    # 13/11/13: trend is estimated below as a proportion, not %</span>

    <span class="comment"># we can assess the significance of this method as follows</span>
    <span class="comment"># first we assume the distribution of each species is equal among poorly-sampled and well-sampled sites</span>
    <span class="comment"># Under the null hypothesis that total proportion of sites has not changed,</span>
    <span class="comment"># we can calculate the binomial probability of the 'estimated number of successes</span>
    <span class="comment"># estimated number of successes is defined here as nsr2 (number of sites recorded in t2)</span>
    <span class="comment"># where the number of trials = nS[2]</span>
    <span class="comment"># 12.9.13 I've changed this</span>

    <span class="comment">#nsr2 &lt;- nS[1] * rc3[,2] / length(well_sampled)</span>
    <span class="comment">#true_probs &lt;- rc3[,1]/length(well_sampled)</span>
    <span class="comment">#pval &lt;- mapply(FUN=pbinom, q=rc3[,2], prob=true_probs, MoreArgs=list(size=nS[1]))</span>

    <span class="comment"># corrected version</span>
    <span class="comment">#pval &lt;- mapply(FUN=pbinom, q=rc3[,2], prob=rd[,1], MoreArgs=list(size=sum(rc3[,2])))</span>

    <span class="comment">#these are one-tailed: convert them to one-tailed</span>
    <span class="comment">#pval &lt;- one_to_two_tail(pval)</span>

    <span class="comment"># New version, by Thierry Onkelinx</span>
    <span id="sym462" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span> <span class="assignement">&lt;-</span> <a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym463" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">)</span>
    <span class="comment">#confidence intervals under the alternative hypothesis</span>
    <span id="sym464" class="symbol" onmouseover='showVariable("CI", symIdentifiers);' onmouseout='hideVariable("CI", symIdentifiers);'>CI</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym465" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span><span class="keyword">{</span>
      <a href="stats/quantile.html">quantile</a><span class="keyword">(</span>
        <a href="stats/na.omit.html">na.omit</a><span class="keyword">(</span><span class="comment">#ignore trends where the species is absent in both time periods</span>
          <a href="base/apply.html">apply</a><span class="keyword">(</span>
            <span class="comment">#simulate under the alternative hypothesis</span>
            <a href="base/matrix.html">matrix</a><span class="keyword">(</span>
              <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="number">2e3</span><span class="keyword">,</span> <span class="argument">size</span> <span class="argument">=</span> <span id="sym466" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">,</span> <span class="argument">prob</span> <span class="argument">=</span> <span id="sym467" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym468" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">,</span>
              <span class="argument">nrow</span> <span class="argument">=</span> <span class="number">2</span><span class="keyword">)</span><span class="keyword">,</span>
            <span class="number">2</span><span class="keyword">,</span>
            <span class="comment">#calculate simulated trend under the alternative hypothesis</span>
            <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">y</span><span class="keyword">)</span><span class="keyword">{</span><span class="keyword">(</span><span id="sym469" class="symbol" onmouseover='showVariable("y", symIdentifiers);' onmouseout='hideVariable("y", symIdentifiers);'>y</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span> <span class="keyword">-</span> <span id="sym470" class="symbol" onmouseover='showVariable("y", symIdentifiers);' onmouseout='hideVariable("y", symIdentifiers);'>y</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym471" class="symbol" onmouseover='showVariable("y", symIdentifiers);' onmouseout='hideVariable("y", symIdentifiers);'>y</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">}</span>
          <span class="keyword">)</span>
        <span class="keyword">)</span><span class="keyword">,</span>
        <span class="argument">prob</span> <span class="argument">=</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">0.025</span><span class="keyword">,</span> <span class="number">0.975</span><span class="keyword">)</span>
      <span class="keyword">)</span>
    <span class="keyword">}</span><span class="keyword">)</span><span class="keyword">)</span>

    <span class="comment">#p-values under the null hypothesis</span>
    <span id="sym472" class="symbol" onmouseover='showVariable("p.values", symIdentifiers);' onmouseout='hideVariable("p.values", symIdentifiers);'>p.values</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym473" class="symbol" onmouseover='showVariable("rd", symIdentifiers);' onmouseout='hideVariable("rd", symIdentifiers);'>rd</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span><span class="keyword">{</span>
      <span id="sym474" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span> <span class="assignement">&lt;-</span> <span class="keyword">(</span><span id="sym475" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span> <span class="keyword">-</span> <span id="sym476" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym477" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span>
      <span id="sym478" class="symbol" onmouseover='showVariable("trend.null", symIdentifiers);' onmouseout='hideVariable("trend.null", symIdentifiers);'>trend.null</span> <span class="assignement">&lt;-</span> <a href="stats/na.omit.html">na.omit</a><span class="keyword">(</span><a href="base/apply.html">apply</a><span class="keyword">(</span>
        <span class="comment">#simulate under the null hypothesis x[1] == x[2]</span>
        <a href="base/matrix.html">matrix</a><span class="keyword">(</span>
          <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="number">2e3</span><span class="keyword">,</span> <span class="argument">size</span> <span class="argument">=</span> <span id="sym479" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">,</span> <span class="argument">prob</span> <span class="argument">=</span> <span id="sym480" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym481" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">,</span>
          <span class="argument">nrow</span> <span class="argument">=</span> <span class="number">2</span>
        <span class="keyword">)</span><span class="keyword">,</span>
        <span class="number">2</span><span class="keyword">,</span>
        <span class="comment">#calculate simulated trend under the null hypothesis</span>
        <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">y</span><span class="keyword">)</span><span class="keyword">{</span><span class="keyword">(</span><span id="sym482" class="symbol" onmouseover='showVariable("y", symIdentifiers);' onmouseout='hideVariable("y", symIdentifiers);'>y</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span> <span class="keyword">-</span> <span id="sym483" class="symbol" onmouseover='showVariable("y", symIdentifiers);' onmouseout='hideVariable("y", symIdentifiers);'>y</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym484" class="symbol" onmouseover='showVariable("y", symIdentifiers);' onmouseout='hideVariable("y", symIdentifiers);'>y</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">}</span>
      <span class="keyword">)</span><span class="keyword">)</span>
      <a href="base/c.html">c</a><span class="keyword">(</span>
        <span class="argument">trend</span> <span class="argument">=</span> <a href="base/unname.html">unname</a><span class="keyword">(</span><span id="sym485" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">)</span><span class="keyword">,</span>
        <span class="argument">p.negative.trend.one.sided</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><span id="sym486" class="symbol" onmouseover='showVariable("trend.null", symIdentifiers);' onmouseout='hideVariable("trend.null", symIdentifiers);'>trend.null</span> &lt;= <span id="sym487" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">)</span><span class="keyword">,</span>
        <span class="argument">p.positive.trend.one.sided</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><span id="sym488" class="symbol" onmouseover='showVariable("trend.null", symIdentifiers);' onmouseout='hideVariable("trend.null", symIdentifiers);'>trend.null</span> <span class="keyword">&gt;=</span> <span id="sym489" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">)</span><span class="keyword">,</span>
        <span class="argument">p.absolute.trend.two.sided</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/abs.html">abs</a><span class="keyword">(</span><span id="sym490" class="symbol" onmouseover='showVariable("trend.null", symIdentifiers);' onmouseout='hideVariable("trend.null", symIdentifiers);'>trend.null</span><span class="keyword">)</span> <span class="keyword">&gt;=</span> <a href="base/abs.html">abs</a><span class="keyword">(</span><span id="sym491" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">)</span>
    <span class="keyword">}</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">########## end of Thierry Onkelinx's code    </span>

    <span id="sym492" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span> <span class="assignement">&lt;-</span> <a href="base/data.frame.html">data.frame</a><span class="keyword">(</span><span class="argument">N1</span><span class="argument">=</span><span id="sym493" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">N2</span><span class="argument">=</span><span id="sym494" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">trend</span><span class="argument">=</span><span id="sym495" class="symbol" onmouseover='showVariable("p.values", symIdentifiers);' onmouseout='hideVariable("p.values", symIdentifiers);'>p.values</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">pval</span><span class="argument">=</span><span id="sym496" class="symbol" onmouseover='showVariable("p.values", symIdentifiers);' onmouseout='hideVariable("p.values", symIdentifiers);'>p.values</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym497" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">,</span> <span class="string">'GridCellSums'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym498" class="symbol" onmouseover='showVariable("rc3", symIdentifiers);' onmouseout='hideVariable("rc3", symIdentifiers);'>rc3</span><span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym499" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">,</span> <span class="string">'wellsampled'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/length.html">length</a><span class="keyword">(</span><span id="sym500" class="symbol" onmouseover='showVariable("well_sampled", symIdentifiers);' onmouseout='hideVariable("well_sampled", symIdentifiers);'>well_sampled</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym501" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span class="comment">#takes a dataframe of observations, with a vector indexing the time period</span>
<span id="sym502" class="symbol" onmouseover='showVariable("fit_Telfer", symIdentifiers);' onmouseout='hideVariable("fit_Telfer", symIdentifiers);'>fit_Telfer</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">gridcell_counts</span><span class="keyword">,</span> <span class="formalargs">min_sq</span><span class="eqformalargs">=</span><span class="number">5</span><span class="keyword">)</span> <span class="keyword">{</span>
        <span class="comment">#takes output from Convert_to_2tp and fits the telfer model</span>
        <span class="comment">#convert to proportions	</span>
        <span id="sym503" class="symbol" onmouseover='showVariable("p1", symIdentifiers);' onmouseout='hideVariable("p1", symIdentifiers);'>p1</span> <span class="assignement">&lt;-</span> <span id="sym504" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">$</span><span id="sym505" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span><span class="keyword">/</span><a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym506" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">,</span> <span class="string">'denom'</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span>
        <span id="sym507" class="symbol" onmouseover='showVariable("p2", symIdentifiers);' onmouseout='hideVariable("p2", symIdentifiers);'>p2</span> <span class="assignement">&lt;-</span> <span id="sym508" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">$</span><span id="sym509" class="symbol" onmouseover='showVariable("n2", symIdentifiers);' onmouseout='hideVariable("n2", symIdentifiers);'>n2</span><span class="keyword">/</span><a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym510" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">,</span> <span class="string">'denom'</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span>

        <span class="comment">#Telfer's method is the *standardized* residual from a logit-logit regression</span>
        <span id="sym511" class="symbol" onmouseover='showVariable("model1", symIdentifiers);' onmouseout='hideVariable("model1", symIdentifiers);'>model1</span> <span class="assignement">&lt;-</span> <a href="stats/lm.html">lm</a><span class="keyword">(</span> <a href="base/log.html">log</a><span class="keyword">(</span><span id="sym512" class="symbol" onmouseover='showVariable("p2", symIdentifiers);' onmouseout='hideVariable("p2", symIdentifiers);'>p2</span><span class="keyword">/</span><span class="keyword">(</span><span class="number">1</span><span class="keyword">-</span><span id="sym513" class="symbol" onmouseover='showVariable("p2", symIdentifiers);' onmouseout='hideVariable("p2", symIdentifiers);'>p2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">~</span> <a href="base/log.html">log</a><span class="keyword">(</span><span id="sym514" class="symbol" onmouseover='showVariable("p1", symIdentifiers);' onmouseout='hideVariable("p1", symIdentifiers);'>p1</span><span class="keyword">/</span><span class="keyword">(</span><span class="number">1</span><span class="keyword">-</span><span id="sym515" class="symbol" onmouseover='showVariable("p1", symIdentifiers);' onmouseout='hideVariable("p1", symIdentifiers);'>p1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">subset</span><span class="argument">=</span><span id="sym516" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">$</span><span id="sym517" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span> <span class="keyword">&gt;=</span><span id="sym518" class="symbol" onmouseover='showVariable("min_sq", symIdentifiers);' onmouseout='hideVariable("min_sq", symIdentifiers);'>min_sq</span> <span class="keyword">&amp;</span> <span id="sym519" class="symbol" onmouseover='showVariable("p2", symIdentifiers);' onmouseout='hideVariable("p2", symIdentifiers);'>p2</span> <span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><a href="stats/rstandard.html">rstandard</a><span class="keyword">(</span><span id="sym520" class="symbol" onmouseover='showVariable("model1", symIdentifiers);' onmouseout='hideVariable("model1", symIdentifiers);'>model1</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">}</span>

<span id="sym521" class="symbol" onmouseover='showVariable("is.gridcell.wellsampled", symIdentifiers);' onmouseout='hideVariable("is.gridcell.wellsampled", symIdentifiers);'>is.gridcell.wellsampled</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">CellID</span><span class="keyword">,</span> <span class="formalargs">n</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># modified version of filter.gridcells()</span>
        <span class="comment">#takes the dataframe and returns the rownumbers of the dataset identifying well-sampled the gridcells</span>
        <span id="sym522" class="symbol" onmouseover='showVariable("nyrs", symIdentifiers);' onmouseout='hideVariable("nyrs", symIdentifiers);'>nyrs</span> <span class="assignement">&lt;-</span> <a href="base/table.html">table</a><span class="keyword">(</span><span id="sym523" class="symbol" onmouseover='showVariable("CellID", symIdentifiers);' onmouseout='hideVariable("CellID", symIdentifiers);'>CellID</span><span class="keyword">)</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym524" class="symbol" onmouseover='showVariable("CellID", symIdentifiers);' onmouseout='hideVariable("CellID", symIdentifiers);'>CellID</span> <span class="keyword">%in%</span> <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym525" class="symbol" onmouseover='showVariable("nyrs", symIdentifiers);' onmouseout='hideVariable("nyrs", symIdentifiers);'>nyrs</span><span class="keyword">)</span><span class="keyword">[</span><span id="sym526" class="symbol" onmouseover='showVariable("nyrs", symIdentifiers);' onmouseout='hideVariable("nyrs", symIdentifiers);'>nyrs</span> <span class="keyword">&gt;=</span> <span id="sym527" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>

<span id="sym528" class="symbol" onmouseover='showVariable("is.gridcell.wellsampled2", symIdentifiers);' onmouseout='hideVariable("is.gridcell.wellsampled2", symIdentifiers);'>is.gridcell.wellsampled2</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">data</span><span class="keyword">,</span> <span class="formalargs">n</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment">#takes the dataframe and returns a logical vector identifying well-sampled gridcells</span>
    <span class="comment">#this version copied from the Odonata trend analysis (late Feb 2013)</span>
    <span class="comment">#changed 4 March to filter on number of years, not number of visits</span>
    <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/reshape2"><span class="symbol">reshape2</span></a><span class="keyword">)</span>
    <span id="sym529" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="NA/acast.html">acast</a><span class="keyword">(</span><span id="sym530" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span><span class="keyword">,</span> <span id="sym531" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">~</span><span id="sym532" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym533" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'L'</span><span class="keyword">)</span> <span class="comment"># x is the number of visits</span>
    <span id="sym534" class="symbol" onmouseover='showVariable("num_yrs_visits", symIdentifiers);' onmouseout='hideVariable("num_yrs_visits", symIdentifiers);'>num_yrs_visits</span>  <span class="assignement">&lt;-</span> <a href="base/rowSums.html">rowSums</a><span class="keyword">(</span><span id="sym535" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span> <span class="comment"># convert nVisits to binary and sum across years </span>
    <span id="sym536" class="symbol" onmouseover='showVariable("sites_to_include", symIdentifiers);' onmouseout='hideVariable("sites_to_include", symIdentifiers);'>sites_to_include</span> <span class="assignement">&lt;-</span> <span id="sym537" class="symbol" onmouseover='showVariable("num_yrs_visits", symIdentifiers);' onmouseout='hideVariable("num_yrs_visits", symIdentifiers);'>num_yrs_visits</span> <span class="keyword">&gt;=</span> <span id="sym538" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym539" class="symbol" onmouseover='showVariable("data", symIdentifiers);' onmouseout='hideVariable("data", symIdentifiers);'>data</span><span class="keyword">$</span><span id="sym540" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">%in%</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym541" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym542" class="symbol" onmouseover='showVariable("sites_to_include", symIdentifiers);' onmouseout='hideVariable("sites_to_include", symIdentifiers);'>sites_to_include</span><span class="keyword">]</span><span class="keyword">)</span>
<span class="keyword">}</span>

<span class="comment">################################################# SIM-SPECIFIC FUNCTIONS</span>

<span id="sym543" class="symbol" onmouseover='showVariable("bias_focal", symIdentifiers);' onmouseout='hideVariable("bias_focal", symIdentifiers);'>bias_focal</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">disadvantage</span><span class="eqformalargs">=</span><span class="number">0.5</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># a clever way to simulate bias *against* is to delete records from 'well-sampled' set by stratified random sampling</span>
        <span class="comment"># disadvantage defines the proportion of lists where the focal species should be 'unrecorded'</span>
        <span class="comment"># If a single number then it's constant across years.</span>
        <span class="comment"># if numeric, this remains constant over time. If two numbers, the second number identifies the FINAL value</span>
        <span id="sym544" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span> <span class="assignement">&lt;-</span> <a href="base/ifelse.html">ifelse</a><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym545" class="symbol" onmouseover='showVariable("disadvantage", symIdentifiers);' onmouseout='hideVariable("disadvantage", symIdentifiers);'>disadvantage</span><span class="keyword">)</span>==<span class="number">1</span><span class="keyword">,</span> <span class="number">0</span><span class="keyword">,</span> <a href="base/diff.html">diff</a><span class="keyword">(</span><span id="sym546" class="symbol" onmouseover='showVariable("disadvantage", symIdentifiers);' onmouseout='hideVariable("disadvantage", symIdentifiers);'>disadvantage</span><span class="keyword">)</span> <span class="keyword">/</span> <a href="base/max.html">max</a><span class="keyword">(</span><span id="sym547" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym548" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># which extra ones should be included in each year</span>
        <span id="sym549" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym550" class="symbol" onmouseover='showVariable("record_id", symIdentifiers);' onmouseout='hideVariable("record_id", symIdentifiers);'>record_id</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym551" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span>
        <span id="sym552" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym553" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">subset</span><span class="argument">=</span><span id="sym554" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span>==<span class="string">'focal'</span><span class="keyword">)</span>
        <span id="sym555" class="symbol" onmouseover='showVariable("p_lost", symIdentifiers);' onmouseout='hideVariable("p_lost", symIdentifiers);'>p_lost</span> <span class="assignement">&lt;-</span> <span id="sym556" class="symbol" onmouseover='showVariable("disadvantage", symIdentifiers);' onmouseout='hideVariable("disadvantage", symIdentifiers);'>disadvantage</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span> <span class="keyword">+</span> <span id="sym557" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span> <span class="keyword">*</span> <span id="sym558" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">$</span><span id="sym559" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="comment"># probability of being 'lost' (un-recorded) is a function of year and disadvantage</span>
        <span id="sym560" class="symbol" onmouseover='showVariable("lost", symIdentifiers);' onmouseout='hideVariable("lost", symIdentifiers);'>lost</span> <span class="assignement">&lt;-</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym561" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym562" class="symbol" onmouseover='showVariable("p_lost", symIdentifiers);' onmouseout='hideVariable("p_lost", symIdentifiers);'>p_lost</span><span class="keyword">)</span> <span class="comment"># a vector of zero &amp; 1s indicating  </span>
        <span id="sym563" class="symbol" onmouseover='showVariable("record_id_to_lose", symIdentifiers);' onmouseout='hideVariable("record_id_to_lose", symIdentifiers);'>record_id_to_lose</span> <span class="assignement">&lt;-</span> <span id="sym564" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">$</span><span id="sym565" class="symbol" onmouseover='showVariable("record_id", symIdentifiers);' onmouseout='hideVariable("record_id", symIdentifiers);'>record_id</span><span class="keyword">[</span><span id="sym566" class="symbol" onmouseover='showVariable("lost", symIdentifiers);' onmouseout='hideVariable("lost", symIdentifiers);'>lost</span>==<span class="number">1</span><span class="keyword">]</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym567" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">[</span><span class="keyword">-</span><span id="sym568" class="symbol" onmouseover='showVariable("record_id_to_lose", symIdentifiers);' onmouseout='hideVariable("record_id_to_lose", symIdentifiers);'>record_id_to_lose</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># </span>
        <span class="keyword">}</span>


<span id="sym569" class="symbol" onmouseover='showVariable("create_data_1", symIdentifiers);' onmouseout='hideVariable("create_data_1", symIdentifiers);'>create_data_1</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nSites</span><span class="eqformalargs">=</span><span class="number">500</span><span class="keyword">,</span> <span class="formalargs">nSpecies</span><span class="eqformalargs">=</span><span class="number">25</span><span class="keyword">,</span> <span class="formalargs">pFocal</span><span class="eqformalargs">=</span><span class="number">0.5</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># The original version</span>
    <span class="comment"># 24 October: I removed the 'ubiquitous' option &amp; replaced it with a normal distribution of site occupancy</span>
        <span class="comment"># creates a site by species matrix of presence-absence data</span>
        <span class="comment">#focal &lt;- sample(x=c(1,0), size=nSites, replace=T, prob=c(pFocal, 1-pFocal))</span>
        <span id="sym570" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="assignement">&lt;-</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym571" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym572" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">)</span>
        <span class="comment">#if(ubiquitous) x &lt;- matrix(data=1, nr=nSites, ncol=nSpecies) #all non-focal species are everywhere</span>
        <span class="comment">#else x &lt;- matrix(data=sample(x=c(1,0), size=nSites*nSpecies, replace=T), nr=nSites, ncol=nSpecies) #all nonfocal species have 50% probability of occupancy</span>
        <span class="comment">#else x &lt;- matrix(data=rbinom(n=nSites*nSpecies, size=1, prob=0.5), nr=nSites, ncol=nSpecies) #all nonfocal species have 50% probability of occupancy</span>

        <span class="comment"># NEW: the probability of occupancy for any species is changed from a constant (0.5) to a random normal deviate</span>
        <span id="sym573" class="symbol" onmouseover='showVariable("prob", symIdentifiers);' onmouseout='hideVariable("prob", symIdentifiers);'>prob</span> <span class="assignement">&lt;-</span> <a href="stats/rnorm.html">rnorm</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym574" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">mean</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="argument">sd</span><span class="argument">=</span><span class="number">0.25</span><span class="keyword">)</span>
        <span id="sym575" class="symbol" onmouseover='showVariable("prob", symIdentifiers);' onmouseout='hideVariable("prob", symIdentifiers);'>prob</span><span class="keyword">[</span><span id="sym576" class="symbol" onmouseover='showVariable("prob", symIdentifiers);' onmouseout='hideVariable("prob", symIdentifiers);'>prob</span><span class="keyword">&gt;=</span><span class="number">1</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="number">1</span>
        <span id="sym577" class="symbol" onmouseover='showVariable("prob", symIdentifiers);' onmouseout='hideVariable("prob", symIdentifiers);'>prob</span><span class="keyword">[</span><span id="sym578" class="symbol" onmouseover='showVariable("prob", symIdentifiers);' onmouseout='hideVariable("prob", symIdentifiers);'>prob</span><span class="keyword">&lt;</span><span class="number">0.05</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="number">0.05</span>

        <span id="sym579" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/replicate.html">replicate</a><span class="keyword">(</span><span id="sym580" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym581" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym582" class="symbol" onmouseover='showVariable("prob", symIdentifiers);' onmouseout='hideVariable("prob", symIdentifiers);'>prob</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="comment">#summary(colSums(x)/nSites) # matches well with prob</span>
        <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym583" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'site'</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym584" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
        <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym585" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'spp'</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym586" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
        <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym587" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span><span class="string">'richness'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="base/rowSums.html">rowSums</a><span class="keyword">(</span><span id="sym588" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym589" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym590" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">,</span> <span id="sym591" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym592" class="symbol" onmouseover='showVariable("create_data_2", symIdentifiers);' onmouseout='hideVariable("create_data_2", symIdentifiers);'>create_data_2</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nSites</span><span class="eqformalargs">=</span><span class="number">500</span><span class="keyword">,</span> <span class="formalargs">nSpecies</span><span class="eqformalargs">=</span><span class="number">25</span><span class="keyword">,</span> <span class="formalargs">pFocal</span><span class="eqformalargs">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="formalargs">bsh1</span><span class="eqformalargs">=</span><span class="number">6</span><span class="keyword">,</span> <span class="formalargs">bsh2</span><span class="eqformalargs">=</span><span class="number">4</span><span class="keyword">,</span> <span class="formalargs">k</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">{</span>
  <span class="comment"># 3 December: as 'old' above, except</span>
  <span class="comment"># a) nonfocal species are defined by a beta distribution (occupancy &amp; detectability)</span>
  <span class="comment"># b) includes an attribute of the true detection probability for each species</span>

  <span id="sym593" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="assignement">&lt;-</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym594" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym595" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">)</span>

  <span class="comment"># define the probability of occupancy based on a beta distribution</span>
  <span id="sym596" class="symbol" onmouseover='showVariable("p_detect", symIdentifiers);' onmouseout='hideVariable("p_detect", symIdentifiers);'>p_detect</span> <span class="assignement">&lt;-</span> <a href="stats/rbeta.html">rbeta</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym597" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">,</span> <span id="sym598" class="symbol" onmouseover='showVariable("bsh1", symIdentifiers);' onmouseout='hideVariable("bsh1", symIdentifiers);'>bsh1</span><span class="keyword">,</span> <span id="sym599" class="symbol" onmouseover='showVariable("bsh2", symIdentifiers);' onmouseout='hideVariable("bsh2", symIdentifiers);'>bsh2</span><span class="keyword">)</span>
  <span class="comment">#sum(p_detect[p_detect&gt;=quantile(p_detect, 1-0.27)])/sum(p_detect) # around 0.34, ie 34% of detectablity lies within benchmarks. target is 45%</span>
  <span id="sym600" class="symbol" onmouseover='showVariable("p_occ", symIdentifiers);' onmouseout='hideVariable("p_occ", symIdentifiers);'>p_occ</span> <span class="assignement">&lt;-</span> <span id="sym601" class="symbol" onmouseover='showVariable("p_detect", symIdentifiers);' onmouseout='hideVariable("p_detect", symIdentifiers);'>p_detect</span> <span class="keyword">^</span> <span id="sym602" class="symbol" onmouseover='showVariable("k", symIdentifiers);' onmouseout='hideVariable("k", symIdentifiers);'>k</span>

  <span id="sym603" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/replicate.html">replicate</a><span class="keyword">(</span><span id="sym604" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym605" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym606" class="symbol" onmouseover='showVariable("p_occ", symIdentifiers);' onmouseout='hideVariable("p_occ", symIdentifiers);'>p_occ</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
  <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym607" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'site'</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym608" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
  <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym609" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'spp'</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym610" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
  <span id="sym611" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym612" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">,</span> <span id="sym613" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
  <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym614" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span><span class="string">'richness'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/rowSums.html">rowSums</a><span class="keyword">(</span><span id="sym615" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span>
  <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym616" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span><span class="string">'p_detect'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym617" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">,</span> <span id="sym618" class="symbol" onmouseover='showVariable("p_detect", symIdentifiers);' onmouseout='hideVariable("p_detect", symIdentifiers);'>p_detect</span><span class="keyword">)</span>
  <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym619" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym620" class="symbol" onmouseover='showVariable("create_data_3", symIdentifiers);' onmouseout='hideVariable("create_data_3", symIdentifiers);'>create_data_3</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nSites</span><span class="eqformalargs">=</span><span class="number">500</span><span class="keyword">,</span> <span class="formalargs">nSpecies</span><span class="eqformalargs">=</span><span class="number">25</span><span class="keyword">,</span> <span class="formalargs">pFocal</span><span class="eqformalargs">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="formalargs">bsh1</span><span class="eqformalargs">=</span><span class="number">6</span><span class="keyword">,</span> <span class="formalargs">bsh2</span><span class="eqformalargs">=</span><span class="number">4</span><span class="keyword">,</span> <span class="formalargs">k</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># 3 December: as 'old' above, except</span>
    <span class="comment"># a) nonfocal species are defined by a beta distribution (occupancy &amp; detectability)</span>
    <span class="comment"># b) includes an attribute of the true detection probability for each species</span>
    <span class="comment"># 10 January: Further modified so that detectablity follows Mark Hill's formula for detectability</span>
    <span class="comment"># I also removed the correlation between abundance and occupancy </span>

    <span id="sym621" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="assignement">&lt;-</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym622" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym623" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">)</span>

    <span class="comment"># define the probability of occupancy based on Mark Hill's formula</span>
    <span id="sym624" class="symbol" onmouseover='showVariable("Hill_detectability", symIdentifiers);' onmouseout='hideVariable("Hill_detectability", symIdentifiers);'>Hill_detectability</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nSp</span><span class="keyword">,</span> <span class="formalargs">a</span><span class="eqformalargs">=</span><span class="number">2.005</span><span class="keyword">,</span> <span class="formalargs">b</span><span class="eqformalargs">=</span><span class="keyword">-</span><span class="number">2.545</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># Here I apply a global version of Mark Hill's empirically-derived detectability function</span>
        <span class="comment"># It's appropriate for neighbourhoods where the expected number of species is 1/2 the total species pool</span>
        <span class="comment"># fâ(Râ) = 1 - exp(-exp(a+b Râ))</span>
        <span class="comment"># Parameters a and b were derived empirically from Bryophyte data</span>
        <span class="comment"># R is simply species number divided by 1/2 the total species richness</span>
        <span class="comment"># this way, the median detectability is about 0.42 and the minimum around 0.045 (using Mark's a and b)</span>
        <span id="sym625" class="symbol" onmouseover='showVariable("R", symIdentifiers);' onmouseout='hideVariable("R", symIdentifiers);'>R</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><span id="sym626" class="symbol" onmouseover='showVariable("nSp", symIdentifiers);' onmouseout='hideVariable("nSp", symIdentifiers);'>nSp</span><span class="keyword">/</span><span class="keyword">(</span><span class="number">0.5</span><span class="keyword">*</span><span id="sym627" class="symbol" onmouseover='showVariable("nSp", symIdentifiers);' onmouseout='hideVariable("nSp", symIdentifiers);'>nSp</span><span class="keyword">)</span>
        <span id="sym628" class="symbol" onmouseover='showVariable("pd", symIdentifiers);' onmouseout='hideVariable("pd", symIdentifiers);'>pd</span> <span class="assignement">&lt;-</span> <span class="number">1</span> <span class="keyword">-</span> <a href="base/exp.html">exp</a><span class="keyword">(</span><span class="keyword">-</span><a href="base/exp.html">exp</a><span class="keyword">(</span><span id="sym629" class="symbol" onmouseover='showVariable("a", symIdentifiers);' onmouseout='hideVariable("a", symIdentifiers);'>a</span><span class="keyword">+</span><span id="sym630" class="symbol" onmouseover='showVariable("b", symIdentifiers);' onmouseout='hideVariable("b", symIdentifiers);'>b</span><span class="keyword">*</span><span id="sym631" class="symbol" onmouseover='showVariable("R", symIdentifiers);' onmouseout='hideVariable("R", symIdentifiers);'>R</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="comment">#sum(pd[pd&gt;=quantile(pd, 1-0.27)])/sum(pd) # around 0.34, ie 34% of detectablity lies within benchmarks. target is 45%</span>
    <span class="keyword">}</span>

    <span id="sym632" class="symbol" onmouseover='showVariable("p_detect", symIdentifiers);' onmouseout='hideVariable("p_detect", symIdentifiers);'>p_detect</span> <span class="assignement">&lt;-</span> <a href="NA/Hill_detectability.html">Hill_detectability</a><span class="keyword">(</span><span id="sym633" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">)</span> <span class="comment"># substract focal since we're fixing that constant</span>
    <span class="comment">#p_occ &lt;- p_detect ^ k</span>
    <span id="sym634" class="symbol" onmouseover='showVariable("p_occ", symIdentifiers);' onmouseout='hideVariable("p_occ", symIdentifiers);'>p_occ</span> <span class="assignement">&lt;-</span> <a href="stats/rbeta.html">rbeta</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym635" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">,</span> <span id="sym636" class="symbol" onmouseover='showVariable("bsh1", symIdentifiers);' onmouseout='hideVariable("bsh1", symIdentifiers);'>bsh1</span><span class="keyword">,</span> <span id="sym637" class="symbol" onmouseover='showVariable("bsh2", symIdentifiers);' onmouseout='hideVariable("bsh2", symIdentifiers);'>bsh2</span><span class="keyword">)</span> <span class="keyword">^</span> <span id="sym638" class="symbol" onmouseover='showVariable("k", symIdentifiers);' onmouseout='hideVariable("k", symIdentifiers);'>k</span>

    <span id="sym639" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/replicate.html">replicate</a><span class="keyword">(</span><span id="sym640" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym641" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym642" class="symbol" onmouseover='showVariable("p_occ", symIdentifiers);' onmouseout='hideVariable("p_occ", symIdentifiers);'>p_occ</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym643" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'site'</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym644" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
    <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym645" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'spp'</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym646" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
    <span id="sym647" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym648" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">,</span> <span id="sym649" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym650" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span><span class="string">'richness'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/rowSums.html">rowSums</a><span class="keyword">(</span><span id="sym651" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym652" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span><span class="string">'p_detect'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym653" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">,</span> <span id="sym654" class="symbol" onmouseover='showVariable("p_detect", symIdentifiers);' onmouseout='hideVariable("p_detect", symIdentifiers);'>p_detect</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym655" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym656" class="symbol" onmouseover='showVariable("create_data", symIdentifiers);' onmouseout='hideVariable("create_data", symIdentifiers);'>create_data</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nSites</span><span class="eqformalargs">=</span><span class="number">500</span><span class="keyword">,</span> <span class="formalargs">nSpecies</span><span class="eqformalargs">=</span><span class="number">25</span><span class="keyword">,</span> <span class="formalargs">pFocal</span><span class="eqformalargs">=</span><a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">Occ</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="argument">DetP</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">)</span><span class="keyword">,</span> <span class="formalargs">ONR</span><span class="eqformalargs">=</span><span id="sym657" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">bsh1</span><span class="eqformalargs">=</span><span class="number">2</span><span class="keyword">,</span> <span class="formalargs">bsh2</span><span class="eqformalargs">=</span><span class="number">2</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># 3 December: as 'old' above, except</span>
    <span class="comment"># a) nonfocal species are defined by a beta distribution (occupancy &amp; detectability)</span>
    <span class="comment"># b) includes an attribute of the true detection probability for each species</span>
    <span class="comment"># 24 January: I fixed some inconsistency in the use of nSpecies</span>
    <span class="comment">#   For simplicity, the User-defined number of species is the number of NON-FOCALS</span>
    <span class="comment">#   I've also changed the shape of the interspecific occupancy distribution to be symmetrical around 0.5</span>
    <span class="comment">#   Although [mean occupancy]&lt;&lt;0.5 for most groups, this high number is necessary to generate enough 'global benchmarks'</span>
    <span class="comment">#   (i.e. species that are common enough everywhere to give Frescalo a decent change of generating neighbourhoods)</span>
    <span class="comment">#   And added an optional ONR (Occupancy Abundance(Number) Relationship) - the N follows McGill</span>
    <span class="comment">#   When False (the default) there is NO correlation between occupancy and detectability (abundance)</span>
    <span class="comment">#   When True, there is a perfect correlation between Detectability and Occupancy</span>
    <span class="comment"># 22 January: I further modified the detectability function, following consultation with Mark Hill.</span>
    <span class="comment">#   The function descrbed in create_data_3 (the last current version) is for a survey of intensity=1</span>
    <span class="comment">#   For bryophytes, surveying a hectad to this intensity takes 8 days!</span>
    <span class="comment">#   In Mark's concept, the pool of possible species being detected at a site is infinite,</span>
    <span class="comment">#       but the 'expected number of species from a complete survey (intensity &gt;&gt; 1) is known</span>
    <span class="comment">#   I want to simulate a standard visit, which is much less intense, but where the most detectable species are highly likely to be recorded</span>
    <span class="comment">#   I tried using an exponential decay function but it was much too steep.  </span>
    <span class="comment"># 9 April: pFocal separated into Occupancy &amp; probability of detection</span>

    <span class="comment"># first define the vector of presence-absence for the focal species</span>
    <span id="sym658" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="assignement">&lt;-</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym659" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym660" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">$</span><span id="sym661" class="symbol" onmouseover='showVariable("Occ", symIdentifiers);' onmouseout='hideVariable("Occ", symIdentifiers);'>Occ</span><span class="keyword">)</span>

    <span id="sym662" class="symbol" onmouseover='showVariable("HillP", symIdentifiers);' onmouseout='hideVariable("HillP", symIdentifiers);'>HillP</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nSp</span><span class="keyword">,</span> <span class="formalargs">pse</span><span class="eqformalargs">=</span><span class="number">1</span><span class="keyword">,</span> <span class="formalargs">a</span><span class="eqformalargs">=</span><span class="number">2.005</span><span class="keyword">,</span> <span class="formalargs">b</span><span class="eqformalargs">=</span><span class="keyword">-</span><span class="number">2.545</span><span class="keyword">,</span> <span class="formalargs">S</span><span class="eqformalargs">=</span><span class="number">0.3</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># generates a detectability decay curve as per Mark hill's Frescalo paper</span>
        <span class="comment"># under the default settings, the sppSVS has an 89% detection prob, the least detectable 16%.</span>
        <span class="comment"># the median detectability is 46%</span>
        <span class="comment"># this decay curve is close to linear</span>
        <span id="sym663" class="symbol" onmouseover='showVariable("R", symIdentifiers);' onmouseout='hideVariable("R", symIdentifiers);'>R</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><span id="sym664" class="symbol" onmouseover='showVariable("nSp", symIdentifiers);' onmouseout='hideVariable("nSp", symIdentifiers);'>nSp</span><span class="keyword">/</span><span class="keyword">(</span><span id="sym665" class="symbol" onmouseover='showVariable("pse", symIdentifiers);' onmouseout='hideVariable("pse", symIdentifiers);'>pse</span><span class="keyword">*</span><span id="sym666" class="symbol" onmouseover='showVariable("nSp", symIdentifiers);' onmouseout='hideVariable("nSp", symIdentifiers);'>nSp</span><span class="keyword">)</span>
        <span id="sym667" class="symbol" onmouseover='showVariable("pd", symIdentifiers);' onmouseout='hideVariable("pd", symIdentifiers);'>pd</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">-</span><a href="base/exp.html">exp</a><span class="keyword">(</span><span class="keyword">-</span><span id="sym668" class="symbol" onmouseover='showVariable("S", symIdentifiers);' onmouseout='hideVariable("S", symIdentifiers);'>S</span><span class="keyword">*</span><a href="base/exp.html">exp</a><span class="keyword">(</span><span id="sym669" class="symbol" onmouseover='showVariable("a", symIdentifiers);' onmouseout='hideVariable("a", symIdentifiers);'>a</span><span class="keyword">+</span><span id="sym670" class="symbol" onmouseover='showVariable("b", symIdentifiers);' onmouseout='hideVariable("b", symIdentifiers);'>b</span><span class="keyword">*</span><span id="sym671" class="symbol" onmouseover='showVariable("R", symIdentifiers);' onmouseout='hideVariable("R", symIdentifiers);'>R</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">}</span>

    <span id="sym672" class="symbol" onmouseover='showVariable("p_detect", symIdentifiers);' onmouseout='hideVariable("p_detect", symIdentifiers);'>p_detect</span> <span class="assignement">&lt;-</span> <a href="NA/HillP.html">HillP</a><span class="keyword">(</span><span id="sym673" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">)</span>
    <span class="keyword">if</span><span class="keyword">(</span><span id="sym674" class="symbol" onmouseover='showVariable("ONR", symIdentifiers);' onmouseout='hideVariable("ONR", symIdentifiers);'>ONR</span><span class="keyword">)</span> <span id="sym675" class="symbol" onmouseover='showVariable("p_occ", symIdentifiers);' onmouseout='hideVariable("p_occ", symIdentifiers);'>p_occ</span> <span class="assignement">&lt;-</span> <span id="sym676" class="symbol" onmouseover='showVariable("p_detect", symIdentifiers);' onmouseout='hideVariable("p_detect", symIdentifiers);'>p_detect</span>
    <span class="keyword">else</span> <span id="sym677" class="symbol" onmouseover='showVariable("p_occ", symIdentifiers);' onmouseout='hideVariable("p_occ", symIdentifiers);'>p_occ</span> <span class="assignement">&lt;-</span> <a href="stats/rbeta.html">rbeta</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym678" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span id="sym679" class="symbol" onmouseover='showVariable("bsh1", symIdentifiers);' onmouseout='hideVariable("bsh1", symIdentifiers);'>bsh1</span><span class="keyword">,</span> <span id="sym680" class="symbol" onmouseover='showVariable("bsh2", symIdentifiers);' onmouseout='hideVariable("bsh2", symIdentifiers);'>bsh2</span><span class="keyword">)</span>

    <span id="sym681" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/replicate.html">replicate</a><span class="keyword">(</span><span id="sym682" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span id="sym683" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym684" class="symbol" onmouseover='showVariable("p_occ", symIdentifiers);' onmouseout='hideVariable("p_occ", symIdentifiers);'>p_occ</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym685" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'site'</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym686" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
    <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym687" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'spp'</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym688" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
    <span id="sym689" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym690" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">,</span> <span id="sym691" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym692" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span><span class="string">'richness'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/rowSums.html">rowSums</a><span class="keyword">(</span><span id="sym693" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym694" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span><span class="string">'p_detect'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><span id="sym695" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">$</span><span id="sym696" class="symbol" onmouseover='showVariable("DetP", symIdentifiers);' onmouseout='hideVariable("DetP", symIdentifiers);'>DetP</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym697" class="symbol" onmouseover='showVariable("p_detect", symIdentifiers);' onmouseout='hideVariable("p_detect", symIdentifiers);'>p_detect</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym698" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym699" class="symbol" onmouseover='showVariable("generate_all_scenarios", symIdentifiers);' onmouseout='hideVariable("generate_all_scenarios", symIdentifiers);'>generate_all_scenarios</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nSites</span><span class="eqformalargs">=</span><span class="number">1000</span><span class="keyword">,</span> <span class="formalargs">nSpecies</span><span class="eqformalargs">=</span><span class="number">25</span><span class="keyword">,</span> <span class="formalargs">nYrs</span><span class="eqformalargs">=</span><span class="number">10</span><span class="keyword">,</span> <span class="formalargs">pSVS</span><span class="eqformalargs">=</span><span class="number">0.07</span><span class="keyword">,</span> <span class="formalargs">mv</span><span class="eqformalargs">=</span><span class="number">10</span><span class="keyword">,</span> <span class="formalargs">vrs</span><span class="eqformalargs">=</span><span id="sym700" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">stoch</span><span class="eqformalargs">=</span><span id="sym701" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="formalargs">Scenarios</span><span class="eqformalargs">=</span><span class="string">'BCDF'</span><span class="keyword">,</span> <span class="formalargs">combos</span><span class="eqformalargs">=</span><span id="sym702" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span>
                                   <span class="formalargs">save_data</span><span class="eqformalargs">=</span><span id="sym703" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">id</span><span class="eqformalargs">=</span><span class="string">''</span><span class="keyword">,</span> <span class="formalargs">pFocal</span><span class="eqformalargs">=</span><a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">Occ</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="argument">DetP</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">)</span><span class="keyword">,</span><span class="formalargs">p_short</span><span class="eqformalargs">=</span><a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">init</span><span class="argument">=</span><span class="number">0.6</span><span class="keyword">,</span><span class="argument">final</span><span class="argument">=</span><span class="number">0.9</span><span class="keyword">)</span><span class="keyword">,</span> <span class="formalargs">pDetMod</span><span class="eqformalargs">=</span><span class="number">0.2</span><span class="keyword">,</span> <span class="formalargs">decline</span><span class="eqformalargs">=</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># This is a wrapper for creating data</span>
    <span class="comment"># 25 October: added 'decline' for testing power</span>
    <span class="comment">#  3 December: removed B1 &amp; replaced E</span>
    <span class="comment"># 25 January 2013: I added B3: new sites are biased toward the focal species</span>
    <span class="comment">#  4 February: added F: decline in a nonfocal species</span>
    <span class="comment">#  7 February: added the option of user-controlled subset of scenarios</span>
    <span class="comment"># 13 February: I added the optional argument pFocal to allow exploration of changing it from outside</span>
    <span class="comment"># 14 February: I dropped D1 and F1</span>
    <span class="comment"># 8 April: removed B3n</span>

    <span class="comment"># the actual data   </span>
    <span id="sym704" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span> <span class="assignement">&lt;-</span> <a href="NA/create_data.html">create_data</a><span class="keyword">(</span><span class="argument">nSites</span><span class="argument">=</span><span id="sym705" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">nSpecies</span><span class="argument">=</span><span id="sym706" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">pFocal</span><span class="argument">=</span><span id="sym707" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">)</span>

    <span class="comment">#cntrlsp &lt;- median_occ(true_data) #the identity of a control species</span>
    <span id="sym708" class="symbol" onmouseover='showVariable("records_A", symIdentifiers);' onmouseout='hideVariable("records_A", symIdentifiers);'>records_A</span> <span class="assignement">=</span> <a href="NA/generate_records.html">generate_records</a><span class="keyword">(</span><span class="argument">nYrs</span><span class="argument">=</span><span id="sym709" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">,</span> <span class="argument">pSVS</span><span class="argument">=</span><span id="sym710" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">,</span> <span class="argument">true_data</span><span class="argument">=</span><span id="sym711" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">,</span> <span class="argument">decline</span><span class="argument">=</span><span id="sym712" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">,</span> <span class="argument">mv</span><span class="argument">=</span><span id="sym713" class="symbol" onmouseover='showVariable("mv", symIdentifiers);' onmouseout='hideVariable("mv", symIdentifiers);'>mv</span><span class="keyword">,</span> <span class="argument">vrs</span><span class="argument">=</span><span id="sym714" class="symbol" onmouseover='showVariable("vrs", symIdentifiers);' onmouseout='hideVariable("vrs", symIdentifiers);'>vrs</span><span class="keyword">,</span> <span class="argument">stoch</span><span class="argument">=</span><span id="sym715" class="symbol" onmouseover='showVariable("stoch", symIdentifiers);' onmouseout='hideVariable("stoch", symIdentifiers);'>stoch</span><span class="keyword">)</span>
    <span id="sym716" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">A_EvenRcrdng</span><span class="argument">=</span><span id="sym717" class="symbol" onmouseover='showVariable("records_A", symIdentifiers);' onmouseout='hideVariable("records_A", symIdentifiers);'>records_A</span><span class="keyword">)</span>

    <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'B'</span><span class="keyword">,</span> <span id="sym718" class="symbol" onmouseover='showVariable("Scenarios", symIdentifiers);' onmouseout='hideVariable("Scenarios", symIdentifiers);'>Scenarios</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment"># run the B Scenarios</span>
        <span class="comment">#records$B1_IncrnSite = subset_recs_by_X(records_A, X=records_A$Site, init=0.5), # first year has 50% sites, final year has all</span>
        <span id="sym719" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym720" class="symbol" onmouseover='showVariable("B2_IncrnVisit", symIdentifiers);' onmouseout='hideVariable("B2_IncrnVisit", symIdentifiers);'>B2_IncrnVisit</span> <span class="assignement">=</span> <a href="NA/subset_recs_by_X.html">subset_recs_by_X</a><span class="keyword">(</span><span id="sym721" class="symbol" onmouseover='showVariable("records_A", symIdentifiers);' onmouseout='hideVariable("records_A", symIdentifiers);'>records_A</span><span class="keyword">,</span> <span class="argument">X</span><span class="argument">=</span><span id="sym722" class="symbol" onmouseover='showVariable("records_A", symIdentifiers);' onmouseout='hideVariable("records_A", symIdentifiers);'>records_A</span><span class="keyword">$</span><span id="sym723" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span><span class="keyword">,</span> <span class="argument">init</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">)</span> <span class="comment"># first year has 50% visits, final year has all</span>
        <span id="sym724" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym725" class="symbol" onmouseover='showVariable("B3f_IncrnVBiasFc", symIdentifiers);' onmouseout='hideVariable("B3f_IncrnVBiasFc", symIdentifiers);'>B3f_IncrnVBiasFc</span> <span class="assignement">=</span> <a href="NA/subset_recs_Biased.html">subset_recs_Biased</a><span class="keyword">(</span><span id="sym726" class="symbol" onmouseover='showVariable("records_A", symIdentifiers);' onmouseout='hideVariable("records_A", symIdentifiers);'>records_A</span><span class="keyword">,</span> <span class="argument">init</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="argument">target</span><span class="argument">=</span><span id="sym727" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">[</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="comment">#records$B3n_IncrnVBiasNf = subset_recs_Biased(records_A, init=0.5, target=true_data[,cntrlsp]) # bias wrt a species of median detectability      </span>
    <span class="keyword">}</span>
    <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'C'</span><span class="keyword">,</span> <span id="sym728" class="symbol" onmouseover='showVariable("Scenarios", symIdentifiers);' onmouseout='hideVariable("Scenarios", symIdentifiers);'>Scenarios</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment"># run the C Scenarios</span>
        <span id="sym729" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym730" class="symbol" onmouseover='showVariable("C1_pShortLEven", symIdentifiers);' onmouseout='hideVariable("C1_pShortLEven", symIdentifiers);'>C1_pShortLEven</span> <span class="assignement">=</span> <a href="NA/shorten_lists.html">shorten_lists</a><span class="keyword">(</span><span id="sym731" class="symbol" onmouseover='showVariable("records_A", symIdentifiers);' onmouseout='hideVariable("records_A", symIdentifiers);'>records_A</span><span class="keyword">,</span> <span class="argument">p_short</span><span class="argument">=</span><a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/unlist.html">unlist</a><span class="keyword">(</span><span id="sym732" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment">#a fixed proportion will be short, split evenly between incidental and others </span>
        <span id="sym733" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym734" class="symbol" onmouseover='showVariable("C2_pShortLIncr", symIdentifiers);' onmouseout='hideVariable("C2_pShortLIncr", symIdentifiers);'>C2_pShortLIncr</span> <span class="assignement">=</span> <a href="NA/shorten_lists.html">shorten_lists</a><span class="keyword">(</span><span id="sym735" class="symbol" onmouseover='showVariable("records_A", symIdentifiers);' onmouseout='hideVariable("records_A", symIdentifiers);'>records_A</span><span class="keyword">,</span> <span class="argument">p_short</span><span class="argument">=</span><span id="sym736" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">)</span> <span class="comment">#proportion of short lists increases over time</span>
    <span class="keyword">}</span>
    <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'D'</span><span class="keyword">,</span> <span id="sym737" class="symbol" onmouseover='showVariable("Scenarios", symIdentifiers);' onmouseout='hideVariable("Scenarios", symIdentifiers);'>Scenarios</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment"># run the D Scenarios</span>
        <span class="comment">#records$D1_SelectvEven = bias_focal(records_A, disadvantage=pDetMod) #Remove records of the focal species at random (bias *against* detection) </span>
        <span id="sym738" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym739" class="symbol" onmouseover='showVariable("D2_SelectvIncr", symIdentifiers);' onmouseout='hideVariable("D2_SelectvIncr", symIdentifiers);'>D2_SelectvIncr</span> <span class="assignement">=</span> <a href="NA/bias_focal.html">bias_focal</a><span class="keyword">(</span><span id="sym740" class="symbol" onmouseover='showVariable("records_A", symIdentifiers);' onmouseout='hideVariable("records_A", symIdentifiers);'>records_A</span><span class="keyword">,</span> <span class="argument">disadvantage</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym741" class="symbol" onmouseover='showVariable("pDetMod", symIdentifiers);' onmouseout='hideVariable("pDetMod", symIdentifiers);'>pDetMod</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment">#Bias against detection decreases to zero (i.e. increasing apparency)</span>
    <span class="keyword">}</span>
    <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'E'</span><span class="keyword">,</span> <span id="sym742" class="symbol" onmouseover='showVariable("Scenarios", symIdentifiers);' onmouseout='hideVariable("Scenarios", symIdentifiers);'>Scenarios</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment"># generally not used - after 25/4 it is unuseable since we've dropped nVisits as a parameter</span>
        <span class="comment">#records$E1n_IncidentalNfEv = rbind(records_A, incidental_records(true_data, nYrs=nYrs, nVisits=nVisits, p_short=mean(unlist(p_short)), focal=F)) #add nonfocal records</span>
        <span class="comment">#records$E2n_IncidentalNfIn = rbind(records_A, incidental_records(true_data, nYrs=nYrs, nVisits=nVisits, p_short=p_short, focal=F)) #add nonfocal records</span>
        <span class="comment">#records$E1f_IncidentalFcEv = rbind(records_A, incidental_records(true_data, nYrs=nYrs, nVisits=nVisits, p_short=mean(unlist(p_short)), focal=T)) #add nonfocal records</span>
        <span class="comment">#records$E2f_IncidentalFcIn = rbind(records_A, incidental_records(true_data, nYrs=nYrs, nVisits=nVisits, p_short=p_short, focal=T)) #add nonfocal records</span>
    <span class="keyword">}</span>
    <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'F'</span><span class="keyword">,</span> <span id="sym743" class="symbol" onmouseover='showVariable("Scenarios", symIdentifiers);' onmouseout='hideVariable("Scenarios", symIdentifiers);'>Scenarios</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># Added 4/2/13: A new scenario in which a nonfocal species (indexed by cntrlsp) declines dramatically (50% over the period)</span>
        <span class="comment">#records$F_NfDecline &lt;- generate_records(nYrs, pSVS, true_data, decline=c(decline,0.5), which.decline=c(1,cntrlsp))</span>
        <span class="comment">#records$F_NfDecline10 &lt;- generate_records(nYrs, pSVS, true_data, decline=c(decline,0.5), which.decline=0.1)</span>
        <span id="sym744" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym745" class="symbol" onmouseover='showVariable("F_NfDecline", symIdentifiers);' onmouseout='hideVariable("F_NfDecline", symIdentifiers);'>F_NfDecline</span> <span class="assignement">&lt;-</span> <a href="NA/generate_records.html">generate_records</a><span class="keyword">(</span><span class="argument">nYrs</span><span class="argument">=</span><span id="sym746" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">,</span> <span class="argument">pSVS</span><span class="argument">=</span><span id="sym747" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">,</span> <span class="argument">true_data</span><span class="argument">=</span><span id="sym748" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">,</span> <span class="argument">decline</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym749" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">,</span><span class="number">0.3</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">which.decline</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="argument">mv</span><span class="argument">=</span><span id="sym750" class="symbol" onmouseover='showVariable("mv", symIdentifiers);' onmouseout='hideVariable("mv", symIdentifiers);'>mv</span><span class="keyword">,</span> <span class="argument">vrs</span><span class="argument">=</span><span id="sym751" class="symbol" onmouseover='showVariable("vrs", symIdentifiers);' onmouseout='hideVariable("vrs", symIdentifiers);'>vrs</span><span class="keyword">,</span> <span class="argument">stoch</span><span class="argument">=</span><span id="sym752" class="symbol" onmouseover='showVariable("stoch", symIdentifiers);' onmouseout='hideVariable("stoch", symIdentifiers);'>stoch</span><span class="keyword">)</span> <span class="comment"># half the species are VU</span>
    <span class="keyword">}</span>
    <span class="keyword">if</span><span class="keyword">(</span><span id="sym753" class="symbol" onmouseover='showVariable("combos", symIdentifiers);' onmouseout='hideVariable("combos", symIdentifiers);'>combos</span><span class="keyword">)</span><span class="keyword">{</span><span class="comment"># now add the combination scenarios</span>
        <span id="sym754" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym755" class="symbol" onmouseover='showVariable("B2C1_IncVsShtEv", symIdentifiers);' onmouseout='hideVariable("B2C1_IncVsShtEv", symIdentifiers);'>B2C1_IncVsShtEv</span> <span class="assignement">=</span> <a href="NA/shorten_lists.html">shorten_lists</a><span class="keyword">(</span><span id="sym756" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym757" class="symbol" onmouseover='showVariable("B2_IncrnVisit", symIdentifiers);' onmouseout='hideVariable("B2_IncrnVisit", symIdentifiers);'>B2_IncrnVisit</span><span class="keyword">,</span> <span class="argument">p_short</span><span class="argument">=</span><a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/unlist.html">unlist</a><span class="keyword">(</span><span id="sym758" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym759" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym760" class="symbol" onmouseover='showVariable("B2C2_IncVsShtIn", symIdentifiers);' onmouseout='hideVariable("B2C2_IncVsShtIn", symIdentifiers);'>B2C2_IncVsShtIn</span> <span class="assignement">=</span> <a href="NA/shorten_lists.html">shorten_lists</a><span class="keyword">(</span><span id="sym761" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym762" class="symbol" onmouseover='showVariable("B2_IncrnVisit", symIdentifiers);' onmouseout='hideVariable("B2_IncrnVisit", symIdentifiers);'>B2_IncrnVisit</span><span class="keyword">,</span> <span class="argument">p_short</span><span class="argument">=</span><span id="sym763" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">)</span>
        <span class="comment">#records$B2D1_IncVsSelEv = bias_focal(records$B2_IncrnVisit, disadvantage=pDetMod)</span>
        <span class="comment">#records$C1D1_ShtEvSelEv = bias_focal(records$C1_pShortLEven, disadvantage=pDetMod)</span>
        <span class="comment">#records$C2D1_ShtInSelEv = bias_focal(records$C2_pShortLIncr, disadvantage=pDetMod)</span>
        <span class="comment">#records$B2C1D1_IncVShtSelEv = bias_focal(records$B2C1_IncVsShtEv,disadvantage=pDetMod) #should kill LL model (new 6/11)</span>
    <span class="keyword">}</span>
    <span class="comment"># for validity, we there's an alternative version of B2, done differently (for reality check). Doesn't work for power test</span>
    <span class="comment">#if(decline==0) records$B2_IncrnVisit_a = generate_records(nYrs, pSVS=c(pSVS/2,pSVS/(2*nYrs)), true_data)</span>

    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym764" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span><span class="string">"true_data"</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <span id="sym765" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym766" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span><span class="string">"simpars"</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">nSpecies</span><span class="argument">=</span><span id="sym767" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span><span class="argument">nSites</span><span class="argument">=</span><span id="sym768" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span><span class="argument">nYrs</span><span class="argument">=</span><span id="sym769" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">,</span><span class="argument">pSVS</span><span class="argument">=</span><span id="sym770" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">,</span><span class="argument">pFocal</span><span class="argument">=</span><span id="sym771" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">,</span><span class="argument">p_short</span><span class="argument">=</span><span id="sym772" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">,</span>
                                    <span class="argument">pDetMod</span><span class="argument">=</span><span id="sym773" class="symbol" onmouseover='showVariable("pDetMod", symIdentifiers);' onmouseout='hideVariable("pDetMod", symIdentifiers);'>pDetMod</span><span class="keyword">,</span><span class="argument">decline</span><span class="argument">=</span><span id="sym774" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">,</span><span class="argument">visit_rich_sites</span><span class="argument">=</span><span id="sym775" class="symbol" onmouseover='showVariable("vrs", symIdentifiers);' onmouseout='hideVariable("vrs", symIdentifiers);'>vrs</span><span class="keyword">,</span> <span class="argument">stochastic</span><span class="argument">=</span><span id="sym776" class="symbol" onmouseover='showVariable("stoch", symIdentifiers);' onmouseout='hideVariable("stoch", symIdentifiers);'>stoch</span><span class="keyword">,</span> <span class="argument">max_vis</span><span class="argument">=</span><span id="sym777" class="symbol" onmouseover='showVariable("mv", symIdentifiers);' onmouseout='hideVariable("mv", symIdentifiers);'>mv</span><span class="keyword">)</span>
    <span class="keyword">if</span><span class="keyword">(</span><span id="sym778" class="symbol" onmouseover='showVariable("save_data", symIdentifiers);' onmouseout='hideVariable("save_data", symIdentifiers);'>save_data</span><span class="keyword">)</span> <a href="NA/save_records.html">save_records</a><span class="keyword">(</span><span id="sym779" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym780" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span><span class="keyword">)</span>

    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym781" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym782" class="symbol" onmouseover='showVariable("generate_records", symIdentifiers);' onmouseout='hideVariable("generate_records", symIdentifiers);'>generate_records</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nYrs</span><span class="eqformalargs">=</span><span class="number">10</span><span class="keyword">,</span> <span class="formalargs">true_data</span><span class="keyword">,</span> <span class="formalargs">decline</span><span class="eqformalargs">=</span><span class="number">0</span><span class="keyword">,</span> <span class="formalargs">which.decline</span><span class="eqformalargs">=</span><span class="number">1</span><span class="keyword">,</span> <span class="formalargs">sites_to_use</span><span class="eqformalargs">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">,</span>
                             <span class="formalargs">pSVS</span><span class="eqformalargs">=</span><span class="number">0.07</span><span class="keyword">,</span> <span class="formalargs">mv</span><span class="eqformalargs">=</span><span class="number">20</span><span class="keyword">,</span> <span class="formalargs">vrs</span><span class="eqformalargs">=</span><span id="sym783" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">stoch</span><span class="eqformalargs">=</span><span id="sym784" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span> <span class="keyword">{</span>

    <span class="comment"># wrapper for recording_cycle(), allowing it to be run over many years</span>
    <span class="comment"># sites_to_use was intended to be the way I implemented scenario B1, but no longer necessary</span>
    <span class="comment"># 25 October: added 'decline' for testing power</span>
    <span class="comment"># nVisits is allowed to vary among years. If one value is supplied, the visit rate remains constant</span>
    <span class="comment"># If two values are supplied then the first value is the initial rate, and the second value is the annual increment</span>
    <span class="comment"># 4/2/13: I modified this to allow a species other than the focal to be in decline (which.decline). Default=1 (focal)</span>
    <span class="comment"># 5/2/13: Further modification to allow two species to decline simultaneously</span>
    <span class="comment"># 6/2/13: Additional statement to allow a variable number of declining species</span>
    <span class="comment">#       if which.decline &lt; 1 then it specifies a proportion of species to select at random</span>
    <span class="comment">#       otherwise, which.decline specifies the identities of the species to decline</span>
    <span class="comment">#       Under scenario F, decline must be supplied as a vector of length 2</span>
    <span class="comment">#       The first element specifies the decline rate of the focal species, the second selected nonfocals</span>
    <span class="comment"># 24/4/13: modified so that nVisits is replaced by pSVS, the proportion of sites receiving a single visit</span>

    <span class="keyword">if</span><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym785" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">)</span>==<span class="number">1</span><span class="keyword">)</span> <span id="sym786" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym787" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="number">0</span><span class="keyword">)</span>

    <span id="sym788" class="symbol" onmouseover='showVariable("zeroDecline", symIdentifiers);' onmouseout='hideVariable("zeroDecline", symIdentifiers);'>zeroDecline</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span><span class="keyword">{</span>
      <span id="sym789" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="NA/recording_cycle.html">recording_cycle</a><span class="keyword">(</span><span class="argument">pSVS</span><span class="argument">=</span><span id="sym790" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">+</span><span id="sym791" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">*</span><span id="sym792" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">true_data</span><span class="argument">=</span><span id="sym793" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">,</span> <span class="argument">max_vis</span><span class="argument">=</span><span id="sym794" class="symbol" onmouseover='showVariable("mv", symIdentifiers);' onmouseout='hideVariable("mv", symIdentifiers);'>mv</span><span class="keyword">,</span> <span class="argument">VisRichSites</span><span class="argument">=</span><span id="sym795" class="symbol" onmouseover='showVariable("vrs", symIdentifiers);' onmouseout='hideVariable("vrs", symIdentifiers);'>vrs</span><span class="keyword">,</span> <span class="argument">stochastic</span><span class="argument">=</span><span id="sym796" class="symbol" onmouseover='showVariable("stoch", symIdentifiers);' onmouseout='hideVariable("stoch", symIdentifiers);'>stoch</span><span class="keyword">)</span>
      <span id="sym797" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym798" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="assignement">&lt;-</span> <span id="sym799" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span>
      <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym800" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span>
    <span class="keyword">}</span>

    <span class="keyword">if</span> <span class="keyword">(</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym801" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">)</span>==<span class="number">0</span><span class="keyword">)</span><span class="keyword">{</span>
      <span id="sym802" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="base/lapply.html">lapply</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span id="sym803" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">,</span> <span id="sym804" class="symbol" onmouseover='showVariable("zeroDecline", symIdentifiers);' onmouseout='hideVariable("zeroDecline", symIdentifiers);'>zeroDecline</span><span class="keyword">)</span>  <span class="comment">#can start loop at zero</span>
    <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
        <span class="comment"># This part of the loop is triggered under two circumstances</span>
        <span class="comment"># 1: Testing power</span>
        <span class="comment"># 2: when 1 or more nonfocal (nuisance) species are declining (scenario F)</span>
        <span class="comment"># To test power, we simulate a declining population</span>
        <span class="comment"># For the IUCN criterion A, a decline of 30% over 10 years leads to a Vulnerable listing.</span>

        <span class="comment"># When nonfocal species are declining, which.decline specifies which ones</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym805" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span><span class="keyword">)</span> == <span class="number">1</span><span class="keyword">)</span> <span class="keyword">if</span><span class="keyword">(</span><span id="sym806" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span> <span class="keyword">&lt;</span> <span class="number">1</span><span class="keyword">)</span> <span class="keyword">{</span> <span class="comment"># double if avoids a warning message</span>
            <span class="comment">#which.decline is a proportion of species, to be selected at random</span>
            <span class="comment">#convert the proportion into a number</span>
            <span id="sym807" class="symbol" onmouseover='showVariable("nsp_declining", symIdentifiers);' onmouseout='hideVariable("nsp_declining", symIdentifiers);'>nsp_declining</span> <span class="assignement">&lt;-</span> <a href="base/round.html">round</a><span class="keyword">(</span><span id="sym808" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span> <span class="keyword">*</span> <span class="keyword">(</span><a href="base/ncol.html">ncol</a><span class="keyword">(</span><span id="sym809" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">)</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">)</span>
            <span class="comment"># select that number at random from the nonfocal species</span>
            <span id="sym810" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span> <span class="assignement">&lt;-</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><span class="number">2</span><span class="keyword">:</span><a href="base/ncol.html">ncol</a><span class="keyword">(</span><span id="sym811" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span id="sym812" class="symbol" onmouseover='showVariable("nsp_declining", symIdentifiers);' onmouseout='hideVariable("nsp_declining", symIdentifiers);'>nsp_declining</span><span class="keyword">,</span> <span class="argument">replace</span><span class="argument">=</span><span id="sym813" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">)</span>

            <span class="comment"># is the focal also declining? (i.e. are we testing power under scenario F?)</span>
            <span class="keyword">if</span><span class="keyword">(</span><span id="sym814" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span> == <span class="number">0</span><span class="keyword">)</span> <span class="comment"># NO</span>
                <span id="sym815" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span> <span class="assignement">&lt;-</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span id="sym816" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span id="sym817" class="symbol" onmouseover='showVariable("nsp_declining", symIdentifiers);' onmouseout='hideVariable("nsp_declining", symIdentifiers);'>nsp_declining</span><span class="keyword">)</span>
            <span class="keyword">else</span> <span class="keyword">{</span><span class="comment">#Yes</span>
                <span id="sym818" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym819" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span id="sym820" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span id="sym821" class="symbol" onmouseover='showVariable("nsp_declining", symIdentifiers);' onmouseout='hideVariable("nsp_declining", symIdentifiers);'>nsp_declining</span><span class="keyword">)</span><span class="keyword">)</span>
                <span id="sym822" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span> <span id="sym823" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span><span class="keyword">)</span>
            <span class="keyword">}</span>
        <span class="keyword">}</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym824" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span><span class="keyword">)</span> <span class="keyword">!=</span> <a href="base/length.html">length</a><span class="keyword">(</span><span id="sym825" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">)</span><span class="keyword">)</span> <a href="base/stop.html">stop</a><span class="keyword">(</span><span class="string">'incompatible lengths'</span><span class="keyword">)</span>

        <span class="comment"># each year, every record has a finite probability of persisting to the next year</span>
        <span id="sym826" class="symbol" onmouseover='showVariable("ann_persit_rate", symIdentifiers);' onmouseout='hideVariable("ann_persit_rate", symIdentifiers);'>ann_persit_rate</span> <span class="assignement">&lt;-</span> <span class="keyword">(</span><span class="number">1</span><span class="keyword">-</span><span id="sym827" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">)</span><span class="keyword">^</span><span class="keyword">(</span><span class="number">1</span><span class="keyword">/</span><span id="sym828" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">)</span>
        <span class="comment"># for making populations go extinct, we need to iterate across a function nYr times</span>
        <span class="comment"># each time we pass in the extant sites and get back the ones that survived to the next year</span>
        <span class="comment">#annual_survival &lt;- function(occ, rate) occ[rbinom(n=length(occ),1,rate)==1]</span>
        <span class="comment">#occ &lt;- annual_survival(occ, ann_persit_rate) # I can't get this to work inside sapply, but does work inside afor loop</span>
        <span id="sym829" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a><span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">for</span><span class="keyword">(</span><span id="sym830" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><span id="sym831" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">)</span> <span class="keyword">{</span>  <span class="comment">#can start loop at zero</span>
            <span class="keyword">for</span><span class="keyword">(</span><span id="sym832" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym833" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
                <span id="sym834" class="symbol" onmouseover='showVariable("occ", symIdentifiers);' onmouseout='hideVariable("occ", symIdentifiers);'>occ</span> <span class="assignement">&lt;-</span> <a href="base/which.html">which</a><span class="keyword">(</span><span id="sym835" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">[</span><span class="keyword">,</span><span id="sym836" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span><span class="keyword">[</span><span id="sym837" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">]</span><span class="keyword">]</span>==<span class="number">1</span><span class="keyword">)</span> <span class="comment">#site numbers where focal is present</span>
                <span id="sym838" class="symbol" onmouseover='showVariable("extinctions", symIdentifiers);' onmouseout='hideVariable("extinctions", symIdentifiers);'>extinctions</span> <span class="assignement">&lt;-</span> <span id="sym839" class="symbol" onmouseover='showVariable("occ", symIdentifiers);' onmouseout='hideVariable("occ", symIdentifiers);'>occ</span><span class="keyword">[</span><a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym840" class="symbol" onmouseover='showVariable("occ", symIdentifiers);' onmouseout='hideVariable("occ", symIdentifiers);'>occ</span><span class="keyword">)</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">,</span><span id="sym841" class="symbol" onmouseover='showVariable("ann_persit_rate", symIdentifiers);' onmouseout='hideVariable("ann_persit_rate", symIdentifiers);'>ann_persit_rate</span><span class="keyword">[</span><span id="sym842" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">]</span><span class="keyword">)</span>==<span class="number">0</span><span class="keyword">]</span> <span class="comment"># the site numbers at which extinctions will happen this year</span>
                <span id="sym843" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">[</span><span id="sym844" class="symbol" onmouseover='showVariable("extinctions", symIdentifiers);' onmouseout='hideVariable("extinctions", symIdentifiers);'>extinctions</span><span class="keyword">,</span><span id="sym845" class="symbol" onmouseover='showVariable("which.decline", symIdentifiers);' onmouseout='hideVariable("which.decline", symIdentifiers);'>which.decline</span><span class="keyword">[</span><span id="sym846" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="number">0</span> <span class="comment"># set them to extinct</span>
            <span class="keyword">}</span>
            <span id="sym847" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">[[</span><span id="sym848" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="NA/recording_cycle.html">recording_cycle</a><span class="keyword">(</span><span class="argument">pSVS</span><span class="argument">=</span><span id="sym849" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">+</span><span id="sym850" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">*</span><span id="sym851" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">true_data</span><span class="argument">=</span><span id="sym852" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">,</span> <span class="argument">max_vis</span><span class="argument">=</span><span id="sym853" class="symbol" onmouseover='showVariable("mv", symIdentifiers);' onmouseout='hideVariable("mv", symIdentifiers);'>mv</span><span class="keyword">,</span> <span class="argument">VisRichSites</span><span class="argument">=</span><span id="sym854" class="symbol" onmouseover='showVariable("vrs", symIdentifiers);' onmouseout='hideVariable("vrs", symIdentifiers);'>vrs</span><span class="keyword">,</span> <span class="argument">stochastic</span><span class="argument">=</span><span id="sym855" class="symbol" onmouseover='showVariable("stoch", symIdentifiers);' onmouseout='hideVariable("stoch", symIdentifiers);'>stoch</span><span class="keyword">)</span> <span class="comment">#if starting loop at zero, use records[[i+1]]</span>
            <span id="sym856" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">[[</span><span id="sym857" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">$</span><span id="sym858" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="assignement">&lt;-</span> <span id="sym859" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span>
        <span class="keyword">}</span>
    <span class="keyword">}</span>
    <span class="comment">#records &lt;- lapply(1:nYrs, FUN=recording_cycle, nVisits=nVisits, true_data=true_data) #simple version with constant number of visits</span>
    <span class="comment"># replace melt with rbind 08/05/2014 TA&amp;GP</span>
    <span class="comment"># records &lt;- melt(records, id.vars=1:3) #simply appends the two list elements into a simple </span>
    <span class="comment"># names(records)[4] &lt;- 'Year'</span>
    <span id="sym860" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="base/do.call.html">do.call</a><span class="keyword">(</span><span id="sym861" class="symbol" onmouseover='showVariable("rbind", symIdentifiers);' onmouseout='hideVariable("rbind", symIdentifiers);'>rbind</span><span class="keyword">,</span> <span id="sym862" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym863" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym864" class="symbol" onmouseover='showVariable("get_all_stats", symIdentifiers);' onmouseout='hideVariable("get_all_stats", symIdentifiers);'>get_all_stats</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">output</span><span class="keyword">,</span> <span class="formalargs">save_to_txt</span><span class="eqformalargs">=</span><span id="sym865" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="formalargs">sf</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">,</span> <span class="formalargs">writePath</span> <span class="eqformalargs">=</span> <a href="base/getwd.html">getwd</a><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># 1/5/13: minor changes so that parameters are read from attr(output, ...) rather than passed</span>

    <span class="keyword">if</span><span class="keyword">(</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym866" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span> == <span class="number">1</span><span class="keyword">)</span> <span class="keyword">{</span>
        <span class="comment"># 17/1/13: a quick hack to make the function work with only one replicate</span>
        <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/abind"><span class="symbol">abind</span></a><span class="keyword">)</span>

        <span class="comment"># Added 9/5/3: doing this removes the attr</span>
        <span id="sym867" class="symbol" onmouseover='showVariable("simpars", symIdentifiers);' onmouseout='hideVariable("simpars", symIdentifiers);'>simpars</span> <span class="assignement">&lt;-</span> <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym868" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"simpars"</span><span class="keyword">)</span>
        <span id="sym869" class="symbol" onmouseover='showVariable("combos", symIdentifiers);' onmouseout='hideVariable("combos", symIdentifiers);'>combos</span> <span class="assignement">&lt;-</span> <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym870" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"combos"</span><span class="keyword">)</span>
        <span id="sym871" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span> <span class="assignement">&lt;-</span> <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym872" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">'id'</span><span class="keyword">)</span>
        <span id="sym873" class="symbol" onmouseover='showVariable("time", symIdentifiers);' onmouseout='hideVariable("time", symIdentifiers);'>time</span> <span class="assignement">&lt;-</span> <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym874" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"elapsed_time"</span><span class="keyword">)</span>

        <span id="sym875" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="NA/abind.html">abind</a><span class="keyword">(</span><span id="sym876" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span class="keyword">,</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span><span id="sym877" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span class="keyword">,</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">along</span><span class="argument">=</span><span class="number">3</span><span class="keyword">)</span>

        <span class="comment"># now add back the simpars</span>
        <span id="sym878" class="symbol" onmouseover='showVariable("simpars", symIdentifiers);' onmouseout='hideVariable("simpars", symIdentifiers);'>simpars</span> -&gt; <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym879" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"simpars"</span><span class="keyword">)</span>
        <span id="sym880" class="symbol" onmouseover='showVariable("combos", symIdentifiers);' onmouseout='hideVariable("combos", symIdentifiers);'>combos</span> -&gt; <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym881" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"combos"</span><span class="keyword">)</span>
        <span id="sym882" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span> -&gt; <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym883" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">'id'</span><span class="keyword">)</span>
        <span id="sym884" class="symbol" onmouseover='showVariable("time", symIdentifiers);' onmouseout='hideVariable("time", symIdentifiers);'>time</span> -&gt; <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym885" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"elapsed_time"</span><span class="keyword">)</span>

    <span class="keyword">}</span>

    <span id="sym886" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span> <span class="assignement">&lt;-</span> <a href="NA/get_error_rates.html">get_error_rates</a><span class="keyword">(</span><span id="sym887" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">save</span><span class="argument">=</span><span id="sym888" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">)</span>
    <span id="sym889" class="symbol" onmouseover='showVariable("summ_stats", symIdentifiers);' onmouseout='hideVariable("summ_stats", symIdentifiers);'>summ_stats</span> <span class="assignement">&lt;-</span> <a href="NA/get_summary_stats.html">get_summary_stats</a><span class="keyword">(</span><span id="sym890" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">save</span><span class="argument">=</span><span id="sym891" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="argument">sf</span><span class="argument">=</span><span id="sym892" class="symbol" onmouseover='showVariable("sf", symIdentifiers);' onmouseout='hideVariable("sf", symIdentifiers);'>sf</span><span class="keyword">)</span>

    <span class="comment"># how many replicates are valid - for Mixed model it's sometimes less than the specified</span>
    <span id="sym893" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_p$'</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym894" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment">#changed 16 Oct so only matches to end of string</span>
    <span id="sym895" class="symbol" onmouseover='showVariable("n_valid_reps", symIdentifiers);' onmouseout='hideVariable("n_valid_reps", symIdentifiers);'>n_valid_reps</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym896" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span id="sym897" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span><span class="keyword">,</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span class="number">2</span><span class="keyword">,</span><span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">a</span><span class="keyword">)</span> <a href="base/sum.html">sum</a><span class="keyword">(</span><span class="keyword">!</span><a href="base/is.na.html">is.na</a><span class="keyword">(</span><span id="sym898" class="symbol" onmouseover='showVariable("a", symIdentifiers);' onmouseout='hideVariable("a", symIdentifiers);'>a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym899" class="symbol" onmouseover='showVariable("n_valid_reps", symIdentifiers);' onmouseout='hideVariable("n_valid_reps", symIdentifiers);'>n_valid_reps</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/gsub.html">gsub</a><span class="keyword">(</span><span class="argument">x</span><span class="argument">=</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym900" class="symbol" onmouseover='showVariable("n_valid_reps", symIdentifiers);' onmouseout='hideVariable("n_valid_reps", symIdentifiers);'>n_valid_reps</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">pattern</span><span class="argument">=</span><span class="string">'_p'</span><span class="keyword">,</span> <span class="argument">repl</span><span class="argument">=</span><span class="string">'_nReps'</span><span class="keyword">)</span>

    <span id="sym901" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym902" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span><span class="keyword">,</span> <span id="sym903" class="symbol" onmouseover='showVariable("summ_stats", symIdentifiers);' onmouseout='hideVariable("summ_stats", symIdentifiers);'>summ_stats</span><span class="keyword">,</span> <a href="base/t.html">t</a><span class="keyword">(</span><span id="sym904" class="symbol" onmouseover='showVariable("n_valid_reps", symIdentifiers);' onmouseout='hideVariable("n_valid_reps", symIdentifiers);'>n_valid_reps</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">if</span><span class="keyword">(</span><span id="sym905" class="symbol" onmouseover='showVariable("save_to_txt", symIdentifiers);' onmouseout='hideVariable("save_to_txt", symIdentifiers);'>save_to_txt</span><span class="keyword">)</span>     <span class="keyword">{</span>
        <span id="sym906" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span> <span class="assignement">&lt;-</span> <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym907" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"id"</span><span class="keyword">)</span>
        <a href="utils/write.csv.html">write.csv</a><span class="keyword">(</span><span id="sym908" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span id="sym909" class="symbol" onmouseover='showVariable("writePath", symIdentifiers);' onmouseout='hideVariable("writePath", symIdentifiers);'>writePath</span><span class="keyword">,</span> <span class="string">'/SimStats_'</span><span class="keyword">,</span><span id="sym910" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym911" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">,</span><span class="string">'.csv'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">)</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym912" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span><a href="base/return.html">return</a><span class="keyword">(</span><span id="sym913" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">}</span>
<span class="keyword">}</span>

<span id="sym914" class="symbol" onmouseover='showVariable("error_rate", symIdentifiers);' onmouseout='hideVariable("error_rate", symIdentifiers);'>error_rate</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">p</span><span class="keyword">,</span> <span class="formalargs">alpha</span><span class="eqformalargs">=</span><span class="number">0.05</span><span class="keyword">)</span> <span class="keyword">{</span><span id="sym915" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span> <span class="assignement">&lt;-</span> <span id="sym916" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">[</span><span class="keyword">!</span><a href="base/is.na.html">is.na</a><span class="keyword">(</span><span id="sym917" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">;</span> <a href="base/length.html">length</a><span class="keyword">(</span><span id="sym918" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">[</span><span id="sym919" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span>&lt;=<span id="sym920" class="symbol" onmouseover='showVariable("alpha", symIdentifiers);' onmouseout='hideVariable("alpha", symIdentifiers);'>alpha</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">/</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym921" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">)</span><span class="keyword">}</span>

<span id="sym922" class="symbol" onmouseover='showVariable("test_power", symIdentifiers);' onmouseout='hideVariable("test_power", symIdentifiers);'>test_power</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">,</span> <span class="formalargs">alpha</span><span class="eqformalargs">=</span><span class="number">0.05</span><span class="keyword">,</span> <span class="formalargs">positive</span><span class="keyword">)</span> <span class="keyword">{</span>
    <span class="comment">#modified from error_rate</span>
    <span class="comment">#now, the power is the proportion of replicates that are *both* less than alpha AND in the correct direction</span>
    <span id="sym923" class="symbol" onmouseover='showVariable("right_direction", symIdentifiers);' onmouseout='hideVariable("right_direction", symIdentifiers);'>right_direction</span> <span class="assignement">&lt;-</span> <span class="keyword">(</span><span id="sym924" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">,</span><span class="keyword">]</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span> == <span id="sym925" class="symbol" onmouseover='showVariable("positive", symIdentifiers);' onmouseout='hideVariable("positive", symIdentifiers);'>positive</span> <span class="comment">#logical vector </span>
    <span id="sym926" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span> <span class="assignement">&lt;-</span> <span id="sym927" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="keyword">]</span>
    <span class="keyword">if</span><span class="keyword">(</span><a href="base/any.html">any</a><span class="keyword">(</span><span id="sym928" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span> &lt;= <span id="sym929" class="symbol" onmouseover='showVariable("alpha", symIdentifiers);' onmouseout='hideVariable("alpha", symIdentifiers);'>alpha</span> <span class="keyword">&amp;</span> <span class="keyword">!</span><span id="sym930" class="symbol" onmouseover='showVariable("right_direction", symIdentifiers);' onmouseout='hideVariable("right_direction", symIdentifiers);'>right_direction</span><span class="keyword">,</span> <span class="argument">na.rm</span><span class="argument">=</span><span id="sym931" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">)</span> <a href="base/print.html">print</a><span class="keyword">(</span><span class="string">'significant correlation opposite to true!'</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym932" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">[</span><span id="sym933" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span>&lt;=<span id="sym934" class="symbol" onmouseover='showVariable("alpha", symIdentifiers);' onmouseout='hideVariable("alpha", symIdentifiers);'>alpha</span> <span class="keyword">&amp;</span> <span id="sym935" class="symbol" onmouseover='showVariable("right_direction", symIdentifiers);' onmouseout='hideVariable("right_direction", symIdentifiers);'>right_direction</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">/</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym936" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym937" class="symbol" onmouseover='showVariable("get_error_rates", symIdentifiers);' onmouseout='hideVariable("get_error_rates", symIdentifiers);'>get_error_rates</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">output</span><span class="keyword">,</span> <span class="formalargs">datecode</span><span class="eqformalargs">=</span>NULL<span class="keyword">,</span> <span class="formalargs">save_to_txt</span><span class="eqformalargs">=</span><span id="sym938" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="formalargs">sf</span><span class="eqformalargs">=</span><span class="number">4</span><span class="keyword">,</span> <span class="formalargs">true_change</span><span class="eqformalargs">=</span>NULL<span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># first get the p-values from the methods that actually return p-values</span>
        <span class="comment"># 24 October: replaced dnorm with  one_to_two_tail(pnorm())): the former is conservative</span>
        <span class="comment"># 5-6 November: modified so that testing for power only looks for negative (or positive) associations (true_change)</span>
        <span class="comment"># 4/2/13 amended for cases where p includes NAs (typically MM under scenario C)</span>
    <span class="comment"># 1/5/13: minor changes so that parameters are read from attr(output, ...) rather than passed</span>

    <span class="comment"># is it power or validity? If not passed then read from output directly</span>
    <span class="comment"># fixed an error: 9 May so that power calculated in correct direction</span>
    <span class="keyword">if</span><span class="keyword">(</span><a href="base/is.null.html">is.null</a><span class="keyword">(</span><span id="sym939" class="symbol" onmouseover='showVariable("true_change", symIdentifiers);' onmouseout='hideVariable("true_change", symIdentifiers);'>true_change</span><span class="keyword">)</span><span class="keyword">)</span> <span id="sym940" class="symbol" onmouseover='showVariable("true_change", symIdentifiers);' onmouseout='hideVariable("true_change", symIdentifiers);'>true_change</span> <span class="assignement">&lt;-</span> <span class="keyword">-</span> <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym941" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">'simpars'</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym942" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span>

    <span class="comment">#which columns contain the p-values</span>
        <span id="sym943" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_p$'</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym944" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment">#changed 16 Oct so only matches to end of string</span>

        <span class="keyword">if</span><span class="keyword">(</span><span id="sym945" class="symbol" onmouseover='showVariable("true_change", symIdentifiers);' onmouseout='hideVariable("true_change", symIdentifiers);'>true_change</span>==<span class="number">0</span><span class="keyword">)</span> <span class="keyword">{</span>
                <span id="sym946" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span> <span class="assignement">&lt;-</span> <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span id="sym947" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym948" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span id="sym949" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span id="sym950" class="symbol" onmouseover='showVariable("error_rate", symIdentifiers);' onmouseout='hideVariable("error_rate", symIdentifiers);'>error_rate</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment">#test validity</span>
                <span class="comment">#plr = apply(one_to_two_tail(pnorm(output[dimnames(output)[[1]] == 'plr',,])),1,error_rate)</span>
                <span class="comment">#Telfer = apply(one_to_two_tail(pnorm(output[dimnames(output)[[1]] == 'Telfer',,])),1,error_rate)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span class="comment"># added 16/9/13: add the word 'trend' onto Telfer &amp; plr residual (index)</span>
          <span class="comment"># this is the simplest way of getting around the problem of matching</span>
          <span class="comment"># it's actually only necessary for the test of power</span>
          <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym951" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/gsub.html">gsub</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym952" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">pattern</span><span class="argument">=</span><span class="string">'Telfer$'</span><span class="keyword">,</span> <span class="argument">repl</span><span class="argument">=</span><span class="string">'Telfer_trend'</span><span class="keyword">)</span>
          <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym953" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/gsub.html">gsub</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym954" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">pattern</span><span class="argument">=</span><span class="string">'plr$'</span><span class="keyword">,</span> <span class="argument">repl</span><span class="argument">=</span><span class="string">'plr_trend'</span><span class="keyword">)</span>

          <span class="comment"># if testing power, we need to know which columns match the p-value columns</span>
          <span id="sym955" class="symbol" onmouseover='showVariable("trend_names", symIdentifiers);' onmouseout='hideVariable("trend_names", symIdentifiers);'>trend_names</span> <span class="assignement">&lt;-</span> <a href="base/gsub.html">gsub</a><span class="keyword">(</span><span class="string">'p$'</span><span class="keyword">,</span><span class="string">'trend'</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym956" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym957" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span><span class="keyword">]</span><span class="keyword">)</span>
          <span id="sym958" class="symbol" onmouseover='showVariable("trend_cols", symIdentifiers);' onmouseout='hideVariable("trend_cols", symIdentifiers);'>trend_cols</span> <span class="assignement">&lt;-</span> <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span id="sym959" class="symbol" onmouseover='showVariable("trend_names", symIdentifiers);' onmouseout='hideVariable("trend_names", symIdentifiers);'>trend_names</span><span class="keyword">,</span> <span id="sym960" class="symbol" onmouseover='showVariable("grep", symIdentifiers);' onmouseout='hideVariable("grep", symIdentifiers);'>grep</span><span class="keyword">,</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym961" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">fixed</span><span class="argument">=</span><span id="sym962" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
          <span class="comment">#trend_cols &lt;- which(dimnames(output)[[1]] %in% trend_names) </span>


    <span id="sym963" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span> <span class="assignement">&lt;-</span> <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym964" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span>
    <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym965" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym966" class="symbol" onmouseover='showVariable("trend_cols", symIdentifiers);' onmouseout='hideVariable("trend_cols", symIdentifiers);'>trend_cols</span><span class="keyword">[[</span><span id="sym967" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">,</span> <span id="sym968" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span><span class="keyword">[[</span><span id="sym969" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">,</span> <span id="sym970" class="symbol" onmouseover='showVariable("test_power", symIdentifiers);' onmouseout='hideVariable("test_power", symIdentifiers);'>test_power</span><span class="keyword">,</span> <span class="argument">positive</span><span class="argument">=</span><span id="sym971" class="symbol" onmouseover='showVariable("true_change", symIdentifiers);' onmouseout='hideVariable("true_change", symIdentifiers);'>true_change</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment">#power (fixed error 21 Nov)</span>
    <span class="comment">#plr = apply(one_to_two_tail(pnorm(output[dimnames(output)[[1]] == 'plr',,])),1,error_rate) #TO FIX - doesn't account for wrong direction</span>
                <span class="comment">#Telfer = apply(one_to_two_tail(pnorm(output[dimnames(output)[[1]] == 'Telfer',,])),1,error_rate) #TO FIX - doesn't account for wrong direction</span>
        <span class="keyword">}</span>

        <span id="sym972" class="symbol" onmouseover='showVariable("varnames", symIdentifiers);' onmouseout='hideVariable("varnames", symIdentifiers);'>varnames</span> <span class="assignement">&lt;-</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym973" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym974" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span><span class="keyword">]</span>
        <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym975" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/substr.html">substr</a><span class="keyword">(</span><span id="sym976" class="symbol" onmouseover='showVariable("varnames", symIdentifiers);' onmouseout='hideVariable("varnames", symIdentifiers);'>varnames</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <a href="base/regexpr.html">regexpr</a><span class="keyword">(</span><span class="string">'_'</span><span class="keyword">,</span><span id="sym977" class="symbol" onmouseover='showVariable("varnames", symIdentifiers);' onmouseout='hideVariable("varnames", symIdentifiers);'>varnames</span><span class="keyword">)</span> <span class="keyword">-</span> <span class="number">1</span><span class="keyword">)</span>

        <span class="comment"># now append the p-values from the standardised residuals</span>
        <span class="comment">#error_rates &lt;- cbind(prop.diff = NA, plr = plr, Telfer = Telfer,	error_rates)</span>

    <span class="comment"># for some combos (especially mixed model under scenario C) there are some reps which don't return enough data</span>
    <span id="sym978" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span> <span class="assignement">&lt;-</span> <a href="base/round.html">round</a><span class="keyword">(</span><span id="sym979" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span><span class="keyword">,</span><span id="sym980" class="symbol" onmouseover='showVariable("sf", symIdentifiers);' onmouseout='hideVariable("sf", symIdentifiers);'>sf</span><span class="keyword">)</span>

    <span class="keyword">if</span> <span class="keyword">(</span><span id="sym981" class="symbol" onmouseover='showVariable("save_to_txt", symIdentifiers);' onmouseout='hideVariable("save_to_txt", symIdentifiers);'>save_to_txt</span><span class="keyword">)</span> <a href="utils/write.csv.html">write.csv</a><span class="keyword">(</span><span id="sym982" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'ErrorRates_'</span><span class="keyword">,</span><span id="sym983" class="symbol" onmouseover='showVariable("datecode", symIdentifiers);' onmouseout='hideVariable("datecode", symIdentifiers);'>datecode</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym984" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">,</span><span class="string">'.csv'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">)</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym985" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span><span class="keyword">)</span>

        <span class="keyword">}</span>


<span id="sym986" class="symbol" onmouseover='showVariable("get_summary_stats", symIdentifiers);' onmouseout='hideVariable("get_summary_stats", symIdentifiers);'>get_summary_stats</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">output</span><span class="keyword">,</span> <span class="formalargs">datecode</span><span class="eqformalargs">=</span>NULL<span class="keyword">,</span> <span class="formalargs">sf</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">,</span> <span class="formalargs">save_to_txt</span><span class="eqformalargs">=</span><span id="sym987" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># the various 'rows' of output contain a range of information types. Separate them out</span>
    <span id="sym988" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_trend'</span><span class="keyword">,</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym989" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># added 25/1/13</span>
    <span id="sym990" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'Recs_'</span><span class="keyword">,</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym991" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym992" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span> <span class="comment"># added 14/12/12, modified 22/1/13</span>
    <span id="sym993" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_t[0-9]'</span><span class="keyword">,</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym994" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym995" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span>
    <span id="sym996" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'pCombosUsed'</span><span class="keyword">,</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym997" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym998" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span> <span class="comment"># if no mixed model this appends -1 (i.e. it gets ignored). Slight modification for multiple MMs (3/11/12)</span>
    <span id="sym999" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'Fr_'</span><span class="keyword">,</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1000" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1001" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span> <span class="comment"># if no Frescalo this appends -1 (i.e. it gets ignored). Added 17/1/13, modified 24/1</span>

    <span class="comment"># mean value for all stats (na.rm added 4/2/13)</span>
    <span class="comment"># 1/5/13: changed to median since Maes' method occasionally returns Inf (and is bounded at zero)</span>
    <span id="sym1002" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym1003" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">:</span><span class="number">2</span><span class="keyword">,</span> <span id="sym1004" class="symbol" onmouseover='showVariable("median", symIdentifiers);' onmouseout='hideVariable("median", symIdentifiers);'>median</span><span class="keyword">,</span> <span class="argument">na.rm</span><span class="argument">=</span><span id="sym1005" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">[</span><span id="sym1006" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span>

    <span class="comment">#strsplit(dimnames(x)[[2]], '_') # add this in future</span>
    <span class="comment">#x &lt;- t(signif(x,sf)) # transpose and remove extraneous decimal places</span>
    <span id="sym1007" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/t.html">t</a><span class="keyword">(</span><a href="base/round.html">round</a><span class="keyword">(</span><span id="sym1008" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span><span id="sym1009" class="symbol" onmouseover='showVariable("sf", symIdentifiers);' onmouseout='hideVariable("sf", symIdentifiers);'>sf</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># changed from above to avoid rounding the number of records to nearest 100!</span>
    <span class="keyword">if</span> <span class="keyword">(</span><span id="sym1010" class="symbol" onmouseover='showVariable("save_to_txt", symIdentifiers);' onmouseout='hideVariable("save_to_txt", symIdentifiers);'>save_to_txt</span><span class="keyword">)</span> <a href="utils/write.csv.html">write.csv</a><span class="keyword">(</span><span id="sym1011" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'SummaryStats_'</span><span class="keyword">,</span><span id="sym1012" class="symbol" onmouseover='showVariable("datecode", symIdentifiers);' onmouseout='hideVariable("datecode", symIdentifiers);'>datecode</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1013" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">,</span><span class="string">'.csv'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym1014" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym1015" class="symbol" onmouseover='showVariable("incidental_records", symIdentifiers);' onmouseout='hideVariable("incidental_records", symIdentifiers);'>incidental_records</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">true_data</span><span class="keyword">,</span> <span class="formalargs">nYrs</span><span class="keyword">,</span> <span class="formalargs">nVisits</span><span class="keyword">,</span> <span class="formalargs">p_short</span><span class="keyword">,</span> <span class="formalargs">focal</span><span class="eqformalargs">=</span><span id="sym1016" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">)</span><span class="keyword">{</span>
  <span class="comment"># generates incidental records for just one species; either the focal or sppSVS</span>
  <span class="comment"># each year, generate a set of incidental records, all of the same species</span>
  <span class="comment"># first we need a vector of sites in which the target species is found</span>
  <span class="comment"># This doesn't work under test of power with nonfocal=T</span>

  <span id="sym1017" class="symbol" onmouseover='showVariable("col", symIdentifiers);' onmouseout='hideVariable("col", symIdentifiers);'>col</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">+</span><a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><span class="keyword">!</span><span id="sym1018" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">)</span> <span class="comment"># column 1 for the focal, column 2 for sppSVS (the nonfocal)</span>
  <span id="sym1019" class="symbol" onmouseover='showVariable("sites", symIdentifiers);' onmouseout='hideVariable("sites", symIdentifiers);'>sites</span> <span class="assignement">&lt;-</span> <a href="base/which.html">which</a><span class="keyword">(</span><span id="sym1020" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">[</span><span class="keyword">,</span><span id="sym1021" class="symbol" onmouseover='showVariable("col", symIdentifiers);' onmouseout='hideVariable("col", symIdentifiers);'>col</span><span class="keyword">]</span>==<span class="number">1</span><span class="keyword">)</span> <span class="comment"># set of sites where the target species if found</span>

  <span class="keyword">if</span><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1022" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">)</span>==<span class="number">1</span><span class="keyword">)</span><span class="keyword">{</span>
    <span id="sym1023" class="symbol" onmouseover='showVariable("nInc", symIdentifiers);' onmouseout='hideVariable("nInc", symIdentifiers);'>nInc</span> <span class="assignement">&lt;-</span> <span id="sym1024" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span> <span class="keyword">*</span> <span id="sym1025" class="symbol" onmouseover='showVariable("nVisits", symIdentifiers);' onmouseout='hideVariable("nVisits", symIdentifiers);'>nVisits</span> <span class="comment"># number of incidental records per year</span>
    <span id="sym1026" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span> <span class="assignement">&lt;-</span> <a href="base/replicate.html">replicate</a><span class="keyword">(</span><span id="sym1027" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">,</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><span id="sym1028" class="symbol" onmouseover='showVariable("sites", symIdentifiers);' onmouseout='hideVariable("sites", symIdentifiers);'>sites</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1029" class="symbol" onmouseover='showVariable("nInc", symIdentifiers);' onmouseout='hideVariable("nInc", symIdentifiers);'>nInc</span><span class="keyword">,</span> <span class="argument">repl</span><span class="argument">=</span><span id="sym1030" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment">#as.numeric is helpful to avoid confusion</span>
    <span id="sym1031" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span> <span class="assignement">&lt;-</span> <a href="NA/melt.html">melt</a><span class="keyword">(</span><span id="sym1032" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">)</span>
    <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1033" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'Visit'</span><span class="keyword">,</span><span class="string">'Year'</span><span class="keyword">,</span><span class="string">'Site'</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
    <span id="sym1034" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span> <span class="assignement">&lt;-</span> <a href="base/diff.html">diff</a><span class="keyword">(</span><a href="base/unlist.html">unlist</a><span class="keyword">(</span><span id="sym1035" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">/</span> <span id="sym1036" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span> <span class="comment"># which extra ones should be included in each year</span>
    <span id="sym1037" class="symbol" onmouseover='showVariable("nInc", symIdentifiers);' onmouseout='hideVariable("nInc", symIdentifiers);'>nInc</span> <span class="assignement">&lt;-</span> <a href="base/round.html">round</a><span class="keyword">(</span><span class="keyword">(</span><span id="sym1038" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">$</span><span id="sym1039" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span> <span class="keyword">+</span> <span id="sym1040" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span> <span class="keyword">*</span> <span class="number">1</span><span class="keyword">:</span><span id="sym1041" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">)</span> <span class="keyword">*</span> <span id="sym1042" class="symbol" onmouseover='showVariable("nVisits", symIdentifiers);' onmouseout='hideVariable("nVisits", symIdentifiers);'>nVisits</span><span class="keyword">)</span> <span class="comment"># number of incidental records per year</span>
    <span id="sym1043" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span> <span class="assignement">&lt;-</span> <a href="base/lapply.html">lapply</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span id="sym1044" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><span id="sym1045" class="symbol" onmouseover='showVariable("sites", symIdentifiers);' onmouseout='hideVariable("sites", symIdentifiers);'>sites</span><span class="keyword">,</span> <span id="sym1046" class="symbol" onmouseover='showVariable("nInc", symIdentifiers);' onmouseout='hideVariable("nInc", symIdentifiers);'>nInc</span><span class="keyword">[</span><span id="sym1047" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">repl</span><span class="argument">=</span><span id="sym1048" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">)</span>
    <span id="sym1049" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span> <span class="assignement">&lt;-</span> <a href="NA/melt.html">melt</a><span class="keyword">(</span><span id="sym1050" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">)</span>
    <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1051" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'Site'</span><span class="keyword">,</span><span class="string">'Year'</span><span class="keyword">)</span>
    <span id="sym1052" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">$</span><span id="sym1053" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span> <span class="assignement">&lt;-</span> <a href="NA/melt.html">melt</a><span class="keyword">(</span><a href="base/sapply.html">sapply</a><span class="keyword">(</span><span id="sym1054" class="symbol" onmouseover='showVariable("nInc", symIdentifiers);' onmouseout='hideVariable("nInc", symIdentifiers);'>nInc</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <span class="number">1</span><span class="keyword">:</span><span id="sym1055" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1056" class="symbol" onmouseover='showVariable("value", symIdentifiers);' onmouseout='hideVariable("value", symIdentifiers);'>value</span>
  <span class="keyword">}</span>

  <span id="sym1057" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">$</span><span id="sym1058" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span> <span class="assignement">&lt;-</span> <span id="sym1059" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">$</span><span id="sym1060" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span> <span class="keyword">+</span> <span id="sym1061" class="symbol" onmouseover='showVariable("nVisits", symIdentifiers);' onmouseout='hideVariable("nVisits", symIdentifiers);'>nVisits</span> <span class="comment"># these are extra visits, over and above the normal</span>
  <span id="sym1062" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">$</span><span id="sym1063" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span> <span class="assignement">&lt;-</span> <a href="base/ifelse.html">ifelse</a><span class="keyword">(</span><span id="sym1064" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">,</span> <span class="string">'focal'</span><span class="keyword">,</span> <span class="string">'sppSVS'</span><span class="keyword">)</span>
  <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym1065" class="symbol" onmouseover='showVariable("recs", symIdentifiers);' onmouseout='hideVariable("recs", symIdentifiers);'>recs</span><span class="keyword">[</span><span class="keyword">,</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'Species'</span><span class="keyword">,</span><span class="string">'Visit'</span><span class="keyword">,</span><span class="string">'Site'</span><span class="keyword">,</span><span class="string">'Year'</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment">#structure matches main records, to which this appended</span>
  <span class="keyword">}</span>


<span id="sym1066" class="symbol" onmouseover='showVariable("iterate_all_scenarios", symIdentifiers);' onmouseout='hideVariable("iterate_all_scenarios", symIdentifiers);'>iterate_all_scenarios</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nreps</span><span class="eqformalargs">=</span><span class="number">1</span><span class="keyword">,</span> <span class="formalargs">nSites</span><span class="eqformalargs">=</span><span class="number">1000</span><span class="keyword">,</span> <span class="formalargs">nSpecies</span><span class="eqformalargs">=</span><span class="number">50</span><span class="keyword">,</span> <span class="formalargs">nYrs</span><span class="eqformalargs">=</span><span class="number">10</span><span class="keyword">,</span> <span class="formalargs">pSVS</span><span class="eqformalargs">=</span><span class="number">0.05</span><span class="keyword">,</span> <span class="formalargs">save_data</span><span class="eqformalargs">=</span><span id="sym1067" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">pFocal</span><span class="eqformalargs">=</span><a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">Occ</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="argument">DetP</span><span class="argument">=</span><span class="number">0.5</span><span class="keyword">)</span><span class="keyword">,</span> <span class="formalargs">vrs</span><span class="eqformalargs">=</span><span id="sym1068" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">mv</span><span class="eqformalargs">=</span><span class="number">20</span><span class="keyword">,</span> <span class="formalargs">stoch</span><span class="eqformalargs">=</span><span id="sym1069" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span>
                                  <span class="formalargs">p_short</span><span class="eqformalargs">=</span><a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">init</span><span class="argument">=</span><span class="number">0.6</span><span class="keyword">,</span><span class="argument">final</span><span class="argument">=</span><span class="number">0.9</span><span class="keyword">)</span><span class="keyword">,</span> <span class="formalargs">pDetMod</span><span class="eqformalargs">=</span><span class="number">0.2</span><span class="keyword">,</span> <span class="formalargs">decline</span><span class="eqformalargs">=</span><span class="number">0</span><span class="keyword">,</span> <span class="formalargs">id</span><span class="eqformalargs">=</span><span class="string">''</span><span class="keyword">,</span> <span class="formalargs">combos</span><span class="eqformalargs">=</span><span id="sym1070" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">Scenarios</span><span class="eqformalargs">=</span><span class="string">'BCDF'</span><span class="keyword">,</span>
                                  <span class="formalargs">inclMM</span><span class="eqformalargs">=</span><span id="sym1071" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">Frescalo</span><span class="eqformalargs">=</span><span id="sym1072" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">frescalo_path</span><span class="eqformalargs">=</span>NULL<span class="keyword">,</span> <span class="formalargs">Occ</span><span class="eqformalargs">=</span><span id="sym1073" class="symbol" onmouseover='showVariable("Occ", symIdentifiers);' onmouseout='hideVariable("Occ", symIdentifiers);'>Occ</span><span class="keyword">,</span> <span class="formalargs">nyr</span><span class="eqformalargs">=</span><span id="sym1074" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">,</span> <span class="formalargs">writePath</span> <span class="eqformalargs">=</span> <a href="base/getwd.html">getwd</a><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span>
    <span class="comment"># this function is the wrapper for the standard procedure of generating data then analysing it and spitting the output</span>
    <span class="comment"># TO DO: allow save data to be an integer defining the number of reps to be printed. e.g. the first 100 out of 1000</span>
    <span class="comment"># As a workaround, I've added the 'inclMM' argument: if FALSE it bypasses the mixed model, which takes most time.</span>
    <span class="comment"># 8 April: I separated the data generation from data analsysis</span>
    <span class="comment"># Feb-March 2014: I added the arguments Occ and nyr</span>

    <span id="sym1075" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/system.time.html">system.time</a><span class="keyword">(</span>
         <span id="sym1076" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/replicate.html">replicate</a><span class="keyword">(</span><span id="sym1077" class="symbol" onmouseover='showVariable("nreps", symIdentifiers);' onmouseout='hideVariable("nreps", symIdentifiers);'>nreps</span><span class="keyword">,</span> <span class="keyword">{</span> <span class="comment"># probeme when nreps&gt;1. Hang on - is it when Frescalo=F?</span>
            <span class="comment"># first generate the records</span>
            <span id="sym1078" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="NA/generate_all_scenarios.html">generate_all_scenarios</a><span class="keyword">(</span><span class="argument">nSites</span><span class="argument">=</span><span id="sym1079" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span> <span class="argument">nSpecies</span><span class="argument">=</span><span id="sym1080" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span> <span class="argument">nYrs</span><span class="argument">=</span><span id="sym1081" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">,</span> <span class="argument">pSVS</span><span class="argument">=</span><span id="sym1082" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">,</span> <span class="argument">save_data</span><span class="argument">=</span><span id="sym1083" class="symbol" onmouseover='showVariable("save_data", symIdentifiers);' onmouseout='hideVariable("save_data", symIdentifiers);'>save_data</span><span class="keyword">,</span>
                                              <span class="argument">pFocal</span><span class="argument">=</span><span id="sym1084" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">,</span> <span class="argument">p_short</span><span class="argument">=</span><span id="sym1085" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">,</span> <span class="argument">pDetMod</span><span class="argument">=</span><span id="sym1086" class="symbol" onmouseover='showVariable("pDetMod", symIdentifiers);' onmouseout='hideVariable("pDetMod", symIdentifiers);'>pDetMod</span><span class="keyword">,</span> <span class="argument">decline</span><span class="argument">=</span><span id="sym1087" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">,</span> <span class="argument">id</span><span class="argument">=</span><span id="sym1088" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span><span class="keyword">,</span>
                                              <span class="argument">combos</span><span class="argument">=</span><span id="sym1089" class="symbol" onmouseover='showVariable("combos", symIdentifiers);' onmouseout='hideVariable("combos", symIdentifiers);'>combos</span><span class="keyword">,</span> <span class="argument">Scenarios</span><span class="argument">=</span><span id="sym1090" class="symbol" onmouseover='showVariable("Scenarios", symIdentifiers);' onmouseout='hideVariable("Scenarios", symIdentifiers);'>Scenarios</span><span class="keyword">,</span> <span class="argument">mv</span><span class="argument">=</span><span id="sym1091" class="symbol" onmouseover='showVariable("mv", symIdentifiers);' onmouseout='hideVariable("mv", symIdentifiers);'>mv</span><span class="keyword">,</span> <span class="argument">vrs</span><span class="argument">=</span><span id="sym1092" class="symbol" onmouseover='showVariable("vrs", symIdentifiers);' onmouseout='hideVariable("vrs", symIdentifiers);'>vrs</span><span class="keyword">,</span> <span class="argument">stoch</span><span class="argument">=</span><span id="sym1093" class="symbol" onmouseover='showVariable("stoch", symIdentifiers);' onmouseout='hideVariable("stoch", symIdentifiers);'>stoch</span><span class="keyword">)</span>

            <span class="comment"># now analyse the data</span>
            <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span id="sym1094" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym1095" class="symbol" onmouseover='showVariable("run_all_methods", symIdentifiers);' onmouseout='hideVariable("run_all_methods", symIdentifiers);'>run_all_methods</span><span class="keyword">,</span> <span class="argument">inclMM</span><span class="argument">=</span><span id="sym1096" class="symbol" onmouseover='showVariable("inclMM", symIdentifiers);' onmouseout='hideVariable("inclMM", symIdentifiers);'>inclMM</span><span class="keyword">,</span> <span class="argument">Frescalo</span><span class="argument">=</span><span id="sym1097" class="symbol" onmouseover='showVariable("Frescalo", symIdentifiers);' onmouseout='hideVariable("Frescalo", symIdentifiers);'>Frescalo</span><span class="keyword">,</span> <span class="argument">frescalo_path</span><span class="argument">=</span><span id="sym1098" class="symbol" onmouseover='showVariable("frescalo_path", symIdentifiers);' onmouseout='hideVariable("frescalo_path", symIdentifiers);'>frescalo_path</span><span class="keyword">,</span> <span class="argument">OccMods</span><span class="argument">=</span><span id="sym1099" class="symbol" onmouseover='showVariable("Occ", symIdentifiers);' onmouseout='hideVariable("Occ", symIdentifiers);'>Occ</span><span class="keyword">,</span> <span class="argument">nyr</span><span class="argument">=</span><span id="sym1100" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">)</span>
        <span class="keyword">}</span><span class="keyword">)</span>
    <span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1101" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span><span class="string">"simpars"</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">nreps</span><span class="argument">=</span><span id="sym1102" class="symbol" onmouseover='showVariable("nreps", symIdentifiers);' onmouseout='hideVariable("nreps", symIdentifiers);'>nreps</span><span class="keyword">,</span><span class="argument">nSpecies</span><span class="argument">=</span><span id="sym1103" class="symbol" onmouseover='showVariable("nSpecies", symIdentifiers);' onmouseout='hideVariable("nSpecies", symIdentifiers);'>nSpecies</span><span class="keyword">,</span><span class="argument">nSites</span><span class="argument">=</span><span id="sym1104" class="symbol" onmouseover='showVariable("nSites", symIdentifiers);' onmouseout='hideVariable("nSites", symIdentifiers);'>nSites</span><span class="keyword">,</span><span class="argument">nYrs</span><span class="argument">=</span><span id="sym1105" class="symbol" onmouseover='showVariable("nYrs", symIdentifiers);' onmouseout='hideVariable("nYrs", symIdentifiers);'>nYrs</span><span class="keyword">,</span><span class="argument">pSVS</span><span class="argument">=</span><span id="sym1106" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">,</span><span class="argument">pFocal</span><span class="argument">=</span><span id="sym1107" class="symbol" onmouseover='showVariable("pFocal", symIdentifiers);' onmouseout='hideVariable("pFocal", symIdentifiers);'>pFocal</span><span class="keyword">,</span><span class="argument">p_short</span><span class="argument">=</span><span id="sym1108" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">,</span>
                                   <span class="argument">pDetMod</span><span class="argument">=</span><span id="sym1109" class="symbol" onmouseover='showVariable("pDetMod", symIdentifiers);' onmouseout='hideVariable("pDetMod", symIdentifiers);'>pDetMod</span><span class="keyword">,</span><span class="argument">decline</span><span class="argument">=</span><span id="sym1110" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">,</span> <span class="argument">visit_rich_sites</span><span class="argument">=</span><span id="sym1111" class="symbol" onmouseover='showVariable("vrs", symIdentifiers);' onmouseout='hideVariable("vrs", symIdentifiers);'>vrs</span><span class="keyword">,</span> <span class="argument">stochastic</span><span class="argument">=</span><span id="sym1112" class="symbol" onmouseover='showVariable("stoch", symIdentifiers);' onmouseout='hideVariable("stoch", symIdentifiers);'>stoch</span><span class="keyword">,</span> <span class="argument">max_vis</span><span class="argument">=</span><span id="sym1113" class="symbol" onmouseover='showVariable("mv", symIdentifiers);' onmouseout='hideVariable("mv", symIdentifiers);'>mv</span><span class="keyword">,</span> <span class="argument">nyr_SS</span><span class="argument">=</span><span id="sym1114" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1115" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span><span class="string">"combos"</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">Scenarios</span><span class="argument">=</span><span id="sym1116" class="symbol" onmouseover='showVariable("Scenarios", symIdentifiers);' onmouseout='hideVariable("Scenarios", symIdentifiers);'>Scenarios</span><span class="keyword">,</span> <span class="argument">combos</span><span class="argument">=</span><span id="sym1117" class="symbol" onmouseover='showVariable("combos", symIdentifiers);' onmouseout='hideVariable("combos", symIdentifiers);'>combos</span><span class="keyword">,</span> <span class="argument">MM</span><span class="argument">=</span><span id="sym1118" class="symbol" onmouseover='showVariable("inclMM", symIdentifiers);' onmouseout='hideVariable("inclMM", symIdentifiers);'>inclMM</span><span class="keyword">,</span> <span class="argument">Frescalo</span><span class="argument">=</span><span id="sym1119" class="symbol" onmouseover='showVariable("Frescalo", symIdentifiers);' onmouseout='hideVariable("Frescalo", symIdentifiers);'>Frescalo</span><span class="keyword">)</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1120" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"id"</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <span id="sym1121" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span>
    <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1122" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">"elapsed_time"</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><span id="sym1123" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">)</span>
    <a href="base/dir.create.html">dir.create</a><span class="keyword">(</span><span class="argument">path</span> <span class="argument">=</span> <span id="sym1124" class="symbol" onmouseover='showVariable("writePath", symIdentifiers);' onmouseout='hideVariable("writePath", symIdentifiers);'>writePath</span><span class="keyword">,</span> <span class="argument">showWarnings</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span>
    <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1125" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span id="sym1126" class="symbol" onmouseover='showVariable("writePath", symIdentifiers);' onmouseout='hideVariable("writePath", symIdentifiers);'>writePath</span><span class="keyword">,</span> <span class="string">'/SimOutput_'</span><span class="keyword">,</span><span id="sym1127" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1128" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">,</span><span class="string">'.rData'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym1129" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span>
    <a href="base/gc.html">gc</a><span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">}</span>

<span id="sym1130" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <a href="base/length.html">length</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym1131" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment">#for calculating the list length from a list of species (allows duplicates, which are ignored)</span>

<span id="sym1132" class="symbol" onmouseover='showVariable("median_occ", symIdentifiers);' onmouseout='hideVariable("median_occ", symIdentifiers);'>median_occ</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">true_data</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># returns the column number of true_data corresponding to the species with the median distributions size (excluding the focal)</span>
    <span class="comment"># there's no which.median() function to this effectively creates that functionality</span>
    <span id="sym1133" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym1134" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">)</span><span class="keyword">[</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">]</span>
    <span class="comment">#x[order(x)] #lists species in increasing order</span>
    <span id="sym1135" class="symbol" onmouseover='showVariable("name", symIdentifiers);' onmouseout='hideVariable("name", symIdentifiers);'>name</span> <span class="assignement">&lt;-</span> <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1136" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><a href="base/order.html">order</a><span class="keyword">(</span><span id="sym1137" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><a href="base/ceiling.html">ceiling</a><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1138" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">/</span><span class="number">2</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span class="number">1</span> <span class="keyword">+</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/gsub.html">gsub</a><span class="keyword">(</span><span class="string">'spp'</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span id="sym1139" class="symbol" onmouseover='showVariable("name", symIdentifiers);' onmouseout='hideVariable("name", symIdentifiers);'>name</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># add 1 because of the focal species</span>
<span class="keyword">}</span>


<span id="sym1140" class="symbol" onmouseover='showVariable("one_to_two_tail", symIdentifiers);' onmouseout='hideVariable("one_to_two_tail", symIdentifiers);'>one_to_two_tail</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">p</span><span class="keyword">)</span> <a href="base/ifelse.html">ifelse</a><span class="keyword">(</span><span id="sym1141" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">&lt;</span><span class="number">0.5</span><span class="keyword">,</span> <span id="sym1142" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">*</span><span class="number">2</span><span class="keyword">,</span> <span class="keyword">(</span><span class="number">1</span><span class="keyword">-</span><span id="sym1143" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span><span class="keyword">)</span><span class="keyword">*</span><span class="number">2</span><span class="keyword">)</span>


<span id="sym1144" class="symbol" onmouseover='showVariable("plot_error_rates", symIdentifiers);' onmouseout='hideVariable("plot_error_rates", symIdentifiers);'>plot_error_rates</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">output</span><span class="keyword">,</span> <span class="formalargs">error_rates</span><span class="keyword">,</span> <span class="formalargs">datecode</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># the various 'rows' of output contain a range of information types. Separate them out</span>
        <span id="sym1145" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_p'</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1146" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span>
        <span id="sym1147" class="symbol" onmouseover='showVariable("recording_rate_cols", symIdentifiers);' onmouseout='hideVariable("recording_rate_cols", symIdentifiers);'>recording_rate_cols</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_t[1-9]'</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1148" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span>
        <span id="sym1149" class="symbol" onmouseover='showVariable("method_cols", symIdentifiers);' onmouseout='hideVariable("method_cols", symIdentifiers);'>method_cols</span> <span class="assignement">&lt;-</span> <a href="base/setdiff.html">setdiff</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1150" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1151" class="symbol" onmouseover='showVariable("p_val_cols", symIdentifiers);' onmouseout='hideVariable("p_val_cols", symIdentifiers);'>p_val_cols</span><span class="keyword">,</span> <span id="sym1152" class="symbol" onmouseover='showVariable("recording_rate_cols", symIdentifiers);' onmouseout='hideVariable("recording_rate_cols", symIdentifiers);'>recording_rate_cols</span><span class="keyword">)</span><span class="keyword">)</span>

        <span class="comment"># plot a histogram of the other parameters</span>
        <a href="grDevices/pdf.html">pdf</a><span class="keyword">(</span><span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'Sim_T1Errors_'</span><span class="keyword">,</span><span id="sym1153" class="symbol" onmouseover='showVariable("datecode", symIdentifiers);' onmouseout='hideVariable("datecode", symIdentifiers);'>datecode</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1154" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">,</span><span class="string">'.pdf'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">onefile</span><span class="argument">=</span><span id="sym1155" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="argument">paper</span><span class="argument">=</span><span class="string">'a4'</span><span class="keyword">,</span> <span class="argument">height</span><span class="argument">=</span><span class="number">11.69</span><span class="keyword">,</span> <span class="argument">width</span><span class="argument">=</span><span class="number">8.27</span><span class="keyword">)</span>
        <a href="graphics/par.html">par</a><span class="keyword">(</span><span class="argument">mfrow</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1156" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1157" class="symbol" onmouseover='showVariable("method_cols", symIdentifiers);' onmouseout='hideVariable("method_cols", symIdentifiers);'>method_cols</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">mar</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">5</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">,</span><span class="number">3</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">omi</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span>

        <span class="keyword">for</span><span class="keyword">(</span><span id="sym1158" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1159" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># for each recording scenario</span>
                <span class="keyword">for</span><span class="keyword">(</span><span id="sym1160" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1161" class="symbol" onmouseover='showVariable("method_cols", symIdentifiers);' onmouseout='hideVariable("method_cols", symIdentifiers);'>method_cols</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span><span class="comment"># for each test statistic, excluding the p-values</span>
                        <a href="graphics/hist.html">hist</a><span class="keyword">(</span><span id="sym1162" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span id="sym1163" class="symbol" onmouseover='showVariable("method_cols", symIdentifiers);' onmouseout='hideVariable("method_cols", symIdentifiers);'>method_cols</span><span class="keyword">[</span><span id="sym1164" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span><span id="sym1165" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">xlab</span><span class="argument">=</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1166" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym1167" class="symbol" onmouseover='showVariable("method_cols", symIdentifiers);' onmouseout='hideVariable("method_cols", symIdentifiers);'>method_cols</span><span class="keyword">[</span><span id="sym1168" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">col.lab</span><span class="argument">=</span><span class="string">'blue'</span><span class="keyword">,</span> <span class="argument">main</span><span class="argument">=</span>NULL<span class="keyword">)</span>
                        <span class="keyword">if</span><span class="keyword">(</span><span id="sym1169" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span>==<span class="number">1</span><span class="keyword">)</span> <span class="keyword">{</span><a href="graphics/title.html">title</a><span class="keyword">(</span><span class="argument">main</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1170" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym1171" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">col.main</span><span class="argument">=</span><span class="string">'red'</span><span class="keyword">)</span>
                        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span><a href="graphics/title.html">title</a><span class="keyword">(</span><span class="argument">sub</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><a href="base/quote.html">quote</a><span class="keyword">(</span><span id="sym1172" class="symbol" onmouseover='showVariable("alpha", symIdentifiers);' onmouseout='hideVariable("alpha", symIdentifiers);'>alpha</span><span class="keyword">)</span><span class="keyword">,</span><span class="string">'='</span><span class="keyword">,</span><span id="sym1173" class="symbol" onmouseover='showVariable("error_rates", symIdentifiers);' onmouseout='hideVariable("error_rates", symIdentifiers);'>error_rates</span><span class="keyword">[</span><span id="sym1174" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">,</span><span id="sym1175" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span><span class="argument">col.sub</span><span class="argument">=</span><span class="string">'blue'</span><span class="keyword">)</span><span class="keyword">}</span>
                        <span class="comment">#} else {title(sub=paste(expression(alpha),'=',error_rates[j,i], sep=''),col.sub='blue')}</span>
                        <span class="comment">#} else {title(sub=paste(substitute(alpha),'=',error_rates[j,i], sep=''),col.sub='blue')}</span>
                        <span class="comment">#} else {title(sub=substitute(paste(alpha,'=',error_rates[j,i], sep='')),col.sub='blue')}</span>
                        <span class="comment">#} else {title(sub=paste(quote(substitute(alpha)),'=',error_rates[j,i], sep=''),col.sub='blue')}</span>
                        <span class="comment">#} else {title(sub=expression(paste(alpha,'=',eval(error_rates[j,i]))))}</span>
                        <span class="keyword">}</span>
        <a href="grDevices/dev.off.html">dev.off</a><span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">}</span>


<span id="sym1176" class="symbol" onmouseover='showVariable("plot_error_rates_trace", symIdentifiers);' onmouseout='hideVariable("plot_error_rates_trace", symIdentifiers);'>plot_error_rates_trace</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">output</span><span class="keyword">,</span> <span class="formalargs">datecode</span><span class="eqformalargs">=</span>NULL<span class="keyword">,</span> <span class="formalargs">ignore.first</span><span class="eqformalargs">=</span><span class="number">200</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment">#plots how the error rates change with increasing replicate number</span>
        <span class="comment">#require(lattice)</span>
        <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/ggplot2"><span class="symbol">ggplot2</span></a><span class="keyword">)</span>
    <span id="sym1177" class="symbol" onmouseover='showVariable("nreps", symIdentifiers);' onmouseout='hideVariable("nreps", symIdentifiers);'>nreps</span> <span class="assignement">&lt;-</span> <a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1178" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span>
        <span class="keyword">if</span><span class="keyword">(</span><span id="sym1179" class="symbol" onmouseover='showVariable("nreps", symIdentifiers);' onmouseout='hideVariable("nreps", symIdentifiers);'>nreps</span> <span class="keyword">&lt;</span> <span id="sym1180" class="symbol" onmouseover='showVariable("ignore.first", symIdentifiers);' onmouseout='hideVariable("ignore.first", symIdentifiers);'>ignore.first</span><span class="keyword">)</span> <span id="sym1181" class="symbol" onmouseover='showVariable("sample_reps", symIdentifiers);' onmouseout='hideVariable("sample_reps", symIdentifiers);'>sample_reps</span> <span class="assignement">&lt;-</span> <span class="number">2</span><span class="keyword">:</span><span id="sym1182" class="symbol" onmouseover='showVariable("nreps", symIdentifiers);' onmouseout='hideVariable("nreps", symIdentifiers);'>nreps</span> <span class="keyword">else</span> <span id="sym1183" class="symbol" onmouseover='showVariable("sample_reps", symIdentifiers);' onmouseout='hideVariable("sample_reps", symIdentifiers);'>sample_reps</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span class="number">4</span><span class="keyword">*</span><span class="number">50</span><span class="keyword">,</span> <span class="number">250</span><span class="keyword">:</span><span id="sym1184" class="symbol" onmouseover='showVariable("nreps", symIdentifiers);' onmouseout='hideVariable("nreps", symIdentifiers);'>nreps</span><span class="keyword">)</span>
        <span id="sym1185" class="symbol" onmouseover='showVariable("er", symIdentifiers);' onmouseout='hideVariable("er", symIdentifiers);'>er</span> <span class="assignement">&lt;-</span> <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span id="sym1186" class="symbol" onmouseover='showVariable("sample_reps", symIdentifiers);' onmouseout='hideVariable("sample_reps", symIdentifiers);'>sample_reps</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <a href="NA/get_error_rates.html">get_error_rates</a><span class="keyword">(</span><span id="sym1187" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span class="keyword">,</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span id="sym1188" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">save_to_txt</span><span class="argument">=</span><span id="sym1189" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="argument">tr</span><span class="argument">=</span><a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1190" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">'simpars'</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1191" class="symbol" onmouseover='showVariable("decline", symIdentifiers);' onmouseout='hideVariable("decline", symIdentifiers);'>decline</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">simplify</span><span class="argument">=</span><span id="sym1192" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">)</span>
        <span id="sym1193" class="symbol" onmouseover='showVariable("er", symIdentifiers);' onmouseout='hideVariable("er", symIdentifiers);'>er</span> <span class="assignement">&lt;-</span> <a href="NA/melt.html">melt</a><span class="keyword">(</span><span id="sym1194" class="symbol" onmouseover='showVariable("er", symIdentifiers);' onmouseout='hideVariable("er", symIdentifiers);'>er</span><span class="keyword">)</span>
        <span id="sym1195" class="symbol" onmouseover='showVariable("er", symIdentifiers);' onmouseout='hideVariable("er", symIdentifiers);'>er</span><span class="keyword">$</span><span id="sym1196" class="symbol" onmouseover='showVariable("repnum", symIdentifiers);' onmouseout='hideVariable("repnum", symIdentifiers);'>repnum</span> <span class="assignement">&lt;-</span> <span id="sym1197" class="symbol" onmouseover='showVariable("sample_reps", symIdentifiers);' onmouseout='hideVariable("sample_reps", symIdentifiers);'>sample_reps</span><span class="keyword">[</span><span id="sym1198" class="symbol" onmouseover='showVariable("er", symIdentifiers);' onmouseout='hideVariable("er", symIdentifiers);'>er</span><span class="keyword">$</span><span id="sym1199" class="symbol" onmouseover='showVariable("L1", symIdentifiers);' onmouseout='hideVariable("L1", symIdentifiers);'>L1</span><span class="keyword">]</span>
        <span class="comment">#pdf(file=paste('Sim_TraceErrors_',datecode,'_',dim(output)[3],'.pdf', sep=''), onefile=T, paper='a4r', width=11.69, height=8.27)</span>
        <span class="comment">#xyplot(data=er, value ~ repnum|Var1, gr=Var2, type='l', xlab='number of replicates', ylab='error rate', auto.key=T, scales=list(relation='free'), as.table=T)	</span>
    <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1200" class="symbol" onmouseover='showVariable("er", symIdentifiers);' onmouseout='hideVariable("er", symIdentifiers);'>er</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="string">'Method'</span>
    <span id="sym1201" class="symbol" onmouseover='showVariable("qp", symIdentifiers);' onmouseout='hideVariable("qp", symIdentifiers);'>qp</span> <span class="assignement">&lt;-</span> <a href="NA/qplot.html">qplot</a><span class="keyword">(</span><span class="argument">data</span><span class="argument">=</span><span id="sym1202" class="symbol" onmouseover='showVariable("er", symIdentifiers);' onmouseout='hideVariable("er", symIdentifiers);'>er</span><span class="keyword">,</span> <span class="argument">x</span><span class="argument">=</span><span id="sym1203" class="symbol" onmouseover='showVariable("repnum", symIdentifiers);' onmouseout='hideVariable("repnum", symIdentifiers);'>repnum</span><span class="keyword">,</span> <span class="argument">y</span><span class="argument">=</span><span id="sym1204" class="symbol" onmouseover='showVariable("value", symIdentifiers);' onmouseout='hideVariable("value", symIdentifiers);'>value</span><span class="keyword">,</span> <span class="argument">col</span><span class="argument">=</span><span id="sym1205" class="symbol" onmouseover='showVariable("Method", symIdentifiers);' onmouseout='hideVariable("Method", symIdentifiers);'>Method</span><span class="keyword">,</span> <span class="argument">group</span><span class="argument">=</span><span id="sym1206" class="symbol" onmouseover='showVariable("Method", symIdentifiers);' onmouseout='hideVariable("Method", symIdentifiers);'>Method</span><span class="keyword">,</span> <span class="argument">geom</span><span class="argument">=</span><span class="string">'line'</span><span class="keyword">)</span>
    <span id="sym1207" class="symbol" onmouseover='showVariable("qp", symIdentifiers);' onmouseout='hideVariable("qp", symIdentifiers);'>qp</span> <span class="keyword">+</span> <a href="NA/facet_wrap.html">facet_wrap</a><span class="keyword">(</span><span class="keyword">~</span> <span id="sym1208" class="symbol" onmouseover='showVariable("Var1", symIdentifiers);' onmouseout='hideVariable("Var1", symIdentifiers);'>Var1</span><span class="keyword">,</span> <span class="argument">nr</span><span class="argument">=</span><span class="number">2</span><span class="keyword">)</span> <span class="keyword">+</span> <a href="NA/xlab.html">xlab</a><span class="keyword">(</span><span class="string">'number of replicates'</span><span class="keyword">)</span> <span class="keyword">+</span> <a href="NA/ylab.html">ylab</a><span class="keyword">(</span><span class="string">'error rate'</span><span class="keyword">)</span>
    <span class="comment">#dev.off() #pdf doesn't work!</span>
        <span class="keyword">}</span>


<span id="sym1209" class="symbol" onmouseover='showVariable("plot_summary_stats", symIdentifiers);' onmouseout='hideVariable("plot_summary_stats", symIdentifiers);'>plot_summary_stats</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">output</span><span class="keyword">,</span> <span class="formalargs">datecode</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># the various 'rows' of output contain a range of information types. Separate them out</span>
        <span class="comment"># NB This will look congested if multiple mixed model thresholds were used</span>
        <span id="sym1210" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_t1'</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1211" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span>
        <span id="sym1212" class="symbol" onmouseover='showVariable("t2_cols", symIdentifiers);' onmouseout='hideVariable("t2_cols", symIdentifiers);'>t2_cols</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_t2'</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1213" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="comment">#nc &lt;- dim(output)[1]</span>
        <span id="sym1214" class="symbol" onmouseover='showVariable("sc", symIdentifiers);' onmouseout='hideVariable("sc", symIdentifiers);'>sc</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'MM_pCombosUsed'</span><span class="keyword">,</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1215" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># 'starting column' is given by this, the first summary statistic</span>

        <span class="comment"># plot a histogram of the other parameters</span>
        <a href="grDevices/pdf.html">pdf</a><span class="keyword">(</span><span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'Sim_Summary_'</span><span class="keyword">,</span><span id="sym1216" class="symbol" onmouseover='showVariable("datecode", symIdentifiers);' onmouseout='hideVariable("datecode", symIdentifiers);'>datecode</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1217" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">,</span><span class="string">'.pdf'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">onefile</span><span class="argument">=</span><span id="sym1218" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="argument">paper</span><span class="argument">=</span><span class="string">'a4'</span><span class="keyword">,</span> <span class="argument">height</span><span class="argument">=</span><span class="number">11.69</span><span class="keyword">,</span> <span class="argument">width</span><span class="argument">=</span><span class="number">8.27</span><span class="keyword">)</span>
        <a href="graphics/par.html">par</a><span class="keyword">(</span><span class="argument">mfrow</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1219" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">+</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1220" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">mar</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">5</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">,</span><span class="number">3</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">omi</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span>

        <span class="keyword">for</span><span class="keyword">(</span><span id="sym1221" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1222" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># for each recording scenario</span>
                <span class="keyword">for</span><span class="keyword">(</span><span id="sym1223" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">in</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1224" class="symbol" onmouseover='showVariable("sc", symIdentifiers);' onmouseout='hideVariable("sc", symIdentifiers);'>sc</span><span class="keyword">,</span><span id="sym1225" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span><span class="comment"># for each summary stat</span>
                        <a href="graphics/hist.html">hist</a><span class="keyword">(</span><span id="sym1226" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span id="sym1227" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span id="sym1228" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">xlab</span><span class="argument">=</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1229" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym1230" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">col.lab</span><span class="argument">=</span><span class="string">'blue'</span><span class="keyword">,</span> <span class="argument">main</span><span class="argument">=</span>NULL<span class="keyword">)</span>
                        <span class="keyword">if</span><span class="keyword">(</span><span id="sym1231" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span>==<span id="sym1232" class="symbol" onmouseover='showVariable("sc", symIdentifiers);' onmouseout='hideVariable("sc", symIdentifiers);'>sc</span><span class="keyword">)</span> <span class="keyword">{</span><a href="graphics/title.html">title</a><span class="keyword">(</span><span class="argument">main</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1233" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym1234" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">col.main</span><span class="argument">=</span><span class="string">'red'</span><span class="keyword">)</span><span class="keyword">}</span>
                        <a href="graphics/title.html">title</a><span class="keyword">(</span><span class="argument">sub</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'Mean='</span><span class="keyword">,</span><a href="base/round.html">round</a><span class="keyword">(</span><a href="base/mean.html">mean</a><span class="keyword">(</span><span id="sym1235" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span id="sym1236" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span id="sym1237" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span><span class="argument">col.sub</span><span class="argument">=</span><span class="string">'blue'</span><span class="keyword">)</span>
                                <span class="keyword">}</span>

        <span class="keyword">for</span><span class="keyword">(</span><span id="sym1238" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1239" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># for each recording scenario</span>
                <span class="keyword">for</span><span class="keyword">(</span><span id="sym1240" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">in</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1241" class="symbol" onmouseover='showVariable("sc", symIdentifiers);' onmouseout='hideVariable("sc", symIdentifiers);'>sc</span><span class="keyword">,</span><span id="sym1242" class="symbol" onmouseover='showVariable("t2_cols", symIdentifiers);' onmouseout='hideVariable("t2_cols", symIdentifiers);'>t2_cols</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span><span class="comment"># for each summary stat</span>
                        <a href="graphics/hist.html">hist</a><span class="keyword">(</span><span id="sym1243" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span id="sym1244" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span id="sym1245" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">xlab</span><span class="argument">=</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1246" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym1247" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">col.lab</span><span class="argument">=</span><span class="string">'blue'</span><span class="keyword">,</span> <span class="argument">main</span><span class="argument">=</span>NULL<span class="keyword">)</span>
                        <span class="keyword">if</span><span class="keyword">(</span><span id="sym1248" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span>==<span id="sym1249" class="symbol" onmouseover='showVariable("sc", symIdentifiers);' onmouseout='hideVariable("sc", symIdentifiers);'>sc</span><span class="keyword">)</span> <span class="keyword">{</span><a href="graphics/title.html">title</a><span class="keyword">(</span><span class="argument">main</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1250" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym1251" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">col.main</span><span class="argument">=</span><span class="string">'red'</span><span class="keyword">)</span><span class="keyword">}</span>
                        <a href="graphics/title.html">title</a><span class="keyword">(</span><span class="argument">sub</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'Mean='</span><span class="keyword">,</span><a href="base/round.html">round</a><span class="keyword">(</span><a href="base/mean.html">mean</a><span class="keyword">(</span><span id="sym1252" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><span id="sym1253" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span id="sym1254" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span><span class="number">3</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span><span class="argument">col.sub</span><span class="argument">=</span><span class="string">'blue'</span><span class="keyword">)</span>
                                <span class="keyword">}</span>

        <a href="grDevices/dev.off.html">dev.off</a><span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">}</span>


<span id="sym1255" class="symbol" onmouseover='showVariable("plot_summary_stats3", symIdentifiers);' onmouseout='hideVariable("plot_summary_stats3", symIdentifiers);'>plot_summary_stats3</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">output</span><span class="keyword">,</span> <span class="formalargs">datecode</span><span class="eqformalargs">=</span>NULL<span class="keyword">,</span> <span class="formalargs">maxN</span><span class="eqformalargs">=</span><span class="number">7</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># New version of above using boxplot over hist AND transposed</span>
        <span class="comment"># the various 'rows' of output contain a range of information types. Separate them out</span>
        <span id="sym1256" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span> <span class="assignement">&lt;-</span> <a href="base/grep.html">grep</a><span class="keyword">(</span><span class="string">'_t1'</span><span class="keyword">,</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1257" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="comment">#t2_cols &lt;- grep('_t2',dimnames(output)[[1]]) #should be just t1_cols + 1</span>
        <span class="comment">#nc &lt;- dim(output)[1]</span>
        <span class="comment">#sc &lt;- grep('MM_pCombosUsed', dimnames(output)[[1]]) # 'starting column' is given by this, the first summary statistic</span>
        <span id="sym1258" class="symbol" onmouseover='showVariable("stat_names", symIdentifiers);' onmouseout='hideVariable("stat_names", symIdentifiers);'>stat_names</span> <span class="assignement">&lt;-</span> <a href="base/gsub.html">gsub</a><span class="keyword">(</span><span class="string">'_t1'</span><span class="keyword">,</span> <span class="string">''</span><span class="keyword">,</span> <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1259" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym1260" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span><span class="keyword">]</span><span class="keyword">)</span>

        <span class="comment"># plot a histogram of the other parameters</span>
        <a href="grDevices/pdf.html">pdf</a><span class="keyword">(</span><span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'Sim_Summary_'</span><span class="keyword">,</span><span id="sym1261" class="symbol" onmouseover='showVariable("datecode", symIdentifiers);' onmouseout='hideVariable("datecode", symIdentifiers);'>datecode</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><a href="base/dim.html">dim</a><span class="keyword">(</span><span id="sym1262" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">3</span><span class="keyword">]</span><span class="keyword">,</span><span class="string">'.pdf'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">onefile</span><span class="argument">=</span><span id="sym1263" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="argument">paper</span><span class="argument">=</span><span class="string">'a4r'</span><span class="keyword">,</span> <span class="argument">width</span><span class="argument">=</span><span class="number">11.69</span><span class="keyword">,</span> <span class="argument">height</span><span class="argument">=</span><span class="number">8.27</span><span class="keyword">)</span>
        <a href="graphics/par.html">par</a><span class="keyword">(</span><span class="argument">mfrow</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1264" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span><span class="keyword">)</span><span class="keyword">,</span><span class="number">7</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">mar</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">4</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">omi</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">,</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># 7 is the number of basic scenarios - any others get put on a second page</span>

        <span class="keyword">for</span><span class="keyword">(</span><span id="sym1265" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1266" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># for each summary stat</span>
                <span class="keyword">for</span><span class="keyword">(</span><span id="sym1267" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><span id="sym1268" class="symbol" onmouseover='showVariable("maxN", symIdentifiers);' onmouseout='hideVariable("maxN", symIdentifiers);'>maxN</span><span class="keyword">)</span> <span class="keyword">{</span><span class="comment"># for each recording scenario</span>
                        <span class="comment">#temp &lt;- output[t1_cols[c(i,i+1)],j,]</span>
                        <span id="sym1269" class="symbol" onmouseover='showVariable("temp", symIdentifiers);' onmouseout='hideVariable("temp", symIdentifiers);'>temp</span> <span class="assignement">&lt;-</span> <span id="sym1270" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">[</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1271" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span><span class="keyword">[</span><span id="sym1272" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span><span id="sym1273" class="symbol" onmouseover='showVariable("t1_cols", symIdentifiers);' onmouseout='hideVariable("t1_cols", symIdentifiers);'>t1_cols</span><span class="keyword">[</span><span id="sym1274" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">+</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">,</span><span id="sym1275" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">,</span><span class="keyword">]</span>
                        <a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1276" class="symbol" onmouseover='showVariable("temp", symIdentifiers);' onmouseout='hideVariable("temp", symIdentifiers);'>temp</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'t1'</span><span class="keyword">,</span> <span class="string">'t2'</span><span class="keyword">)</span>
                        <a href="graphics/boxplot.html">boxplot</a><span class="keyword">(</span><a href="base/t.html">t</a><span class="keyword">(</span><span id="sym1277" class="symbol" onmouseover='showVariable("temp", symIdentifiers);' onmouseout='hideVariable("temp", symIdentifiers);'>temp</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">xlab</span><span class="argument">=</span><span id="sym1278" class="symbol" onmouseover='showVariable("stat_names", symIdentifiers);' onmouseout='hideVariable("stat_names", symIdentifiers);'>stat_names</span><span class="keyword">[</span><span id="sym1279" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">col.lab</span><span class="argument">=</span><span class="string">'blue'</span><span class="keyword">,</span> <span class="argument">main</span><span class="argument">=</span>NULL<span class="keyword">)</span>
                        <span class="keyword">if</span><span class="keyword">(</span><span id="sym1280" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span>==<span class="number">1</span><span class="keyword">)</span> <span class="keyword">{</span><a href="graphics/title.html">title</a><span class="keyword">(</span><span class="argument">main</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1281" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">[</span><span id="sym1282" class="symbol" onmouseover='showVariable("j", symIdentifiers);' onmouseout='hideVariable("j", symIdentifiers);'>j</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">col.main</span><span class="argument">=</span><span class="string">'red'</span><span class="keyword">)</span><span class="keyword">}</span>
                        <span class="comment">#title(sub=paste('Mean=',round(mean(output[i,j,]),3), sep=''),col.sub='blue')</span>
                        <span class="keyword">}</span>

        <a href="grDevices/dev.off.html">dev.off</a><span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">}</span>


<span id="sym1283" class="symbol" onmouseover='showVariable("recording_cycle_old", symIdentifiers);' onmouseout='hideVariable("recording_cycle_old", symIdentifiers);'>recording_cycle_old</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">nVisits</span><span class="keyword">,</span> <span class="formalargs">true_data</span><span class="keyword">,</span> <span class="formalargs">with_repl</span><span class="eqformalargs">=</span><span id="sym1284" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="formalargs">max_vis</span><span class="eqformalargs">=</span><span class="number">10</span><span class="keyword">)</span> <span class="keyword">{</span>
        <span class="comment"># runs a 'recording cycle': nVisits are apportioned randomly among the sites (rows) in true_data: some sites get multiple visits</span>
    <span class="comment"># 3 December: modified to give 'fatter tails' in the distribution of recording effort among sites</span>
    <span class="comment">#   in UK recording data, about 1/4 of monads visited each year get further visits</span>
    <span class="comment">#   For the Dutch Dragonfly &amp; Butterfly data, the figure is about 1/2</span>
    <span class="comment">#   The parameterization here is for UK.</span>
    <span class="comment">#   this makes the total number of visits and expectation, rather than fixed</span>
    <span class="comment">#  8/4/13: I removed the correlation between p(visited) and species richness</span>
    <span class="comment"># 24/4/13: New formulation </span>


    <span id="sym1285" class="symbol" onmouseover='showVariable("nS", symIdentifiers);' onmouseout='hideVariable("nS", symIdentifiers);'>nS</span> <span class="assignement">=</span> <a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym1286" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">)</span> <span class="comment"># number of sites</span>

    <span class="comment"># this is the old version</span>
    <span class="comment">#sites_visited_old &lt;- sample(1:nS, nVisits, repl=with_repl) #sites_visited is a vector of site identities</span>
        <span class="comment"># about 12% of sites receive multiple visits per year (for 250 visits to 1000 sites)</span>

    <span class="comment"># getting the number of visits per site from the binomial distribution: same distribution as above</span>
    <span class="comment">#vis_per_site &lt;-rbinom(nS, max_vis, nVisits/(nS*max_vis)) # only 10% of visited sites get &gt;1 visit</span>
    <span class="comment">#getting the number of sites from the betabinomial </span>
    <span class="comment">#shape = 3000/nVisits # just about right to get 25% of visited sites having &gt;1 visit</span>
    <span class="comment">#pr &lt;- rbeta(nS,1,shape) # thanks to Steve Freeman for this insight</span>
    <span class="comment">#vis_per_site &lt;- rbinom(nS, max_vis, pr*nVisits/nS) # increases to 25% the proportion visited twice or more</span>
    <span class="comment">#sites_visited_bb &lt;- unlist(sapply(which(vis_per_site&gt;0), function(i) rep(i, vis_per_site[i])))</span>
    <span class="comment">#problem - shape parameter means that nVisit is nonlinearly related to the acutal number of visits</span>

    <span class="comment">#14 December: revert to the old way, but make the probability of being selected related to richness </span>
    <span class="comment">#rich &lt;- rowSums(true_data)</span>
    <span class="comment">#temp &lt;- rich - rpois(nS,2)</span>
    <span class="comment">#ss &lt;- (temp/max(temp))^2 # makes negative values postive &amp; increases the spread</span>
    <span class="comment">#sites_visited &lt;- sample(1:nS, nVisits, repl=with_repl, prob=ss/sum(ss)) #sites_visited is a vector of site identities</span>

    <span class="comment"># 8 April: we no longer need 'memory' in the system</span>
    <span id="sym1287" class="symbol" onmouseover='showVariable("sites_visited", symIdentifiers);' onmouseout='hideVariable("sites_visited", symIdentifiers);'>sites_visited</span> <span class="assignement">&lt;-</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span id="sym1288" class="symbol" onmouseover='showVariable("nS", symIdentifiers);' onmouseout='hideVariable("nS", symIdentifiers);'>nS</span><span class="keyword">,</span> <span id="sym1289" class="symbol" onmouseover='showVariable("nVisits", symIdentifiers);' onmouseout='hideVariable("nVisits", symIdentifiers);'>nVisits</span><span class="keyword">,</span> <span class="argument">repl</span><span class="argument">=</span><span id="sym1290" class="symbol" onmouseover='showVariable("with_repl", symIdentifiers);' onmouseout='hideVariable("with_repl", symIdentifiers);'>with_repl</span><span class="keyword">)</span>

    <span class="comment">#temp &lt;- rich + rpois(nS,mean(rich)) - rpois(nS,mean(rich))</span>
    <span class="comment">#temp[temp&lt;0] &lt;- 0</span>
    <span class="comment">#sites_visited &lt;- sample(1:nS, nVisits, repl=with_repl, prob=temp) #sites_visited is a vector of site identities</span>

    <span class="comment"># compare the differnet ways</span>
    <span class="comment">#stats &lt;- list(sites_visited_old, sites_visited_bb, sites_visited)</span>
    <span class="comment">#sapply(stats, length) # number of visits</span>
    <span class="comment">#lapply(stats, function(x) table(table(x)))</span>
    <span class="comment">#sapply(stats, function(x) {x&lt;- table(table(x)); sum(x)}) # number of sites</span>
    <span class="comment">#sapply(stats, function(x) {x&lt;- table(table(x)); sum(x[-1])/sum(x)}) # prop getting multi visits</span>
    <span class="comment">#table(table(sites_visited))</span>
    <span class="comment">#the new way is better, but only 50% higher</span>

    <span id="sym1291" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="NA/visit_these_sites.html">visit_these_sites</a><span class="keyword">(</span><span id="sym1292" class="symbol" onmouseover='showVariable("sites_visited", symIdentifiers);' onmouseout='hideVariable("sites_visited", symIdentifiers);'>sites_visited</span><span class="keyword">,</span> <span id="sym1293" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">)</span>
    <span id="sym1294" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="NA/melt.html">melt</a><span class="keyword">(</span><span id="sym1295" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span> <span class="comment">#Var2 is the VisitNum</span>
        <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1296" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">:</span><span class="number">2</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'Species'</span><span class="keyword">,</span> <span class="string">'Visit'</span><span class="keyword">)</span>
        <span id="sym1297" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1298" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">subset</span><span class="argument">=</span><span id="sym1299" class="symbol" onmouseover='showVariable("value", symIdentifiers);' onmouseout='hideVariable("value", symIdentifiers);'>value</span>==<span class="number">1</span><span class="keyword">)</span>
        <span id="sym1300" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym1301" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="assignement">&lt;-</span> <span id="sym1302" class="symbol" onmouseover='showVariable("sites_visited", symIdentifiers);' onmouseout='hideVariable("sites_visited", symIdentifiers);'>sites_visited</span><span class="keyword">[</span><span id="sym1303" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym1304" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span><span class="keyword">]</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1305" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">select</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1306" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span><span class="keyword">,</span> <span id="sym1307" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span><span class="keyword">,</span> <span id="sym1308" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">}</span>

<span id="sym1309" class="symbol" onmouseover='showVariable("recording_cycle", symIdentifiers);' onmouseout='hideVariable("recording_cycle", symIdentifiers);'>recording_cycle</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">pSVS</span><span class="eqformalargs">=</span><span class="number">0.05</span><span class="keyword">,</span> <span class="formalargs">true_data</span><span class="keyword">,</span> <span class="formalargs">max_vis</span><span class="eqformalargs">=</span><span class="number">10</span><span class="keyword">,</span> <span class="formalargs">VisRichSites</span><span class="eqformalargs">=</span><span id="sym1310" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="formalargs">stochastic</span><span class="eqformalargs">=</span><span id="sym1311" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span> <span class="keyword">{</span>
    <span class="comment"># runs a 'recording cycle': nVisits are apportioned randomly among the sites (rows) in true_data: some sites get multiple visits</span>
    <span class="comment"># 3 December: modified to give 'fatter tails' in the distribution of recording effort among sites</span>
    <span class="comment">#   in UK recording data, about 1/4 of monads visited each year get further visits</span>
    <span class="comment">#   For the Dutch Dragonfly &amp; Butterfly data, the figure is about 1/2</span>
    <span class="comment">#   The parameterization here is for UK.</span>
    <span class="comment">#   this makes the total number of visits and expectation, rather than fixed</span>
    <span class="comment">#  8/4/13: I removed the correlation between p(visited) and species richness</span>
    <span class="comment"># 24/4/13: New formulation based on power law. NB this means number of visits varies from year to year</span>
    <span class="comment">#  2/5/13: I added back the correlatin between p(visited) and species richness, with an option to control</span>
    <span class="comment">#   I also added in the option for stochastic (the detault) vs determininistic numbers of visits    </span>
    <span class="comment">#  3/5/13: VisRichSites now additionally determines the number of visits received by each site (if selected)</span>

    <span id="sym1312" class="symbol" onmouseover='showVariable("fx", symIdentifiers);' onmouseout='hideVariable("fx", symIdentifiers);'>fx</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">a</span><span class="eqformalargs">=</span><span class="keyword">-</span><span class="number">3</span><span class="keyword">,</span><span class="formalargs">b</span><span class="eqformalargs">=</span><span class="keyword">-</span><span class="number">2</span><span class="keyword">,</span> <span class="formalargs">nSite</span><span class="eqformalargs">=</span><span class="number">1000</span><span class="keyword">,</span> <span class="formalargs">maxV</span><span class="eqformalargs">=</span><span class="number">10</span><span class="keyword">,</span> <span class="formalargs">stochastic</span><span class="eqformalargs">=</span><span id="sym1313" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># This function defines the distribution of visits among sites in each year, based on the observed power law</span>
        <span class="comment"># the power law is truncated at maxV visits per year.</span>

        <span class="comment"># first define the log probabilities based on the model fit</span>
        <span id="sym1314" class="symbol" onmouseover='showVariable("pr", symIdentifiers);' onmouseout='hideVariable("pr", symIdentifiers);'>pr</span> <span class="assignement">&lt;-</span> <a href="base/exp.html">exp</a><span class="keyword">(</span><span id="sym1315" class="symbol" onmouseover='showVariable("a", symIdentifiers);' onmouseout='hideVariable("a", symIdentifiers);'>a</span> <span class="keyword">+</span> <span id="sym1316" class="symbol" onmouseover='showVariable("b", symIdentifiers);' onmouseout='hideVariable("b", symIdentifiers);'>b</span> <span class="keyword">*</span> <a href="base/log.html">log</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span id="sym1317" class="symbol" onmouseover='showVariable("maxV", symIdentifiers);' onmouseout='hideVariable("maxV", symIdentifiers);'>maxV</span><span class="keyword">)</span><span class="keyword">)</span>

        <span class="comment"># now append the probability of getting zero visits</span>
        <span id="sym1318" class="symbol" onmouseover='showVariable("pr", symIdentifiers);' onmouseout='hideVariable("pr", symIdentifiers);'>pr</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">-</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym1319" class="symbol" onmouseover='showVariable("pr", symIdentifiers);' onmouseout='hideVariable("pr", symIdentifiers);'>pr</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1320" class="symbol" onmouseover='showVariable("pr", symIdentifiers);' onmouseout='hideVariable("pr", symIdentifiers);'>pr</span><span class="keyword">)</span>

        <span class="comment">#enS &lt;- nSite * exp(y) ## the expected number of sites in each group</span>
        <span class="comment"># the number of visits at each site is defined by a multinomial distribution</span>
        <span class="comment"># this includes the number of sites with zero visits, so remove that from the calculation</span>
        <span class="keyword">if</span><span class="keyword">(</span><span id="sym1321" class="symbol" onmouseover='showVariable("stochastic", symIdentifiers);' onmouseout='hideVariable("stochastic", symIdentifiers);'>stochastic</span><span class="keyword">)</span><span class="keyword">{</span>
            <span id="sym1322" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span> <span class="assignement">&lt;-</span> <a href="stats/rmultinom.html">rmultinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span id="sym1323" class="symbol" onmouseover='showVariable("nSite", symIdentifiers);' onmouseout='hideVariable("nSite", symIdentifiers);'>nSite</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym1324" class="symbol" onmouseover='showVariable("pr", symIdentifiers);' onmouseout='hideVariable("pr", symIdentifiers);'>pr</span><span class="keyword">)</span><span class="comment">#[-1] removal of 0 count moved to return statement</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
            <span id="sym1325" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span> <span class="assignement">&lt;-</span> <a href="base/round.html">round</a><span class="keyword">(</span><span id="sym1326" class="symbol" onmouseover='showVariable("pr", symIdentifiers);' onmouseout='hideVariable("pr", symIdentifiers);'>pr</span><span class="keyword">*</span><span id="sym1327" class="symbol" onmouseover='showVariable("nSite", symIdentifiers);' onmouseout='hideVariable("nSite", symIdentifiers);'>nSite</span><span class="keyword">)</span>
            <span class="comment"># are there rounding errors?</span>
            <span id="sym1328" class="symbol" onmouseover='showVariable("rem", symIdentifiers);' onmouseout='hideVariable("rem", symIdentifiers);'>rem</span> <span class="assignement">&lt;-</span> <a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym1329" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">)</span> <span class="keyword">-</span> <span class="number">1000</span> <span class="comment"># corrected typo 18 june ('-' replaced '&lt;')</span>
            <span class="comment">#if there are rounding errors, alter the number of sites in the zero category</span>
            <span class="keyword">if</span><span class="keyword">(</span><span id="sym1330" class="symbol" onmouseover='showVariable("rem", symIdentifiers);' onmouseout='hideVariable("rem", symIdentifiers);'>rem</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span> <span id="sym1331" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span id="sym1332" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span> <span class="keyword">-</span> <span id="sym1333" class="symbol" onmouseover='showVariable("rem", symIdentifiers);' onmouseout='hideVariable("rem", symIdentifiers);'>rem</span>
        <span class="keyword">}</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym1334" class="symbol" onmouseover='showVariable("n", symIdentifiers);' onmouseout='hideVariable("n", symIdentifiers);'>n</span><span class="keyword">[</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span>
    <span class="keyword">}</span>

    <span id="sym1335" class="symbol" onmouseover='showVariable("fxp", symIdentifiers);' onmouseout='hideVariable("fxp", symIdentifiers);'>fxp</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">pSVS</span><span class="eqformalargs">=</span><span class="number">0.05</span><span class="keyword">,</span><span class="formalargs">prch</span><span class="eqformalargs">=</span><span class="number">0.25</span><span class="keyword">,</span> <span class="formalargs">nSite</span><span class="eqformalargs">=</span><span class="number">1000</span><span class="keyword">,</span> <span class="formalargs">maxV</span><span class="eqformalargs">=</span><span class="number">10</span><span class="keyword">,</span> <span class="formalargs">stochastic</span><span class="eqformalargs">=</span><span id="sym1336" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># a wrapper for fx in which the input parameters are on the measurement, rather than modelled scale:</span>
        <span class="comment">#   the proportion of sites receiving 1 visit &amp; prch: the multiplier for doubling the number of visits </span>
        <a href="NA/fx.html">fx</a><span class="keyword">(</span><span class="argument">a</span><span class="argument">=</span><a href="base/log.html">log</a><span class="keyword">(</span><span id="sym1337" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">b</span><span class="argument">=</span><a href="base/log2.html">log2</a><span class="keyword">(</span><span id="sym1338" class="symbol" onmouseover='showVariable("prch", symIdentifiers);' onmouseout='hideVariable("prch", symIdentifiers);'>prch</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">nSite</span><span class="argument">=</span><span id="sym1339" class="symbol" onmouseover='showVariable("nSite", symIdentifiers);' onmouseout='hideVariable("nSite", symIdentifiers);'>nSite</span><span class="keyword">,</span> <span class="argument">maxV</span><span class="argument">=</span><span id="sym1340" class="symbol" onmouseover='showVariable("maxV", symIdentifiers);' onmouseout='hideVariable("maxV", symIdentifiers);'>maxV</span><span class="keyword">,</span> <span class="argument">stochastic</span><span class="argument">=</span><span id="sym1341" class="symbol" onmouseover='showVariable("stochastic", symIdentifiers);' onmouseout='hideVariable("stochastic", symIdentifiers);'>stochastic</span><span class="keyword">)</span>
    <span class="keyword">}</span>

    <span class="comment"># number of sites</span>
    <span id="sym1342" class="symbol" onmouseover='showVariable("nS", symIdentifiers);' onmouseout='hideVariable("nS", symIdentifiers);'>nS</span> <span class="assignement">=</span> <a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym1343" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">)</span>

    <span class="comment"># 3/5/13 VisRichSites gets used twice: if we only get one then use it twice</span>
    <span class="keyword">if</span><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1344" class="symbol" onmouseover='showVariable("VisRichSites", symIdentifiers);' onmouseout='hideVariable("VisRichSites", symIdentifiers);'>VisRichSites</span><span class="keyword">)</span>==<span class="number">1</span><span class="keyword">)</span> <span class="keyword">{</span><span id="sym1345" class="symbol" onmouseover='showVariable("VisRichSites", symIdentifiers);' onmouseout='hideVariable("VisRichSites", symIdentifiers);'>VisRichSites</span> <span class="assignement">&lt;-</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span id="sym1346" class="symbol" onmouseover='showVariable("VisRichSites", symIdentifiers);' onmouseout='hideVariable("VisRichSites", symIdentifiers);'>VisRichSites</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">)</span>
    <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span><span id="sym1347" class="symbol" onmouseover='showVariable("VisRichSites", symIdentifiers);' onmouseout='hideVariable("VisRichSites", symIdentifiers);'>VisRichSites</span> <span class="assignement">&lt;-</span> <a href="base/unlist.html">unlist</a><span class="keyword">(</span><span id="sym1348" class="symbol" onmouseover='showVariable("VisRichSites", symIdentifiers);' onmouseout='hideVariable("VisRichSites", symIdentifiers);'>VisRichSites</span><span class="keyword">)</span><span class="keyword">}</span>

    <span class="comment"># get the number of sites receiving 1, 2, 3 visits</span>
    <span class="comment">#sv &lt;- fxp(pSVS=pSVS, prch=0.25, nSite=nS, maxV=max_vis)</span>
    <span id="sym1349" class="symbol" onmouseover='showVariable("sv", symIdentifiers);' onmouseout='hideVariable("sv", symIdentifiers);'>sv</span> <span class="assignement">&lt;-</span> <a href="NA/fxp.html">fxp</a><span class="keyword">(</span><span class="argument">pSVS</span><span class="argument">=</span><span id="sym1350" class="symbol" onmouseover='showVariable("pSVS", symIdentifiers);' onmouseout='hideVariable("pSVS", symIdentifiers);'>pSVS</span><span class="keyword">,</span> <span class="argument">prch</span><span class="argument">=</span><span class="number">0.25</span><span class="keyword">,</span> <span class="argument">nSite</span><span class="argument">=</span><span id="sym1351" class="symbol" onmouseover='showVariable("nS", symIdentifiers);' onmouseout='hideVariable("nS", symIdentifiers);'>nS</span><span class="keyword">,</span> <span class="argument">maxV</span><span class="argument">=</span><span id="sym1352" class="symbol" onmouseover='showVariable("max_vis", symIdentifiers);' onmouseout='hideVariable("max_vis", symIdentifiers);'>max_vis</span><span class="keyword">,</span> <span class="argument">stochastic</span><span class="argument">=</span><span id="sym1353" class="symbol" onmouseover='showVariable("stochastic", symIdentifiers);' onmouseout='hideVariable("stochastic", symIdentifiers);'>stochastic</span><span class="keyword">)</span> <span class="comment">#corrected 18/6/13</span>

    <span class="comment"># set the probability that sites will be visited</span>
    <span class="keyword">if</span><span class="keyword">(</span><span id="sym1354" class="symbol" onmouseover='showVariable("VisRichSites", symIdentifiers);' onmouseout='hideVariable("VisRichSites", symIdentifiers);'>VisRichSites</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">{</span><span id="sym1355" class="symbol" onmouseover='showVariable("prVis", symIdentifiers);' onmouseout='hideVariable("prVis", symIdentifiers);'>prVis</span> <span class="assignement">&lt;-</span> <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1356" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">,</span> <span class="string">"richness"</span><span class="keyword">)</span>
    <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span><span id="sym1357" class="symbol" onmouseover='showVariable("prVis", symIdentifiers);' onmouseout='hideVariable("prVis", symIdentifiers);'>prVis</span> <span class="assignement">&lt;-</span> NULL<span class="keyword">}</span>

    <span class="comment"># to figure out which sites get visited, sample sum(sv) sites without replacement</span>
    <span class="comment"># unlike sites_visited, each site appears only once in sites_to_visit </span>
    <span id="sym1358" class="symbol" onmouseover='showVariable("sites_to_visit", symIdentifiers);' onmouseout='hideVariable("sites_to_visit", symIdentifiers);'>sites_to_visit</span> <span class="assignement">&lt;-</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span id="sym1359" class="symbol" onmouseover='showVariable("nS", symIdentifiers);' onmouseout='hideVariable("nS", symIdentifiers);'>nS</span><span class="keyword">,</span> <a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym1360" class="symbol" onmouseover='showVariable("sv", symIdentifiers);' onmouseout='hideVariable("sv", symIdentifiers);'>sv</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">repl</span><span class="argument">=</span><span id="sym1361" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym1362" class="symbol" onmouseover='showVariable("prVis", symIdentifiers);' onmouseout='hideVariable("prVis", symIdentifiers);'>prVis</span><span class="keyword">)</span>

    <span class="comment"># should we order the sites so that speciose sites ALWAYS get most visits?</span>
    <span class="keyword">if</span><span class="keyword">(</span><span id="sym1363" class="symbol" onmouseover='showVariable("VisRichSites", symIdentifiers);' onmouseout='hideVariable("VisRichSites", symIdentifiers);'>VisRichSites</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">]</span><span class="keyword">)</span> <span class="keyword">{</span>
        <span class="comment"># create a temporary dataframe of the selected sites and their richness</span>
        <span id="sym1364" class="symbol" onmouseover='showVariable("nsp", symIdentifiers);' onmouseout='hideVariable("nsp", symIdentifiers);'>nsp</span><span class="assignement">=</span><a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1365" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">,</span> <span class="string">"richness"</span><span class="keyword">)</span><span class="keyword">[</span><span id="sym1366" class="symbol" onmouseover='showVariable("sites_to_visit", symIdentifiers);' onmouseout='hideVariable("sites_to_visit", symIdentifiers);'>sites_to_visit</span><span class="keyword">]</span>
        <span id="sym1367" class="symbol" onmouseover='showVariable("sites_to_visit", symIdentifiers);' onmouseout='hideVariable("sites_to_visit", symIdentifiers);'>sites_to_visit</span> <span class="assignement">&lt;-</span> <span id="sym1368" class="symbol" onmouseover='showVariable("sites_to_visit", symIdentifiers);' onmouseout='hideVariable("sites_to_visit", symIdentifiers);'>sites_to_visit</span><span class="keyword">[</span><a href="base/order.html">order</a><span class="keyword">(</span><span id="sym1369" class="symbol" onmouseover='showVariable("nsp", symIdentifiers);' onmouseout='hideVariable("nsp", symIdentifiers);'>nsp</span><span class="keyword">)</span><span class="keyword">]</span>
    <span class="keyword">}</span>

    <span class="comment"># unpack sv so that it has the same length as sites_to_visit</span>
    <span id="sym1370" class="symbol" onmouseover='showVariable("nVis", symIdentifiers);' onmouseout='hideVariable("nVis", symIdentifiers);'>nVis</span> <span class="assignement">&lt;-</span> <a href="base/unlist.html">unlist</a><span class="keyword">(</span><a href="base/sapply.html">sapply</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1371" class="symbol" onmouseover='showVariable("sv", symIdentifiers);' onmouseout='hideVariable("sv", symIdentifiers);'>sv</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span> <a href="base/rep.int.html">rep.int</a><span class="keyword">(</span><span class="argument">x</span><span class="argument">=</span><span id="sym1372" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span> <span class="argument">times</span><span class="argument">=</span><span id="sym1373" class="symbol" onmouseover='showVariable("sv", symIdentifiers);' onmouseout='hideVariable("sv", symIdentifiers);'>sv</span><span class="keyword">[</span><span id="sym1374" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>

    <span class="comment">#visit_site_Ntimes(i=sites_to_visit[646], times=nVis[646], true_data)</span>
    <span id="sym1375" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/mapply.html">mapply</a><span class="keyword">(</span><span class="argument">FUN</span><span class="argument">=</span><span id="sym1376" class="symbol" onmouseover='showVariable("visit_site_Ntimes", symIdentifiers);' onmouseout='hideVariable("visit_site_Ntimes", symIdentifiers);'>visit_site_Ntimes</span><span class="keyword">,</span> <span class="argument">i</span><span class="argument">=</span><span id="sym1377" class="symbol" onmouseover='showVariable("sites_to_visit", symIdentifiers);' onmouseout='hideVariable("sites_to_visit", symIdentifiers);'>sites_to_visit</span><span class="keyword">,</span> <span class="argument">times</span><span class="argument">=</span><span id="sym1378" class="symbol" onmouseover='showVariable("nVis", symIdentifiers);' onmouseout='hideVariable("nVis", symIdentifiers);'>nVis</span><span class="keyword">,</span> <span class="argument">MoreArgs</span><span class="argument">=</span><a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">true_data</span><span class="argument">=</span><span id="sym1379" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">)</span><span class="keyword">)</span>

    <span id="sym1380" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="NA/melt.html">melt</a><span class="keyword">(</span><span id="sym1381" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span> <span class="comment">#Var2 is the VisitNum - in the new version it goes from 1:max(nVis)</span>
    <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1382" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">:</span><span class="number">2</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'Species'</span><span class="keyword">,</span> <span class="string">'RepVisit'</span><span class="keyword">)</span>
    <span id="sym1383" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym1384" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="assignement">&lt;-</span> <span id="sym1385" class="symbol" onmouseover='showVariable("sites_to_visit", symIdentifiers);' onmouseout='hideVariable("sites_to_visit", symIdentifiers);'>sites_to_visit</span><span class="keyword">[</span><span id="sym1386" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym1387" class="symbol" onmouseover='showVariable("L1", symIdentifiers);' onmouseout='hideVariable("L1", symIdentifiers);'>L1</span><span class="keyword">]</span>

    <span class="comment"># renumber the visits so that they're unique within years, not within site:year combos</span>
    <span id="sym1388" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span> <span class="assignement">&lt;-</span> <a href="NA/dcast.html">dcast</a><span class="keyword">(</span><span id="sym1389" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym1390" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">+</span> <span id="sym1391" class="symbol" onmouseover='showVariable("RepVisit", symIdentifiers);' onmouseout='hideVariable("RepVisit", symIdentifiers);'>RepVisit</span> <span class="keyword">~</span> <span id="sym1392" class="symbol" onmouseover='showVariable(".", symIdentifiers);' onmouseout='hideVariable(".", symIdentifiers);'>.</span><span class="keyword">,</span> <span id="sym1393" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">)</span>
    <span id="sym1394" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym1395" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym1396" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">)</span>
    <span id="sym1397" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="base/merge.html">merge</a><span class="keyword">(</span><span id="sym1398" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym1399" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">)</span>
    <span id="sym1400" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym1401" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span> <span class="assignement">&lt;-</span> <span id="sym1402" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym1403" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span>

    <span class="comment"># return the informative columns, without the occasions where a species was not observed </span>
    <a href="base/return.html">return</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1404" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">subset</span><span class="argument">=</span><span id="sym1405" class="symbol" onmouseover='showVariable("value", symIdentifiers);' onmouseout='hideVariable("value", symIdentifiers);'>value</span>==<span class="number">1</span><span class="keyword">,</span> <span class="argument">select</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1406" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span><span class="keyword">,</span> <span id="sym1407" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span><span class="keyword">,</span> <span id="sym1408" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">}</span>

<span id="sym1409" class="symbol" onmouseover='showVariable("recording_visit", symIdentifiers);' onmouseout='hideVariable("recording_visit", symIdentifiers);'>recording_visit</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">spp_vector</span><span class="keyword">,</span> <span class="formalargs">p_obs</span><span class="eqformalargs">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="formalargs">S</span><span class="eqformalargs">=</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># simulate a visit to the site, OR a search for one species across multiple sites</span>
        <span class="comment"># takes a vector of species occurrences</span>
        <span class="comment"># the simplest way of doing this is to generate the observations for all sites first, even those without actual presences</span>
    <span class="comment"># in the default version, all species have equal probability</span>
    <span class="comment"># but species-specific detectabilities can be used also</span>
    <span class="comment"># detection probabilities can also be modified by the D parameter, which is the intensity of the search</span>
    <span class="comment"># for a complete search, S=1. (from Mark Hill)</span>

    <span id="sym1410" class="symbol" onmouseover='showVariable("Hill_search", symIdentifiers);' onmouseout='hideVariable("Hill_search", symIdentifiers);'>Hill_search</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">pr</span><span class="keyword">,</span> <span class="formalargs">S</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment">#takes a vector of species probabilities and the search intensity, S</span>
        <span class="number">1</span> <span class="keyword">-</span> <a href="base/exp.html">exp</a><span class="keyword">(</span><span id="sym1411" class="symbol" onmouseover='showVariable("S", symIdentifiers);' onmouseout='hideVariable("S", symIdentifiers);'>S</span> <span class="keyword">*</span> <a href="base/log.html">log</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">-</span><span id="sym1412" class="symbol" onmouseover='showVariable("pr", symIdentifiers);' onmouseout='hideVariable("pr", symIdentifiers);'>pr</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">}</span>

    <span class="keyword">if</span> <span class="keyword">(</span><span id="sym1413" class="symbol" onmouseover='showVariable("S", symIdentifiers);' onmouseout='hideVariable("S", symIdentifiers);'>S</span>==<span class="number">1</span><span class="keyword">)</span> <span id="sym1414" class="symbol" onmouseover='showVariable("detected", symIdentifiers);' onmouseout='hideVariable("detected", symIdentifiers);'>detected</span> <span class="assignement">&lt;-</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1415" class="symbol" onmouseover='showVariable("spp_vector", symIdentifiers);' onmouseout='hideVariable("spp_vector", symIdentifiers);'>spp_vector</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym1416" class="symbol" onmouseover='showVariable("p_obs", symIdentifiers);' onmouseout='hideVariable("p_obs", symIdentifiers);'>p_obs</span><span class="keyword">)</span>
    <span class="keyword">else</span> <span id="sym1417" class="symbol" onmouseover='showVariable("detected", symIdentifiers);' onmouseout='hideVariable("detected", symIdentifiers);'>detected</span> <span class="assignement">&lt;-</span> <a href="stats/rbinom.html">rbinom</a><span class="keyword">(</span><span class="argument">n</span><span class="argument">=</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1418" class="symbol" onmouseover='showVariable("spp_vector", symIdentifiers);' onmouseout='hideVariable("spp_vector", symIdentifiers);'>spp_vector</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><a href="NA/Hill_search.html">Hill_search</a><span class="keyword">(</span><span id="sym1419" class="symbol" onmouseover='showVariable("p_obs", symIdentifiers);' onmouseout='hideVariable("p_obs", symIdentifiers);'>p_obs</span><span class="keyword">,</span><span id="sym1420" class="symbol" onmouseover='showVariable("S", symIdentifiers);' onmouseout='hideVariable("S", symIdentifiers);'>S</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="comment"># the realised set of observations is then the minimim value (i.e. a species was only recorded if both present and detected)</span>
        <a href="base/apply.html">apply</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym1421" class="symbol" onmouseover='showVariable("detected", symIdentifiers);' onmouseout='hideVariable("detected", symIdentifiers);'>detected</span><span class="keyword">,</span> <span id="sym1422" class="symbol" onmouseover='showVariable("spp_vector", symIdentifiers);' onmouseout='hideVariable("spp_vector", symIdentifiers);'>spp_vector</span><span class="keyword">)</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span id="sym1423" class="symbol" onmouseover='showVariable("min", symIdentifiers);' onmouseout='hideVariable("min", symIdentifiers);'>min</span><span class="keyword">)</span>
<span class="keyword">}</span>

<span id="sym1424" class="symbol" onmouseover='showVariable("resample", symIdentifiers);' onmouseout='hideVariable("resample", symIdentifiers);'>resample</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">,</span> <span class="formalargs">...</span><span class="keyword">)</span> <span id="sym1425" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><a href="base/sample.int.html">sample.int</a><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym1426" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1427" class="symbol" onmouseover='showVariable("...", symIdentifiers);' onmouseout='hideVariable("...", symIdentifiers);'>...</span><span class="keyword">)</span><span class="keyword">]</span> <span class="comment"># added 3/11 7 moved to separate function 5/2/13</span>


<span id="sym1428" class="symbol" onmouseover='showVariable("run_all_methods", symIdentifiers);' onmouseout='hideVariable("run_all_methods", symIdentifiers);'>run_all_methods</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">min_sq</span><span class="eqformalargs">=</span><span class="number">5</span><span class="keyword">,</span> <span class="formalargs">summarize</span><span class="eqformalargs">=</span><span id="sym1429" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="formalargs">nyr</span><span class="eqformalargs">=</span><span class="number">3</span><span class="keyword">,</span> <span class="formalargs">inclMM</span><span class="eqformalargs">=</span><span class="number">2</span><span class="keyword">,</span>
                            <span class="formalargs">OccMods</span><span class="eqformalargs">=</span>NULL<span class="keyword">,</span> <span class="formalargs">Frescalo</span><span class="eqformalargs">=</span><span class="number">TRUE</span><span class="keyword">,</span> <span class="formalargs">frescalo_path</span><span class="eqformalargs">=</span>NULL<span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># 3 November 2012: inclMM modified from a Boolean to the option of a number or vector of numbers, each of which specify the values of nsp for including</span>
        <span class="comment"># 6 November: added a 'stupid' model based on simply the number of visits &amp; sites</span>
        <span class="comment"># 4 December: added 'pRecsBenchmark': the proportion of records made up by commonest 27%</span>
    <span class="comment">#takes a simulated dataset and runs each method</span>
  <span class="comment"># 13 September 2013: Added mixed effects version of List Length model</span>
        <span class="comment">#18 February 2014: Added Occupancy </span>
    <span class="comment"># added threshold number of years into function definition</span>

        <span class="comment">######## two timeperiod models (0.01 seconds)</span>
        <span id="sym1430" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span> <span class="assignement">&lt;-</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/range.html">range</a><span class="keyword">(</span><span id="sym1431" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym1432" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1433" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span> <span class="assignement">&lt;-</span> <a href="NA/Convert_records_to_2tp.html">Convert_records_to_2tp</a><span class="keyword">(</span><span id="sym1434" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym1435" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span>     <span class="comment">#get the number of sites in each time periods</span>
        <span id="sym1436" class="symbol" onmouseover='showVariable("prop.diff", symIdentifiers);' onmouseout='hideVariable("prop.diff", symIdentifiers);'>prop.diff</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1437" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">,</span> <span id="sym1438" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span><span class="keyword">&gt;=</span><span id="sym1439" class="symbol" onmouseover='showVariable("min_sq", symIdentifiers);' onmouseout='hideVariable("min_sq", symIdentifiers);'>min_sq</span> <span class="keyword">&amp;</span> <span id="sym1440" class="symbol" onmouseover='showVariable("n2", symIdentifiers);' onmouseout='hideVariable("n2", symIdentifiers);'>n2</span> <span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span><span id="sym1441" class="symbol" onmouseover='showVariable("n2", symIdentifiers);' onmouseout='hideVariable("n2", symIdentifiers);'>n2</span><span class="keyword">-</span><span id="sym1442" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span><span class="keyword">)</span><span class="keyword">/</span><span id="sym1443" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span><span class="keyword">)</span>
        <span class="comment">#plr &lt;- rstandard(lm(log(n2) ~ log(n1), gridcell_counts, subset=gridcell_counts$n1 &gt;= min_sq &amp; gridcell_counts$n2 &gt;0))</span>
        <span id="sym1444" class="symbol" onmouseover='showVariable("plr", symIdentifiers);' onmouseout='hideVariable("plr", symIdentifiers);'>plr</span> <span class="assignement">&lt;-</span> <a href="stats/rstandard.html">rstandard</a><span class="keyword">(</span><a href="stats/lm.html">lm</a><span class="keyword">(</span><a href="base/log.html">log</a><span class="keyword">(</span><span id="sym1445" class="symbol" onmouseover='showVariable("n2", symIdentifiers);' onmouseout='hideVariable("n2", symIdentifiers);'>n2</span><span class="keyword">)</span> <span class="keyword">~</span> <a href="base/log.html">log</a><span class="keyword">(</span><span id="sym1446" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1447" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">,</span> <span class="argument">subset</span><span class="argument">=</span><span id="sym1448" class="symbol" onmouseover='showVariable("n1", symIdentifiers);' onmouseout='hideVariable("n1", symIdentifiers);'>n1</span> <span class="keyword">&gt;=</span> <span id="sym1449" class="symbol" onmouseover='showVariable("min_sq", symIdentifiers);' onmouseout='hideVariable("min_sq", symIdentifiers);'>min_sq</span> <span class="keyword">&amp;</span> <span id="sym1450" class="symbol" onmouseover='showVariable("n2", symIdentifiers);' onmouseout='hideVariable("n2", symIdentifiers);'>n2</span> <span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1451" class="symbol" onmouseover='showVariable("Telfer", symIdentifiers);' onmouseout='hideVariable("Telfer", symIdentifiers);'>Telfer</span> <span class="assignement">&lt;-</span> <a href="NA/fit_Telfer.html">fit_Telfer</a><span class="keyword">(</span><span id="sym1452" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">,</span> <span id="sym1453" class="symbol" onmouseover='showVariable("min_sq", symIdentifiers);' onmouseout='hideVariable("min_sq", symIdentifiers);'>min_sq</span><span class="keyword">)</span>

  <span class="comment">#we actually only want information from the focal species</span>
        <span id="sym1454" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym1455" class="symbol" onmouseover='showVariable("prop.diff", symIdentifiers);' onmouseout='hideVariable("prop.diff", symIdentifiers);'>prop.diff</span><span class="keyword">,</span> <span id="sym1456" class="symbol" onmouseover='showVariable("plr", symIdentifiers);' onmouseout='hideVariable("plr", symIdentifiers);'>plr</span><span class="keyword">,</span> <span id="sym1457" class="symbol" onmouseover='showVariable("Telfer", symIdentifiers);' onmouseout='hideVariable("Telfer", symIdentifiers);'>Telfer</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">,</span><span class="keyword">]</span>

  <span class="comment"># Add Telfer p here for simplicity (no estimate of directionality)</span>
        <span id="sym1458" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1459" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span>
              <span class="argument">plr_p</span> <span class="argument">=</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="NA/one_to_two_tail.html">one_to_two_tail</a><span class="keyword">(</span><a href="stats/pnorm.html">pnorm</a><span class="keyword">(</span><span id="sym1460" class="symbol" onmouseover='showVariable("plr", symIdentifiers);' onmouseout='hideVariable("plr", symIdentifiers);'>plr</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span>
              <span class="argument">Telfer_p</span> <span class="argument">=</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="NA/one_to_two_tail.html">one_to_two_tail</a><span class="keyword">(</span><a href="stats/pnorm.html">pnorm</a><span class="keyword">(</span><span id="sym1461" class="symbol" onmouseover='showVariable("Telfer", symIdentifiers);' onmouseout='hideVariable("Telfer", symIdentifiers);'>Telfer</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>

        <span class="comment"># now fit the method of Maes et al 2012</span>
  <span id="sym1462" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span> <span class="assignement">&lt;-</span> <a href="NA/fit_Maes.html">fit_Maes</a><span class="keyword">(</span><span id="sym1463" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym1464" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">,</span> <span id="sym1465" class="symbol" onmouseover='showVariable("min_sq", symIdentifiers);' onmouseout='hideVariable("min_sq", symIdentifiers);'>min_sq</span><span class="keyword">,</span> <span class="argument">test</span><span class="argument">=</span><span class="number">4</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">,</span><span class="keyword">]</span> <span class="comment"># just the first row (i.e. the focal species)</span>
  <span id="sym1466" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1467" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">Maes_trend</span><span class="argument">=</span><span id="sym1468" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">$</span><span id="sym1469" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">,</span> <span class="argument">Maes_p</span><span class="argument">=</span><span id="sym1470" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">$</span><span id="sym1471" class="symbol" onmouseover='showVariable("pval", symIdentifiers);' onmouseout='hideVariable("pval", symIdentifiers);'>pval</span><span class="keyword">)</span>

        <span class="comment"># temporary measure</span>
  <span class="comment"># rerun with the other version of the test (number of cells, not gridcellsum as denom)</span>
  <span id="sym1472" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span> <span class="assignement">&lt;-</span> <a href="NA/fit_Maes.html">fit_Maes</a><span class="keyword">(</span><span id="sym1473" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym1474" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">,</span> <span id="sym1475" class="symbol" onmouseover='showVariable("min_sq", symIdentifiers);' onmouseout='hideVariable("min_sq", symIdentifiers);'>min_sq</span><span class="keyword">,</span> <span class="argument">test</span><span class="argument">=</span><span class="number">5</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">,</span><span class="keyword">]</span> <span class="comment"># just the first row (i.e. the focal species)</span>
        <span id="sym1476" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1477" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">Maes5_trend</span><span class="argument">=</span><span id="sym1478" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">$</span><span id="sym1479" class="symbol" onmouseover='showVariable("trend", symIdentifiers);' onmouseout='hideVariable("trend", symIdentifiers);'>trend</span><span class="keyword">,</span> <span class="argument">Maes5_p</span><span class="argument">=</span><span id="sym1480" class="symbol" onmouseover='showVariable("Maes", symIdentifiers);' onmouseout='hideVariable("Maes", symIdentifiers);'>Maes</span><span class="keyword">$</span><span id="sym1481" class="symbol" onmouseover='showVariable("pval", symIdentifiers);' onmouseout='hideVariable("pval", symIdentifiers);'>pval</span><span class="keyword">)</span>

        <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1482" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="string">'nSitesFocal'</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <span id="sym1483" class="symbol" onmouseover='showVariable("gridcell_counts", symIdentifiers);' onmouseout='hideVariable("gridcell_counts", symIdentifiers);'>gridcell_counts</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span class="number">2</span><span class="keyword">]</span>

  <span class="comment">######## DATA FRAME FOR visit-based analysis</span>
        <span id="sym1484" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span> <span class="assignement">&lt;-</span> <a href="NA/cast_recs.html">cast_recs</a><span class="keyword">(</span><span id="sym1485" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">resolution</span><span class="argument">=</span><span class="string">'visit'</span><span class="keyword">)</span> <span class="comment"># 0.02 seconds</span>

  <span class="comment"># for later: which are on well-sampled sites (3 years data)</span>
        <span id="sym1486" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <a href="NA/is.gridcell.wellsampled2.html">is.gridcell.wellsampled2</a><span class="keyword">(</span><span id="sym1487" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span class="argument">n</span><span class="argument">=</span><span id="sym1488" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">)</span>

        <span class="comment">######## WHICH SITES HAS THE FOCAL SPECIES EVER BEEN RECORDED ON? (added 1/5/13)</span>
        <span id="sym1489" class="symbol" onmouseover='showVariable("focalsites", symIdentifiers);' onmouseout='hideVariable("focalsites", symIdentifiers);'>focalsites</span> <span class="assignement">&lt;-</span> <a href="base/unique.html">unique</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1490" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym1491" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span>==<span class="string">'focal'</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1492" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span>

        <span class="comment">######## List Length (0.01 seconds)</span>
        <span class="comment"># 4/2/13: looking for an occasional bug</span>
        <span id="sym1493" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span>
          <span id="sym1494" class="symbol" onmouseover='showVariable("LL_model", symIdentifiers);' onmouseout='hideVariable("LL_model", symIdentifiers);'>LL_model</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/glm.html">glm</a><span class="keyword">(</span><span id="sym1495" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="keyword">~</span> <span id="sym1496" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <a href="base/log2.html">log2</a><span class="keyword">(</span><span id="sym1497" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1498" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><span id="sym1499" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span class="argument">subset</span> <span class="argument">=</span> <span id="sym1500" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1501" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span>
          <span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym1502" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym1503" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1504" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'LL1_try_error.rData'</span><span class="keyword">)</span>
          <span id="sym1505" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1506" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">LLsimple_trend</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">,</span> <span class="argument">LLsimple_p</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span id="sym1507" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1508" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">LLsimple_trend</span><span class="argument">=</span><span id="sym1509" class="symbol" onmouseover='showVariable("LL_model", symIdentifiers);' onmouseout='hideVariable("LL_model", symIdentifiers);'>LL_model</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">LLsimple_p</span><span class="argument">=</span><span id="sym1510" class="symbol" onmouseover='showVariable("LL_model", symIdentifiers);' onmouseout='hideVariable("LL_model", symIdentifiers);'>LL_model</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>
  <span class="comment">## a second version of the List Length in which only sites where the focal has been EVER recorded</span>
        <span class="comment"># added 1/5/13</span>
        <span id="sym1511" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span>
          <span id="sym1512" class="symbol" onmouseover='showVariable("LL_model2", symIdentifiers);' onmouseout='hideVariable("LL_model2", symIdentifiers);'>LL_model2</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/glm.html">glm</a><span class="keyword">(</span><span id="sym1513" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="keyword">~</span> <span id="sym1514" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <a href="base/log2.html">log2</a><span class="keyword">(</span><span id="sym1515" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1516" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><span id="sym1517" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span>
                                   <span class="argument">subset</span> <span class="argument">=</span> <span id="sym1518" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">&gt;</span><span class="number">0</span> <span class="keyword">&amp;</span> <span id="sym1519" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">%in%</span> <span id="sym1520" class="symbol" onmouseover='showVariable("focalsites", symIdentifiers);' onmouseout='hideVariable("focalsites", symIdentifiers);'>focalsites</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1521" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span>
          <span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym1522" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym1523" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1524" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'LLfs_try_error.rData'</span><span class="keyword">)</span>
          <span id="sym1525" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1526" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">LLfs_trend</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">,</span> <span class="argument">LLfs_p</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span id="sym1527" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1528" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">LLfs_trend</span><span class="argument">=</span><span id="sym1529" class="symbol" onmouseover='showVariable("LL_model2", symIdentifiers);' onmouseout='hideVariable("LL_model2", symIdentifiers);'>LL_model2</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">LLfs_p</span><span class="argument">=</span><span id="sym1530" class="symbol" onmouseover='showVariable("LL_model2", symIdentifiers);' onmouseout='hideVariable("LL_model2", symIdentifiers);'>LL_model2</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>
        <span class="comment"># end bug check</span>

  <span class="comment">### 13/9/13: LL model with random effect</span>
  <span class="comment">#simdata$cYr &lt;- simdata$Year - median(unique(simdata$Year))</span>
  <span class="comment">#x &lt;- try(</span>
        <span class="comment">#  LL_mm &lt;- summary(glmer(focal ~ cYr + log2(L) + (1|Site), binomial, data=simdata, subset = L&gt;0))</span>
        <span class="comment">#  , silent=T)</span>
        <span class="comment">#if(class(x)=='try-error'){</span>
  <span class="comment">#  save(records, file='LLMM_try_error.rData')</span>
  <span class="comment">#  coef &lt;- rep(NA,4)</span>
  <span class="comment">#  output &lt;- c(output, LLmm_trend=NA, LLmm_p=NA)</span>
        <span class="comment">#} else {</span>
        <span class="comment">#  coef &lt;- as.numeric(coef(LL_mm)[2,]) # should be compatible with old and new versions of lme4</span>
        <span class="comment">#  output &lt;- c(output, LLmm_trend=coef[1], LLmm_p=coef[4])</span>
        <span class="comment">#}</span>
        <span class="comment"># end bug check</span>


        <span class="comment">### 18/2/14: LL model with random effect &amp; site selection</span>
        <span id="sym1531" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym1532" class="symbol" onmouseover='showVariable("cYr", symIdentifiers);' onmouseout='hideVariable("cYr", symIdentifiers);'>cYr</span> <span class="assignement">&lt;-</span> <span id="sym1533" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym1534" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">-</span> <a href="stats/median.html">median</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym1535" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym1536" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1537" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span>
          <span id="sym1538" class="symbol" onmouseover='showVariable("LL_mm_SS", symIdentifiers);' onmouseout='hideVariable("LL_mm_SS", symIdentifiers);'>LL_mm_SS</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="NA/glmer.html">glmer</a><span class="keyword">(</span><span id="sym1539" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="keyword">~</span> <span id="sym1540" class="symbol" onmouseover='showVariable("cYr", symIdentifiers);' onmouseout='hideVariable("cYr", symIdentifiers);'>cYr</span> <span class="keyword">+</span> <a href="base/log2.html">log2</a><span class="keyword">(</span><span id="sym1541" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span> <span class="keyword">+</span> <span class="keyword">(</span><span class="number">1</span><span class="keyword">|</span><span id="sym1542" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1543" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><span id="sym1544" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span class="argument">subset</span> <span class="argument">=</span> <span id="sym1545" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">&amp;</span> <span id="sym1546" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym1547" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym1548" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1549" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'LLMMSS_try_error.rData'</span><span class="keyword">)</span>
          <span id="sym1550" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span> <span class="assignement">&lt;-</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span class="number">NA</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">)</span>
          <span id="sym1551" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1552" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">LLmm_trend</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">,</span> <span class="argument">LLmm_p</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span id="sym1553" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="stats/coef.html">coef</a><span class="keyword">(</span><span id="sym1554" class="symbol" onmouseover='showVariable("LL_mm_SS", symIdentifiers);' onmouseout='hideVariable("LL_mm_SS", symIdentifiers);'>LL_mm_SS</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># should be compatible with old and new versions of lme4</span>
          <span id="sym1555" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1556" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">LLmmSS_trend</span><span class="argument">=</span><span id="sym1557" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">LLmmSS_p</span><span class="argument">=</span><span id="sym1558" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span><span class="keyword">[</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>
        <span class="comment"># end bug check</span>

        <span class="comment">### 4/3/14: the other two "2 component models"</span>
        <span id="sym1559" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span>
          <span id="sym1560" class="symbol" onmouseover='showVariable("LL_SS", symIdentifiers);' onmouseout='hideVariable("LL_SS", symIdentifiers);'>LL_SS</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/glm.html">glm</a><span class="keyword">(</span><span id="sym1561" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="keyword">~</span> <span id="sym1562" class="symbol" onmouseover='showVariable("cYr", symIdentifiers);' onmouseout='hideVariable("cYr", symIdentifiers);'>cYr</span> <span class="keyword">+</span> <a href="base/log2.html">log2</a><span class="keyword">(</span><span id="sym1563" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1564" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><span id="sym1565" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span class="argument">subset</span> <span class="argument">=</span> <span id="sym1566" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">&amp;</span> <span id="sym1567" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym1568" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym1569" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1570" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'LLSS_try_error.rData'</span><span class="keyword">)</span>
          <span id="sym1571" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span> <span class="assignement">&lt;-</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span class="number">NA</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">)</span>
          <span id="sym1572" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1573" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">LLSS_trend</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">,</span> <span class="argument">LLSS_p</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span id="sym1574" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="stats/coef.html">coef</a><span class="keyword">(</span><span id="sym1575" class="symbol" onmouseover='showVariable("LL_SS", symIdentifiers);' onmouseout='hideVariable("LL_SS", symIdentifiers);'>LL_SS</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># should be compatible with old and new versions of lme4</span>
          <span id="sym1576" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1577" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">LLSS_trend</span><span class="argument">=</span><span id="sym1578" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">LLSS_p</span><span class="argument">=</span><span id="sym1579" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span><span class="keyword">[</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>

        <span id="sym1580" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span>
          <span id="sym1581" class="symbol" onmouseover='showVariable("mm_SS", symIdentifiers);' onmouseout='hideVariable("mm_SS", symIdentifiers);'>mm_SS</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="NA/glmer.html">glmer</a><span class="keyword">(</span><span id="sym1582" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span> <span class="keyword">~</span> <span id="sym1583" class="symbol" onmouseover='showVariable("cYr", symIdentifiers);' onmouseout='hideVariable("cYr", symIdentifiers);'>cYr</span> <span class="keyword">+</span> <span class="keyword">(</span><span class="number">1</span><span class="keyword">|</span><span id="sym1584" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1585" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">,</span> <span class="argument">data</span><span class="argument">=</span><span id="sym1586" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span class="argument">subset</span> <span class="argument">=</span> <span id="sym1587" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">&amp;</span> <span id="sym1588" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym1589" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym1590" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1591" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'MMSS_try_error.rData'</span><span class="keyword">)</span>
          <span id="sym1592" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span> <span class="assignement">&lt;-</span> <a href="base/rep.html">rep</a><span class="keyword">(</span><span class="number">NA</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">)</span>
          <span id="sym1593" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1594" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">mmSS_trend</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">,</span> <span class="argument">mmSS_p</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span id="sym1595" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="stats/coef.html">coef</a><span class="keyword">(</span><span id="sym1596" class="symbol" onmouseover='showVariable("mm_SS", symIdentifiers);' onmouseout='hideVariable("mm_SS", symIdentifiers);'>mm_SS</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span> <span class="comment"># should be compatible with old and new versions of lme4</span>
          <span id="sym1597" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1598" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">mmSS_trend</span><span class="argument">=</span><span id="sym1599" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">mmSS_p</span><span class="argument">=</span><span id="sym1600" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span><span class="keyword">[</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>


        <span class="comment">####################################################### REPORTING RATE</span>
  <span class="comment">######## Ball method </span>
        <span class="comment"># modified 1/5/13 to include multiple versions of this method</span>

    <span class="comment"># first, the simple version (as used previously)</span>
        <span id="sym1601" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym1602" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym1603" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">,</span> <span id="sym1604" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym1605" class="symbol" onmouseover='showVariable("sum", symIdentifiers);' onmouseout='hideVariable("sum", symIdentifiers);'>sum</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1606" class="symbol" onmouseover='showVariable("num_visits_that_year", symIdentifiers);' onmouseout='hideVariable("num_visits_that_year", symIdentifiers);'>num_visits_that_year</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym1607" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym1608" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">,</span> <span id="sym1609" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym1610" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1611" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span> <span class="assignement">&lt;-</span> <span id="sym1612" class="symbol" onmouseover='showVariable("num_visits_that_year", symIdentifiers);' onmouseout='hideVariable("num_visits_that_year", symIdentifiers);'>num_visits_that_year</span> <span class="keyword">-</span> <span id="sym1613" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span><span class="comment">#[,2] #col 2 is focal species (col 1 is year)</span>
        <span id="sym1614" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="assignement">&lt;-</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym1615" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym1616" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span>

        <span id="sym1617" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span><span class="comment"># 4/2/13: looking for an occasional bug</span>
          <span id="sym1618" class="symbol" onmouseover='showVariable("Ball_model", symIdentifiers);' onmouseout='hideVariable("Ball_model", symIdentifiers);'>Ball_model</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/glm.html">glm</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym1619" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span><span class="keyword">,</span><span id="sym1620" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span><span class="keyword">)</span> <span class="keyword">~</span> <span id="sym1621" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span class="argument">family</span><span class="argument">=</span><span id="sym1622" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1623" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span>
          <span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym1624" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym1625" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1626" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'try_error.rData'</span><span class="keyword">)</span>
          <span id="sym1627" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1628" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">VRsimple_trend</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">,</span> <span class="argument">VRsimple_p</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span id="sym1629" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1630" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">VRsimple_trend</span><span class="argument">=</span><span id="sym1631" class="symbol" onmouseover='showVariable("Ball_model", symIdentifiers);' onmouseout='hideVariable("Ball_model", symIdentifiers);'>Ball_model</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">VRsimple_p</span><span class="argument">=</span><span id="sym1632" class="symbol" onmouseover='showVariable("Ball_model", symIdentifiers);' onmouseout='hideVariable("Ball_model", symIdentifiers);'>Ball_model</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>

    <span class="comment"># Note that in the hoverfly atlas, Ball fits the logit(proportion), with number of hectads &amp; visits as covariates</span>
    <span class="comment"># the binomial version of this model should render these covariates unnecessary</span>
    <span class="comment"># he also includes number of unique recorders</span>

    <span class="comment"># Next, we use a version in which only sites where the focal was ever recorded</span>
    <span class="comment"># this is a filter discussed by Stuart Ball but not described in the hoverfly atlas</span>
    <span class="comment"># Ball calls these visits 'suitable', although they would be defined at a coarser resolution than used here.</span>
    <span class="comment">#num_visits_recorded &lt;- aggregate(simdata$focal, by=list(simdata$Year), FUN=sum)</span>
        <span id="sym1633" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1634" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym1635" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">%in%</span> <span id="sym1636" class="symbol" onmouseover='showVariable("focalsites", symIdentifiers);' onmouseout='hideVariable("focalsites", symIdentifiers);'>focalsites</span><span class="keyword">)</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym1637" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">,</span> <span id="sym1638" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym1639" class="symbol" onmouseover='showVariable("sum", symIdentifiers);' onmouseout='hideVariable("sum", symIdentifiers);'>sum</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1640" class="symbol" onmouseover='showVariable("num_visits_that_year", symIdentifiers);' onmouseout='hideVariable("num_visits_that_year", symIdentifiers);'>num_visits_that_year</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1641" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym1642" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">%in%</span> <span id="sym1643" class="symbol" onmouseover='showVariable("focalsites", symIdentifiers);' onmouseout='hideVariable("focalsites", symIdentifiers);'>focalsites</span><span class="keyword">)</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym1644" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">,</span> <span id="sym1645" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym1646" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1647" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span> <span class="assignement">&lt;-</span> <span id="sym1648" class="symbol" onmouseover='showVariable("num_visits_that_year", symIdentifiers);' onmouseout='hideVariable("num_visits_that_year", symIdentifiers);'>num_visits_that_year</span> <span class="keyword">-</span> <span id="sym1649" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span><span class="comment">#[,2] #col 2 is focal species (col 1 is year)</span>
        <span id="sym1650" class="symbol" onmouseover='showVariable("YearFS", symIdentifiers);' onmouseout='hideVariable("YearFS", symIdentifiers);'>YearFS</span> <span class="assignement">&lt;-</span><a href="base/unique.html">unique</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1651" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym1652" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">%in%</span> <span id="sym1653" class="symbol" onmouseover='showVariable("focalsites", symIdentifiers);' onmouseout='hideVariable("focalsites", symIdentifiers);'>focalsites</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1654" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span> <span class="comment"># modified 9/5 to catch years when no focal sites are visited</span>

        <span id="sym1655" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span><span class="comment"># 4/2/13: looking for an occasional bug</span>
          <span id="sym1656" class="symbol" onmouseover='showVariable("Ball_model", symIdentifiers);' onmouseout='hideVariable("Ball_model", symIdentifiers);'>Ball_model</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/glm.html">glm</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym1657" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span><span class="keyword">,</span><span id="sym1658" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span><span class="keyword">)</span> <span class="keyword">~</span> <span id="sym1659" class="symbol" onmouseover='showVariable("YearFS", symIdentifiers);' onmouseout='hideVariable("YearFS", symIdentifiers);'>YearFS</span><span class="keyword">,</span> <span class="argument">family</span><span class="argument">=</span><span id="sym1660" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1661" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span>
          <span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym1662" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym1663" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1664" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'VR_try_error.rData'</span><span class="keyword">)</span>
          <span id="sym1665" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1666" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">VRfs_trend</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">,</span> <span class="argument">VRfs_p</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span id="sym1667" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1668" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">VRfs_trend</span><span class="argument">=</span><span id="sym1669" class="symbol" onmouseover='showVariable("Ball_model", symIdentifiers);' onmouseout='hideVariable("Ball_model", symIdentifiers);'>Ball_model</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">VRfs_p</span><span class="argument">=</span><span id="sym1670" class="symbol" onmouseover='showVariable("Ball_model", symIdentifiers);' onmouseout='hideVariable("Ball_model", symIdentifiers);'>Ball_model</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>

    <span class="comment"># Next, we'll use the version in the hoverfly atlas</span>
    <span class="comment"># this is a logistic regression with covariates. </span>
    <span class="comment"># Stuart Ball told me (8/5/13) that he did this just because it was easier to explain</span>
    <span class="comment"># but it's not clear to me whether we should restrict the data to Years when focal sites were visited</span>
    <span class="comment">#nRecsFocal &lt;- with(subset(records, Species=='focal'), tapply(Species,Year,length))</span>
    <span class="comment">#recs_temp &lt;- subset(records, Year %in% YearFS)</span>
    <span class="comment">#nRecsTotal &lt;- with(recs_temp, table(Year))</span>
          <span class="comment">#n_Sites &lt;- with(recs_temp, tapply(Site, Year, LenUniq))</span>
          <span class="comment">#n_Vis &lt;- with(recs_temp, tapply(Visit, Year, LenUniq))</span>

    <span class="comment"># 14/5/13: there's an occasional problem here</span>
    <span class="comment"># in some datasets, there are zero focal records for a particular year</span>
    <span class="comment"># this means that the lengths of the vectors are different</span>
          <span class="comment">#if(length(nRecsFocal) &lt; length(nRecsTotal)){</span>
         <span class="comment">#   nRecsFocal &lt;- nRecsFocal[match(dimnames(nRecsTotal)[[1]], dimnames(nRecsFocal)[[1]])]</span>
         <span class="comment">#   nRecsFocal[is.na(nRecsFocal)] &lt;- 0.01 # a fudge to prevent NA/-Inf in the logit</span>
         <span class="comment">#   }</span>

    <span class="comment">#x &lt;- try({</span>
     <span class="comment">#   pF &lt;- nRecsFocal/nRecsTotal</span>
           <span class="comment"># logit_pF &lt;- log(pF/(1-pF))</span>
    <span class="comment">#    Ball_model &lt;- summary(lm(logit_pF ~ YearFS + n_Vis + n_Sites))$coef</span>
          <span class="comment">#   }, silent=T)</span>
    <span class="comment">#if(class(x)=='try-error') save(records, file='VRhov_try_error.rData')</span>

    <span class="comment">#output &lt;- c(output, VRhov_trend=Ball_model[2,1], VRhov_p=Ball_model[2,4])    </span>

    <span class="comment"># Finally, a version with site selection</span>
          <span id="sym1671" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym1672" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">[</span><span id="sym1673" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym1674" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">,</span> <span id="sym1675" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym1676" class="symbol" onmouseover='showVariable("sum", symIdentifiers);' onmouseout='hideVariable("sum", symIdentifiers);'>sum</span><span class="keyword">)</span><span class="keyword">)</span>
          <span id="sym1677" class="symbol" onmouseover='showVariable("num_visits_that_year", symIdentifiers);' onmouseout='hideVariable("num_visits_that_year", symIdentifiers);'>num_visits_that_year</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym1678" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">[</span><span id="sym1679" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym1680" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">,</span> <span id="sym1681" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym1682" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">)</span><span class="keyword">)</span>
          <span id="sym1683" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span> <span class="assignement">&lt;-</span> <span id="sym1684" class="symbol" onmouseover='showVariable("num_visits_that_year", symIdentifiers);' onmouseout='hideVariable("num_visits_that_year", symIdentifiers);'>num_visits_that_year</span> <span class="keyword">-</span> <span id="sym1685" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span><span class="comment">#[,2] #col 2 is focal species (col 1 is year)</span>
          <span id="sym1686" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="assignement">&lt;-</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym1687" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">[</span><span id="sym1688" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">$</span><span id="sym1689" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span>

        <span id="sym1690" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span><span class="comment"># 4/2/13: looking for an occasional bug</span>
          <span id="sym1691" class="symbol" onmouseover='showVariable("RRSS", symIdentifiers);' onmouseout='hideVariable("RRSS", symIdentifiers);'>RRSS</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/glm.html">glm</a><span class="keyword">(</span><a href="base/cbind.html">cbind</a><span class="keyword">(</span><span id="sym1692" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span><span class="keyword">,</span><span id="sym1693" class="symbol" onmouseover='showVariable("failures", symIdentifiers);' onmouseout='hideVariable("failures", symIdentifiers);'>failures</span><span class="keyword">)</span> <span class="keyword">~</span> <span id="sym1694" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span class="argument">family</span><span class="argument">=</span><span id="sym1695" class="symbol" onmouseover='showVariable("binomial", symIdentifiers);' onmouseout='hideVariable("binomial", symIdentifiers);'>binomial</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1696" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span>
          <span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym1697" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym1698" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym1699" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'RRSS_try_error.rData'</span><span class="keyword">)</span>
          <span id="sym1700" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1701" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">RR_SS_trend</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">,</span> <span class="argument">RR_SS_p</span><span class="argument">=</span><span class="number">NA</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span>
          <span id="sym1702" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1703" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">RR_SS_trend</span><span class="argument">=</span><span id="sym1704" class="symbol" onmouseover='showVariable("RRSS", symIdentifiers);' onmouseout='hideVariable("RRSS", symIdentifiers);'>RRSS</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">RR_SS_p</span><span class="argument">=</span><span id="sym1705" class="symbol" onmouseover='showVariable("RRSS", symIdentifiers);' onmouseout='hideVariable("RRSS", symIdentifiers);'>RRSS</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>
        <span class="keyword">}</span>


          <span class="comment">####################################################### MIXED MODEL (WSS)</span>
    <span class="comment">######## Mixed model: 0.16 seconds to cast the data, 0.3 to fit the model</span>

    <span class="comment"># 21 June: add the MM without any kind of threshold</span>
    <span class="comment"># this makes it the same as Visit Rate but with a site effect</span>
    <span class="comment"># we're actually including it in order to verify that Occupancy will be ok under B3f</span>
    <span id="sym1706" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span> <span class="assignement">&lt;-</span> <a href="NA/fit_ladybirdMM_bin.html">fit_ladybirdMM_bin</a><span class="keyword">(</span><span id="sym1707" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span class="argument">nsp</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">nyr</span><span class="argument">=</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">[</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">,</span><span class="number">5</span><span class="keyword">)</span><span class="keyword">]</span>
          <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1708" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'trend'</span><span class="keyword">,</span> <span class="string">'p'</span><span class="keyword">,</span> <span class="string">'pCombosUsed'</span><span class="keyword">)</span>
          <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1709" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'MMbin0_'</span><span class="keyword">,</span> <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1710" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
          <span id="sym1711" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1712" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span id="sym1713" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="comment">#     </span>

    <span class="comment">#MMdata &lt;- cast_recs(records, resolution='kmyr')</span>
        <span class="comment">#i &lt;- MMdata$L &gt;= 2</span>
        <span class="comment">#i[i==T] &lt;- is.gridcell.wellsampled(MMdata$Site[i], n=3)</span>
        <span class="comment">#MM &lt;- glmer(focal ~ Year + (1|Site), MMdata, subset=i, family=binomial)</span>
        <span class="comment">#MM &lt;- as.numeric(summary(MM)@coefs[2,]) # keep this a two step process in case we later decide to extract other info</span>
        <span class="comment">#output &lt;- c(output, MM_trend=MM[1], MM_p=MM[4], MM_pCombosUsed=sum(i)/length(i)) # M_pVisitsUsed added: 16 October</span>
        <span class="keyword">if</span><span class="keyword">(</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym1714" class="symbol" onmouseover='showVariable("inclMM", symIdentifiers);' onmouseout='hideVariable("inclMM", symIdentifiers);'>inclMM</span><span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="number">0</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment"># option to bypass fitting the mixed model, e.g. if set to F</span>
            <span id="sym1715" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span> <span class="assignement">&lt;-</span> <a href="NA/cast_recs.html">cast_recs</a><span class="keyword">(</span><span id="sym1716" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">resolution</span><span class="argument">=</span><span class="string">'kmyr'</span><span class="keyword">)</span>
            <span class="keyword">for</span> <span class="keyword">(</span><span id="sym1717" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">in</span> <span id="sym1718" class="symbol" onmouseover='showVariable("inclMM", symIdentifiers);' onmouseout='hideVariable("inclMM", symIdentifiers);'>inclMM</span><span class="keyword">)</span> <span class="keyword">{</span>
                    <span class="comment"># the standard MM, as year-monad (ym) resolution</span>
            <span id="sym1719" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span> <span class="assignement">&lt;-</span> <a href="NA/fit_LadybirdMM.html">fit_LadybirdMM</a><span class="keyword">(</span><span id="sym1720" class="symbol" onmouseover='showVariable("MMdata", symIdentifiers);' onmouseout='hideVariable("MMdata", symIdentifiers);'>MMdata</span><span class="keyword">,</span> <span class="argument">nsp</span><span class="argument">=</span><span id="sym1721" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span> <span class="argument">nyr</span><span class="argument">=</span><span id="sym1722" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">)</span><span class="keyword">[</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">,</span><span class="number">5</span><span class="keyword">)</span><span class="keyword">]</span>
                        <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1723" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'trend'</span><span class="keyword">,</span> <span class="string">'p'</span><span class="keyword">,</span> <span class="string">'pCombosUsed'</span><span class="keyword">)</span>
                        <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1724" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'MMber'</span><span class="keyword">,</span> <span id="sym1725" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="string">'sp_'</span><span class="keyword">,</span> <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1726" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
                        <span id="sym1727" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1728" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span id="sym1729" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="comment">#</span>

            <span class="comment"># repeat using disaggregated (visit) data (Added 24/1/13)</span>
            <span class="comment"># NB Currently the nyr parameter actually filters on the number of visits, not unique years</span>
            <span class="comment">#MM &lt;- fit_LadybirdMM(simdata, nsp=i, nyr=3)[c(1,4,5)]</span>
            <span class="comment">#names(MM) &lt;- c('trend', 'p', 'pCombosUsed')</span>
            <span class="comment">#names(MM) &lt;- paste('MMv', i,'sp_', names(MM), sep='')</span>
            <span class="comment">#output &lt;- c(output, MM) #    </span>

            <span class="comment"># instead of disaggregated visit data, use the Binomial model</span>
            <span class="comment"># it should be identical to the MMv model, but with greater numerical stability &amp; quicker</span>
            <span class="comment"># it's more robust than the bernoulli version above (previously MMym)</span>
            <span id="sym1730" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span> <span class="assignement">&lt;-</span> <a href="NA/fit_ladybirdMM_bin.html">fit_ladybirdMM_bin</a><span class="keyword">(</span><span id="sym1731" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span class="argument">nsp</span><span class="argument">=</span><span id="sym1732" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span> <span class="argument">nyr</span><span class="argument">=</span><span id="sym1733" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">)</span><span class="keyword">[</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">,</span><span class="number">5</span><span class="keyword">)</span><span class="keyword">]</span>
            <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1734" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'trend'</span><span class="keyword">,</span> <span class="string">'p'</span><span class="keyword">,</span> <span class="string">'pCombosUsed'</span><span class="keyword">)</span>
            <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1735" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'MMbin'</span><span class="keyword">,</span> <span id="sym1736" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="string">'sp_'</span><span class="keyword">,</span> <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1737" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
            <span id="sym1738" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1739" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span id="sym1740" class="symbol" onmouseover='showVariable("MM", symIdentifiers);' onmouseout='hideVariable("MM", symIdentifiers);'>MM</span><span class="keyword">)</span> <span class="comment">#    </span>
        <span class="keyword">}</span><span class="keyword">}</span>

        <span class="comment">######################################################################################## FRESCALO</span>
  <span class="comment">#Frescalo (by Tom August &amp; Colin Harrower)</span>
        <span class="keyword">if</span> <span class="keyword">(</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym1741" class="symbol" onmouseover='showVariable("Frescalo", symIdentifiers);' onmouseout='hideVariable("Frescalo", symIdentifiers);'>Frescalo</span><span class="keyword">)</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">{</span>
         <span class="comment"># Set directory where Frescalo is located</span>
         <span class="comment"># Set path to Frescalo and output folder, which is platform dependent </span>
         <span class="keyword">if</span> <span class="keyword">(</span><a href="base/is.null.html">is.null</a><span class="keyword">(</span><span id="sym1742" class="symbol" onmouseover='showVariable("frescalo_path", symIdentifiers);' onmouseout='hideVariable("frescalo_path", symIdentifiers);'>frescalo_path</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
     <span id="sym1743" class="symbol" onmouseover='showVariable("frescalo_path", symIdentifiers);' onmouseout='hideVariable("frescalo_path", symIdentifiers);'>frescalo_path</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><a href="base/find.package.html">find.package</a><span class="keyword">(</span><span class="string">'sparta'</span><span class="keyword">)</span><span class="keyword">,</span><span class="string">'/exec/Frescalo_3a.exe'</span><span class="keyword">,</span><span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
     <span class="comment"># Look for weights file and if it is not their copy it</span>
     <span id="sym1744" class="symbol" onmouseover='showVariable("sparta_dir", symIdentifiers);' onmouseout='hideVariable("sparta_dir", symIdentifiers);'>sparta_dir</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><a href="base/find.package.html">find.package</a><span class="keyword">(</span><span class="string">'sparta'</span><span class="keyword">)</span><span class="keyword">,</span><span class="string">'/exec'</span><span class="keyword">,</span><span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
     <span class="keyword">if</span><span class="keyword">(</span><span class="keyword">!</span><a href="base/file.exists.html">file.exists</a><span class="keyword">(</span><a href="base/file.path.html">file.path</a><span class="keyword">(</span><span id="sym1745" class="symbol" onmouseover='showVariable("sparta_dir", symIdentifiers);' onmouseout='hideVariable("sparta_dir", symIdentifiers);'>sparta_dir</span><span class="keyword">,</span><span class="string">'simWts.txt'</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
       <span id="sym1746" class="symbol" onmouseover='showVariable("wts_copy", symIdentifiers);' onmouseout='hideVariable("wts_copy", symIdentifiers);'>wts_copy</span> <span class="assignement">&lt;-</span> <a href="base/file.copy.html">file.copy</a><span class="keyword">(</span><span class="string">'simWts.txt'</span><span class="keyword">,</span><span id="sym1747" class="symbol" onmouseover='showVariable("sparta_dir", symIdentifiers);' onmouseout='hideVariable("sparta_dir", symIdentifiers);'>sparta_dir</span><span class="keyword">)</span>
       <span class="keyword">if</span><span class="keyword">(</span><span class="keyword">!</span><span id="sym1748" class="symbol" onmouseover='showVariable("wts_copy", symIdentifiers);' onmouseout='hideVariable("wts_copy", symIdentifiers);'>wts_copy</span><span class="keyword">)</span> <a href="base/stop.html">stop</a><span class="keyword">(</span><span class="string">'Weights file did not copy correctly'</span><span class="keyword">)</span>
     <span class="keyword">}</span>
         <span class="keyword">}</span>

         <span id="sym1749" class="symbol" onmouseover='showVariable("output_dir", symIdentifiers);' onmouseout='hideVariable("output_dir", symIdentifiers);'>output_dir</span> <span class="assignement">&lt;-</span> <a href="base/getwd.html">getwd</a><span class="keyword">(</span><span class="keyword">)</span>


         <span class="keyword">for</span> <span class="keyword">(</span><span id="sym1750" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">in</span> <span id="sym1751" class="symbol" onmouseover='showVariable("Frescalo", symIdentifiers);' onmouseout='hideVariable("Frescalo", symIdentifiers);'>Frescalo</span><span class="keyword">)</span> <span class="keyword">{</span>
    <span class="comment">#i=1: 1 year per time period</span>
    <span class="comment">#i=2: 2 time periods (splitting years in two)</span>
          <span id="sym1752" class="symbol" onmouseover='showVariable("Tfac_Stdev", symIdentifiers);' onmouseout='hideVariable("Tfac_Stdev", symIdentifiers);'>Tfac_Stdev</span> <span class="assignement">&lt;-</span> <a href="NA/sims_to_frescalo.html">sims_to_frescalo</a><span class="keyword">(</span><span id="sym1753" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">output_dir</span><span class="argument">=</span><span id="sym1754" class="symbol" onmouseover='showVariable("output_dir", symIdentifiers);' onmouseout='hideVariable("output_dir", symIdentifiers);'>output_dir</span><span class="keyword">,</span> <span class="argument">frescalo_path</span><span class="argument">=</span><span id="sym1755" class="symbol" onmouseover='showVariable("frescalo_path", symIdentifiers);' onmouseout='hideVariable("frescalo_path", symIdentifiers);'>frescalo_path</span><span class="keyword">,</span> <span class="argument">tp2</span><span class="argument">=</span><a href="base/as.logical.html">as.logical</a><span class="keyword">(</span><span id="sym1756" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">#get p-value &amp; trend from TimeFactors</span>
          <span class="comment">#frescalo_summ &lt;- frescalo_bootstrap(Tfac_Stdev) #bootstrapping nearly ALWAYS returns a significant p-value</span>
          <span id="sym1757" class="symbol" onmouseover='showVariable("frescalo_summ", symIdentifiers);' onmouseout='hideVariable("frescalo_summ", symIdentifiers);'>frescalo_summ</span> <span class="assignement">&lt;-</span> <a href="NA/frescalo_trend.html">frescalo_trend</a><span class="keyword">(</span><span id="sym1758" class="symbol" onmouseover='showVariable("Tfac_Stdev", symIdentifiers);' onmouseout='hideVariable("Tfac_Stdev", symIdentifiers);'>Tfac_Stdev</span><span class="keyword">)</span>
          <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1759" class="symbol" onmouseover='showVariable("frescalo_summ", symIdentifiers);' onmouseout='hideVariable("frescalo_summ", symIdentifiers);'>frescalo_summ</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'trend'</span><span class="keyword">,</span><span class="string">'p'</span><span class="keyword">)</span>
          <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1760" class="symbol" onmouseover='showVariable("frescalo_summ", symIdentifiers);' onmouseout='hideVariable("frescalo_summ", symIdentifiers);'>frescalo_summ</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'Frescalo'</span><span class="keyword">,</span> <span id="sym1761" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span> <span class="string">'tp_'</span><span class="keyword">,</span> <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1762" class="symbol" onmouseover='showVariable("frescalo_summ", symIdentifiers);' onmouseout='hideVariable("frescalo_summ", symIdentifiers);'>frescalo_summ</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
      <span id="sym1763" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1764" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span id="sym1765" class="symbol" onmouseover='showVariable("frescalo_summ", symIdentifiers);' onmouseout='hideVariable("frescalo_summ", symIdentifiers);'>frescalo_summ</span><span class="keyword">)</span>
        <span class="keyword">}</span><span class="keyword">}</span>


  <span class="comment">######################################################################################## OCCUPANCY</span>
        <span class="comment"># Added February 2014 by NJBI, based on code originally written by Arco &amp; Marnix</span>

  <span class="keyword">if</span><span class="keyword">(</span><span class="keyword">!</span><a href="base/is.null.html">is.null</a><span class="keyword">(</span><span id="sym1766" class="symbol" onmouseover='showVariable("OccMods", symIdentifiers);' onmouseout='hideVariable("OccMods", symIdentifiers);'>OccMods</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
          <a href="base/require.html">require</a><span class="keyword">(</span><a href="http://www.omegahat.net/R2jags"><span class="symbol">R2jags</span></a><span class="keyword">)</span>

  <span class="comment">######################################## Setup BUGS data</span>

        <span id="sym1767" class="symbol" onmouseover='showVariable("ni", symIdentifiers);' onmouseout='hideVariable("ni", symIdentifiers);'>ni</span><span class="assignement">&lt;-</span><span class="number">5000</span><span class="keyword">;</span> <span id="sym1768" class="symbol" onmouseover='showVariable("nb", symIdentifiers);' onmouseout='hideVariable("nb", symIdentifiers);'>nb</span><span class="assignement">&lt;-</span><span class="number">2500</span><span class="keyword">;</span> <span id="sym1769" class="symbol" onmouseover='showVariable("nt", symIdentifiers);' onmouseout='hideVariable("nt", symIdentifiers);'>nt</span><span class="assignement">&lt;-</span><span class="number">3</span><span class="keyword">;</span> <span id="sym1770" class="symbol" onmouseover='showVariable("nc", symIdentifiers);' onmouseout='hideVariable("nc", symIdentifiers);'>nc</span><span class="assignement">&lt;-</span><span class="number">3</span> <span class="comment"># as Marnix</span>

        <span class="comment"># need to get a measure of whether the species was on that site in that year, unequivocally, in zst</span>
        <span class="comment">#it should have dims=c(nsite, nyear)</span>
        <span id="sym1771" class="symbol" onmouseover='showVariable("zst", symIdentifiers);' onmouseout='hideVariable("zst", symIdentifiers);'>zst</span> <span class="assignement">&lt;-</span> <a href="NA/acast.html">acast</a><span class="keyword">(</span><span id="sym1772" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym1773" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">~</span><a href="base/factor.html">factor</a><span class="keyword">(</span><span id="sym1774" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'focal'</span><span class="keyword">,</span> <span id="sym1775" class="symbol" onmouseover='showVariable("max", symIdentifiers);' onmouseout='hideVariable("max", symIdentifiers);'>max</span><span class="keyword">,</span> <span class="argument">fill</span><span class="argument">=</span><span class="number">0</span><span class="keyword">)</span> <span class="comment"># initial values for the latent state = observed state</span>
        <span id="sym1776" class="symbol" onmouseover='showVariable("nyear", symIdentifiers);' onmouseout='hideVariable("nyear", symIdentifiers);'>nyear</span> <span class="assignement">&lt;-</span> <a href="NA/LenUniq.html">LenUniq</a><span class="keyword">(</span><span id="sym1777" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym1778" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span>

  <span class="comment"># what are we going to monitor</span>
        <span id="sym1779" class="symbol" onmouseover='showVariable("parameters", symIdentifiers);' onmouseout='hideVariable("parameters", symIdentifiers);'>parameters</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span class="string">"fit"</span><span class="keyword">,</span> <span class="string">"fit.new"</span><span class="keyword">,</span> <span class="string">"psi.fs"</span><span class="keyword">,</span> <span class="string">"regres.psi"</span><span class="keyword">,</span><span class="string">"regres.pdet"</span><span class="keyword">,</span> <span class="string">"sigma2"</span><span class="keyword">,</span><span class="string">"sd.lp"</span><span class="keyword">,</span> <span class="string">"mu.lp"</span><span class="keyword">,</span> <span class="string">"tau.lp"</span><span class="keyword">,</span> <span class="string">"pdet.alpha"</span><span class="keyword">)</span>

        <span class="comment">##################################### function</span>

        <span id="sym1780" class="symbol" onmouseover='showVariable("initiate", symIdentifiers);' onmouseout='hideVariable("initiate", symIdentifiers);'>initiate</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">z</span><span class="keyword">,</span> <span class="formalargs">i</span><span class="eqformalargs">=</span><span class="number">1</span><span class="keyword">)</span> <span class="keyword">{</span>
          <span id="sym1781" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a> <span class="keyword">(</span><span class="argument">z</span><span class="argument">=</span><span id="sym1782" class="symbol" onmouseover='showVariable("z", symIdentifiers);' onmouseout='hideVariable("z", symIdentifiers);'>z</span><span class="keyword">,</span>  <span class="argument">alpha.p</span><span class="argument">=</span><a href="base/rep.html">rep</a><span class="keyword">(</span><a href="stats/runif.html">runif</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span> <span class="keyword">-</span><span class="number">2</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1783" class="symbol" onmouseover='showVariable("nyear", symIdentifiers);' onmouseout='hideVariable("nyear", symIdentifiers);'>nyear</span><span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">if</span><span class="keyword">(</span><span id="sym1784" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">&gt;=</span><span class="number">2</span><span class="keyword">)</span> <span id="sym1785" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="keyword">$</span><span id="sym1786" class="symbol" onmouseover='showVariable("LL.p", symIdentifiers);' onmouseout='hideVariable("LL.p", symIdentifiers);'>LL.p</span><span class="assignement">=</span><a href="stats/runif.html">runif</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span> <span class="keyword">-</span><span class="number">2</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">)</span>
          <span class="keyword">if</span><span class="keyword">(</span><span id="sym1787" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span>==<span class="number">3</span><span class="keyword">)</span> <span class="keyword">{</span>
            <span id="sym1788" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="keyword">$</span><span id="sym1789" class="symbol" onmouseover='showVariable("dtype2.p", symIdentifiers);' onmouseout='hideVariable("dtype2.p", symIdentifiers);'>dtype2.p</span><span class="assignement">=</span><a href="stats/runif.html">runif</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span> <span class="keyword">-</span><span class="number">2</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">)</span>
            <span id="sym1790" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="keyword">$</span><span id="sym1791" class="symbol" onmouseover='showVariable("dtype3.p", symIdentifiers);' onmouseout='hideVariable("dtype3.p", symIdentifiers);'>dtype3.p</span><span class="assignement">=</span><a href="stats/runif.html">runif</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span> <span class="keyword">-</span><span class="number">2</span><span class="keyword">,</span> <span class="number">2</span><span class="keyword">)</span>
          <span class="keyword">}</span>
          <span id="sym1792" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span>
        <span class="keyword">}</span>
        <span class="comment">##################################### run the occupancy models</span>

  <span id="sym1793" class="symbol" onmouseover='showVariable("OccResults", symIdentifiers);' onmouseout='hideVariable("OccResults", symIdentifiers);'>OccResults</span> <span class="assignement">&lt;-</span> <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span id="sym1794" class="symbol" onmouseover='showVariable("OccMods", symIdentifiers);' onmouseout='hideVariable("OccMods", symIdentifiers);'>OccMods</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">OccMod</span><span class="keyword">)</span><span class="keyword">{</span>
          <span class="comment"># work out which Occmod we're using and make the necessary arrangments</span>
          <span class="comment"># the name of the OccMod defines how it should be set up</span>
          <span class="comment">#print(OccMod)</span>
          <span id="sym1795" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="assignement">=</span><span class="number">1</span>

          <span class="comment"># it also defines the name of the file ('SS' criterion is not used to determine which file is used)</span>
          <span id="sym1796" class="symbol" onmouseover='showVariable("OccModFile", symIdentifiers);' onmouseout='hideVariable("OccModFile", symIdentifiers);'>OccModFile</span> <span class="assignement">&lt;-</span> <a href="base/gsub.html">gsub</a><span class="keyword">(</span><span class="string">'SS\\+'</span><span class="keyword">,</span> <span class="string">''</span><span class="keyword">,</span> <span id="sym1797" class="symbol" onmouseover='showVariable("OccMod", symIdentifiers);' onmouseout='hideVariable("OccMod", symIdentifiers);'>OccMod</span><span class="keyword">)</span>

    <span class="keyword">if</span><span class="keyword">(</span><span id="sym1798" class="symbol" onmouseover='showVariable("OccMod", symIdentifiers);' onmouseout='hideVariable("OccMod", symIdentifiers);'>OccMod</span>==<span class="string">'Full'</span><span class="keyword">)</span> <span id="sym1799" class="symbol" onmouseover='showVariable("OccMod", symIdentifiers);' onmouseout='hideVariable("OccMod", symIdentifiers);'>OccMod</span> <span class="assignement">&lt;-</span> <span class="string">'SS+LL+Site'</span>

          <span class="comment"># first figure out if we're doing the site selection</span>
          <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'SS'</span><span class="keyword">,</span> <span id="sym1800" class="symbol" onmouseover='showVariable("OccMod", symIdentifiers);' onmouseout='hideVariable("OccMod", symIdentifiers);'>OccMod</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span> <span class="comment"># Site Selection Criterion: restrict the data to sites represented 3 times</span>
            <span class="comment"># identify the visits that are on sites wih three years data</span>
            <span class="comment"># first determine the number of years per site</span>
            <span id="sym1801" class="symbol" onmouseover='showVariable("yps", symIdentifiers);' onmouseout='hideVariable("yps", symIdentifiers);'>yps</span> <span class="assignement">&lt;-</span> <a href="base/rowSums.html">rowSums</a><span class="keyword">(</span><a href="NA/acast.html">acast</a><span class="keyword">(</span><span id="sym1802" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym1803" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">~</span><span id="sym1804" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym1805" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'L'</span><span class="keyword">)</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span>
            <span id="sym1806" class="symbol" onmouseover='showVariable("sites_to_include", symIdentifiers);' onmouseout='hideVariable("sites_to_include", symIdentifiers);'>sites_to_include</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1807" class="symbol" onmouseover='showVariable("yps", symIdentifiers);' onmouseout='hideVariable("yps", symIdentifiers);'>yps</span><span class="keyword">[</span><span id="sym1808" class="symbol" onmouseover='showVariable("yps", symIdentifiers);' onmouseout='hideVariable("yps", symIdentifiers);'>yps</span><span class="keyword">&gt;=</span><span id="sym1809" class="symbol" onmouseover='showVariable("nyr", symIdentifiers);' onmouseout='hideVariable("nyr", symIdentifiers);'>nyr</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span>
            <span id="sym1810" class="symbol" onmouseover='showVariable("zst", symIdentifiers);' onmouseout='hideVariable("zst", symIdentifiers);'>zst</span> <span class="assignement">&lt;-</span> <span id="sym1811" class="symbol" onmouseover='showVariable("zst", symIdentifiers);' onmouseout='hideVariable("zst", symIdentifiers);'>zst</span><span class="keyword">[</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1812" class="symbol" onmouseover='showVariable("zst", symIdentifiers);' onmouseout='hideVariable("zst", symIdentifiers);'>zst</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="keyword">%in%</span> <span id="sym1813" class="symbol" onmouseover='showVariable("sites_to_include", symIdentifiers);' onmouseout='hideVariable("sites_to_include", symIdentifiers);'>sites_to_include</span><span class="keyword">,</span><span class="keyword">]</span>
            <span id="sym1814" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <span id="sym1815" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym1816" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">%in%</span> <span id="sym1817" class="symbol" onmouseover='showVariable("sites_to_include", symIdentifiers);' onmouseout='hideVariable("sites_to_include", symIdentifiers);'>sites_to_include</span>
            <span class="comment">#i &lt;-is.gridcell.wellsampled2(simdata) # same as three steps but doesn't help with zst</span>
          <span class="keyword">}</span> <span class="keyword">else</span> <span id="sym1818" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <span class="number">TRUE</span> <span class="comment"># use all the rows</span>

          <span class="comment"># now assemble the bugs_data and related objects</span>
          <span class="comment">#need to convert Site identities into row numbers</span>
          <span id="sym1819" class="symbol" onmouseover='showVariable("site_to_row_lookup", symIdentifiers);' onmouseout='hideVariable("site_to_row_lookup", symIdentifiers);'>site_to_row_lookup</span> <span class="assignement">&lt;-</span> <a href="base/data.frame.html">data.frame</a><span class="keyword">(</span><span class="argument">Site</span><span class="argument">=</span><a href="base/as.integer.html">as.integer</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1820" class="symbol" onmouseover='showVariable("zst", symIdentifiers);' onmouseout='hideVariable("zst", symIdentifiers);'>zst</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span><span class="argument">rownum</span><span class="argument">=</span><span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym1821" class="symbol" onmouseover='showVariable("zst", symIdentifiers);' onmouseout='hideVariable("zst", symIdentifiers);'>zst</span><span class="keyword">)</span><span class="keyword">)</span>

          <span id="sym1822" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><a href="base/merge.html">merge</a><span class="keyword">(</span><span id="sym1823" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">[</span><span id="sym1824" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <span id="sym1825" class="symbol" onmouseover='showVariable("site_to_row_lookup", symIdentifiers);' onmouseout='hideVariable("site_to_row_lookup", symIdentifiers);'>site_to_row_lookup</span><span class="keyword">)</span><span class="keyword">,</span> <span class="comment"># adds rownum to simdata (used below)</span>
                            <a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">y</span><span class="argument">=</span><a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><span id="sym1826" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">Year</span><span class="argument">=</span><span id="sym1827" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span class="argument">Site</span><span class="argument">=</span><span id="sym1828" class="symbol" onmouseover='showVariable("rownum", symIdentifiers);' onmouseout='hideVariable("rownum", symIdentifiers);'>rownum</span><span class="keyword">,</span>
                                 <span class="argument">nyear</span><span class="argument">=</span><span id="sym1829" class="symbol" onmouseover='showVariable("nyear", symIdentifiers);' onmouseout='hideVariable("nyear", symIdentifiers);'>nyear</span><span class="keyword">,</span> <span class="argument">nsite</span><span class="argument">=</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym1830" class="symbol" onmouseover='showVariable("zst", symIdentifiers);' onmouseout='hideVariable("zst", symIdentifiers);'>zst</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">nvisit</span><span class="argument">=</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym1831" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">[</span><span id="sym1832" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span>
                                 <span class="argument">sumX</span><span class="argument">=</span><a href="base/sum.html">sum</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym1833" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">sumX2</span><span class="argument">=</span><a href="base/sum.html">sum</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym1834" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">^</span><span class="number">2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>

          <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'LL'</span><span class="keyword">,</span> <span id="sym1835" class="symbol" onmouseover='showVariable("OccMod", symIdentifiers);' onmouseout='hideVariable("OccMod", symIdentifiers);'>OccMod</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span> <span class="comment"># List length as a covariate</span>
            <span id="sym1836" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1837" class="symbol" onmouseover='showVariable("logL", symIdentifiers);' onmouseout='hideVariable("logL", symIdentifiers);'>logL</span><span class="assignement">=</span><a href="base/log.html">log</a><span class="keyword">(</span><span id="sym1838" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">[</span><span id="sym1839" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">$</span><span id="sym1840" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span>
            <span id="sym1841" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1842" class="symbol" onmouseover='showVariable("dtype2p_min", symIdentifiers);' onmouseout='hideVariable("dtype2p_min", symIdentifiers);'>dtype2p_min</span> <span class="assignement">=</span> <span class="keyword">-</span><span class="number">10</span><span class="keyword">;</span> <span id="sym1843" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1844" class="symbol" onmouseover='showVariable("dtype2p_max", symIdentifiers);' onmouseout='hideVariable("dtype2p_max", symIdentifiers);'>dtype2p_max</span><span class="assignement">=</span><span class="number">10</span> <span class="comment">#constraints on the priors</span>
            <span id="sym1845" class="symbol" onmouseover='showVariable("parameters", symIdentifiers);' onmouseout='hideVariable("parameters", symIdentifiers);'>parameters</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1846" class="symbol" onmouseover='showVariable("parameters", symIdentifiers);' onmouseout='hideVariable("parameters", symIdentifiers);'>parameters</span><span class="keyword">,</span> <span class="string">'LL.p'</span><span class="keyword">)</span>
            <span id="sym1847" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="assignement">=</span><span class="number">2</span> <span class="comment"># for defining which initial values are required</span>
          <span class="keyword">}</span>

          <span class="keyword">if</span><span class="keyword">(</span><span class="keyword">!</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'Site'</span><span class="keyword">,</span> <span id="sym1848" class="symbol" onmouseover='showVariable("OccMod", symIdentifiers);' onmouseout='hideVariable("OccMod", symIdentifiers);'>OccMod</span><span class="keyword">)</span><span class="keyword">)</span> <span id="sym1849" class="symbol" onmouseover='showVariable("parameters", symIdentifiers);' onmouseout='hideVariable("parameters", symIdentifiers);'>parameters</span> <span class="assignement">&lt;-</span> <a href="base/setdiff.html">setdiff</a><span class="keyword">(</span><span id="sym1850" class="symbol" onmouseover='showVariable("parameters", symIdentifiers);' onmouseout='hideVariable("parameters", symIdentifiers);'>parameters</span><span class="keyword">,</span> <span class="string">'sigma2'</span><span class="keyword">)</span> <span class="comment"># this variance term is only used in Site models</span>

          <span class="keyword">if</span><span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">'Arco'</span><span class="keyword">,</span> <span id="sym1851" class="symbol" onmouseover='showVariable("OccMod", symIdentifiers);' onmouseout='hideVariable("OccMod", symIdentifiers);'>OccMod</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span> <span class="comment"># Arco's model</span>
            <span id="sym1852" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1853" class="symbol" onmouseover='showVariable("DATATYPE2", symIdentifiers);' onmouseout='hideVariable("DATATYPE2", symIdentifiers);'>DATATYPE2</span> <span class="assignement">=</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><span id="sym1854" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym1855" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span> <span class="keyword">%in%</span> <span class="number">2</span><span class="keyword">:</span><span class="number">3</span><span class="keyword">)</span> <span class="comment"># a short list</span>
            <span id="sym1856" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1857" class="symbol" onmouseover='showVariable("DATATYPE3", symIdentifiers);' onmouseout='hideVariable("DATATYPE3", symIdentifiers);'>DATATYPE3</span> <span class="assignement">=</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><span id="sym1858" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym1859" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span> <span class="keyword">&gt;</span> <span class="number">3</span><span class="keyword">)</span> <span class="comment"># 'full' list</span>
            <span id="sym1860" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1861" class="symbol" onmouseover='showVariable("dtype2p_min", symIdentifiers);' onmouseout='hideVariable("dtype2p_min", symIdentifiers);'>dtype2p_min</span> <span class="assignement">=</span> <span class="keyword">-</span><span class="number">10</span><span class="keyword">;</span> <span id="sym1862" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1863" class="symbol" onmouseover='showVariable("dtype2p_max", symIdentifiers);' onmouseout='hideVariable("dtype2p_max", symIdentifiers);'>dtype2p_max</span><span class="assignement">=</span><span class="number">10</span> <span class="comment">#constraints on the priors</span>
            <span id="sym1864" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1865" class="symbol" onmouseover='showVariable("dtype3p_min", symIdentifiers);' onmouseout='hideVariable("dtype3p_min", symIdentifiers);'>dtype3p_min</span><span class="assignement">=</span> <span class="keyword">-</span><span class="number">10</span><span class="keyword">;</span> <span id="sym1866" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">$</span><span id="sym1867" class="symbol" onmouseover='showVariable("dtype3p_max", symIdentifiers);' onmouseout='hideVariable("dtype3p_max", symIdentifiers);'>dtype3p_max</span><span class="assignement">=</span><span class="number">10</span> <span class="comment">#constraints on the priors</span>
            <span id="sym1868" class="symbol" onmouseover='showVariable("parameters", symIdentifiers);' onmouseout='hideVariable("parameters", symIdentifiers);'>parameters</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1869" class="symbol" onmouseover='showVariable("parameters", symIdentifiers);' onmouseout='hideVariable("parameters", symIdentifiers);'>parameters</span><span class="keyword">,</span> <span class="string">"pdet.d2"</span><span class="keyword">,</span><span class="string">"dtype2.p"</span><span class="keyword">,</span> <span class="string">"pdet.d3"</span><span class="keyword">,</span> <span class="string">"dtype3.p"</span><span class="keyword">)</span>
            <span id="sym1870" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="assignement">=</span><span class="number">3</span>
          <span class="keyword">}</span>


          <span class="comment"># set the initial values</span>
          <span id="sym1871" class="symbol" onmouseover='showVariable("init.vals", symIdentifiers);' onmouseout='hideVariable("init.vals", symIdentifiers);'>init.vals</span> <span class="assignement">&lt;-</span> <a href="base/replicate.html">replicate</a><span class="keyword">(</span><span id="sym1872" class="symbol" onmouseover='showVariable("nc", symIdentifiers);' onmouseout='hideVariable("nc", symIdentifiers);'>nc</span><span class="keyword">,</span> <a href="NA/initiate.html">initiate</a><span class="keyword">(</span><span class="argument">z</span><span class="argument">=</span><span id="sym1873" class="symbol" onmouseover='showVariable("zst", symIdentifiers);' onmouseout='hideVariable("zst", symIdentifiers);'>zst</span><span class="keyword">,</span> <span class="argument">i</span><span class="argument">=</span><span id="sym1874" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">simplify</span><span class="argument">=</span><span id="sym1875" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">)</span>

    <span id="sym1876" class="symbol" onmouseover='showVariable("model_file", symIdentifiers);' onmouseout='hideVariable("model_file", symIdentifiers);'>model_file</span> <span class="assignement">&lt;-</span> <a href="base/paste0.html">paste0</a><span class="keyword">(</span><span class="string">'Occupancy/Occ_'</span><span class="keyword">,</span><a href="base/gsub.html">gsub</a><span class="keyword">(</span><span class="string">'\\+'</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><span id="sym1877" class="symbol" onmouseover='showVariable("OccModFile", symIdentifiers);' onmouseout='hideVariable("OccModFile", symIdentifiers);'>OccModFile</span><span class="keyword">)</span><span class="keyword">,</span><span class="string">'.bugs'</span><span class="keyword">)</span>

          <span id="sym1878" class="symbol" onmouseover='showVariable("out", symIdentifiers);' onmouseout='hideVariable("out", symIdentifiers);'>out</span> <span class="assignement">&lt;-</span> <a href="NA/jags.html">jags</a><span class="keyword">(</span><span id="sym1879" class="symbol" onmouseover='showVariable("bugs_data", symIdentifiers);' onmouseout='hideVariable("bugs_data", symIdentifiers);'>bugs_data</span><span class="keyword">,</span> <span id="sym1880" class="symbol" onmouseover='showVariable("init.vals", symIdentifiers);' onmouseout='hideVariable("init.vals", symIdentifiers);'>init.vals</span><span class="keyword">,</span> <span id="sym1881" class="symbol" onmouseover='showVariable("parameters", symIdentifiers);' onmouseout='hideVariable("parameters", symIdentifiers);'>parameters</span><span class="keyword">,</span> <span class="argument">model.file</span><span class="argument">=</span><span id="sym1882" class="symbol" onmouseover='showVariable("model_file", symIdentifiers);' onmouseout='hideVariable("model_file", symIdentifiers);'>model_file</span><span class="keyword">,</span>
                     <span class="argument">n.chains</span><span class="argument">=</span><span id="sym1883" class="symbol" onmouseover='showVariable("nc", symIdentifiers);' onmouseout='hideVariable("nc", symIdentifiers);'>nc</span><span class="keyword">,</span> <span class="argument">n.iter</span><span class="argument">=</span><span id="sym1884" class="symbol" onmouseover='showVariable("ni", symIdentifiers);' onmouseout='hideVariable("ni", symIdentifiers);'>ni</span><span class="keyword">,</span> <span class="argument">n.thin</span><span class="argument">=</span><span id="sym1885" class="symbol" onmouseover='showVariable("nt", symIdentifiers);' onmouseout='hideVariable("nt", symIdentifiers);'>nt</span><span class="keyword">,</span> <span class="argument">n.burnin</span><span class="argument">=</span><span id="sym1886" class="symbol" onmouseover='showVariable("nb", symIdentifiers);' onmouseout='hideVariable("nb", symIdentifiers);'>nb</span><span class="keyword">,</span> <span class="argument">DIC</span><span class="argument">=</span><span class="number">TRUE</span><span class="keyword">)</span>
    <span class="comment"># try paralellising</span>
          <span class="comment">#out &lt;- jags.parallel(bugs_data, init.vals, parameters, model.file=model_file, </span>
           <span class="comment">#           n.chains=nc, n.iter=ni, n.thin=nt, n.burnin=nb, DIC=TRUE)      </span>

    <span id="sym1887" class="symbol" onmouseover='showVariable("out", symIdentifiers);' onmouseout='hideVariable("out", symIdentifiers);'>out</span><span class="keyword">$</span><span id="sym1888" class="symbol" onmouseover='showVariable("BUGSoutput", symIdentifiers);' onmouseout='hideVariable("BUGSoutput", symIdentifiers);'>BUGSoutput</span><span class="keyword">$</span><span id="sym1889" class="symbol" onmouseover='showVariable("summary", symIdentifiers);' onmouseout='hideVariable("summary", symIdentifiers);'>summary</span>
        <span class="keyword">}</span><span class="keyword">,</span> <span class="argument">USE.NAMES</span><span class="argument">=</span><span id="sym1890" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">,</span> <span class="argument">simplify</span><span class="argument">=</span><span id="sym1891" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">)</span>

  <span class="comment">### Now get the results from each models into a format that matches the rest of the output  </span>
  <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1892" class="symbol" onmouseover='showVariable("OccResults", symIdentifiers);' onmouseout='hideVariable("OccResults", symIdentifiers);'>OccResults</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <span id="sym1893" class="symbol" onmouseover='showVariable("OccMods", symIdentifiers);' onmouseout='hideVariable("OccMods", symIdentifiers);'>OccMods</span>

  <span id="sym1894" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span> <span class="assignement">&lt;-</span> <a href="base/as.data.frame.html">as.data.frame</a><span class="keyword">(</span><a href="base/t.html">t</a><span class="keyword">(</span><a href="base/sapply.html">sapply</a><span class="keyword">(</span>
    <span id="sym1895" class="symbol" onmouseover='showVariable("OccResults", symIdentifiers);' onmouseout='hideVariable("OccResults", symIdentifiers);'>OccResults</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <span id="sym1896" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="string">'regres.psi'</span><span class="keyword">,</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'mean'</span><span class="keyword">,</span><span class="string">'2.5%'</span><span class="keyword">,</span><span class="string">'97.5%'</span><span class="keyword">,</span><span class="string">'Rhat'</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment"># convert to a effective p-value: just a 1 or 0 </span>
  <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1897" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="string">'trend'</span>
  <span id="sym1898" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span><span class="keyword">$</span><span id="sym1899" class="symbol" onmouseover='showVariable("p", symIdentifiers);' onmouseout='hideVariable("p", symIdentifiers);'>p</span> <span class="assignement">&lt;-</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><span class="number">0</span><span class="keyword">&gt;</span><a href="base/apply.html">apply</a><span class="keyword">(</span><span id="sym1900" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <span id="sym1901" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="string">'2.5%'</span><span class="keyword">]</span><span class="keyword">*</span><span id="sym1902" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[</span><span class="string">'97.5%'</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span>
  <span id="sym1903" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span><span class="keyword">$</span><span id="sym1904" class="symbol" onmouseover='showVariable("name", symIdentifiers);' onmouseout='hideVariable("name", symIdentifiers);'>name</span> <span class="assignement">&lt;-</span> <a href="base/rownames.html">rownames</a><span class="keyword">(</span><span id="sym1905" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span><span class="keyword">)</span>
  <span id="sym1906" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span> <span class="assignement">&lt;-</span> <a href="NA/melt.html">melt</a><span class="keyword">(</span><span id="sym1907" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span><span class="keyword">[</span><span class="keyword">,</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">6</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">,</span><span class="number">5</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">id</span><span class="argument">=</span><span class="string">'name'</span><span class="keyword">)</span>

  <span id="sym1908" class="symbol" onmouseover='showVariable("Occ_out", symIdentifiers);' onmouseout='hideVariable("Occ_out", symIdentifiers);'>Occ_out</span> <span class="assignement">&lt;-</span> <span id="sym1909" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span><span class="keyword">$</span><span id="sym1910" class="symbol" onmouseover='showVariable("value", symIdentifiers);' onmouseout='hideVariable("value", symIdentifiers);'>value</span>
  <a href="base/names.html">names</a><span class="keyword">(</span><span id="sym1911" class="symbol" onmouseover='showVariable("Occ_out", symIdentifiers);' onmouseout='hideVariable("Occ_out", symIdentifiers);'>Occ_out</span><span class="keyword">)</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym1912" class="symbol" onmouseover='showVariable("Occ_trends", symIdentifiers);' onmouseout='hideVariable("Occ_trends", symIdentifiers);'>Occ_trends</span><span class="keyword">,</span> <a href="base/paste0.html">paste0</a><span class="keyword">(</span><span class="string">'Occ+'</span><span class="keyword">,</span><span id="sym1913" class="symbol" onmouseover='showVariable("name", symIdentifiers);' onmouseout='hideVariable("name", symIdentifiers);'>name</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span> <span id="sym1914" class="symbol" onmouseover='showVariable("variable", symIdentifiers);' onmouseout='hideVariable("variable", symIdentifiers);'>variable</span><span class="keyword">)</span><span class="keyword">)</span>

  <span id="sym1915" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1916" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span id="sym1917" class="symbol" onmouseover='showVariable("Occ_out", symIdentifiers);' onmouseout='hideVariable("Occ_out", symIdentifiers);'>Occ_out</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment"># end of Occupancy models</span>


  <span class="comment">########################################################################################</span>


        <span class="comment">######## Stupid method - a poisson regression of number of visits &amp; sites</span>
        <span id="sym1918" class="symbol" onmouseover='showVariable("NRecMod", symIdentifiers);' onmouseout='hideVariable("NRecMod", symIdentifiers);'>NRecMod</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/glm.html">glm</a><span class="keyword">(</span><span id="sym1919" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span> <span class="keyword">~</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1920" class="symbol" onmouseover='showVariable("num_visits_recorded", symIdentifiers);' onmouseout='hideVariable("num_visits_recorded", symIdentifiers);'>num_visits_recorded</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> <span class="string">'poisson'</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1921" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span>
        <span id="sym1922" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1923" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">nRecords_trend</span><span class="argument">=</span><span id="sym1924" class="symbol" onmouseover='showVariable("NRecMod", symIdentifiers);' onmouseout='hideVariable("NRecMod", symIdentifiers);'>NRecMod</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">nRecords_p</span><span class="argument">=</span><span id="sym1925" class="symbol" onmouseover='showVariable("NRecMod", symIdentifiers);' onmouseout='hideVariable("NRecMod", symIdentifiers);'>NRecMod</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>

        <span id="sym1926" class="symbol" onmouseover='showVariable("num_sites_recorded", symIdentifiers);' onmouseout='hideVariable("num_sites_recorded", symIdentifiers);'>num_sites_recorded</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym1927" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym1928" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span>==<span class="string">'focal'</span><span class="keyword">)</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym1929" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">,</span> <span id="sym1930" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym1931" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1932" class="symbol" onmouseover='showVariable("NSmod", symIdentifiers);' onmouseout='hideVariable("NSmod", symIdentifiers);'>NSmod</span> <span class="assignement">&lt;-</span> <a href="base/summary.html">summary</a><span class="keyword">(</span><a href="stats/glm.html">glm</a><span class="keyword">(</span><span id="sym1933" class="symbol" onmouseover='showVariable("num_sites_recorded", symIdentifiers);' onmouseout='hideVariable("num_sites_recorded", symIdentifiers);'>num_sites_recorded</span> <span class="keyword">~</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/dimnames.html">dimnames</a><span class="keyword">(</span><span id="sym1934" class="symbol" onmouseover='showVariable("num_sites_recorded", symIdentifiers);' onmouseout='hideVariable("num_sites_recorded", symIdentifiers);'>num_sites_recorded</span><span class="keyword">)</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> <span class="string">'poisson'</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym1935" class="symbol" onmouseover='showVariable("coef", symIdentifiers);' onmouseout='hideVariable("coef", symIdentifiers);'>coef</span>
        <span id="sym1936" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1937" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">nSites_trend</span><span class="argument">=</span><span id="sym1938" class="symbol" onmouseover='showVariable("NSmod", symIdentifiers);' onmouseout='hideVariable("NSmod", symIdentifiers);'>NSmod</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">nSites_p</span><span class="argument">=</span><span id="sym1939" class="symbol" onmouseover='showVariable("NSmod", symIdentifiers);' onmouseout='hideVariable("NSmod", symIdentifiers);'>NSmod</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">,</span><span class="number">4</span><span class="keyword">]</span><span class="keyword">)</span>

        <span class="comment">#append summary info this to the output (doesn't work as attr when looping over multiple datasets</span>
        <span class="keyword">if</span> <span class="keyword">(</span><span id="sym1940" class="symbol" onmouseover='showVariable("summarize", symIdentifiers);' onmouseout='hideVariable("summarize", symIdentifiers);'>summarize</span><span class="keyword">)</span> <span class="keyword">{</span>
        <span id="sym1941" class="symbol" onmouseover='showVariable("recording_summary", symIdentifiers);' onmouseout='hideVariable("recording_summary", symIdentifiers);'>recording_summary</span> <span class="assignement">&lt;-</span> <a href="NA/summarize_recording.html">summarize_recording</a><span class="keyword">(</span><span id="sym1942" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <a href="base/length.html">length</a><span class="keyword">(</span><a href="base/levels.html">levels</a><span class="keyword">(</span><span id="sym1943" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym1944" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># 0.03 seconds</span>

        <span class="keyword">if</span> <span class="keyword">(</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym1945" class="symbol" onmouseover='showVariable("Frescalo", symIdentifiers);' onmouseout='hideVariable("Frescalo", symIdentifiers);'>Frescalo</span><span class="keyword">)</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment"># ~NB if(length(Frescalo) &gt;1) then the following lines will only get info from the last run </span>
            <span class="keyword">if</span> <span class="keyword">(</span><a href="base/grepl.html">grepl</a><span class="keyword">(</span><span class="string">"linux"</span><span class="keyword">,</span> <span id="sym1946" class="symbol" onmouseover='showVariable("R.version", symIdentifiers);' onmouseout='hideVariable("R.version", symIdentifiers);'>R.version</span><span class="keyword">$</span><span id="sym1947" class="symbol" onmouseover='showVariable("platform", symIdentifiers);' onmouseout='hideVariable("platform", symIdentifiers);'>platform</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">{</span>
              <span id="sym1948" class="symbol" onmouseover='showVariable("frst", symIdentifiers);' onmouseout='hideVariable("frst", symIdentifiers);'>frst</span> <span class="assignement">&lt;-</span> <a href="utils/read.csv.html">read.csv</a><span class="keyword">(</span><a href="base/file.path.html">file.path</a><span class="keyword">(</span><a href="base/find.package.html">find.package</a><span class="keyword">(</span><span class="string">'sparta'</span><span class="keyword">)</span><span class="keyword">,</span> <span class="string">'exec/Stats.csv'</span><span class="keyword">)</span><span class="keyword">)</span>
              <span class="comment">#frst &lt;- read.csv("/prj/NEC04273/BSBI Redlisting/Master Code/Frescalo/Frescalo_V3/Stats.csv")			</span>
                        <span class="keyword">}</span><span class="keyword">else</span><span class="keyword">{</span>
                            <span id="sym1949" class="symbol" onmouseover='showVariable("frst", symIdentifiers);' onmouseout='hideVariable("frst", symIdentifiers);'>frst</span> <span class="assignement">&lt;-</span> <a href="utils/read.csv.html">read.csv</a><span class="keyword">(</span><a href="base/file.path.html">file.path</a><span class="keyword">(</span><a href="base/find.package.html">find.package</a><span class="keyword">(</span><span class="string">'sparta'</span><span class="keyword">)</span><span class="keyword">,</span> <span class="string">'exec/Stats.csv'</span><span class="keyword">)</span><span class="keyword">)</span>
                            <span class="comment">#frst &lt;- read.csv("P:/NEC04273_SpeciesDistribution/Workfiles/Range change sims/Frescalo/Frescalo files/Stats.csv")    </span>
                        <span class="keyword">}</span>
        <span id="sym1950" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1951" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">Fr_Phi</span><span class="argument">=</span> <a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym1952" class="symbol" onmouseover='showVariable("Tfac_Stdev", symIdentifiers);' onmouseout='hideVariable("Tfac_Stdev", symIdentifiers);'>Tfac_Stdev</span><span class="keyword">,</span> <span class="string">'Phi'</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">Fr_MedianAlpha</span> <span class="argument">=</span> <a href="stats/median.html">median</a><span class="keyword">(</span><span id="sym1953" class="symbol" onmouseover='showVariable("frst", symIdentifiers);' onmouseout='hideVariable("frst", symIdentifiers);'>frst</span><span class="keyword">$</span><span id="sym1954" class="symbol" onmouseover='showVariable("Alpha", symIdentifiers);' onmouseout='hideVariable("Alpha", symIdentifiers);'>Alpha</span><span class="keyword">)</span><span class="keyword">)</span>
                <span class="keyword">}</span>

        <span class="comment">#get information on the prevelance of benchmark species</span>
        <span class="comment"># NI 24/1/12</span>
        <span class="comment"># The stats below are based on numbers of records</span>
        <span class="comment"># In theory, it should be possible to extract the equivalent info from the Frescalo trend file</span>
        <span class="comment"># I'll wait on this until Tom August has fixed the column names of the different versions</span>
        <span id="sym1955" class="symbol" onmouseover='showVariable("rps", symIdentifiers);' onmouseout='hideVariable("rps", symIdentifiers);'>rps</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym1956" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <a href="base/table.html">table</a><span class="keyword">(</span><span id="sym1957" class="symbol" onmouseover='showVariable("Species", symIdentifiers);' onmouseout='hideVariable("Species", symIdentifiers);'>Species</span><span class="keyword">)</span><span class="keyword">)</span>
        <span id="sym1958" class="symbol" onmouseover='showVariable("bench_thresh", symIdentifiers);' onmouseout='hideVariable("bench_thresh", symIdentifiers);'>bench_thresh</span> <span class="assignement">&lt;-</span> <a href="stats/quantile.html">quantile</a><span class="keyword">(</span><span id="sym1959" class="symbol" onmouseover='showVariable("rps", symIdentifiers);' onmouseout='hideVariable("rps", symIdentifiers);'>rps</span><span class="keyword">,</span> <span class="number">0.73</span><span class="keyword">)</span>
        <span id="sym1960" class="symbol" onmouseover='showVariable("pRecsBench", symIdentifiers);' onmouseout='hideVariable("pRecsBench", symIdentifiers);'>pRecsBench</span> <span class="assignement">&lt;-</span> <a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym1961" class="symbol" onmouseover='showVariable("rps", symIdentifiers);' onmouseout='hideVariable("rps", symIdentifiers);'>rps</span><span class="keyword">[</span><span id="sym1962" class="symbol" onmouseover='showVariable("rps", symIdentifiers);' onmouseout='hideVariable("rps", symIdentifiers);'>rps</span> <span class="keyword">&gt;=</span> <span id="sym1963" class="symbol" onmouseover='showVariable("bench_thresh", symIdentifiers);' onmouseout='hideVariable("bench_thresh", symIdentifiers);'>bench_thresh</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">/</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym1964" class="symbol" onmouseover='showVariable("rps", symIdentifiers);' onmouseout='hideVariable("rps", symIdentifiers);'>rps</span><span class="keyword">)</span>

        <span id="sym1965" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span><span id="sym1966" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">,</span> <span class="argument">Recs_pBnchmk</span><span class="argument">=</span><span id="sym1967" class="symbol" onmouseover='showVariable("pRecsBench", symIdentifiers);' onmouseout='hideVariable("pRecsBench", symIdentifiers);'>pRecsBench</span><span class="keyword">,</span> <span class="argument">Recs_qFocal</span><span class="argument">=</span><a href="base/mean.html">mean</a><span class="keyword">(</span><span id="sym1968" class="symbol" onmouseover='showVariable("rps", symIdentifiers);' onmouseout='hideVariable("rps", symIdentifiers);'>rps</span><span class="keyword">&gt;</span><span id="sym1969" class="symbol" onmouseover='showVariable("rps", symIdentifiers);' onmouseout='hideVariable("rps", symIdentifiers);'>rps</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> <span id="sym1970" class="symbol" onmouseover='showVariable("recording_summary", symIdentifiers);' onmouseout='hideVariable("recording_summary", symIdentifiers);'>recording_summary</span><span class="keyword">)</span>
        <span class="keyword">}</span>
    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym1971" class="symbol" onmouseover='showVariable("output", symIdentifiers);' onmouseout='hideVariable("output", symIdentifiers);'>output</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym1972" class="symbol" onmouseover='showVariable("sims_to_frescalo", symIdentifiers);' onmouseout='hideVariable("sims_to_frescalo", symIdentifiers);'>sims_to_frescalo</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span> <span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span><span class="formalargs">output_dir</span><span class="keyword">,</span><span class="formalargs">frescalo_path</span><span class="keyword">,</span><span class="formalargs">tp2</span><span class="eqformalargs">=</span><span class="number">FALSE</span><span class="keyword">)</span><span class="keyword">{</span>
  <span class="comment"># Tom August - 06/11/12</span>
  <span class="comment"># original is in 'Frescalo/Process files/sims_to_frescalo.r'</span>
  <span class="comment"># take columns Frescalo needs</span>
  <span id="sym1973" class="symbol" onmouseover='showVariable("cols", symIdentifiers);' onmouseout='hideVariable("cols", symIdentifiers);'>cols</span><span class="assignement">&lt;-</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="string">"Site"</span><span class="keyword">,</span><span class="string">"Species"</span><span class="keyword">,</span><span class="string">"Year"</span><span class="keyword">)</span>
  <span id="sym1974" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="assignement">&lt;-</span><span id="sym1975" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">[</span><span id="sym1976" class="symbol" onmouseover='showVariable("cols", symIdentifiers);' onmouseout='hideVariable("cols", symIdentifiers);'>cols</span><span class="keyword">]</span>

  <span class="comment"># bin years into two time periods</span>
  <span class="keyword">if</span><span class="keyword">(</span><span id="sym1977" class="symbol" onmouseover='showVariable("tp2", symIdentifiers);' onmouseout='hideVariable("tp2", symIdentifiers);'>tp2</span><span class="keyword">)</span><span class="keyword">{</span>
    <span id="sym1978" class="symbol" onmouseover='showVariable("split", symIdentifiers);' onmouseout='hideVariable("split", symIdentifiers);'>split</span><span class="assignement">=</span><a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym1979" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="keyword">$</span><span id="sym1980" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span>
    <span id="sym1981" class="symbol" onmouseover='showVariable("lower", symIdentifiers);' onmouseout='hideVariable("lower", symIdentifiers);'>lower</span><span class="assignement">&lt;-</span><span id="sym1982" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="keyword">$</span><span id="sym1983" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span>&lt;=<span id="sym1984" class="symbol" onmouseover='showVariable("split", symIdentifiers);' onmouseout='hideVariable("split", symIdentifiers);'>split</span> <span class="comment"># NI added '=' sign to ensure no data is lost</span>
    <span id="sym1985" class="symbol" onmouseover='showVariable("upper", symIdentifiers);' onmouseout='hideVariable("upper", symIdentifiers);'>upper</span><span class="assignement">&lt;-</span><span id="sym1986" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="keyword">$</span><span id="sym1987" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">&gt;</span><span id="sym1988" class="symbol" onmouseover='showVariable("split", symIdentifiers);' onmouseout='hideVariable("split", symIdentifiers);'>split</span>
    <span id="sym1989" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="keyword">[</span><span id="sym1990" class="symbol" onmouseover='showVariable("lower", symIdentifiers);' onmouseout='hideVariable("lower", symIdentifiers);'>lower</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">$</span><span id="sym1991" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="assignement">&lt;-</span><span class="number">1</span>
    <span id="sym1992" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="keyword">[</span><span id="sym1993" class="symbol" onmouseover='showVariable("upper", symIdentifiers);' onmouseout='hideVariable("upper", symIdentifiers);'>upper</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">$</span><span id="sym1994" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="assignement">&lt;-</span><span class="number">2</span>
  <span class="keyword">}</span>
  <span id="sym1995" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="assignement">&lt;-</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym1996" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="keyword">)</span> <span class="comment"># added 17/1/13 to remove duplicate entries</span>
  <span class="comment"># call the frecalo function</span>
  <a href="base/print.html">print</a><span class="keyword">(</span><a href="utils/head.html">head</a><span class="keyword">(</span><span id="sym1997" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="keyword">)</span><span class="keyword">)</span>
  <span id="sym1998" class="symbol" onmouseover='showVariable("Tfac_StDev", symIdentifiers);' onmouseout='hideVariable("Tfac_StDev", symIdentifiers);'>Tfac_StDev</span><span class="assignement">&lt;-</span><a href="NA/run_fresc_sims.html">run_fresc_sims</a><span class="keyword">(</span><span id="sym1999" class="symbol" onmouseover='showVariable("fres_in", symIdentifiers);' onmouseout='hideVariable("fres_in", symIdentifiers);'>fres_in</span><span class="keyword">,</span><span id="sym2000" class="symbol" onmouseover='showVariable("output_dir", symIdentifiers);' onmouseout='hideVariable("output_dir", symIdentifiers);'>output_dir</span><span class="keyword">,</span><span id="sym2001" class="symbol" onmouseover='showVariable("frescalo_path", symIdentifiers);' onmouseout='hideVariable("frescalo_path", symIdentifiers);'>frescalo_path</span><span class="keyword">)</span>

  <span class="comment"># return the time factor and standard deviation for the species 'focal'</span>
  <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym2002" class="symbol" onmouseover='showVariable("Tfac_StDev", symIdentifiers);' onmouseout='hideVariable("Tfac_StDev", symIdentifiers);'>Tfac_StDev</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym2003" class="symbol" onmouseover='showVariable("save_records", symIdentifiers);' onmouseout='hideVariable("save_records", symIdentifiers);'>save_records</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">id</span><span class="eqformalargs">=</span><span class="string">''</span><span class="keyword">,</span> <span class="formalargs">as.R.obj</span><span class="eqformalargs">=</span><span id="sym2004" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span> <span class="keyword">{</span>
        <span class="comment">#saves the output in one of two formats (csv works but has not been fully tested: two empty files in place of true_data)</span>
        <span class="comment">#ideally replace timestamp with a replicate number</span>
    <span class="comment">#25/4/13: Changed to include 'id', which by default also includes Datestamp</span>
        <span class="comment">#names(x)[[1]] &lt;- 'TrueData'</span>
        <span class="comment">#names(x) &lt;- gsub('_', '', names(x))</span>
        <span id="sym2005" class="symbol" onmouseover='showVariable("path", symIdentifiers);' onmouseout='hideVariable("path", symIdentifiers);'>path</span><span class="assignement">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span class="string">'SimRecords'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span>
        <span class="comment">#datecode &lt;- format(Sys.Date(),'%y%m%d')</span>
        <span id="sym2006" class="symbol" onmouseover='showVariable("timestamp", symIdentifiers);' onmouseout='hideVariable("timestamp", symIdentifiers);'>timestamp</span> <span class="assignement">&lt;-</span> <a href="base/format.html">format</a><span class="keyword">(</span><a href="base/Sys.time.html">Sys.time</a><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span><span class="string">'%H%M%S'</span><span class="keyword">)</span>
        <span class="keyword">if</span><span class="keyword">(</span><span id="sym2007" class="symbol" onmouseover='showVariable("as.R.obj", symIdentifiers);' onmouseout='hideVariable("as.R.obj", symIdentifiers);'>as.R.obj</span><span class="keyword">)</span> <span class="keyword">{</span><a href="base/save.html">save</a><span class="keyword">(</span><span id="sym2008" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span id="sym2009" class="symbol" onmouseover='showVariable("path", symIdentifiers);' onmouseout='hideVariable("path", symIdentifiers);'>path</span><span class="keyword">,</span><span class="string">'/SimData_'</span><span class="keyword">,</span><span id="sym2010" class="symbol" onmouseover='showVariable("id", symIdentifiers);' onmouseout='hideVariable("id", symIdentifiers);'>id</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><span id="sym2011" class="symbol" onmouseover='showVariable("timestamp", symIdentifiers);' onmouseout='hideVariable("timestamp", symIdentifiers);'>timestamp</span><span class="keyword">,</span><span class="string">'.rData'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">{</span><span class="keyword">for</span> <span class="keyword">(</span><span id="sym2012" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="keyword">in</span> <span class="number">1</span><span class="keyword">:</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym2013" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span> <a href="utils/write.csv.html">write.csv</a><span class="keyword">(</span><span id="sym2014" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">[[</span><span id="sym2015" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><a href="base/paste.html">paste</a><span class="keyword">(</span><span id="sym2016" class="symbol" onmouseover='showVariable("path", symIdentifiers);' onmouseout='hideVariable("path", symIdentifiers);'>path</span><span class="keyword">,</span><span class="string">'/SimData_'</span><span class="keyword">,</span><span id="sym2017" class="symbol" onmouseover='showVariable("timestamp", symIdentifiers);' onmouseout='hideVariable("timestamp", symIdentifiers);'>timestamp</span><span class="keyword">,</span><span class="string">'_'</span><span class="keyword">,</span><a href="base/names.html">names</a><span class="keyword">(</span><span id="sym2018" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">[</span><span id="sym2019" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span><span class="string">'.csv'</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">''</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span>
<span class="keyword">}</span>


<span id="sym2020" class="symbol" onmouseover='showVariable("shorten_lists", symIdentifiers);' onmouseout='hideVariable("shorten_lists", symIdentifiers);'>shorten_lists</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">p_short</span><span class="eqformalargs">=</span><span class="number">0.25</span><span class="keyword">)</span><span class="keyword">{</span> <span class="comment">#defaults to 25% of lists being short</span>
        <span class="comment"># a clever way to simulate short lists is to delete records from 'well-sampled' set by stratified random sampling</span>
        <span class="comment"># p_short defines the proportion of lists that should be short</span>
        <span class="comment"># If a single number then it's constant across years.</span>
        <span class="comment"># if numeric, this remains constant over time. If two numbers, the second number identifies the FINAL value</span>
        <span id="sym2021" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span> <span class="assignement">&lt;-</span> <a href="base/ifelse.html">ifelse</a><span class="keyword">(</span><a href="base/length.html">length</a><span class="keyword">(</span><span id="sym2022" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">)</span>==<span class="number">1</span><span class="keyword">,</span> <span class="number">0</span><span class="keyword">,</span> <a href="base/diff.html">diff</a><span class="keyword">(</span><a href="base/unlist.html">unlist</a><span class="keyword">(</span><span id="sym2023" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">/</span> <a href="base/max.html">max</a><span class="keyword">(</span><span id="sym2024" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym2025" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># which extra ones should be included in each year</span>

        <span class="comment">#df of all the visits (Site is redundant but worth retaining for clarity)</span>
        <span id="sym2026" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span>  <span class="assignement">&lt;-</span> <a href="NA/dcast.html">dcast</a><span class="keyword">(</span><span id="sym2027" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym2028" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <span id="sym2029" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">+</span> <span id="sym2030" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span> <span class="keyword">~</span><span id="sym2031" class="symbol" onmouseover='showVariable(".", symIdentifiers);' onmouseout='hideVariable(".", symIdentifiers);'>.</span><span class="keyword">,</span><span id="sym2032" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'Species'</span><span class="keyword">)</span> <span class="comment">#0.06 seconds</span>
        <span class="comment"># Change NA column name to something sensible</span>
        <a href="base/colnames.html">colnames</a><span class="keyword">(</span><span id="sym2033" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">)</span><span class="keyword">[</span><a href="base/is.na.html">is.na</a><span class="keyword">(</span><a href="base/colnames.html">colnames</a><span class="keyword">(</span><span id="sym2034" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">]</span> <span class="assignement">&lt;-</span> <span class="string">'LL'</span>
  <span id="sym2035" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2036" class="symbol" onmouseover='showVariable("visit_id", symIdentifiers);' onmouseout='hideVariable("visit_id", symIdentifiers);'>visit_id</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym2037" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">)</span> <span class="comment"># this is necessary to make x easy to understand</span>

        <span id="sym2038" class="symbol" onmouseover='showVariable("prop_short", symIdentifiers);' onmouseout='hideVariable("prop_short", symIdentifiers);'>prop_short</span> <span class="assignement">&lt;-</span> <span id="sym2039" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span> <span class="keyword">+</span> <span id="sym2040" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span> <span class="keyword">*</span> <span id="sym2041" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2042" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span>
        <span id="sym2043" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2044" class="symbol" onmouseover='showVariable("target_LL", symIdentifiers);' onmouseout='hideVariable("target_LL", symIdentifiers);'>target_LL</span> <span class="assignement">&lt;-</span> <a href="NA/targetLL.html">targetLL</a><span class="keyword">(</span><span id="sym2045" class="symbol" onmouseover='showVariable("prop_short", symIdentifiers);' onmouseout='hideVariable("prop_short", symIdentifiers);'>prop_short</span><span class="keyword">)</span>
        <span id="sym2046" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2047" class="symbol" onmouseover='showVariable("recs_to_remove", symIdentifiers);' onmouseout='hideVariable("recs_to_remove", symIdentifiers);'>recs_to_remove</span> <span class="assignement">&lt;-</span> <span id="sym2048" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2049" class="symbol" onmouseover='showVariable("LL", symIdentifiers);' onmouseout='hideVariable("LL", symIdentifiers);'>LL</span> <span class="keyword">-</span> <span id="sym2050" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2051" class="symbol" onmouseover='showVariable("target_LL", symIdentifiers);' onmouseout='hideVariable("target_LL", symIdentifiers);'>target_LL</span> <span class="comment"># 'NA' is the produced by dcast(): it's the list length for each visit</span>
        <span id="sym2052" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2053" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">,</span> <span class="argument">subset</span><span class="argument">=</span><span id="sym2054" class="symbol" onmouseover='showVariable("recs_to_remove", symIdentifiers);' onmouseout='hideVariable("recs_to_remove", symIdentifiers);'>recs_to_remove</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span> <span class="comment">#restrict uniq_vis to those where pruning is necessary</span>

        <span id="sym2055" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym2056" class="symbol" onmouseover='showVariable("record_id", symIdentifiers);' onmouseout='hideVariable("record_id", symIdentifiers);'>record_id</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym2057" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span>
        <span id="sym2058" class="symbol" onmouseover='showVariable("records_tmp", symIdentifiers);' onmouseout='hideVariable("records_tmp", symIdentifiers);'>records_tmp</span> <span class="assignement">&lt;-</span> <a href="base/merge.html">merge</a><span class="keyword">(</span><span id="sym2059" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym2060" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">,</span> <span class="argument">all</span><span class="argument">=</span><span id="sym2061" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">)</span> <span class="comment"># records in visits to be 'pruned'</span>

        <span class="comment">#~0.1 secs to here: the last bit is quite slow! (0.1-1.4 seconds, depending on nVisits &amp; p_short)</span>
        <span class="comment">#recs_to_omit &lt;- unlist(apply(uniq_vis[,c('visit_id','recs_to_remove')], 1, function(x) { #for each visit that has been selected</span>
        <span class="comment">#	recs &lt;- subset(records_tmp, visit_id==x[1])$record_id #the identities of all the records in selected visits</span>
        <span class="comment">#	sample(recs, size=x[2])</span>
        <span class="comment">#	})) #names(recs_to_omit) contains the visit number plus the number within the sample, ie. '23' is the 3rd visit to be sampled from the visit 2 </span>

        <span class="comment"># this version is much quicker, and *much* less dependent on p_short</span>
        <span class="comment">#recs_to_omit &lt;- sapply(1:3, function(i) unlist(with(subset(records_tmp, recs_to_remove==i), tapply(record_id, visit_id, sample, i))))</span>
        <span class="comment">#26 October: corrected error in version above!</span>

        <span id="sym2062" class="symbol" onmouseover='showVariable("recs_to_omit", symIdentifiers);' onmouseout='hideVariable("recs_to_omit", symIdentifiers);'>recs_to_omit</span> <span class="assignement">&lt;-</span> <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><a href="base/max.html">max</a><span class="keyword">(</span><span id="sym2063" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2064" class="symbol" onmouseover='showVariable("recs_to_remove", symIdentifiers);' onmouseout='hideVariable("recs_to_remove", symIdentifiers);'>recs_to_remove</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span> <a href="base/with.html">with</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2065" class="symbol" onmouseover='showVariable("records_tmp", symIdentifiers);' onmouseout='hideVariable("records_tmp", symIdentifiers);'>records_tmp</span><span class="keyword">,</span> <span id="sym2066" class="symbol" onmouseover='showVariable("recs_to_remove", symIdentifiers);' onmouseout='hideVariable("recs_to_remove", symIdentifiers);'>recs_to_remove</span>==<span id="sym2067" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym2068" class="symbol" onmouseover='showVariable("record_id", symIdentifiers);' onmouseout='hideVariable("record_id", symIdentifiers);'>record_id</span><span class="keyword">,</span> <span id="sym2069" class="symbol" onmouseover='showVariable("visit_id", symIdentifiers);' onmouseout='hideVariable("visit_id", symIdentifiers);'>visit_id</span><span class="keyword">,</span> <span id="sym2070" class="symbol" onmouseover='showVariable("resample", symIdentifiers);' onmouseout='hideVariable("resample", symIdentifiers);'>resample</span><span class="keyword">,</span> <span id="sym2071" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>

        <span class="comment"># so the pruned data look like this:</span>
        <span id="sym2072" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2073" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="keyword">!</span><span id="sym2074" class="symbol" onmouseover='showVariable("record_id", symIdentifiers);' onmouseout='hideVariable("record_id", symIdentifiers);'>record_id</span> <span class="keyword">%in%</span> <a href="base/unlist.html">unlist</a><span class="keyword">(</span><span id="sym2075" class="symbol" onmouseover='showVariable("recs_to_omit", symIdentifiers);' onmouseout='hideVariable("recs_to_omit", symIdentifiers);'>recs_to_omit</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">select</span><span class="argument">=</span><span class="keyword">-</span><a href="base/ncol.html">ncol</a><span class="keyword">(</span><span id="sym2076" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment"># added bug fix 'unlist' 25/10</span>
        <span class="comment">#return(records)</span>
        <span class="keyword">}</span>


<span id="sym2077" class="symbol" onmouseover='showVariable("subset_recs_by_X", symIdentifiers);' onmouseout='hideVariable("subset_recs_by_X", symIdentifiers);'>subset_recs_by_X</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">X</span><span class="keyword">,</span> <span class="formalargs">init</span><span class="eqformalargs">=</span><span class="number">0.5</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># a clever way to simulate increasing numbers of visits OR Sites over time is to take the well-recorded set and strip out the data based on a set of rules</span>
        <span class="comment"># X should be either the vector of sites or visit identities</span>
        <span class="comment"># init defines the number or proportion to be surveyed in year zero</span>
    <span class="comment"># The subset is made easy because the visits and sites are numbered sequentially</span>
    <span class="comment"># sort added 25/1/13 for safety!</span>
    <span class="comment"># modified 25/4/13 to account for the fact that nVisits now varies among years</span>

    <span class="comment"># first calculate the number of visits in the each year</span>
    <span id="sym2078" class="symbol" onmouseover='showVariable("nV", symIdentifiers);' onmouseout='hideVariable("nV", symIdentifiers);'>nV</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym2079" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym2080" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span><span class="keyword">,</span> <span id="sym2081" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym2082" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">#nV &lt;- with(records, tapply(Visit, Year, max)) # should be same as above, but larger by 1 in some years!</span>

    <span class="comment">#if(init &lt; 1) init &lt;- init * max_vis #max(records$Visit)</span>
    <span id="sym2083" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span> <span class="assignement">&lt;-</span> <span class="keyword">(</span><span class="number">1</span> <span class="keyword">-</span> <span id="sym2084" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="keyword">)</span> <span class="keyword">/</span> <a href="base/max.html">max</a><span class="keyword">(</span><span id="sym2085" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym2086" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span> <span class="comment"># additional proportion of visits to be included in each year</span>
    <span id="sym2087" class="symbol" onmouseover='showVariable("pV_include", symIdentifiers);' onmouseout='hideVariable("pV_include", symIdentifiers);'>pV_include</span> <span class="assignement">&lt;-</span> <span id="sym2088" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span> <span class="keyword">+</span> <a href="base/sort.html">sort</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym2089" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym2090" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">*</span> <span id="sym2091" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span>
    <span id="sym2092" class="symbol" onmouseover='showVariable("nV_include", symIdentifiers);' onmouseout='hideVariable("nV_include", symIdentifiers);'>nV_include</span> <span class="assignement">&lt;-</span> <a href="base/round.html">round</a><span class="keyword">(</span><span id="sym2093" class="symbol" onmouseover='showVariable("nV", symIdentifiers);' onmouseout='hideVariable("nV", symIdentifiers);'>nV</span> <span class="keyword">*</span> <span id="sym2094" class="symbol" onmouseover='showVariable("pV_include", symIdentifiers);' onmouseout='hideVariable("pV_include", symIdentifiers);'>pV_include</span><span class="keyword">)</span> <span class="comment"># vector of length nYear defining the number of records to include</span>

    <span id="sym2095" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span> <span class="assignement">&lt;-</span> <span id="sym2096" class="symbol" onmouseover='showVariable("X", symIdentifiers);' onmouseout='hideVariable("X", symIdentifiers);'>X</span> &lt;= <span id="sym2097" class="symbol" onmouseover='showVariable("nV_include", symIdentifiers);' onmouseout='hideVariable("nV_include", symIdentifiers);'>nV_include</span><span class="keyword">[</span><span id="sym2098" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym2099" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">]</span>
        <span class="comment">#table(records$Year, i) # looks sensible</span>
        <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym2100" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">[</span><span id="sym2101" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym2102" class="symbol" onmouseover='showVariable("subset_recs_Biased", symIdentifiers);' onmouseout='hideVariable("subset_recs_Biased", symIdentifiers);'>subset_recs_Biased</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">records</span><span class="keyword">,</span> <span class="formalargs">init</span><span class="eqformalargs">=</span><span class="number">0.5</span><span class="keyword">,</span> <span class="formalargs">bias</span><span class="eqformalargs">=</span><span class="number">2</span><span class="keyword">,</span> <span class="formalargs">target</span><span class="eqformalargs">=</span>NULL<span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># 25 January 2013</span>
    <span class="comment"># Modified version of subset_recs_by_X() in which sampling is biased in favour of sites where a target species is present</span>
    <span class="comment"># The parameter target is a vector of species presence-absence (either the focal or non-focal)</span>
    <span class="comment"># The default setting is for bias=2, indicating that sites with the target species are 2x likely to be visited</span>
    <span class="comment"># This parameter is the odds ratio for selecting sites where Target is present compared with where it's absent</span>
    <span class="comment"># this is actually over-engineered since the number of visits in the original (unsubsetted) records is fixed across years</span>
    <span class="comment"># 8/4/13: added a 'select' argument to the subset statement so that records have same strucutre as other Scenarios</span>
    <span class="comment"># modified 25/4/13 to account for the fact that nVisits now varies among years</span>

    <span class="comment"># first calculate the number of visits in the each year</span>
    <span id="sym2103" class="symbol" onmouseover='showVariable("nV", symIdentifiers);' onmouseout='hideVariable("nV", symIdentifiers);'>nV</span> <span class="assignement">&lt;-</span> <a href="base/with.html">with</a><span class="keyword">(</span><span id="sym2104" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <a href="base/tapply.html">tapply</a><span class="keyword">(</span><span id="sym2105" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span><span class="keyword">,</span> <span id="sym2106" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span id="sym2107" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">#nV &lt;- with(records, tapply(Visit, Year, max)) # should be same as above, but larger by 1 in some years!</span>

    <span class="comment">#if(init &lt; 1) init &lt;- init * max_vis #max(records$Visit)</span>
    <span id="sym2108" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span> <span class="assignement">&lt;-</span> <span class="keyword">(</span><span class="number">1</span> <span class="keyword">-</span> <span id="sym2109" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span><span class="keyword">)</span> <span class="keyword">/</span> <a href="base/max.html">max</a><span class="keyword">(</span><span id="sym2110" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym2111" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span> <span class="comment"># additional proportion of visits to be included in each year</span>
    <span id="sym2112" class="symbol" onmouseover='showVariable("pV_include", symIdentifiers);' onmouseout='hideVariable("pV_include", symIdentifiers);'>pV_include</span> <span class="assignement">&lt;-</span> <span id="sym2113" class="symbol" onmouseover='showVariable("init", symIdentifiers);' onmouseout='hideVariable("init", symIdentifiers);'>init</span> <span class="keyword">+</span> <a href="base/sort.html">sort</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym2114" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym2115" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">*</span> <span id="sym2116" class="symbol" onmouseover='showVariable("increment", symIdentifiers);' onmouseout='hideVariable("increment", symIdentifiers);'>increment</span>
    <span id="sym2117" class="symbol" onmouseover='showVariable("nV_include", symIdentifiers);' onmouseout='hideVariable("nV_include", symIdentifiers);'>nV_include</span> <span class="assignement">&lt;-</span> <a href="base/round.html">round</a><span class="keyword">(</span><span id="sym2118" class="symbol" onmouseover='showVariable("nV", symIdentifiers);' onmouseout='hideVariable("nV", symIdentifiers);'>nV</span> <span class="keyword">*</span> <span id="sym2119" class="symbol" onmouseover='showVariable("pV_include", symIdentifiers);' onmouseout='hideVariable("pV_include", symIdentifiers);'>pV_include</span><span class="keyword">)</span> <span class="comment"># vector of length nYear defining the number of records to include</span>

    <span class="comment">#df of all the visits</span>
    <span id="sym2120" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span>  <span class="assignement">&lt;-</span> <a href="NA/dcast.html">dcast</a><span class="keyword">(</span><span id="sym2121" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym2122" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span> <span class="keyword">+</span> <span id="sym2123" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">+</span> <span id="sym2124" class="symbol" onmouseover='showVariable("Visit", symIdentifiers);' onmouseout='hideVariable("Visit", symIdentifiers);'>Visit</span> <span class="keyword">~</span><span id="sym2125" class="symbol" onmouseover='showVariable(".", symIdentifiers);' onmouseout='hideVariable(".", symIdentifiers);'>.</span><span class="keyword">,</span><span id="sym2126" class="symbol" onmouseover='showVariable("length", symIdentifiers);' onmouseout='hideVariable("length", symIdentifiers);'>length</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'Species'</span><span class="keyword">)</span> <span class="comment">#0.06 seconds</span>
    <span class="comment"># the NA column is the List Length</span>
    <span id="sym2127" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2128" class="symbol" onmouseover='showVariable("visit_id", symIdentifiers);' onmouseout='hideVariable("visit_id", symIdentifiers);'>visit_id</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym2129" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">)</span> <span class="comment"># this is necessary to make x easy to understand</span>

    <span class="comment"># add the unique visit identity to records</span>
    <span id="sym2130" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span> <span class="assignement">&lt;-</span> <a href="base/merge.html">merge</a><span class="keyword">(</span><span id="sym2131" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym2132" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">,</span> <span class="argument">by</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'Site'</span><span class="keyword">,</span><span class="string">'Year'</span><span class="keyword">,</span><span class="string">'Visit'</span><span class="keyword">)</span><span class="keyword">)</span>

    <span class="comment"># now create a vector of length = nrow(uniq_vis) indicating whether the focal species is present</span>
    <span id="sym2133" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2134" class="symbol" onmouseover='showVariable("target", symIdentifiers);' onmouseout='hideVariable("target", symIdentifiers);'>target</span> <span class="assignement">&lt;-</span> <span id="sym2135" class="symbol" onmouseover='showVariable("target", symIdentifiers);' onmouseout='hideVariable("target", symIdentifiers);'>target</span><span class="keyword">[</span><a href="base/match.html">match</a><span class="keyword">(</span><span id="sym2136" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2137" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span><span class="keyword">,</span> <a href="base/as.numeric.html">as.numeric</a><span class="keyword">(</span><a href="base/gsub.html">gsub</a><span class="keyword">(</span><span class="string">'site'</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><a href="base/names.html">names</a><span class="keyword">(</span><span id="sym2138" class="symbol" onmouseover='showVariable("target", symIdentifiers);' onmouseout='hideVariable("target", symIdentifiers);'>target</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">]</span>

    <span class="comment"># convert these into probabilities of being sampled, using bias as the odds ratio</span>
    <span id="sym2139" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2140" class="symbol" onmouseover='showVariable("p_sel", symIdentifiers);' onmouseout='hideVariable("p_sel", symIdentifiers);'>p_sel</span> <span class="assignement">&lt;-</span> <a href="base/ifelse.html">ifelse</a><span class="keyword">(</span><span id="sym2141" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">$</span><span id="sym2142" class="symbol" onmouseover='showVariable("target", symIdentifiers);' onmouseout='hideVariable("target", symIdentifiers);'>target</span><span class="keyword">,</span> <span id="sym2143" class="symbol" onmouseover='showVariable("bias", symIdentifiers);' onmouseout='hideVariable("bias", symIdentifiers);'>bias</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">)</span>

    <span id="sym2144" class="symbol" onmouseover='showVariable("vis_to_include", symIdentifiers);' onmouseout='hideVariable("vis_to_include", symIdentifiers);'>vis_to_include</span> <span class="assignement">&lt;-</span> <a href="base/unlist.html">unlist</a><span class="keyword">(</span><a href="base/sapply.html">sapply</a><span class="keyword">(</span><a href="base/unique.html">unique</a><span class="keyword">(</span><span id="sym2145" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">$</span><span id="sym2146" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">,</span>
        <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span> <span class="keyword">{</span>
            <span id="sym2147" class="symbol" onmouseover='showVariable("vis_tmp", symIdentifiers);' onmouseout='hideVariable("vis_tmp", symIdentifiers);'>vis_tmp</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2148" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">,</span><span id="sym2149" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span>==<span id="sym2150" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span> <span class="comment"># the subset of visits for that year</span>
            <span class="comment"># this sometimes fails.</span>
            <span class="comment"># this can happen when the number of actual visits is less than expected</span>
            <span class="comment"># in year 10 we're sampling the expected number of visits from a vector that should be the same length (e.g. 250)</span>
            <span class="comment"># occasionally it's slightly shorter. Possible reasons: one visit had zero species.</span>
            <span class="comment"># solution: if statement to bypass</span>
            <span class="keyword">if</span><span class="keyword">(</span><a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym2151" class="symbol" onmouseover='showVariable("vis_tmp", symIdentifiers);' onmouseout='hideVariable("vis_tmp", symIdentifiers);'>vis_tmp</span><span class="keyword">)</span> &lt;= <span id="sym2152" class="symbol" onmouseover='showVariable("nV_include", symIdentifiers);' onmouseout='hideVariable("nV_include", symIdentifiers);'>nV_include</span><span class="keyword">[</span><span id="sym2153" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">)</span> <span id="sym2154" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <span id="sym2155" class="symbol" onmouseover='showVariable("vis_tmp", symIdentifiers);' onmouseout='hideVariable("vis_tmp", symIdentifiers);'>vis_tmp</span><span class="keyword">$</span><span id="sym2156" class="symbol" onmouseover='showVariable("visit_id", symIdentifiers);' onmouseout='hideVariable("visit_id", symIdentifiers);'>visit_id</span>
            <span class="keyword">else</span> <span class="keyword">{</span>
                <span id="sym2157" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span> <span class="assignement">&lt;-</span> <a href="base/try.html">try</a><span class="keyword">(</span><a href="base/sample.html">sample</a><span class="keyword">(</span><span id="sym2158" class="symbol" onmouseover='showVariable("vis_tmp", symIdentifiers);' onmouseout='hideVariable("vis_tmp", symIdentifiers);'>vis_tmp</span><span class="keyword">$</span><span id="sym2159" class="symbol" onmouseover='showVariable("visit_id", symIdentifiers);' onmouseout='hideVariable("visit_id", symIdentifiers);'>visit_id</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span id="sym2160" class="symbol" onmouseover='showVariable("nV_include", symIdentifiers);' onmouseout='hideVariable("nV_include", symIdentifiers);'>nV_include</span><span class="keyword">[</span><span id="sym2161" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">replace</span><span class="argument">=</span><span id="sym2162" class="symbol" onmouseover='showVariable("F", symIdentifiers);' onmouseout='hideVariable("F", symIdentifiers);'>F</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><span id="sym2163" class="symbol" onmouseover='showVariable("vis_tmp", symIdentifiers);' onmouseout='hideVariable("vis_tmp", symIdentifiers);'>vis_tmp</span><span class="keyword">$</span><span id="sym2164" class="symbol" onmouseover='showVariable("p_sel", symIdentifiers);' onmouseout='hideVariable("p_sel", symIdentifiers);'>p_sel</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">silent</span><span class="argument">=</span><span id="sym2165" class="symbol" onmouseover='showVariable("T", symIdentifiers);' onmouseout='hideVariable("T", symIdentifiers);'>T</span><span class="keyword">)</span>
                <span class="keyword">if</span><span class="keyword">(</span><a href="base/class.html">class</a><span class="keyword">(</span><span id="sym2166" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>==<span class="string">'try-error'</span><span class="keyword">)</span> <span class="keyword">{</span>
                    <span id="sym2167" class="symbol" onmouseover='showVariable("error_report", symIdentifiers);' onmouseout='hideVariable("error_report", symIdentifiers);'>error_report</span> <span class="assignement">&lt;-</span> <a href="base/list.html">list</a><span class="keyword">(</span><span class="argument">records</span><span class="argument">=</span><span id="sym2168" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span class="argument">uniq_vis</span><span class="argument">=</span><span id="sym2169" class="symbol" onmouseover='showVariable("uniq_vis", symIdentifiers);' onmouseout='hideVariable("uniq_vis", symIdentifiers);'>uniq_vis</span><span class="keyword">,</span> <span class="argument">include</span><span class="argument">=</span><span id="sym2170" class="symbol" onmouseover='showVariable("nV_include", symIdentifiers);' onmouseout='hideVariable("nV_include", symIdentifiers);'>nV_include</span><span class="keyword">,</span> <span class="argument">i</span><span class="argument">=</span><span id="sym2171" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">)</span>
                    <a href="base/save.html">save</a><span class="keyword">(</span><span id="sym2172" class="symbol" onmouseover='showVariable("error_report", symIdentifiers);' onmouseout='hideVariable("error_report", symIdentifiers);'>error_report</span><span class="keyword">,</span> <span class="argument">file</span><span class="argument">=</span><span class="string">'try_error.rData'</span><span class="keyword">)</span>
                <span class="keyword">}</span><span class="keyword">}</span>
            <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym2173" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span>
        <span class="keyword">}</span><span class="keyword">)</span><span class="keyword">)</span>

    <span id="sym2174" class="symbol" onmouseover='showVariable("recs_to_return", symIdentifiers);' onmouseout='hideVariable("recs_to_return", symIdentifiers);'>recs_to_return</span> <span class="assignement">&lt;-</span> <a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2175" class="symbol" onmouseover='showVariable("records", symIdentifiers);' onmouseout='hideVariable("records", symIdentifiers);'>records</span><span class="keyword">,</span> <span id="sym2176" class="symbol" onmouseover='showVariable("visit_id", symIdentifiers);' onmouseout='hideVariable("visit_id", symIdentifiers);'>visit_id</span> <span class="keyword">%in%</span> <span id="sym2177" class="symbol" onmouseover='showVariable("vis_to_include", symIdentifiers);' onmouseout='hideVariable("vis_to_include", symIdentifiers);'>vis_to_include</span><span class="keyword">,</span> <span class="argument">select</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="string">'Species'</span><span class="keyword">,</span><span class="string">'Visit'</span><span class="keyword">,</span><span class="string">'Site'</span><span class="keyword">,</span><span class="string">'Year'</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment"># check the output</span>
    <span class="comment">#with(uniq_vis, plot(tapply(target, Year, sum), ylim=c(0,max(Visit)), type='l', col='red')) # even across years</span>
    <span class="comment">#with(subset(uniq_vis, visit_id %in% vis_to_include), lines(tapply(target, Year, sum), ylim=c(0,max(Visit)))) # increasing over time</span>

    <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym2178" class="symbol" onmouseover='showVariable("recs_to_return", symIdentifiers);' onmouseout='hideVariable("recs_to_return", symIdentifiers);'>recs_to_return</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym2179" class="symbol" onmouseover='showVariable("summarize_recording", symIdentifiers);' onmouseout='hideVariable("summarize_recording", symIdentifiers);'>summarize_recording</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">simdata</span><span class="keyword">,</span> <span class="formalargs">nsp</span><span class="keyword">)</span><span class="keyword">{</span>
  <span class="comment">## Calculate the basic stats, each of the two time periods (split the years evenly)</span>
  <span class="comment"># get the number of nonfocal secies overall and in each visit</span>

    <span id="sym2180" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym2181" class="symbol" onmouseover='showVariable("nonfocal", symIdentifiers);' onmouseout='hideVariable("nonfocal", symIdentifiers);'>nonfocal</span> <span class="assignement">&lt;-</span> <span class="keyword">(</span><span id="sym2182" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym2183" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span> <span class="keyword">-</span> <span id="sym2184" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym2185" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">)</span><span class="keyword">/</span><span class="keyword">(</span><span id="sym2186" class="symbol" onmouseover='showVariable("nsp", symIdentifiers);' onmouseout='hideVariable("nsp", symIdentifiers);'>nsp</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">)</span> <span class="comment"># proportion of species per visit</span>
    <span id="sym2187" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span> <span class="assignement">&lt;-</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/range.html">range</a><span class="keyword">(</span><span id="sym2188" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym2189" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span>

  <span class="comment"># stats on the visit rate (number of sites visited per year, and multiple times per year)</span>
  <span id="sym2190" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span> <span class="assignement">&lt;-</span> <a href="NA/acast.html">acast</a><span class="keyword">(</span><span id="sym2191" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2192" class="symbol" onmouseover='showVariable("Site", symIdentifiers);' onmouseout='hideVariable("Site", symIdentifiers);'>Site</span> <span class="keyword">~</span> <span id="sym2193" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">,</span> <span class="argument">fun</span><span class="argument">=</span><span id="sym2194" class="symbol" onmouseover='showVariable("LenUniq", symIdentifiers);' onmouseout='hideVariable("LenUniq", symIdentifiers);'>LenUniq</span><span class="keyword">,</span> <span class="argument">value.var</span><span class="argument">=</span><span class="string">'Visit'</span><span class="keyword">)</span>
  <span id="sym2195" class="symbol" onmouseover='showVariable("summary_stats", symIdentifiers);' onmouseout='hideVariable("summary_stats", symIdentifiers);'>summary_stats</span> <span class="assignement">&lt;-</span> <a href="base/c.html">c</a><span class="keyword">(</span>
    <span class="argument">Recs_tot_visits</span> <span class="argument">=</span> <a href="base/nrow.html">nrow</a><span class="keyword">(</span><span id="sym2196" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">Recs_Sp_Yr</span> <span class="argument">=</span> <a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym2197" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym2198" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span><span class="keyword">/</span><span class="keyword">(</span><span id="sym2199" class="symbol" onmouseover='showVariable("nsp", symIdentifiers);' onmouseout='hideVariable("nsp", symIdentifiers);'>nsp</span> <span class="keyword">*</span> <a href="base/max.html">max</a><span class="keyword">(</span><span id="sym2200" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym2201" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="comment">#added 9/5/13</span>
    <span class="argument">Recs_total</span> <span class="argument">=</span> <a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym2202" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym2203" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">Recs_focal</span> <span class="argument">=</span> <a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym2204" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">$</span><span id="sym2205" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">VisPerYr_t1</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym2206" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">:</span><span id="sym2207" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span>
        <span class="comment">#mean(with(simdata, tapply(Visit, Year, LenUniq))[1:splityr]), # changed now that 'Visit' is not unique</span>
    <span class="argument">VisPerYr_t2</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym2208" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span><span class="keyword">)</span><span class="keyword">[</span><span class="keyword">-</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span id="sym2209" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span>
        <span class="comment">#mean(with(simdata, tapply(Visit, Year, LenUniq))[-c(1:splityr)]),</span>
    <span class="argument">focal_t1</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2210" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2211" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span>&lt;=<span id="sym2212" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym2213" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">focal_t2</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2214" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2215" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">&gt;</span><span id="sym2216" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym2217" class="symbol" onmouseover='showVariable("focal", symIdentifiers);' onmouseout='hideVariable("focal", symIdentifiers);'>focal</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">nonfocal_t1</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2218" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2219" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span>&lt;=<span id="sym2220" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym2221" class="symbol" onmouseover='showVariable("nonfocal", symIdentifiers);' onmouseout='hideVariable("nonfocal", symIdentifiers);'>nonfocal</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">nonfocal_t2</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2222" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2223" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">&gt;</span><span id="sym2224" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym2225" class="symbol" onmouseover='showVariable("nonfocal", symIdentifiers);' onmouseout='hideVariable("nonfocal", symIdentifiers);'>nonfocal</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">meanL_t1</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2226" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2227" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span>&lt;=<span id="sym2228" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym2229" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">meanL_t2</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2230" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2231" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">&gt;</span><span id="sym2232" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym2233" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">p_shortLists_t1</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2234" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2235" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span>&lt;=<span id="sym2236" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym2237" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span> &lt;= <span class="number">3</span><span class="keyword">)</span><span class="keyword">,</span> <span class="comment">#proportion of lists that are 'short' (i.e. less than 4)</span>
    <span class="argument">p_shortLists_t2</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/subset.html">subset</a><span class="keyword">(</span><span id="sym2238" class="symbol" onmouseover='showVariable("simdata", symIdentifiers);' onmouseout='hideVariable("simdata", symIdentifiers);'>simdata</span><span class="keyword">,</span> <span id="sym2239" class="symbol" onmouseover='showVariable("Year", symIdentifiers);' onmouseout='hideVariable("Year", symIdentifiers);'>Year</span><span class="keyword">&gt;</span><span id="sym2240" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">$</span><span id="sym2241" class="symbol" onmouseover='showVariable("L", symIdentifiers);' onmouseout='hideVariable("L", symIdentifiers);'>L</span> &lt;= <span class="number">3</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">MeanSitesVisited_t1</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym2242" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">:</span><span id="sym2243" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">MeanSitesVisited_t2</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym2244" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">[</span><span class="keyword">-</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span id="sym2245" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="comment">#MeanMultiVisitSites_t1 = mean(colSums(Site_visit_stats&gt;1)[1:splityr]),</span>
    <span class="comment">#MeanMultiVisitSites_t2 = mean(colSums(Site_visit_stats&gt;1)[-c(1:splityr)])</span>
    <span class="argument">PrSitesMultiVisit_t1</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><span class="keyword">(</span><a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym2246" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span><span class="keyword">&gt;</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">/</span><a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym2247" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">[</span><span class="number">1</span><span class="keyword">:</span><span id="sym2248" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span>
    <span class="argument">PrSitesMultiVisit_t2</span> <span class="argument">=</span> <a href="base/mean.html">mean</a><span class="keyword">(</span><span class="keyword">(</span><a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym2249" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span><span class="keyword">&gt;</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">/</span><a href="base/colSums.html">colSums</a><span class="keyword">(</span><span id="sym2250" class="symbol" onmouseover='showVariable("Site_visit_stats", symIdentifiers);' onmouseout='hideVariable("Site_visit_stats", symIdentifiers);'>Site_visit_stats</span><span class="keyword">&gt;</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">[</span><span class="keyword">-</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span id="sym2251" class="symbol" onmouseover='showVariable("splityr", symIdentifiers);' onmouseout='hideVariable("splityr", symIdentifiers);'>splityr</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">)</span>
    <span class="keyword">)</span>
  <a href="base/return.html">return</a><span class="keyword">(</span><span id="sym2252" class="symbol" onmouseover='showVariable("summary_stats", symIdentifiers);' onmouseout='hideVariable("summary_stats", symIdentifiers);'>summary_stats</span><span class="keyword">)</span>
<span class="keyword">}</span>


<span id="sym2253" class="symbol" onmouseover='showVariable("targetLL", symIdentifiers);' onmouseout='hideVariable("targetLL", symIdentifiers);'>targetLL</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">p_short</span><span class="keyword">,</span> <span class="formalargs">ratio</span><span class="eqformalargs">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">4</span><span class="keyword">,</span><span class="number">2</span><span class="keyword">,</span><span class="number">1.5</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">{</span>
        <span class="comment"># p_short defines the proportion of short lists </span>
        <span class="comment"># balance  defines how that proportion is split between lists of 1, 2 and 3 species long</span>
        <span class="comment"># so we draw a number for the number of target species, with NA representing all lists longer than 3</span>
        <span class="comment"># this version will return a vector</span>
    <span class="comment"># 3 December: I changed the 'balance' argument to reflect better the balance of real recording scheme data</span>
    <span id="sym2254" class="symbol" onmouseover='showVariable("balance", symIdentifiers);' onmouseout='hideVariable("balance", symIdentifiers);'>balance</span> <span class="assignement">&lt;-</span> <span id="sym2255" class="symbol" onmouseover='showVariable("ratio", symIdentifiers);' onmouseout='hideVariable("ratio", symIdentifiers);'>ratio</span><span class="keyword">/</span><a href="base/sum.html">sum</a><span class="keyword">(</span><span id="sym2256" class="symbol" onmouseover='showVariable("ratio", symIdentifiers);' onmouseout='hideVariable("ratio", symIdentifiers);'>ratio</span><span class="keyword">)</span>
        <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span id="sym2257" class="symbol" onmouseover='showVariable("p_short", symIdentifiers);' onmouseout='hideVariable("p_short", symIdentifiers);'>p_short</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">x</span><span class="keyword">)</span> <a href="base/sample.html">sample</a><span class="keyword">(</span><a href="base/c.html">c</a><span class="keyword">(</span><span class="number">1</span><span class="keyword">:</span><span class="number">3</span><span class="keyword">,</span><span class="number">NA</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">size</span><span class="argument">=</span><span class="number">1</span><span class="keyword">,</span> <span class="argument">prob</span><span class="argument">=</span><a href="base/c.html">c</a><span class="keyword">(</span><span id="sym2258" class="symbol" onmouseover='showVariable("balance", symIdentifiers);' onmouseout='hideVariable("balance", symIdentifiers);'>balance</span><span class="keyword">*</span><span id="sym2259" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">-</span><span id="sym2260" class="symbol" onmouseover='showVariable("x", symIdentifiers);' onmouseout='hideVariable("x", symIdentifiers);'>x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">}</span>


<span id="sym2261" class="symbol" onmouseover='showVariable("visit_site_Ntimes", symIdentifiers);' onmouseout='hideVariable("visit_site_Ntimes", symIdentifiers);'>visit_site_Ntimes</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">,</span> <span class="formalargs">times</span><span class="keyword">,</span> <span class="formalargs">true_data</span><span class="keyword">)</span><span class="keyword">{</span>
    <span class="comment"># 24 April: new wrapper for recording_visit</span>
    <a href="base/replicate.html">replicate</a><span class="keyword">(</span><span id="sym2262" class="symbol" onmouseover='showVariable("times", symIdentifiers);' onmouseout='hideVariable("times", symIdentifiers);'>times</span><span class="keyword">,</span> <a href="NA/recording_visit.html">recording_visit</a><span class="keyword">(</span><span id="sym2263" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">[</span><span id="sym2264" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">p_obs</span><span class="argument">=</span><a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym2265" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">,</span> <span class="string">"p_detect"</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">}</span>

<span id="sym2266" class="symbol" onmouseover='showVariable("visit_these_sites", symIdentifiers);' onmouseout='hideVariable("visit_these_sites", symIdentifiers);'>visit_these_sites</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">sites_visited</span><span class="keyword">,</span> <span class="formalargs">true_data</span><span class="keyword">)</span><span class="keyword">{</span>
        <span class="comment"># takes a vector of sites to be visited and the set of actual observations</span>
        <span class="comment"># 3 December: I added the 'pr' argument to allow different detection probabilities among species </span>
        <a href="base/sapply.html">sapply</a><span class="keyword">(</span><span id="sym2267" class="symbol" onmouseover='showVariable("sites_visited", symIdentifiers);' onmouseout='hideVariable("sites_visited", symIdentifiers);'>sites_visited</span><span class="keyword">,</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">i</span><span class="keyword">)</span> <a href="NA/recording_visit.html">recording_visit</a><span class="keyword">(</span><span id="sym2268" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">[</span><span id="sym2269" class="symbol" onmouseover='showVariable("i", symIdentifiers);' onmouseout='hideVariable("i", symIdentifiers);'>i</span><span class="keyword">,</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">p_obs</span><span class="argument">=</span><a href="base/attr.html">attr</a><span class="keyword">(</span><span id="sym2270" class="symbol" onmouseover='showVariable("true_data", symIdentifiers);' onmouseout='hideVariable("true_data", symIdentifiers);'>true_data</span><span class="keyword">,</span> <span class="string">"p_detect"</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">}</span>

<span class="comment">#end</span>
</pre>
</body>
</html>
